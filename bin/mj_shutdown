#!/usr/bin/perl -wT
BEGIN {
#  $::BINDIR = "/path/to/bin";
#  $::LIBDIR = "/path/to/lib";
#  $::LISTDIR= "/path/to/lists";
#  $::DEFDOM = "some.dom.ain";
  $::TMPDIR = "/tmp/mj";
#  $::WTMPDIR= "/tmp";
  $::UMASK  = "007";
  $::UID    = "baduid";
  $::GID    = "badgid";
#  $Exporter::Verbose = 1;
#  $AutoLoader::Verbose = 1;
#  $AutoLoader::Notruncate = 1;
  $SIG{__WARN__} = sub {print STDERR "--== $_[0]"};

  # Redirect standard error output.
#  if (! -t STDERR) {
#    open (STDERR, ">>$::TMPDIR/mj_enqueue.debug");
#  }

  # Croak if install was botched
  die("Not running as UID $::UID") unless $> == $::UID;
  die("Not running as GID $::GID") unless $) == $::GID;

}

use Socket;
use strict;
my (%opts, $dom, $i, $line, $ok, $pid, $rendezvous, $q1, $q2, $q3, $qdir,
    $qfile, $qfunc);

umask oct($::UMASK);
$ENV{PATH} = '';

$rendezvous = "$::TMPDIR/mj_queueserv.sock";
unless (socket(SOCK, PF_UNIX, SOCK_STREAM, 0)) {
  print "Couldn't create socket: $!";
  exit 0;
}

if ($ok = connect(SOCK, sockaddr_un($rendezvous))) {
  # Connected to the server; 
  print SOCK "quit\n";
  print "Asked server to shut down.\n";
}
else {
  print "Can't connect to server; perhaps it isn't running.\n";
}

exit;

=head1 NAME

mj_shutdown - Ask a running queue server to exit.

=head1 SYNOPSIS

B<mj_shutdown>

=head1 DESCRIPTION

This asks a running mj_queueserv processes to exit.  The process is not
killed and any currently executing queue servers are allowed to finish.
(They will notice that the server has gone away when they request more
work.)

=head1 COPYRIGHT

Copyright (c) 1999 Jason Tibbitts for The Majordomo Development
Group.  All rights reserved.

This program is free software; you can redistribute it and/or modify it
under the terms of the license detailed in the LICENSE file of the
Majordomo2 distribution.

his program is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR PURPOSE.  See the Majordomo2 LICENSE file for more
detailed information.

=cut

#
### Local Variables: ***
### mode:cperl ***
### cperl-indent-level:2 ***
### End: ***
