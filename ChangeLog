2001-07-15  Jason Tibbitts  <tibbs@math.uh.edu>

	* bin/mj_email (parse_commands): Fix typo.

	* bin/mj_queuerun (parse_commands): Unpack additional key=value
	items from the queue filename and pass them as part of the request
	structure.  Allow the command part of the queue filename to
	contain a command-mode instead of just a mode.  Split and pass
	this in the request structure.

	* bin/mj_enqueue: Switch to Getopts::Long.  Accept a hash-type
	argument --req which specifies additional items to be included in
	the queue filename.

	* bin/mj_email: Switch to Getopts::Long.  Accept a hash-type
	argument --req which specifies additional elements for the request
	structure.  Allow the -c option to specify a command-mode instead
	of just a command.

2001-07-14  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Use an empty list name by default instead of
	the GLOBAL list.  Suggested by Roger Klorese.

	* lib/Majordomo.pm:  (accept)  When a posted message is
	approved with the accept-archive command, log it as a "post"
	instead of a "consult".
	(configset)  Give an error immediately if the setting name
	is not supplied.  Thanks to Roger Klorese.

	* lib/Mj/List.pm:  (bounce_gen_stats)  Add missing dereference.

	* lib/Mj/Resend.pm, lib/Mj/Util.pm:  Allow the "concat" and
	"regcreset" actions in Safe compartments for greater flexibility
	in regular expressions.  Thanks to Paul Hancock.
	
2001-07-12  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Config.pm (parse_access_rules, parse_bounce_rules,
        _compile_rule): Slightly better error messages.

	* lib/Mj/BounceHandler.pm (handle_bounce_user): Pass the
	'diagnostic' variable to the rules parser.

	* lib/Mj/CommandProps.pm: Add 'diagnostic' as a legal bounce_rules
	variable.

2001-07-09  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (get_all_lists)  Bugfix:  Use the first return
	value to determine if access is permitted.  Thanks to David
	Roodman.

	* lib/Mj/MTAConfig.pm:  (add_alias)  Correct the VUT entries
	for -(un)subscribe addresses.  Thanks to Roger Klorese.

	* setup/newdomain.pl:  Bugfix:  Consider $config a global
	variable.  Thanks to Roger Klorese.

2001-07-04  Michael Yount <csf@moscow.com>

	* lib/Mj/Format.pm:  (lists)  Use an empty string instead
	of a question mark in variable expansions to avoid incorrect
        URLs.  Thanks to Gavin Walker.

2001-06-23  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/BounceHandler.pm (handle_bounce_user): Add addr,
	fulladdr, and host variables to bounce_rules.

	* lib/Mj/CommandProps.pm: ditto.
	
2001-06-23  Michael Yount <csf@moscow.com>

	* lib/Mj/Config.pm:  (regen)  Bugfix:  Do not parse 
	addresses in DEFAULT configuration files.

2001-06-22  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_make_list)  Bugfix:  Use the "_install"
	template instead of the GLOBAL defaults to initialize 
	mailing lists.

2001-06-22  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Util.pm (n_defaults): The default file for a bounce probe
	is "bounceprobe".

	* lib/Mj/Token.pm (confirm): Set token type to 'probe' as
	appropriate.  Set envelope extention properly for probe tokens.

	* lib/Majordomo.pm (_put): Preliminary: allow put-delete.
	(_list_file_get): Search per-language default files before
	searching non-language-specific default files.

2001-06-20  Michael Yount <csf@moscow.com>

	* bin/mj_shell:  Note that the -D option causes the debugging
	output to be sent to stderr, not stdout.  Thanks to Paul
	Hancock.

	* lib/Majordomo.pm:  (_list_sync_owners)  Bugfix:  Use the
	correct address when the GLOBAL:owners auxiliary list is
	changed.

	* lib/Mj/Archive.pm:  (_expand_message_range) Bugfix: 
	Initialize the archive name and number correctly.
	(remove) Bugfix:  Always look up the data for each message.
	Thanks to SRE.

	* lib/Mj/Config.pm:  (load)  Bugfix:  Use the GLOBAL 
	installation defaults with the DEFAULT list.
	(regen, set) Bugfix:  Do not parse addresses for the DEFAULT list.
	(isparsed)  Move the DEFAULT/address exception to the
	regen and set routines.  Thanks to Paul Hancock.

	* lib/Mj/Format.pm:  (configshow)  Bugfix:  check for
	equivalence when comparing enumerated values.  Thanks to Duncan
	Hill.
	(lists) Bugfix:  Initialize "legend" variable for the
	lists-enhanced command.  Thanks to Paul Hancock.

2001-06-15  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/CommandProps.pm: Add consecutive_days as a legal variable
	for bounce_rules.

2001-06-14  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/List.pm (bounce_gen_stats): Calculate consecutive_days
	statistic.

	* lib/Mj/BounceHandler.pm (handle_bounce_probe): New function:
	deal with bouncing bounce probes.
	(handle_bounce): Deal with bounces of type 'P' by calling
	handle_bounce_probe.
	(_hbr_probe): New function: send a bounce probe.
	(handle_bounce_user): Add failure variable.

2001-06-13  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/BounceHandler.pm (_hbr_noprobe): Accept 'reason' argument
	so the caller can supply its own removal reason.

	* lib/Mj/BounceParser.pm (parse): Allow type 'P' envelopes (for
	bounce probes) as well.

2001-06-05  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* bin/mj_shell: Don't rely on $ENV{LOGNAME}; use getpwuid($<)
        instead.

2001-06-05  Michael Yount <csf@moscow.com>

	* lib/Mj/Config.pm:  Do not parse the config_array data.
	Thanks to Paul Hancock.

2001-06-04  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm: (configshow) Bugfix:  allow the append,
	declared, and merge modes to work with the nocomments mode.
	(_show)  Allow the password to be displayed.

	* lib/Mj/Archive.pm: (expand_date)  Bugfix:  verify that the
	date is defined before making comparisons.

	* lib/Mj/Config.pm: (load)  Bugfix:  use an array instead of a
	scalar to hold the list of configuration templates.  Thanks to
	Paul Hancock.

	* lib/Mj/List.pm: (describe_class)  Bugfix:  return the setting
	name instead of the setting description if requested (the
	who-export command was displaying "no messages" instead of
	"nomail".)

	* lib/Mj/Resend.pm: (_post)  Bugfix:  allow multi-line subject
	and date headers when untainting.  Use the body length instead
	of a checksum to determine if the uniqueness test should be
	skipped.
	(_munge_subject)  Bugfix:  preserve a multi-line subject when
	"Re:"s are being stripped.

	* lib/Mj/SimpleDB/Base.pm:  (_stringify)  Bugfix:  convert
	returns and newlines to spaces.

	* lib/Mj/Util.pm:  (re_match)  Bugfix:  allow "concat" and 
	"regcreset" operations in the safe compartment.

2001-05-11  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Majordomo.pm (_list_file_get): DEFAULT:$LANG should be
	searched before DEFAULT.

	* lib/Mj/BounceParser.pm (parse_exchange, parse_msn): Fix undef
	warning due to nonexistent subject.

2001-05-08  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/BounceHandler.pm (_hbr_consult): Make sure that the
	bounce data does not indicate that the owners have already been
	consulted.  If not, consult as normal and add a type 'C' bounce
	event.

	* lib/Mj/Token.pm (confirm): Return the token ID which was
	generated.

	* lib/Mj/List.pm (bounce_add): Add 'P' and 'C' events at the head
	of the list.  Change argument names to reflect that the function
	takes bounce event data, not just info on bounced messages.
	(expire_bounce_data): Don't count 'C' or 'P' events.

2001-05-07  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Util.pm (n_defaults): The default for 'attach' should
	only be '1' for posts; take a 'command' argument to determine
	this.

2001-05-06  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Token.pm (confirm): Rework how attach works, so actions
	other than post can have attachments and so that so that the
	attachment parameters can be specified.

	* lib/Mj/BounceParser.pm (parse_exim): Tweak.

	* lib/Mj/BounceHandler.pm: Lay groundwork for consulted and probed
	removals.

	* lib/Mj/CommandProps.pm: Add 'notify' as a legal action for
	_bounce.

	* lib/Mj/Config.pm (parse_bounce_rules): Add notify processing.

2001-05-03  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/CommandProps.pm: nonempty_lines is a legal access
        variable.

	* lib/Mj/Resend.pm (_r_ck_body): Count lines containing something
        other than whitespace in the "nonempty_lines" variable.

2001-04-17  Michael Yount <csf@moscow.com>

	* lib/Mj/Token.pm:  (t_accept)  Bugfix:  do not chain
	the expiration data.

2001-04-13  Michael Yount <csf@moscow.com>

	* lib/Mj/Access.pm:  (list_access_check)  Bugfix:  ensure
	that address-related access variables are initialized.
	(Thanks to Peter Ajamian)

2001-04-11  Michael Yount <csf@moscow.com>

	* lib/Mj/FileSpace.pm:  (put_chunk, put_done)  Bugfix:
	do not use object methods with the file handle.

2001-04-10  Michael Yount <csf@moscow.com>

	* convertlist.pl:  Do not remove hyphen escapes from here
	documents in Mj1 configuration files.

2001-04-09  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Bugfix:  Do not include the password
	in the CGIDATA expansion until it has been converted
	into a temporary password.

2001-04-07  Michael Yount <csf@moscow.com>

	* convertlist.pl:  Bugfix:  Do not convert the "filedir"
	configuration setting.
	Bugfix:  Do not add subscribers to a new list if the 
	subscriber file is empty or absent.
	Bugfix:  Use the subscribe command, not the auxadd command,
	to add addresses to an auxiliary list.

	* lib/Majordomo.pm:  (dispatch)  Bugfix:  Test the validity
	of each victim's address individually, allowing partial
	success if some of the addresses are valid.
	(archive_start)  Feature:  Allow the use of patterns within
	a here document to narrow the scope of the messages retrieved
	by the archive command.  Patterns beginning with "~a" will
	be matched against the authors' e-mail addresses.  Patterns
	beginning with "~s" will be matched against the message
	subjects.  (Thanks to Scott Garee, Paul Hancock, and Duncan
	Hill)
	The version number is now 0.1200104070.

	* lib/Mj/Archive.pm:  (expand_range)  Bugfix:  Remove redundant
	"\d" from a regular expression.

	* lib/Mj/CommandProps.pm:  Bugfix: Use "mismatch" by default
	for the lists command to prevent leaking private information
	with the lists-enhanced command.
	Bugfix:  Do not require strict address validation for the 
	unsubscribe and unregister commands.  (Thanks to Duncan Hill)
	Bugfix:  Use long names for bounce rule variable types.

	* lib/Mj/Format.pm:  (help, lists)  Bugfix:  Remove unnecessary
	"select" statements. (Thanks to Duncan Hill)
	(post)  Bugfix:  Use the "post_chunk" command only if necessary.

	* lib/Mj/Token.pm:  (t_accept)  Bugfix:  When testing the 
	command name, account for the "_" prefix.

	* t/core.t:  Use a valid but fictitious requester address 
	to avoid stalled commands.

2001-03-25  Michael Yount <csf@moscow.com>

	* bin/mj_shell: (parse_interactive)  Bugfix:  allow continuation
	lines and a here document in the same command.

	* lib/Majordomo.pm: (dispatch)  Bugfix:  reset the timer after 
	inform() is called to log the correct elapsed time for multiple
	commands.
	(who_chunk)  Bugfix:  allow the alias and common command modes
	to work together.

	* lib/mj_cf_data.pl, mj_cf_defs.pl:  Support the new config_defaults
	configuration setting.

	* lib/Mj/Archive.pm:  (expand_range) Bugfix:  support the time
	span format with full names (e.g., "months" instead of "m").

	* lib/Mj/Config.pm:  (load, parse_config_array)  Add support
	for configuration templates through the config_defaults setting.
	This setting has higher priority than the DEFAULT list, but
	lower priority than a list's main configuration settings.
	All templates must be stored under the DEFAULT list.
	(parse_limits) Bugfix:  support the time span format with
	full names.

	* lib/Mj/Format.pm:  (who) Include "noinform" in the commands
	displayed by the who-export command.

	* lib/Mj/Parser.pm:  (parse_line) Bugfix:  trim backslashes after
	removing leading and trailing white space.
	(parse_args)  Remove trailing white space from the arguments.

	* lib/Mj/Util.pm:  (str_to_time)  Add support for "mi"
	abbreviation for minutes.

2001-03-24  Jason Tibbitts  <tibbs@math.uh.edu>

	* bin/mj_shell (parse_command): Look for both /usr/bin/more and
	/bin/more.

2001-03-20  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* bin/mj_queuerun (call_format): New function to load the
        Mj::Format library and call the formatter.

2001-03-13  Michael Yount <csf@moscow.com>

	* lib/Mj/Util.pm:  (n_validate)  Bugfix:  Convert "remind"
	variable time spans from a string into a number of seconds.
	(str_to_time)  Support the "s" abbreviation for seconds.

2001-03-11  Michael Yount <csf@moscow.com>

	* README.LINUX:  Describe a workaround for a MakeMaker module
	bug in some versions of linux.

	* lib/Mj/Format.pm:  (g_get)  Bugfix:  Changing the request hash
	for sessioninfo commands prevented mj_wwwadm from executing more
	than one tokeninfo command.

	* lib/Mj/Token.pm:  (confirm)  Bugfix:  Testing the 'ackstall'
	flag could in some cases cause CONSULT notices not to be mailed.

2001-03-09  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  Version number is now 0.1200103090.
	(common_subs, et al.) Declare undeclared variables.
	(list_config_set_to_default) Bugfix:  correct the list variable name
	for the unknown_setting error.
	(report_start, _report) Bugfix: join and split values using \002
	in double, not single, quotes.
	(_showtokens) Add support for the alias token type, which is a way 
	to assign more than one token identifier to the same request.

	* lib/Mj/Access.pm:  (list_access_check)  Add support for the chain
	access variable, which determines whether confirmation notices are
	sent consecutively or simultaneously;  the expire variable, which
	determines the lifetime of a token; and the notify action, which
	changes the attributes of a token.
	(_a_conf_cons, et al.)  Adapt to use data from "notify" actions.
	(_a_replyfile)  Use a local symbol instead of a global filehandle
	for reading the reply file.

	* lib/Mj/Archive.pm:  (sync) Declare undeclared variable.
	(get_to_file)  Add file handle error checks.

	* lib/Mj/BounceHandler.pm:  (handle_bounce_token) Call
	Mj::Token::t_reject instead of t_remove, to account for potential
	alias tokens.

	* lib/Mj/BounceParser.pm:  (parse_dsn)  Cope with missing
	delivery-status parts.

	* lib/Mj/CommandProps.pm:  Add support for the "notify" action
	in the access rules.  Give access variables type names instead
	of type numbers.  Make the "mkdigest" command an alias for the
	digest command.  Add support for the showtokens-alias command.

	* lib/Mj/Config.pm:  (parse_access_rules)  Add support for the
	notify action, including validation of the variables names.

	* lib/Mj/Format.pm:  (archive, et al.)  Declare undeclared 
	variables.

	* lib/Mj/List.pm:  (default_class, et al.)  Declare undeclared
	variables.

	* lib/Mj/MIMEParser.pm:  (_r_ct_lines)  Declare undeclared
	variables.

	* lib/Mj/Resend.pm:  (post) Include CMDLINE substitution in
	stall/denial acknowledgment messages.
	(_post)  Bugfix:  Use the correct content data in delivery
	acknowledgment messages.
	(_check_poster)  Add a message to the list of reasons if the
	postblock flag is set.

	* lib/Mj/Token.pm:  (consult, delay)  Removed.  The code for
	these two methods has been merged into the confirm method.
	(get_moderators)  Obtain a list of moderator addresses, given
	a mailing list name, moderator group, and pool size.
	(confirm, t_accept)  Adapt to use "notify" hash refs to determine
	the attributes of a token.  The "chain" fields of the token data
	are now used to store packed representations of the "notify"
	data, allowing up to five approval steps to be required.

	* lib/Mj/Util.pm:  (condense, n_build, n_defaults, n_validate,
	reconstitute)  These new routines are used to construct,
	validate, pack, and unpack "notify" hash refs.
	(process_rule)  Add support for the "notify" action.

	* lib/Mj/Deliver/Dest.pm:  (sendenvelope) Declare undeclared
	variable.

	* setup/ask_basic.pl:  (ask_basic) Comment out pgsql question.

	* setup/setup_func.pl:  (mta_setup) Bugfix:  change ownership 
	of the mj-domains file after it is created.  Suggested by 
	David Miller.

2001-03-02  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/BounceParser.pm (parse_exim): Adapt to new exim bounce
        format: X-Failed-Recipients: may have more than one address.
        Addresses in body may or may not be followed by a colon.

2001-03-02  Michael Yount <csf@moscow.com>

	* lib/Mj/Resend.pm:  (_munge_subject)  Bugfix:  Add missing library
	requirement.

	* lib/Mj/Token.pm:  (t_accept)  Bugfix:  Create an Mj::Addr object
	before testing whether or not to send an acknowledgment to that 
	address.

2001-03-01  Michael Yount <csf@moscow.com>

	* bin/mj_shell:  Bugfix:  allow command completion to work again.
	Store multi-line commands as one history entry.
	Indicate the Term::ReadLine library in use on startup.
	Refer people to the new command_line help file.
	Allow multi-line commands in interactive mode when the first
	line ends in a backslash.

	* lib/Majordomo.pm:  (domains)  Use a local symbol for the file
	handle.
	(substitute_vars_format)  Add support for displaying help files
	in a separate web browser window.
	(config_get_mutable, config_get_visible)  Bugfix:  do not always
	use the GLOBAL context to determine if a setting is visible or
	mutable.
	(report, _report)  Change the semantics of the report command:
	allow here documents, and expect to find the date criteria
	before the action criteria.
	
	* lib/mj_cf_data.pl, lib/mj_cf_defs.pl:  Add support for the
	GLOBAL www_help_window setting, which will cause help links in
	the www interfaces to display the help files in a separate window.
	Requested by David Miller.

	* lib/Mj/CommandProps.pm:  Support the changes to the report command.

	* lib/Mj/Config.pm:  (parse_access_array)  Bugfix:  return the
	correct data.
	(parse_inform)  Verify the names of the events that are being
	monitored.

	* lib/Mj/FileSpace.pm:  (put)  Only use File::Copy if needed.

	* lib/Mj/Format.pm:  (configshow)  Add a HELPLINK substitution
	to allow help documents for the settings to be viewed in a 
	separate web browser window.
	(help)  Add support for the GLOBAL www_help_window setting, which
	allows help documents to be viewed in a separate browser window.

	* lib/Mj/SimpleDB/Base.pm:  (_stringify)  Convert ^A characters
	to spaces in individual fields as they are added to the string.

	* lib/Mj/Token.pm:  (t_accept)  Bugfix:  determine whether or
	not the request would cause an acknowledgement to be sent.

2001-02-27  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Resend.pm (_munge_subject): Bugfix: don't delete subjects
        not matching $re_regexp.

2001-02-25  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Resend.pm (_munge_subject): Make use of
        subject_re_pattern and subject_re_strip settings.  Put the prefix
        after any existing Re: part.

	* lib/Mj/Util.pm (re_match): Accept a third argument and return
        the match array if present.

	* lib/mj_cf_data.pl: Add subject_re_pattern and subject_re_strip
        variables.

2001-02-24  Michael Yount <csf@moscow.com>

	* Makefile.PL:  Depend upon Socket instead of IO::Socket.
	Suggest reading the admin_domain help file with the new -P
	option to mj_shell.

	* bin/mj_confirm:  Add explanation box, as requested by 
	David Miller.

	* bin/mj_email, bin/mj_queuerun:  Use Symbol instead of IO::File. 
	Do not mail a reply if the request came from the server address.

	* bin/mj_queueserv:  Use Symbol instead of IO::File.  Add a
	routine to autoflush file handles.

	* bin/mj_shell:  Add "-P" option to show the output of commands
	in a pager.  The "default display" command can be used to show
	the output of any command in a pager or editor.  If an editor
	is used, mj_shell will attempt to execute commands from the file
	after the editing is completed.

	* bin/mj_wwwadm:  Increase the time before cache expiration to
	50 seconds.

	* lib/Majordomo.pm:  Version number is now 0.1200102240.
	Use Symbol instead of IO::File.
	(connect)  Reuse session files for logging if a temporary password
	is supplied.
	(_site_config_get, _global_config_get, _make_list) Move ubiquitous 
	methods above the autoload line.
	(_re_match) Move this routine to Mj::Util::re_match.
	(_get_stock) Use the FileSpace module instead of loading INDEX.pl.
	(_createlist) Include the new priority configuration setting
	when aliases are created.
	(_showtokens) Support the new "async" mode, which displays
	asynchronous tokens.  These tokens are created when a posted
	message is accepted, then delivered in the background.
	
	* lib/mj_cf_defs.pl, mj_cf_data.pl:  Support the archive_date
	and priority configuration settings.

	* lib/Bf/Sender.pm:  (open_abbrev_database)  Commented out.

	* lib/Mj/Access.pm:  (list_access_check)  Comment out
	Data::Dumper dependency.
	(_a_forward)  Use MIME::Entity::build instead of MIME::Entity::new.
	Use Symbol instead of IO::File.
	(_a_replyfile)  Remove Mj::File dependency.
	(_d_advertise)  Use Mj::Util::re_match.

	* lib/Mj/Addr.pm:  (_xform)  Only use the Safe module if needed.

	* lib/Mj/Archive.pm:  Only use the Mj::File module if needed.

	* lib/Mj/BounceHandler.pm:  (handle_bounce)  Use Symbol instead
	of IO::File.
	(handle_bounce_removal)  Call inform() to log the removal.
	(_gen_bounce_message)  Allow the possibility of multiple actions.

	* lib/Mj/CommandProps.pm:  Remove access_vars_desc_en hash.
	Support the "async" mode for the showtokens command.

	* lib/Mj/Config.pm:  (_load_new, _load_dfl)  Use Mj::Lock
	instead of Mj::File.
	(_save_new, unlock)  Use Data::Dumper only if necessary.
	(compile_pattern)  Use Mj::Util::re_match.

	* lib/Mj/Deliver.pm:  (deliver, setup)  Use Mj::Util::re_match.
	Pass the local host name (from the whereami GLOBAL setting)
	down to the other delivery modules.

	* lib/Mj/Digest.pm:  (_open_state) Use Mj::FileRepl explicitly.

	* lib/Mj/File.pm:  (search)  Use Mj::Util::re_match.

	* lib/Mj/FileRepl.pm:  (search_copy)  Use Mj::Util::re_match.

	* lib/Mj/FileSpace.pm:  Use Symbol instead of IO::File.

	* lib/Mj/Format.pm:  (lists)  Display the error if one occurs.
	Noticed by David Miller.

	* lib/Mj/Inform.pm:  Use Mj::Lock and Symbol instead of Mj::File.

	* lib/Mj/List.pm:  (_fill_config, _fill_aux)  Use Symbol instead
	of IO::Handle.

	* lib/Mj/Lock.pm:  Use Symbol instead of IO::Handle.

	* lib/Mj/Log.pm:  Use Symbol instead of IO::Handle.  Only load
	Sys::Syslog if necessary.

	* lib/Mj/MTAConfig.pm:  (add_alias)  Include the priorities
	from the priority configuration setting if queue_mode is
	enabled.

	* lib/Mj/MailOut.pm:  (mail_message, deliver, probe)  Pass
	the host name from the whereami configuration setting to
	the delivery modules for use in the EHLO/HELO SMTP commands.
	This avoids having to load Net::Domain to determine the local
	host name.
	(owner_start, owner_chunk, owner_done)  Use Symbol instead
	of IO::File.

	* lib/Mj/Parser.pm:  Load modules only as needed.
	(parse_part)  Use Mj::Util::re_match.

	* lib/Mj/Resend.pm:  (post) Store the arrival time in the
	access variables hash.
	(_post)  Add a random string to the temporary file names.
	Use the archive_date configuration setting to determine which
	date should be used to archive a message:  time of arrival,
	or time of delivery.
	(_check_poster, _r_ck_body)  Use Mj::Util::re_match.
	
	* lib/Mj/SimpleDB.pm:  Remove unneeded dependencies.

	* lib/Mj/Token.pm:  (t_accept) Allow asynchronous delivery
	of posted messages using an "async" token.  A message
	containing an accept command is mailed to the server, which
	then performs the actual delivery.

	* lib/Mj/Util.pm:  (re_match)  Rename Majordomo::_re_match().

	* lib/Mj/Deliver/Connection.pm:  Use Socket instead of IO::Socket.

	* lib/Mj/Deliver/Dest.pm:  (new)  Include the local host name.
	(flush)  Use Symbol instead of IO::File.

	* lib/Mj/Deliver/Envelope.pm:  Use Symbol instead of IO::File.

	* lib/Mj/Deliver/Prober.pm:  (new) Include the local host name.

	* lib/Mj/Deliver/SMTP.pm: (new)  Only use Net::Domain if a
	local host name was not supplied.

	* lib/Mj/Deliver/Sorter.pm:  (new) Include the local host name.

	* lib/Mj/SimpleDB/Base.pm:  Remove unneeded dependencies.

	* lib/Mj/SimpleDB/DB.pm:  Use Mj::Util::re_match.

	* lib/Mj/SimpleDB/Text.pm:  Use Mj::Util::re_match.  Remove
	IO::File dependency.

	* setup/config_commands:  Add a template, DEFAULT:rfc2369,
	to support the addition of RFC 2369 message headers, such
	as List-Post and List-Subscribe.

2001-02-16  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (connect) Use SHA-1 hex digest for session
	identifiers.
	(_lists)  Add back end to allow the lists command to stall.
	Change version number to 0.1200102160.

	* lib/Mj/Access.pm:  (validate_passwd)  Compare SHA-1 digests
	instead of clear text passwords.

	* lib/Mj/Config.pm:  (parse_passwords, parse_pw)  Convert clear
	text admin passwords to SHA-1 digests.

	* lib/Mj/Token.pm:  (validate_latchkey)  Removed.

	* lib/Mj/Util.pm:  (ep_convert, ep_recognize)  New routines to
	convert a clear text password to an SHA-1 digest, and to recognize
	an SHA-1 base 64 digest.

2001-02-14  Michael Yount <csf@moscow.com>

	* bin/mj_confirm, mj_wwwadm, mj_wwwusr:  Improve domain checking.
	Check the URL path, CGI parameters, and HTTP_HOST, in that order.
	Add "Expires" header (set to 10 seconds in the future) to avoid
	caching.  Thanks to Peter Ajamian and David Miller for the 
	suggestions.  Fix set command bug in mj_wwwusr.  Add a "Sign Out"
	button to mj_wwwadm and mj_wwwusr, which invalidates the 
	temporary password.

	* lib/Majordomo.pm:  Change version number to 0.1200102140.
	(dispatch) Improve mode validation: no modes over 11 characters
	in length are allowed.
	(legal_list_name)  Make this routine a function instead of an
	object method.

	* lib/Mj/Token.pm: (del_latchkey)  New routine.  Remove a 
	latchkey from the temporary password database.

2001-02-13  Michael Yount <csf@moscow.com>

	* files/en/help/admin*:  Revise and expand the introductory
	documents for list owners.

2001-02-11  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm: (_set) Return an error if a pattern was
	used and no matches were found.

	* lib/Mj/Access.pm: (_d_advertise) Revise the order of assessment
	for compatibility with Mj1.  The noadvertise patterns take
	precedence over the advertise patterns.

	* lib/Mj/Config.pm: (parse_inform) Move inform setting defaults
	out of the code and into the default configuration file.

2001-02-05  Michael Yount <csf@moscow.com>

	* lib/Mj/Access.pm: (list_access_check) Minor cleanup. 
	(_gen_pw)  Moved to Mj::Util::gen_pw.

	* lib/Mj/CommandProps.pm:  Add "nopass" command property
	to the help and lists commands.
	
2001-02-04  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Format.pm (who): Use nowelcome for who-export GLOBAL.

	* setup/setup_func.pl (tempfile): New function copied from
	mj_shell.
	Call it where appropriate.

	* setup/mta_sendmail.pl: Call tempfile where appropriate.
	
	* bin/mj_shell (tempfile): New function to generate random
	tempfile names.
	Call it where appropriate.	

2001-02-03  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_shell (privs_user, privs_mj): New functions to drop and
	regain permissions.

	Call them throughout the code where permissions were switched.

	Add permission-changing calls around all code that opens files
	specified on the command line.

	* lib/Mj/Parser.pm (parse_part): Note if we skipped any garbage at
	the end of the part.
	Fix minor bug where we said "Skipped 1 lines..."
	
2001-02-02  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* t/shell.t: Copy the mj_shell script and take out the 'use lib'
	line so that the tests won't use already-installed libraries.

2001-02-01  Michael Yount <csf@moscow.com>

	* Makefile.PL:  (check_nr_install) Test to see if installation
	as the majordomo user is feasible, and report any problems.

2001-01-31  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm, bin/mj_wwwusr:  Various cosmetic changes,
	plus the ability to include "domain=example.com" in the 
	path_info part of the URL, to make aliasing the URL easier.

2001-01-30  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Majordomo.pm (sync_owners): Set the override flag so that
	majordomo-owner is never sent mail.

2001-01-29  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm: (trigger)  Allow private files from a 
	list's file space to be parsed for commands.  The files
	must be specified in the list's "triggers" configuration
	setting, with names beginning with a forward slash.
	(configdef, configset, configshow)  Support a five-level
	password approach.  The ability to see or change a setting
	is based upon the kind of password used, and upon any changes
	to the default levels in the new config_access setting.
	(_list_file_get)  Remove GLOBAL from the default file search path.

	* lib/Mj/Config.pm:  (mutable, visible)  Check the config_access
	setting for access level changes.
	(intro)  Return a listref of data instead of a formatted string.
	(parse_access_array) New routine.  Parse a table that controls
	what level of password is necessary to see or change configuration
	settings.
	(parse_xform_array)  Cope with blank lines.  Thanks to David
	Miller.

	* lib/Mj/Util.pm:  (in_clock) Move routine from Mj::Digest
	to Mj::Util.

2001-01-27  Michael Yount <csf@moscow.com>

	* lib/Mj/BounceParser.pm:  (parse)  Parse addresses with
	digest volume and issue number, which takes the form DVxxxNyyy.

	* lib/Mj/Deliver.pm:  (_setup)  Use a separate envelope sender for
	each destination object.  This allows VERP probing for digest
	recipients, among other things.

	* lib/Mj/Resend.pm:  (do_digests)  Manufacture a sequence
	number from the volume and issue number of each digest to 
	allow VERP probing of digest recipients.

2001-01-25  Michael Yount <csf@moscow.com>

	* bin/mj_shell:  Untaint the password.  Allow multiple
	files to be processed with the -F option.

	* lib/Majordomo.pm:  (configdef)  Do not allow the installation
	settings, in the GLOBAL:_install and DEFAULT:_install templates,
	to be reset.
	(_createlist, _list_config_regen)  Regenerate the parsed values 
	for the GLOBAL:_install and DEFAULT:_install templates.
	(_list_sync_owners)  New routine.  Assess the old and new owners
	settings and update the GLOBAL:owners sublist accordingly.
	(sync_owners)  Use the "groups" field in the SubscriberList
	to store a list of mailing lists owned by a particular address

	* lib/mj_cf_defs.pl:  Use a substitution hash to set configured
	values; this will correct the quoting problems noted by
	Peter Ajamian.

	* lib/Mj/Config.pm:  (isparsed) Addresses are not parsed
	by DEFAULT lists.  This allows "$LIST" substitutions to
	be applicable to each list using the defaults individually.
	(_defaults)  Removed.  _load_dfl is used to load
	all default values from configuration files.
	(parse_address)  Retrieve the "whereami" value with get()
	instead of always using the installation settings.
	(regen)  New routine.  Reconstruct the parsed configuration
	data from the raw configuration data, and save the result
	in the configuration file.

	* lib/Mj/Deliver.pm:  (deliver) Access address lists directly.
	Mj::SubscriberList and Mj::RegList, as well as a list of 
	addresses can be used.  This routine is now used to deliver
	all mail that Majordomo sends.

	* lib/Mj/List.pm:  (new)  Include the domain in the data stored
	by the List object.  Adjust SubscriberList instantiation arguments
	to allow future backend enhancements.
	(config_regen)  New routine.  Wrapper for Mj::Config::regen.
	(update)  New routine.  Offer a generic way to replace the
	data for an existing subscriber database entry.

	* lib/Mj/MailOut.pm:  (mail_message, deliver, probe)  Call
	Mj::Deliver::deliver using a revised set of arguments.  This
	allows the Mj::Deliver and related modules to be detached
	from Mj::List, eventually to allow asynchronous delivery.

	* lib/Mj/Resend.pm:  (post_start)  Add support for the addhdr
	command mode, which treats the here args as a (plain text) message 
	body, and generates the necessary headers.
	(_add_headers)  New routine.  Add From, To, Subject, Date,
	Message-Id, and Content-type headers.

	* lib/Mj/SubscriberList.pm:  Rename the "rewritefrom" field to
	"groups."  This field is used by the GLOBAL:owners sublist
	to store a list of supported lists.

	* setup/setup_func.pl:  (do_default_config)  Create 
	DEFAULT:_install and GLOBAL:_install configuration files.
	mj_cf_defs.pl is no longer used directly by Majordomo.
	(install_config_templates)  Do not reveal the domain password
	during installation.

2001-01-20  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (p_expire)  Remove old data from the
	parser database, using the session_lifetime setting for
	the cutoff age.

2001-01-18  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_archive)  Add support for summary mode,
	which lists the archives available and the number of bytes,
	lines, and messages in each archive.  
	(archive_chunk) Change the default behavior
	of the "archive-get" command:  mail the messages individually,
	unless "digest" mode is also specified.
	(_createlist) Add missing MIME::Entity declaration.  Noted
	by Marc Fournier.
	The version number is now 0.1200101180

	* lib/Mj/Access.pm:  (_a_default)  Add password-only access
	settings to the *_access and *_policy configuration settings.
	_access settings can include open+password or list+password,
	and _policy settings can include open+password or auto+password.

	* lib/Mj/Archive.pm:  (summary)  New routine. Return the message, 
	byte, and line count of each archive file.

	* lib/Mj/List.pm:  (archive_get_to_file, archive_summary) 
	New routines.  Wrappers for Mj::Archive::{get_to_file,summary}.

	* lib/Mj/Deliver/Envelope.pm:  (new)  Allow an empty envelope
	sender.  Suggested by Rudolph T Maceyko.

2001-01-12  Michael Yount <csf@moscow.com>

	* bin/mj_queuerun:  (parse_commands)  Record data for messages
	which contain no valid commands.  After a threshold is reached,
	send the results to the domain owner instead of replying to
	the originator.  This will prevent an autoresponder mail loop
	with Majordomo if the message contains no valid commands.

	* lib/Majordomo.pm:  (record_parser_data, _make_parser_data)  
	Store a record containing the date and count of commands issued by a 
	particular address.  At the moment, this is only used to
	restrict autoresponder loops.
	(_subscribe, _unsubscribe)  Do not alter the registry when
	an address is subscribed to or unsubscribed from an auxiliary 
	list.
	(_unregister)  Log/inform for each of the individual unsubs.

	* setup/setup_func.pl:  (install_config_templates)  Run the
	Majordomo commands in the setup/config_commands file.  These
	commands currently establish the DEFAULT:personal template,
	which causes a separate copy of a posted message to be sent
	to each recipient of a mailing list.  The recipient's address
	is contained in the To: header, and a message footer with
	unsubscription instructions is added.

2001-01-05  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (announce) Add support for sending
	announcements to auxiliary lists.
	(_who) Add "owners" command mode, which displays the list
	owner addresses and the lists they administrate.  
	(sync_owners) New routine.  The GLOBAL:owners auxiliary list 
	is automatically updated to contain all of the owners' addresses, 
	including the deletion of addresses that are no longer owners.
	This routine is called by the "createlist-regen" command, by
	the "who-owners" command, and whenever the owners setting for
	a mailing list is changed.

2000-12-20  Michael Yount <csf@moscow.com>

	* lib/Mj/Format.pm:  (archive) Use format files for the archive
	command, which is supported by the text and wwwadm interfaces.

2000-12-19  Michael Yount <csf@moscow.com>

	* bin/mj_confirm:  Rewrite to use format files, have instructions,
	and be easier to navigate.

	* lib/Mj/Format.pm:  (who) Use hard-coded formatting for the
	plain who command for better speed.  The who-enhanced and who-bounces
	commands will be 5 to 10 times slower for large lists due to the 
	formatting substitutions.

	* lib/Mj/List.pm:  (_make_fs)  Cease using the filedir setting.

2000-12-17  Michael Yount <csf@moscow.com>

	* lib/Mj/Parser: (parse_part)  Inform about "parse" failure if
	no valid commands were found.

2000-12-16  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (standard_subs) Add CONFIRM_URL, WWWADM_URL
	and WWWUSR_URL variables to the standard substitutions.  These
	give the values from the GLOBAL configuration settings of the
	same names (wwwadm_url and wwwusr_url are new settings).
	(help_start)  Use "help overview" as the default help page;
	"help help" instead displays a summary of the help command.
	(_faq, _info, _intro)  Allow LASTCHANGE substitution to be used
	to supply the date on which the document was last modified.

2000-12-13  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/BounceHandler.pm (handle_bounce_user): Actually call
	handle_bounce_removal to delete users.
	(handle_bounce_removal): Delete users only when -noprobe is
	specified.

	* lib/Mj/Config.pm (parse_access_rules, parse_bounce_rules):
	Accept '-' separating actions from modes in addition to '='.

2000-12-12  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/mj_cf_defs.pl: Now that reply_do and subject_prefix default
	to nonempty values, default_flags should not include replyto or
	prefix.

	* lib/Mj/BounceHandler.pm (handle_bounce_removal): New function:
	handle deleting of users or constructing tokens to do so.

2000-12-11  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (trigger): Expire additional bounce data as
	well.

	* lib/Mj/List.pm (expire_subscriber_data): Trim accidental debug
	statement.  Properly deal with excessive counts.  Unshift data
	into new list unstead of pushing it, so that order is preserved.
	
	(expire_bounce_data): New function: expire old data from _bounce
	database.

2000-12-11  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/BounceHandler.pm (handle_bounce_user): Pass $user to
	_gen_bounce_message.
	(handle_bounce_user): Stop warning "don't know how to inform".

2000-12-11  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/List.pm (bounce_gen_stats): Handle generating statistics
	even if we got no bounce data.

	* lib/Mj/CommandProps.pm: "subscribed" variable is valid in
	bounce_rules.

	* lib/Mj/BounceHandler.pm (_gen_bounce_message): New function to
	generate the bounce report message.
	(handle_bounce_message): Don't ignore warnings; let bounce_rules
	decide that.  If handle_bounce_user doesn't return a message,
	assume that the owner doesn't want to be informed about the
	bounce.
	(handle_bounce_user): Rewrite.  Pay some atttention to
	bounce_rules; don't generate a report if the owner doesn't want to
	be informed.  Generate a short report for bounces to
	majordomo-owner.  Since bounce_add can handle it, add bounce data
	even for not-subscribed addresses.

2000-12-10  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/List.pm (bounce_add): Take hash instead of lots of
	arguments.
	(_make_bounce): New function; create the simple bounce database.
	(bounce_add): If user is not subscribed, add bounce data to a
	separate database.
	(bounce_get): If no subscriber data was found, look in the bounce
	database.

2000-12-09  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* t/core.t: Add even more tests.  Now tests all of the core calls
	that shell.t does, plus a few other things.

	* lib/Mj/Addr.pm (_validate): Completely ignored case of two @
	signs outside of comments.

	* t/addr.t: Add tests for two @ signs outside of comments.

2000-12-08  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm: (_unsubscribe) Add "farewell" mode, which
	causes the farewell file to be mailed to each address that
	is removed from the list.

2000-12-08  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (_list_config_set): When addr_xforms changes,
	store the new value in the address parser.

	* lib/Mj/Config.pm (set): Return the parsed data, if there is any,
	on a successful set.

2000-12-07  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/CommandProps.pm: Make %actions the hash of all supported
	actions along with their parameters.  Make %generic_actions a hash
	of the actions supported by most commands.  Replace %actions with
	%generic_actions in {access}{actions} portion of command
	descriptions.

	* lib/Mj/BounceHandler.pm (handle_bounce_user): Fix oops in bounce
	percentage display.

	* lib/Mj/Resend.pm (_within_limits): 
	* lib/Mj/List.pm (describe_class): 
	* lib/Mj/Format.pm (digest):
	Import time_to_str from Mj::Util and call it instead of
	List::_time_to_str.

	* lib/Majordomo.pm (_report): 
	* lib/Mj/Parser.pm (parse_part): 
	* lib/Mj/List.pm (make_setting): 
	* lib/Mj/Config.pm (parse_limits): 
	* lib/Mj/Archive.pm (expand_range): 
	* lib/Mj/Access.pm (_a_delay):
	Import str_to_time from Mj::Util and call it instead of
	List::_str_to_time.

	* lib/Mj/Util.pm: Add str_to_time, time_to_str, and
	_str_to_time_dm, and export the first two.
	(process_rule): Call str_to_time instead of
	Mj::List::_str_to_time.

	* lib/Mj/List.pm: Remove _str_to_time, _str_to_time_dm, and
	_time_to_str.

2000-12-07  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (dispatch)  Alter mode checking to
	give an error instead of silently ignoring invalid punctuation.
	(_createlist)  Convert the aliases setting from flags to
	enumerated format if necessary.

	* lib/Mj/Access.pm:  (list_access_check)  The data used to 
	check time constraints on access rules are now a list
	of lists rather than a scalar value.   Treat the master_password
	variable as an integer instead of a boolean value.  This
	allows administrative passwords to be differentiated by type.

	* lib/Mj/BounceHandler.pm:  (handle_bounce_message, 
	handle_bounce_token)  Use the first owner's address as the 
	envelope sender to avoid loops if the majordomo-owner address
	malfunctions.

	* lib/Mj/Config.pm:  (get)  Return a scalar value if a
	supposed listref is not a reference.
	(parse_flags)  Remove unused routine.
	(_compile_rule)  Revise time constraints to use a 2d listref.

	* lib/Mj/List.pm:  (set)  Revise handling of flags to
	convert configuration settings automatically from the old, 
	abbreviated format to the new, enumerated format.  The
	allowed_flags setting now treats each flag individually,
	instead of grouping ack and hide flags.
	(get_flags)  Convert an enumerated list of flags into a
	a string of abbreviations.  Replaces the default_flags routine.

	* lib/Mj/MTAConfig.pm:  (add_alias)  Use the new, enumerated
	format of the aliases setting.

	* lib/Mj/MailOut.pm:  (owner_done)  Use the first owner's
	address as the envelope sender when forwarding mail to
	the majordomo-owner address.

	* lib/Mj/Resend.pm:  (_post)  Use the Date header for the 
	date in the DATE substitution.

	* lib/Mj/Util.pm:  (process_rule)  Treat the "current" time
	spec checks as a list of lists.  Revise the "args" hash to
	allow reasons and delays to be passed back to the calling routine.

2000-12-07  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/BounceHandler.pm (handle_bounce_user): Remove rule
	processing and call Mj::Util::process_rule instead.

	* lib/Mj/Util.pm (process_rule): Accept and deal with $current.
	Export process_rule.

	* lib/Mj/Access.pm (list_access_check): Remove rule processing and
	call Mj::Util::process_rule instead.

2000-12-06  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/CommandProps.pm: Remove bounce actions from %actions;
	they were in there only by mistake.

2000-12-05  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* t/bounce.t: Make sure we process the tests in numerical order.

2000-12-05  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/BounceHandler.pm: %args needs to be local so it can be
	shared with the compartment during bounce_rules processing.

	* lib/Mj/Config.pm (parse_bounce_rules): Fix off by one error in
	rule IDs.

	* lib/Mj/List.pm (bounce_gen_stats): Always generate all
	statistics.  

	Computation of consecutive bounce count was badly busted.
	
	* lib/Mj/Config.pm (parse_bounce_rules): The default action is
	'inform', not 'ignore'.

	* lib/Mj/BounceHandler.pm (handle_bounce_user): Import
	'action_terminal' from Mj::CommandProps.

	Since all stats are always generated, don't include some messages
	about statistics when they are meaningless.

	Enable the bounce_rules checking code; include the result in the
	report but don't actually do anything with is.
	
	* lib/Mj/CommandProps.pm: 'remove' is a terminal action.

2000-12-04  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/BounceHandler.pm (handle_bounce_message): Completely
	ignore warning bounces.

	* lib/Mj/CommandProps.pm: Revise actions for bounce_rules.

2000-12-04  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* setup/ask_domain.pl (ask_domain): Make it clear that the
	expected answer to "What is the email address of the
	owner of this Majordomo installation" is not "majordomo-owner".

2000-12-03  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/List.pm (expire_subscriber_data): Bug fix: when all
	bounces expired, all were kept.

2000-12-02  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (dispatch):  Add simple command mode validation.

	* lib/Mj/List.pm (search):  Allow a count of results desired.

2000-12-01  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/MTAConfig.pm (add_alias): Fix bug in VUT owner-list
	entry.

	* lib/Mj/BounceParser.pm (parse_smtp32): Fix possible infloop.

2000-11-25  Michael Yount <csf@moscow.com>

	* setup/newdomain.pl:  Allow domains to be added
	to the installation using the "make domain" shell command.

2000-11-22  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Format.pm: Correct various syntax errors.

2000-11-18  Michael Yount <csf@moscow.com>

	* README.CALLING:  Somewhat outdated file describing the 
	request hash calling conventions.

	* bin/mj_shell:  Add editing support for the get-edit
	command, which wraps a file in a put command, to allow
	easy editing and replacement using your favorite editor.

	* bin/mj_wwwadm, bin/mj_wwwusr:  Rewrite.  Move all formatting
	into Mj::Format.  List explicitly the supported commands.

	* files/en/error/*:  New error files.  Allow customization
	of error messages (only two are used at present).

	* files/en/format/*:  New format files.  Allow customization
	of command output (only commands that require special
	formatting in the WWW interfaces are included at present,
	such as the configshow, lists, and show commands.)

	* files/en/help/configset_*:  Change "Variable Groups" heading
	to "Category" and revise the categories used.

	* files/en/help/configshow:  Document "categories" mode, 
	including a list of all ten categories.

	* files/en/help/get:  Document "edit" mode, which wraps a
	file with a put command, to allow easy editing and replacement.

	* lib/Majordomo.pm:  (dispatch) Improve list validation.
	(standard_subs) Add DOMAIN and PWLENGTH substitutions.
	(substitute_vars_format)  New routine.  Allows more extensive
	line-based formatting, with the following new features:
	  $HELP:LOZENGE   add a hypertext link to the "lozenge" help file
	  ?COMMENT        skip this line if the COMMENT substitution is empty.
	Also, if a substitution value is a list reference, the formatting
	of lines in which the variable appears will be spread over multiple
	lines, one for each array element.  For example, in the lists command,
	the DESCRIPTION substitution is a list reference.  As a result,
	the following line in the format file:
	  $LIST:-23 $DESCRIPTION
	will cause the list name to be displayed only on the first line,
	while the description may span several lines, all indented.
	(format_error) New routine.  Retrieve an error file and apply
	substitutions to it.  Return the result in a string.
	(format_get_string) New routine.  Obtain a format file as a string.
	(_get) Add support for the edit command mode.
	(help_start) Allow abbreviations of configset_ topics.  For example,
	  help configset_who_access
	can be abbreviated to
	  help who_access
	(password)  Use error files instead of hard-coded messages.
	(configshow)  Add support for the categories command mode.
	(createlist)  Allow multiple list owners to be specified,
	using a here document.

	* lib/Mj/Access.pm (list_access_check, validate_passwd):  
	Perform latchkey validation.

	* lib/Mj/Archive.pm (expand_range):  Allow mwdh time expansions
	in arguments containing sublists.

	* lib/Mj/Format.pm (configshow, lists, show, showtokens,
	tokeninfo, who):  Use file formatting instead of hard-coded
	output.

	* lib/Mj/List.pm:  (get_setting_data)  New routine.  Obtain data 
	about the personal settings for a list, including default and
	allowed values.
	
2000-11-15  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/BounceParser.pm (parse_qmail): Support multiline
	diagnostics.

	* lib/Mj/Deliver/Prober.pm (add): Don't use the canonical address
	in the envelope, since it makes it difficult to get back to the
	real address later.

	* lib/Mj/List.pm (_make_post_data): New function to create the
	posts database.
	(post_add, get_post_data, expire_post_data): Call _make_post_data.

	* lib/Mj/BounceHandler.pm (handle_bounce_message): Incorrectly
	used "bounce" instead of "failure" for bounce status.

	* lib/Mj/BounceParser.pm (parse_mms): Accept WorldSecure SMTP
	Relay bounces as well.
	(check_dsn_netscape): Handle an additional format.
	(parse_dsn): Call check_dsn_netscape when appropriate to pull out
	additional diags that check_dsn_diags missed.

	* bin/mj_enqueue: Support -S option for qmail.

	* lib/Mj/BounceParser.pm (parse_postoffice): Handle older
	Post.Office bounces.
	(parse_mms): New function to parse Tumbleweed MMS bounces.

2000-11-14  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* t/bounce.t: Clear out @expect array between tests.

	* lib/Mj/BounceParser.pm (parse_postoffice): Restructure to fix
	several warnings.

	* lib/Mj/Deliver/Dest.pm (add): Accept null second argument.

2000-11-01  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Parser.pm (parse_part): Fix undef warning with "default
	password".  Use a better message in this case.

	* bin/mj_shell (parse_command): Use better message when
	"default password" is used to clear out a default password.

2000-10-28  Michael Yount <csf@moscow.com>

	* files/en/help/*:  Document previously undocumented modes.
	Add a paragraph about comments within here documents to the
	appropriate configuration setting files.  Describe configuration
	templates.  Demonstrate the use of here documents with the
	subscribe and unsubscribe commands.

	* lib/Majordomo.pm:   (common_subs)  New routine.  Find the
	addresses that are present in two or more subscriber lists.
	(config_get_vars)  Make non-secure settings of DEFAULT lists
	visible.
	(list_config_set)  Support "extract" mode, which removes a
	set of values from an array, or sets an existing value to
	its default if the existing value and extracted value are
	identical.
	(compare_arrays) New routine, from the perl FAQ.
	(lists) Show the private auxiliary lists (in aux mode) and
	private configuration templates (in config mode) if a
	list-specific master password is used.  Show the DEFAULT
	templates (in config mode) if a pattern matching DEFAULT
	is used.
	(rekey) Return to old behavior:  do not verify by default.
	(set) Add support for patterns using "pattern," "regex,"
	and "allmatching" modes.
	(who) Add support for "common" mode, which displays the 
	addresses held in common by two mailing lists.

	* lib/Mj/Access.pm (list_access_check):  Do not fail if
	the lists command was provided with a non-GLOBAL password.
	List-specific passwords can be used to view private templates
	and sublists.

	* lib/Mj/CommandProps.pm:  List the supported modes
	for each command.

	* lib/Mj/Config.pm:  (parse_inform) Inform majordomo-owner
	about connection failures by default.

	* lib/Mj/Format.pm:  (configset) Support append and extract modes.
	(configshow)  Support append, extract, and merge modes.

	* lib/Mj/List.pm:  (get_chunk) Return the canonical address
	with the rest of the data.

	* lib/Mj/Resend.pm:  (post) Initialize sublist (Thanks to SRE.)

	* lib/Mj/Token.pm:  (t_accept) Propagate the reasons (Thanks to SRE.)

	* lib/Mj/Deliver/Dest.pm:  (flush) Use empty envelope sender 
	(Thanks to Jason.)

2000-10-27  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* bin/mj_queuerun (run_queue): If mj_enqueue was called with an
	explicit command to run, always run it regardless of the setting
	of request_answer.

2000-10-27  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_queuerun (run_queue): Make sure $debug2 is actually an
	integer; the config variable might be the empty string.
	(debug_to): Add some useful into to the logs to show when we
	switch to a different log.

2000-10-26  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_queuerun (run_queue): Maintain a count of how many times
	a queue file has been processed.  When this gets too large, assume
	that something is hosed, crank up the debug level, and store a
	separate debug log.

	* lib/Majordomo.pm (which): List::search now takes the sublist (or
	MAIN) as the first arg.

2000-10-26  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/BounceHandler.pm (handle_bounce_message): Include info on
	what list the bounce is from, for folks who filter all owner mail
	to one place.

2000-10-22  Michael Yount <csf@moscow.com>

	* CREDITS, README:  Suggest mj2-dev instead of majordomo-workers.

	* bin/mj_trigger:  Separate lock expiration from the other triggers.

	* lib/Majordomo.pm:  (connect)  Do not validate addresses
	for requests from the resend and owner interfaces.
	(dispatch) Simplify processing requests with multiple victims.
	(substitute_vars_string) Allow formatting widths.  For example,
	  $OWNER:48  would pad the list owner address out to 48 characters
	and right-justify it.
	(list_config_get, list_config_set, list_config_set_to_default)
	Support the storage of configuration templates on a per-list
	basis.  All variables in a configuration template are visible
	without the use of a password.
	(list_config_set)  Support "append" mode, which combines arrays
	of configuration settings.
	(list_set_config)  Change the configuration file ('MAIN' by default)
	which is used by a mailing list.  This allows configuration
	templates to be accessed without changing the call arguments.
	(lists) Use "full" mode to display supplemental data such
	as digest names, subscriber count, and list addresses.
	Add "config" mode to list configuration templates.  The
	descriptions for templates are taken from the comments setting.
	(report) Add "succeed," "stall," and "fail" modes to 
	differentiate log entries according to the result.

	* lib/Mj/Access.pm:  (list_access_check) Make the name of
	the interface available to the access rules.

	* lib/Mj/Config.pm:  (is_array) Differentiate arrays that
	require blank lines between blocks from those that do not.
	(parse_table)  Treat lines beginning with (optional white
	space and) "#" as comments, and discard them during parsing.
	(load)  Do not automatically create a configuration file
	for a template.

	* lib/Mj/Format.pm:  (report)  Display dates on a separate 
	line to conserve space.

	* lib/Mj/List.pm:  (_fill_config, _make_config, valid_config,
	set_config)  New routines to find, load, and validate 
	configuration templates.

	* lib/Mj/Resend.pm:  (post) Set the "invalid_from" access
	variable if the address in the From: header is invalid.

	* setup/setup_func.pl:  Include a crontab entry for lock expiration.

2000-10-20  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/BounceParser.pm (parse_exim): Put a space between the
	lines of a multiline diag.
	(parse_postfix): Handle warnings properly.

2000-10-20  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/BounceParser.pm (parse_exchange): Parse a variant of the
	exchange format.

2000-10-19  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Config.pm (_defaults): When an eval of the defaults
	string fails, print it out.

	* t/core.t: Clean up a bit.

	* t/shell.t: Set some variables to allow non-internet-connected
	hosts to run the tests.

	* lib/Mj/List.pm (remove): Mode "pattern" is valid for
	unsubscribe, but "regex" needs to be passed to the database
	routines.

2000-10-18  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (_who):  Display aliasing commands
	in "alias" mode for the GLOBAL list.  Display register
	commands with passwords with the "who-export GLOBAL"
	command.  Add sublist support to "export" mode.

2000-10-15  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (auxadd, auxremove, auxwho) Merge
	auxiliary list commands with their common counterparts,
	subscribe, unsubscribe, and who.
	(rekey)  Rekeying automatically verifies the contents
	of the subscriber lists and registry.  Using "repair"
	mode will cause both to be repaired.
	(who)  Add preliminary support for "alias" mode, which
	will display the contents of the aliases database.
	(_make_list)  Use the stored values for the installation
	defaults from the DEFAULT list to avoid reloading them
	for every list.
	(dispatch)  Separate list:sublist into separate request hash
	variables.
	(config_get_vars)  All settings of the DEFAULT list are visible.
	(valid_list)  Understand and untaint list:sublist combination.

	* lib/Mj/Access.pm: (list_access_check)  Use GLOBAL checks 
	for the DEFAULT list.
	(_a_default)  "deny" by default if a sublist other than 'MAIN' is used.

	* lib/Mj/Config.pm:  (parse_address, parse_pw)  Allow
	$LIST substitution to avoid having to reload the installation
	defaults for each mailing list.
	(load) Rearrange the data structures for storing configuration
	information.

	* lib/Mj/List.pm:  (add, get, is_subscriber, et cetera)  
	Merge main subscriber list and auxiliary list code.
	(aux_rekey) Always run verification checks against the registry when
	rekeying.  Return data about missing entries.

2000-10-14  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_queueserv (in): Triple timeout when waiting for queue
	runner to start up.

2000-10-11  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* bin/mj_email (connect_no_parse, connect_and_parse): Call
	Majordomo::connect in a list context so failed connects don't
	screw us up.  Log failed connects.

2000-10-07  Michael Yount <csf@moscow.com>

	* bin/mj_shell (parse_interactive):  Remove unneeded white space.

	* lib/Majordomo.pm (accept):  Track elapsed time for each token
	individually.
	(_subscribe):  Use "set" mode to allow settings to be included
	in a subscription command.  For example,
	  subscribe-set LIST digest
	is used instead of 
	  subscribe-digest LIST
	
2000-10-05  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* bin/mj_shell (parse_interactive): Term::ReadLine can spew
	warnings over files we can't control; turn warnings off when
	loading it.

	* lib/Mj/Token.pm: Clean up various undeclared variable warnings.

2000-10-04  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Access.pm (_d_post): Fix error when checking
	restrict_post.

2000-10-04  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (trigger):  Use the list-specific triggers
	setting to determine when the bounce, checksum, and post
	triggers will be run.

2000-10-03  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm: Use BounceHandler module; set ISA
	appropriately.

	* lib/Mj/MailOut.pm: Remove bounce handling stuff.

	* lib/Mj/BounceHandler.pm: New file: handle bounces.

	* bin/mj_shell: Add option to dump request and result structures.

	* lib/Majordomo.pm (dispatch): Eliminate warnings when mode is
	empty or contains all non-alphabetics.

2000-10-02  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (dispatch):  Inform on *_done commands.
	Do not inform on *_start commands if they succeed.
	Track the elapsed time taken by a request.

	* lib/Mj/Format.pm (report):  Display the elapsed time
	if one is given.

	* lib/Mj/Inform.pm (inform):  Store the elapsed time of
	the command in the log.
	(_inform_owner)  Include TIME substitution, for the elapsed time.

	* lib/Mj/Log.pm (elapsed):  New routine.  Return the amount
	of time elapsed since the first call to in().

2000-10-02  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Resend.pm (_check_mime): Don't fault messages for
	exceeding max_mime_header_length if it is zero.

2000-10-01  Michael Yount <csf@moscow.com>

	* lib/Mj/Resend.pm (_post):  Add support for the "unique"
	class.  Subscribers with this setting will not receive
	a duplicate copy if a message with the same ID or checksum
	has previously been posted to a list in the same domain.

2000-09-30  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm: Bump version number.

	* lib/Mj/BounceParser.pm (parse_msn): Handle MSN bounces with
	multiline diagnostics.
	(parse_compuserve): Old function moved to parse_compuserve2.  New
	function to parse new bounce format.
	(parse_exim): Look at X-Failed-Recipients: header as well.

	* lib/Mj/SimpleDB/Text.pm: Use Majordomo::_re_match instead of
	local version.  Delete local copy.

	* lib/Majordomo.pm: Declare various undeclared variables.

	* lib/Mj/SimpleDB/DB.pm: Use Majordomo::_re_match for all regexp
	work.  Delete the local copy.

2000-09-29  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_shell: Add commented out code to get backtraces on
	warnings.
	Set $/ to $/ to get rid of a strange Perl problem.

	* lib/Majordomo.pm (substitute_vars): Was opening the input file
	twice.

2000-09-26  Michael Yount <csf@moscow.com>

	* lib/Mj/Config.pm (_compile_rule):  Add support for a 
	time specification within asterisks, similar to the
	digest "times" field.

2000-09-24  Michael Yount <csf@moscow.com>

	* files/en/ack_delay, delay, delay_noweb, repl_delay, 
	repl_fulfill:  New reply files for "delay" tokens.
	(Idea suggested by Marc Fournier.)

	* bin/mj_email, mj_queuerun:  Determine author's address.
	This allows the global 'access' checks to restrict posted
	messages and messages to list owners.

	* bin/mj_shell:  Add support for the default command
	in interactive mode (delay, password, and user only).

	* bin/mj_wwwadm:  Obtain token reasons from the reasons
	variable instead of arg2.

	* lib/Majordomo.pm:  Simplify calls to *_access_check.
	(trigger) Add "delay" trigger to fulfill delayed requests.

	* lib/Mj/Access.pm:  (_gen_pw) Accept an argument specifying
	the minimum password length.
	(list_access_check)  Use a hash instead of a long argument list.
	If the master password is used, and a delay was requested,
	delay the command.  Simplify calls to action routines (_a_*).
	Remove _a_denymess and _d_password.  Add _a_delay routine to
	handle the new "delay" action.

	* lib/Mj/Archive.pm (find):  New routine.  Find a list of
	archive files matching a pattern.  (Suggested by SRE)

	* lib/Mj/Config.pm:  (_load_dfl) Do not allow the GLOBAL list
	to use the DEFAULT settings.
	(compile_pattern)  Allow a leading "!" to indicate inversion.

	* lib/Mj/Format.pm (archive):  Synchronize multiple archives
	with one command using one-archive chunks.

	* lib/Mj/List.pm:  (archive_find) New wrapper for Mj::Archive::find.
	(_str_to_time) Allow a whole number to indicate a number of seconds.

	* lib/Mj/MIMEParser.pm (replace_headers):  Parse a file containing
	a message and add, replace, or delete some of the message headers.

	* lib/Mj/MailOut.pm (handle_bounce_token):  Do not delete a
	delay token (type 'D') when a message bounces.

	* lib/Mj/Parser.pm (parse_part):  Add support for the 
	"default delay" command.

	* lib/Mj/Resend.pm (post):  Return the error message for
	a stalled or denied post, which will appear in 'inform'
	messages mailed to the owners.

	* lib/Mj/Token.pm:  (delay)  New routine.  Create delay tokens,
	for requests which are completed when the token expires.
	(t_accept)  Always requeue posted messages with an "Approved" header
	added, to speed the reply to the accepter.
	(t_fulfill)  New routine.  Expire delay tokens and complete
	their requests.

	* lib/Mj/TokenDB.pm:  Add "reasons" field.  Store reasons
	there instead of in the arg2 fields.

	* lib/Mj/Digest/Build.pm (idx_numbered):  Add new "numbered"
	digest index format.

2000-09-11  Michael Yount <csf@moscow.com>

	* lib/Mj/Archive.pm (remove, sync, _sync_msgs): New routines.
	Allow groups of messages to be deleted from the archives,
	and individual archive files to be indexed, with the archive-delete
	and archive-sync commands.

2000-09-06  Michael Yount <csf@moscow.com>

	* files/en/config/post_limits:  New local configuration
	setting.  Each line consists of a pattern, followed by
	comma-separated lists of soft and hard limits.  By default,
	messages exceeding a soft limit are bounced to the moderators,
	while messages exceeding a hard limit are denied.

	* lib/Majordomo.pm: (_lists) In aux mode, include a count
	of posted messages in the last 30 days.
	(trigger) Add new "post" trigger, which removed old data
	from the post database.  The data have a lifetime twice
	that of the duplicate database.

	* lib/Mj/Access.pm (_d_post):  Add "limit_soft" to the list
	of consult variables, and "limit_hard" to the list of deny
	variables.

	* lib/Mj/Archive.pm: (first_n, last_n)  Collect data more quickly.
	(expand_range)  Allow use of "mwdh" format to specify "last 3 weeks"
	and similar ages.
	(get_all_data)  New routine.  Load all data from an archive index.

	* lib/Mj/Config.pm (parse_limits):  New routine.  Parse the
	post_limits variable into a format similar to the digest times.

	* lib/Mj/List.pm:  (_time_to_str) Allow "long" format output
	("2 days" instead of "2d").
	(post_add, get_post_data, expire_post_data) New routines to 
	handle the "posts" database, which records times and sequence
	numbers for posted messages, keyed on the e-mail address of
	the authors.
	(count_posts) New routine.  Total the posts to a list over
	a number of days, based upon the archive data.

	* lib/Mj/Resend.pm:  (_post)  Add the data about a post to
	the "posts" database after delivery.
	(_check_poster)  Determine if a message falls within limits.
	(_within_limits)  New routine.  Use the post_limits setting
	and data from the posts database to determine if a hard
	or soft limit is exceeded.

2000-08-31  Michael Yount <csf@moscow.com>

	* files/en/config/block_headers:  New global configuration
	setting.  Connections on the email and request interfaces
	will be dropped (and the site administrator informed) if
	headers of the incoming message match the regular expressions
	in this setting.

	* bin/mj_email, bin/mj_queuerun:  Instead of adding a 
	hard-coded reply-to header when sending command results,
	use the global message_headers setting to add headers
	(x-loop and reply-to headers are added by default).

	* bin/mj_wwwadm and others:  Use COMMAND variable substitution
	for a majordomo command instead of REQUEST.  REQUEST is used
	to indicate the LIST-request address.

	* lib/Majordomo.pm: (connect) Block connection if request
	message headers match patterns in the block_headers setting.
	(standard_subs) New routine.  Return a hash containing 
	common variable substitutions.

	* lib/Mj/Access.pm (check_headers): New routine.  Determine
	if the headers of a request message match the patterns in
	the block_headers setting.

	* lib/Mj/Token.pm (confirm, consult, remind):  Add headers
	from the global message_headers setting.

2000-08-30  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (_set):  Issue a partial digest when the
	delivery mode changes from digest to each.

	* lib/Mj/Resend.pm (_post):  Add SUBSCRIBED substitution,
	which is converted to "not" if the message author is not
	subscribed, or an empty string otherwise.

2000-08-27  Michael Yount <csf@moscow.com>

	* bin/mj_*, setup/query_util.pl :  Allow only letters, digits, 
	period and hyphen in domain names when untainting.

	* bin/mj_email, bin/mj_queuerun:  Look for the "x-loop" header
	in messages containing commands, and forward such a message to the 
	list owner.

	* bin/mj_wwwusr:  Add a button for the alias command.

	* files/en/config/triggers:  New file.  Describe the new
	triggers configuration setting, which determines at what
	times the hourly trigger will invoke a particular trigger.

	* lib/Majordomo.pm (trigger):  Evaluate the triggers configuration
	setting during the hourly trigger.

	* lib/Mj/Config.pm (parse_triggers):  New routine.  Each line
	of the triggers setting contains a trigger name and set of
	times at which the trigger should be invoked.
	(_str_to_clock)  Parse "yearly" "quarterly" "monthly" "weekly" "daily"
	and a new abbreviated format (e.g., 7m3d(8) for July 3, 8 am).

	* lib/Mj/Digest.pm (in_clock):  Handle hours relative to the 
	start of a year, or relative to the start of a particular month.

	* lib/Mj/Resend.pm (_r_strip_body):  New routine.  Discard
	attachments as required by the attachment_rules setting.

	* lib/Mj/Token.pm (confirm, consult, remind): Add 
	X-Loop: majordomo@example.com  header, to prevent loops.

2000-08-24  Darren Stalder  <torin@daft.com>

	* README: After the setup questions are asked, mention that you
	can prepare and use a response file.

	* setup/query_util.pl (prompt): Allow prompt to read from STDIN if
	there is any data waiting there.  This allows the installer to
	prepare a response file for the questions; very useful for
	packaging mj2.

2000-08-24  Michael Yount <csf@moscow.com>

	* bin/mj_wwwusr:  Include digests when the details about
	an individual list are shown.

	* lib/Majordomo.pm: (lists) Include digest names and
	descriptions in the data.
	(_report) Allow more complicated time spans, e.g.,
	2w3d4h for the last 2 weeks, 3 days, and 4 hours.
	(Thanks to Dave Wolfe for the suggestion.)
	(trigger) Add new trigger options for finer control.
	The following abbreviations are available:
	b (bounce) or v (vacation) ... expire bounce and vacation data.
	c (checksum) ... expire duplicate checksum/id data.
	da (daily) ... all of the other tasks, except digests.
	di (digest) or h (hourly) ... issue digests.
	l (log) ... expire old log entries.
	s (session) ... expire old session data.
	t (token) ... expire old tokens and temporary passwords.

	* lib/Mj/BounceParser.pm (parse): Anchor matches at the
	beginning of the envelope information.

	* lib/Mj/Format.pm (lists):  Display digests in "aux" mode.

	* lib/Mj/List.pm: (_time_to_str) New routine.  Convert a
	time span abbreviation (such as 2w3d4h) to a count of seconds.
	(describe_class) Deal with vacation spans correctly.

2000-08-23  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (lists, who_start):  Treat a search
	pattern not enclosed in delimiters to a case-insensitive
	substring match.

2000-08-21  Michael Yount <csf@moscow.com>

	* files/en/config/archive_url:  New configuration
	variable, used by mj_wwwusr and the message_headers
	setting (ARCURL substitution in Mj::Resend::_post.)

	* files/en/config/sublists:  New configuration variable.
	The lists-aux command will only display auxiliary lists
	explicity mentioned in this setting.  The createlist-regen
	command will only create mail aliases for sublists included
	in this setting.  Each line of the array consists of
	a sublist name, followed by an optional description.
	The description appears in the output of the lists-aux 
	command.

	* bin/mj_wwwusr:  Overhaul formatting.  The introductory
	page is now very simple, offering only instructions.  The
	lists page contains a link to a separate page for each mailing 
	list.

	* lib/Majordomo.pm: (get_all_lists) Take a regular expression,
	to allow the list names to be searched.
	(list_config_set_to_default) Remove calls to inform().
	(_createlist) Create aliases only for auxiliary lists
	named in the "sublists" configuration setting.
	(lists) Allow a regular expression to be used, to search
	the list of lists.  Add new data (list address, owner
	address, number of subscribers, archive URL) to the 
	output of the lists-aux command.
	(report_done) Include a list of auxiliary lists in
	summary mode, to compensate for the new restrictions
	to the lists-aux command.
	
	* lib/Mj/Config.pm (parse_sublist_array):  New routine.
	Used with the "sublists" variable.  Each line consists
	of a list name, followed by an optional description.

	* lib/Mj/List.pm (count_subs):  New routine.  Count
	the number of subscribers in a list or auxiliary list.

2000-08-20  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm: Strip trailing whitespace in code.

	* lib/Mj/MailOut.pm (mail_message): Fix undeclared variable
	problem.
	Strip trailing whitespace in code.
	(handle_bounce_user): Take all arguments in a hash.

	* lib/Mj/Config.pm (parse_bounce_rules): New function to parse
	bounce_rules variable.  Works mostly like parse_delivery_rules.
	Strip trailing whitespace in code.
	Hook up parse_bounce_rules function to the appropriate type.
	(_compile_rule): Fix handling of two-character numeric
	comparisons, which have been broken for forever.

	* lib/Mj/CommandProps.pm: Add variables and actions for "_bounce"
	fake command, for use in bounce_rules.
	Strip trailing whitespace in code.

	* bin/mj_queuerun: Strip trailing whitespace in the code.

	* lib/Mj/MailOut.pm (handle_bounce): Split out 'M'-type bounce
	processing, like we did with 'T'-type bounces.
	(handle_bounce_message): New function to deal with bounced
	messages.

	* lib/Mj/List.pm (bounce_add): Add logging.

2000-08-19  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/BounceParser.pm (parse_msn): Add parser for MSN-format
	bounces.

	* lib/Mj/Config.pm (_compile_rule): Fix broken operator comparison
	regexp.

2000-08-19  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (_digest):  Add "status" mode,
	which allows the current state of the digests to be 
	viewed.

	* lib/Mj/Token.pm (gen_latchkey):  Use new "latchkey_lifetime"
	global configuration variable, which gives the lifetime of
	a temporary password in minutes.

2000-08-18  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (_rekey):  Allow the registry
	to be verified or repaired, based upon the subscriber
	databases, if the registry is corrupted.

2000-08-15  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Further refine the output of
	the configshow command (menus for enumerated types,
	add links to help pages).

	* files/en/config/log_lifetime:  New variable.  Log
	entries older than this age (default 31 days) will be
	deleted during the daily trigger.

	* lib/Majordomo.pm (set):  Support "check" mode, which
	allows settings to be reviewed but not changed.

	* lib/Mj/CommandProps.pm, lib/Mj/Parser.pm (parse_args):  
	Rearrange 'arguments' data to make per-mode adjustments easier.

	* lib/Mj/Inform.pm (l_expire):  New routine.  Remove log
	entries older than the log_lifetime setting.

2000-08-13  Michael Yount <csf@moscow.com>

	* files/en/ack_archive:  New file, sent when a post is
	archived but not distributed.

	* bin/mj_wwwadm:  Add forms to the output of the configshow
	command to allow settings to be changed or set to the default.
	(only one setting at a time may be changed)

	* lib/Majordomo.pm: (_alias_reverse_lookup) Optionally
	include the bookkeeping alias in the result.  Return
	keys instead of stripsource values.
	(alias) Use list instead of listref error return values.
	(configshow) Indicate if a global password is 
	required to change a particular variable.
	(_changeaddr) Replace the bookkeeping alias correctly.
	(reject) Allow DATE substitution (date of original request).
	(set, _set) Use "check" and "force" variables to allow
	settings to be seen without changing them, and to allow
	list owners to override allowed_* settings that limit
	the changes available to subscribers.

	* lib/mj_cf_data.pl: Remove ack_denials_always.
	Add values for 'flags' variables to allow sanity checks.

	* lib/Mj/Config.pm (parse_flags):  Check the validity
	of flags in list settings (allowed_flags, aliases, ...)

	* lib/Mj/List.pm: (%flags) Add ackdeny, ackpost, ackreject,
	and ackstall settings for fine-grained selection of acknowledgements.
	(set) Implement allowed_classes and allowed_flags checks,
	which limit the settings which may be changed by subscribers.
	(make_setting) Deal with group settings: the ackall and
	ackimportant flags now turn on all of the individual ack flags,
	and the noack flag turns them all off.
	(should_ack) New routine.  Determine whether a certain action
	requires an ack to be sent to the victim.
	(aux_get_member) New routine.  Return the auxiliary list
	data for a particular address.
	
	* lib/Mj/Resend.pm: (post) Include the sublist, date,
	and message author in the variable substitutions.
	(_post) Send an acknowledgement if warranted.

	* lib/Mj/Token.pm (t_accept):  Acks for posted messages
	are handled by Mj::Resend::_post.  Determine if an
	ack was sent in this case.

2000-08-12  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/mj_cf_data.pl: Add bounce_rules variable.

	* lib/Mj/MailOut.pm (handle_bounce): Fix busted indentation.

2000-08-10  Michael Yount <csf@moscow.com>

	* lib/Mj/Access.pm (list_access_check):  Allow reasons
	to be described for commands other than "post."

	* lib/Mj/Config.pm (parse_table):  Allow parens within
	quotes and vice-versa when parsing multifield lines.

2000-08-09  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (dispatch) Treat an "owner" command as
	a "bounce" during inform() if a bad address was supplied.
	Set the "user" to the message author and put bad addresses
	into the command line variable.

	* lib/Mj/MailOut.pm (handle_bounce):  Return the bad
	addresses (if any were found) and message author (always).

	* bin/mj_wwwadm, lib/Mj/Format.pm (who):  Show bounce diagnostics.

	* lib/Mj/List.pm (bounce_add),  lib/Mj/SubscriberList.pm: 
	Add bounce diagnostics to saved/displayed data.

	* lib/Mj/Deliver/Dest.pm, lib/Mj/Deliver/Envelope.pm:
	Report non-fatal failures during RCPT TO as pseudo-exim bounces
	to the message sender. (Thanks to Paul Hancock.)

2000-08-08  Michael Yount <csf@moscow.com>

	* files/en/wwwadm_head, files/en/wwwadm_help:  Move the 
	command form and introduction from mj_wwwadm to separate files
	to allow easier customization.

	* lib/Mj/CommandProps.pm, lib/Mj/Parser.pm (parse_args):
	Split variable names in the configdef and configshow commands
	on either commas or spaces.

2000-08-07  Michael Yount <csf@moscow.com>
 
	* lib/Mj/Config.pm (set):  Initialize value if it is not 
	defined.  (Thanks to Todd Goodman.)

2000-08-06  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (_createlist):  Create the archive
	directory unless "noarchive" mode is specified.  Generate
	a password randomly.  Send the "new_list" file to the 
	owner unless "nowelcome" mode was specified.
	Add "destroy" mode, which will remove a list by renaming
	its directory, but only if there are no subscribers.
	Destroy mode also regenerates the aliases.

2000-08-05  Michael Yount <csf@moscow.com>

	* lib/Mj/List.pm (make_setting):  Allow nomail-return to
	work for vacations that are not timed.

2000-08-04  Michael Yount <csf@moscow.com>

	* bin/mj_email, bin/mj_enqueue:  delete unneeded envvars.

	* bin/mj_queuerun:  randomize directories and files. 
	Fix indentation.  

	* bin/mj_wwwadm:  simplify command form maintenance.

	* files/en/consult, files/en/consult_noweb:  Suggest
	that the accepter type an explanation.

	* lib/Majordomo.pm: (new) Treat the registry as
	a subscriber list for the GLOBAL list.  This allows
	the Deliver module to distribute messages to addresses
	in the registry.
	(announce) New command.  Distribute a file to one
	or more classes of subscribers.  Each message is
	sent as a probe, with the recipient in the To: header.
	This could be used for periodic reminders, or 
	announcements that need to reach 'digest' and 'nomail'
	subscribers immediately.
	(archive_chunk) Allow the type of digest for the
	archive-get command to be specified in the mode ("-mime"
	for mime; text otherwise.)
	(report) New, iterated command.  Obtain raw or summarized
	data for recent log entries for a mailing list.
	The data can be constrained by action or by date.
	(get_all_lists, _make_list) Make DEFAULT data available 
	to Mj::List::new when all of the lists are being 
	loaded, to save redundant lookups.

	* lib/mj_cf_defs.pl: Add 'MSGRCPT' to admin_header checks.

	* lib/Mj/CommandProps.pm, lib/Mj/Format.pm:  Support new
	announce and report commands.

	* lib/Mj/Config.pm:  Use existing data for the DEFAULT
	list when Majordomo::get_all_lists is run.

	* lib/Mj/Deliver.pm:  (deliver) Support delivery to 
	addresses in the registry.  Addresses subscribed to 
	at least one list are in the "each" class.  Addresses
	not subscribed to any lists are in the "nomail" class.

	* lib/Mj/List.pm:  (_digest_classes) New routine.  Return
	a list of all possible digest classes.

	* lib/Mj/MailOut.pm:  (probe) New routine.  Probe all
	addresses in the classes provided.  This is used by
	the announce command.

	* lib/Mj/Parser.pm:  (parse_entity) Test for existence
	of a bodyhandle before using it.  (Thanks to Paul Hancock.)

	* lib/Mj/Deliver/Dest.pm:  (make_envelope)  Add 'personal'
	variable, which is set if there is only one recipient.

	* lib/Mj/Deliver/Envelope.pm:  (new, address, send)
	If a message is personal, substitute the recipient's
	address for the variable $MSGRCPT during delivery.

2000-07-30  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm: (dispatch) Inform on post_done, but not
	on post_start.
	(set, who)  Use arg3 instead of arg2 for the auxiliary list,
	because arg2 is used by the access rules to offer reasons. 
	(accept)  Allow a comment to be given on the command line,
	as with the reject command.
	
	* lib/Mj/Access.pm: (list_access_check) Make the command mode 
	available to the access rules.

	* lib/Mj/Format.pm: (post) Do not print comment on success.
	(accept) Indicate whether or not the victim was notified.

	* lib/Mj/List.pm: (valid_aux) Rename validate_aux to valid_aux
	and use it to untaint the sublist name, ala valid_list.

2000-07-28  Michael Yount <csf@moscow.com>

	* lib/Mj/CommandProps.pm:  Use "auxlist" instead of "sublist."
	The argument names must be alphabetical in relation to the
	order in which the arguments appear on the command line.
	Using "auxlist" allows more flexibility in choosing names
	for the other arguments.

	* lib/Majordomo.pm, lib/Mj/Format.pm:  Combine code for
	the who and auxwho commands.
 
	* lib/Mj/List.pm (expire_subscriber_data): Expire auxiliary
	list data.

2000-07-27  Michael Yount <csf@moscow.com>

	* lib/Mj/Archive.pm:  Make archives of auxiliary lists available.
	(add_start)  Use time derived from the Date: header.
	
	* lib/Mj/Resend.pm (_post):  Archive messages sent to 
	auxiliary lists.

2000-07-26  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Add support for multiple domains.

	* bin/mj_wwwusr:  Restructure to override Mj::Format routines
	for the help, lists, and show commands.  
	Add support for multiple domains.
	Add support for the help and changeaddr commands.
	(Thanks to Sudhakar Chandrasekharan for the help suggestion.)

	* lib/Majordomo.pm (subscribe):  Set the matches_list variable
	if someone attempts to add the -unsubscribe alias to the list.

2000-07-25  Michael Yount <csf@moscow.com>

	* bin/mj_email, bin/mj_enqueue: Add options for new aliases
	  -c COMMAND    Issue a command (-subscribe, -unsubscribe)
	  -M	    Forward message to moderators (-moderator)
	  -x SUBLIST    Post a message to an auxiliary list.
	At present, qmail support does not include auxiliary lists.
	The -moderator alias follows the same conventions as the
	-owner alias.  The auxiliary list aliases follow the same
	conventions as the resend (main list) alias.
	(Thanks to Brock Rozen for suggesting the -(un)subscribe aliases.)

	* bin/mj_queuerun: Handle altered queue file names for new aliases.
	The file names will end with a comma, followed by an auxiliary
	list name or command name or 'M' (for -moderator).
	Remove the unused qmail code.

	* bin/mj_wwwadm, bin/mj_wwwusr: Add support for latchkeys. 
	Instead of sending the password back to the client with the
	results, a temporary password is created with a limited lifetime
	(one hour by default).

	* lib/Majordomo.pm: 
	(dispatch)  Convert a latchkey into a permanent password.
	(gen_cmdline) Take into consideration messages posted to
	auxiliary lists.
	(_createlist)  Use the "aliases" setting to determine
	which aliases to use.  Include alias and sublist data
	when using the MTAConfig module.
	(reject) Include datum concerning whether or not an 
	acknowledgement was sent to the victim.
	(set, _set) Allow use of the "aux" mode to change the 
	settings for an auxiliary list.

	* lib/Mj/Access.pm (_a_forward):  Allow a posted message
	to be forwarded to a different address.

	* lib/Mj/CommandProps.pm: Allow the "sublist" variable
	to be used by the access rules for the "post" command.
	Allow the use of auxiliary lists with the "set-aux" command.

	* lib/Mj/Deliver.pm (deliver):  Obtain the list of subscribers
	from an auxiliary list, if that is the destination.

	* lib/Mj/Format.pm: (auxwho)  Use expanded format, like
	the "who-enhanced" command.
	(reject) For consult tokens, indicate whether or not the
	victim was informed.
	(set) Indicate the sublist if "aux" mode is used.
	(tokeninfo) Indicate the number of approvals required.
  
	* lib/Mj/List.pm:  Cease using AddressList.pm.  Auxiliary
	lists now use the SubscriberList module.
	(set, make_setting) Allow settings to be changed for 
	auxiliary lists.  Digest mode is not supported for sublists.
	Ensure that digest names are converted to lower case.
	(aux_add) Extend the data to accommodate the fields of
	a SubscriberList.
	(aux_get_chunk) Return all of the data instead of just the address.
	(aux_get_matching) New subroutine.
	(aux_rekey) Allow an easy transition from AddressList to 
	SubscriberList by rekeying.
	(moderators) New subroutine.  Obtain a list of moderators from
	1) A named auxiliary list
	2) The 'moderators' auxiliary list
	3) The 'moderators' configuration setting
	4) The 'moderator' configuration setting
	5) The 'sender' configuration setting
	in decreasing order of precedence.
	(_make_aux) Use SubscriberList instead of AddressList
	(validate_aux) New subroutine. Initialize an auxiliary list if it
	already exists.

	lib/Mj/MTAConfig.pm: (add_alias) Allow the use of optional
	(moderator, subscribe, unsubscribe, and auxiliary list) aliases.
	(regen_aliases) Sort the lists alphabetically.

	lib/Mj/MailOut.pm: (deliver) Add the sublist to the argument list.
	(owner_done) Direct the message to the moderators instead of
	the owner, if required.

	lib/Mj/Resend.pm: (post, _post) Allow messages to be posted
	to auxiliary lists.  Add 'sublist' to the access variables.
	Do not increase the sequence number, archive the message,
	or issue digests if the message is posted to a sublist.

	lib/Mj/Token.pm: (consult) Allow moderator groups (auxiliary
	lists) and group sizes to be used.
	(t_expire) Expire latchkeys (temporary passwords).
	(_make_latchkeydb, gen_latchkey, validate_latchkey) New subroutines.
	Latchkeys are temporary passwords used by the WWW interfaces
	to prevent the CGI scripts from passing a permanent password
	back to the client.

2000-07-21  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (connect): Call inform() if a connection
	attempt fails due to access restrictions.
 
	* lib/Mj/Resend.pm (_add_fters): Avoid adding footers
	and fronters to multipart/alternative messages.
	(Thanks to Joe Tremblay.)

2000-07-18  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (reject):  Allow an explanation or a file to
	be specified when a token is rejected.  The usual variable
	substitutions are available for use in the file.

2000-07-17  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Add hypertext links to help pages.
	(Thanks to Sudhakar Chandrasekharan for the suggestion.)

2000-07-16  Michael Yount <csf@moscow.com>

	* lib/Mj/TextOutput.pm:  Remove entirely.

	* lib/Majordomo.pm:  Remove the 'auth' variable from the
	request hash, and make the 'interface' variable specific
	to each session, rather than to each request.  This reduces
	the number of arguments to routines like global_config_get
	and list_access_check by 2.

2000-07-07  Michael Yount <csf@moscow.com>

	* lib/Mj/Parser.pm (parse_args):   Deal with attachments.  If a command 
	accepts here arguments and is iterated,  set the appropriate request
	variable to the attachment file handle.  Otherwise, read
	the data from the file handle into the argument array.
	(Only the post and put commands will use the file handle.)

2000-07-03  Michael Yount <csf@moscow.com>

	* bin/mj_confirm:  Include domain in HTML form (from Olivier Prenant).
	Use Format to present output of sessioninfo.
	Show the expiration date of a token.

2000-07-01  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/BounceParser.pm (parse_lotus): Would accept an all-blank
	bounce.
	(parse_softswitch): Would accept an all-blank bounce.

2000-07-01  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm: (archive_chunk)  Use existing
	Mj::List routines to retrieve messages in 'immediate' mode.

2000-06-30  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm: Formatting rewrite; override Mj::Format 
	routines for the showtokens, tokeninfo, and who commands.

	* lib/Majordomo.pm:
	(faq_start, info_start, intro_start) Remove temporary files.
	(createlist) Use "newlist" variable instead of "list."
	(sessioninfo) Rename to sessioninfo_start.  Treat
	sessioninfo as an iterated core routine.
	(showtokens) Allow tokens shown to be limited to a
	particular command.  Include the size of the spool
	file in the output for posted messages.

2000-06-27  Michael Yount <csf@moscow.com>

	Use new core function calling conventions.

2000-06-26  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (createlist): Return values were done
	improperly for some reason.

	* lib/Mj/BounceParser.pm: Renamed from Bf/Parser.pm.

2000-06-25  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/List.pm (bounce_gen_stats): Fixed calculation of overload
	stats.

	* Rotated old ChangeLog entries.

