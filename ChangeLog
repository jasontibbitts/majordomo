2005-04-28  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_alias)  Make the target the canonical
	address rather than the aliased address.
	(who_chunk)  Use the target to find bookkeeping aliases.
	Thanks to John Levine.

	* lib/Mj/Addr.pm:  (_alias)  Do not use alias information from
	a bookkeeping alias.

2005-03-16  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (connect)  Use delete instead of undef
	to quell a warning.  Thanks to SRE.

2005-03-06  Michael Yount <csf@moscow.com>

	* lib/Mj/Resend.pm:  (_r_strip_body)  Mark the body as changed
	when a multipart message is condensed to a single part.
	Thanks to Richard Birkett.

2005-02-26  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (dispatch)  Account for the possibility
	of a failed "owner" event.

	* lib/Mj/Access.pm:  (_a_mailfile)  Take pains to prevent
	a mail loop of the whoami_owner address with itself.
	(_d_owner)  Messages to the list owners are now subject to 
	the access rules.

	* lib/Mj/CommandProps.pm:  Messages to the list owners are
	now subject to the access rules.

	* lib/Mj/Inform.pm:  (_inform_owner)  Take pains to prevent
	a mail loop of the whoami_owner address with itself.

	* lib/Mj/MailOut.pm:  (owner_done)  Apply the access rules
	to messages sent to the list owners which were not handled
	by the bounce parser.

2005-01-31  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (connect)  Give a reasonable value
	for the elapsed time if the connection fails.
	Thanks to Marc Fournier.

	* lib/Mj/Parser.pm:  (parse_part)  Give a reasonable value
	for the elapsed time if no commands are found.

2005-01-16  Michael Yount <csf@moscow.com>

	* lib/Mj/Access.pm:  (_d_advertise)  Show information about
	a list if an admin password for the list is used.
	Thanks to Roger Klorese.

2004-12-09  Michael Yount <csf@moscow.com>

	* files/INDEX.pl:  The "unregistered" file has a "noweb"
	counterpart.

	* lib/Majordomo.pm:  (trigger, _unregister)  Send farewell
	messages as appropriate when an address is unregistered.
	Suggested by Brock Rozen.

	* lib/mj_cf_data.pl, mj_cf_defs.pl:  The farewell and
	farewell_files settings are also GLOBAL.

	* lib/Mj/CommandProps.pm:  Support the unregister-farewell
	and unregister-nofarewell commands.

2004-12-08  Michael Yount <csf@moscow.com>

	* lib/Mj/CommandProps.pm:  Support the who-noname command,
	which prints the plain address without comments.
	Suggested by Steven Orr.

	* lib/Mj/Format.pm:  (who)  Support the who-noname command.

2004-12-01  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_subscribe)  Log a "register" event
	if the subscription causes the subscriber to be registered.

2004-11-22  Michael Yount <csf@moscow.com>

	* lib/Mj/Config.pm:  (compile_pattern)  Change the 'ALL'
	pattern to work around a bug for the empty pattern (//).
	Thanks to Dean Collins.

2004-11-09  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (who_chunk)  Fix MSGNO substitution.
	Thanks to Roger Klorese.

2004-11-05  Michael Yount <csf@moscow.com>

	* lib/Mj/Addr.pm:  (setcomment)  Add quotes if needed.
	(_xform)  Always validate the address.  Thanks to SRE.

	* lib/Mj/Resend.pm:  (_exclude)  Skip invalid addresses.

2004-11-04  Michael Yount <csf@moscow.com>

	* lib/Mj/Format.pm:  (g_get, index, put)  Use the FULLPATH
	substitution to avoid a substitution race condition.
	Thanks to SRE.

2004-10-30  Michael Yount <csf@moscow.com>

	* bin/mj_enqueue:  Place the mj_queueserv lock in the lock
	directory.  Suggested by SRE.

	* lib/Mj/Archive.pm:  (add_done)  Sort the archives to 
	prevent a race condition.
	(get_all_data, expand_range)  Support split archives.
	Thanks to Roger Klorese.
	
	* lib/Mj/Lock.pm:  (expire_locks)  Do not remove the queueserv
	lock file.

	* setup/setup_func.pl:  (make_alias_symlinks)  Unlink before
	creating a symlink.  Thanks to SRE.

2004-10-27  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (list_config_get)  Retrieve GLOBAL
	settings for the ALL pseudo-list.  Thanks to Marc Fournier.

2004-10-23  Michael Yount <csf@moscow.com>

	* lib/Mj/Inform.pm:  (inform)  Add a shell hook.
	Suggested by Marc Fournier and John Hansen.

2004-10-22  Michael Yount <csf@moscow.com>

	* lib/Mj/Format.pm:  (lists)  Use the lists_aux_none format
	file when no auxiliary lists are found.
	Thanks to Roger Klorese.

2004-10-21  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Add support for the sublist command.

	* lib/Majordomo.pm:  (sublist, _sublist)  Add support
	for the sublist command.  Suggested by Roger Klorese.
	(_subscribe) Exclude digest subscriptions for sublists.  
	(trigger)  Update the registry after a subscription 
	expires.  Thanks to SRE.
	
	* lib/Mj/CommandProps.pm:  Add support for the sublist command.

	* lib/Mj/Format.pm:  Add support for the sublist command.

	* lib/Mj/List.pm:  (get_setting_data)  Exclude digests
	from the list of classes for sublists.
	(aux_create, aux_destroy)  Support the creation and destruction
	of sublists.

	* lib/Mj/SimpleDB/Base.pm:  (erase)  Remove a sublist's database
	file if one exists.

2004-10-18  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  Version number is now 0.1200410180.
	(_lists_aux)  The lists-aux command now displays only
	auxiliary lists.
	(who_chunk)  Bugfix:  Retrieve subscriber info for sublists
	of the DEFAULT pseudo-list.
	(standard_subs)  Add the PLIST substitution, which contains
	the list name without any sublist.

	* lib/Mj/CommandProps.pm:  The lists-aux command precludes
	the use of other command modes.

	* lib/Mj/Format.pm:  (lists)  Add format file support for the
	lists-aux command.

	* lib/Mj/Inform.pm:  (_inform_owner)  Bugfix:  Use GLOBAL
	settings when informing about the DEFAULT pseudo-list.

2004-10-13  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Fix substitution typos.

	* lib/Majordomo.pm:  (_changeaddr)  Use the xformed
	address instead of the stripped address for equivalence
	tests.  Thanks to SRE.
	(_unalias)  Remove hard-coded error messages.

	* lib/Mj/CommandProps.pm:  Allow the unalias command to
	accept a here document.

	* lib/Mj/Format.pm:  (unalias)  Process with g_sub().
	(g_sub)  Support the VICTIM substitution when the
	command fails.

2004-10-12  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Add support for the unalias command,
	and allow the aliases database to be searched.

	* bin/mj_wwwusr:  Delete unneeded request data before
	the "show" command is run.

	* lib/Majordomo.pm:  (who_chunk)  Handle chunks of data
	more consistently when some data are discarded.

	* lib/Mj/Format.pm:  (who)  Add format file support for
	the "who-alias" command.

2004-10-10  Michael Yount <csf@moscow.com>

	* lib/Mj/Deliver.pm, et al.:  Make use of the qmail path
	specified during the installation process.

2004-10-09  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  Version number is now 0.1200410090
	(_reg_add)  Atomically change the registration data to 
	avoid a race condition.  Thanks to SRE.

2004-10-03  Michael Yount <csf@moscow.com>

	* bin/mj_confirm, mj_wwwadm, mj_wwwusr:  Change the debug
	level to match the appropriate debug setting.

	* bin/mj_queuerun:  Limit each queue runner to 1000 messages.

2004-09-30  Michael Yount <csf@moscow.com>

	* lib/Mj/Resend.pm:  (_r_strip_body)  Alter the headers
	of a cleaned or formatted body part as little as possible.

2004-09-29  Michael Yount <csf@moscow.com>

	* bin/mj_enqueue, et al.:  Change the real uid and gid
	to match their effective counterparts.
	Thanks to James Grinter.

	* lib/Mj/Config.pm:  (parse_attachment_filters)  Support
	the "keep" action, which allows multipart types to pass
	without having their subparts filtered.

	* lib/Mj/Resend.pm:  (_post)  Use the original message body
	instead of the decoded and re-encoded body if no alterations
	were made to the body.
	Thanks to Steve Kennedy.

2004-09-18  Michael Yount <csf@moscow.com>

	* Makefile.PL, postinstall:  Qmail requires mj_enqueue
	and mj_email to be setuid in case a domain is managed
	by some user other than the majordomo user.
	Thanks to Peter Ajamian.

2004-09-17  Michael Yount <csf@moscow.com>

	* lib/Mj/Access.pm:  (list_access_check)  Remove
	definition test, which was preventing reply messages
	from being sent.

	* lib/Mj/Format.pm:  (who)  Support a "who_none" format
	file, which indicates that no addresses were found.
	Thanks to SRE.

	* lib/Mj/Resend.pm:  (post)  Do not send an ack if the
	reply is NONE.  Thanks to SRE.

2004-09-11  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Add support for directory and file
	creation and deletion.

	* lib/Majordomo.pm:  (_put) Untaint the file name.

	* lib/Mj/Format.pm:  (put)  Support the put_delete
	and put_dir format files.

2004-09-10  Michael Yount <csf@moscow.com>

	* lib/Mj/Format.pm:  (put)  Support PARENT and PATH
	substitutions.

2004-09-09  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (archive_start)  Initialize to avoid
	warnings.

	* lib/Mj/Access.pm:  (list_access_check)  Initialize the
	victim variable.
	(_a_default)  Supply a reason when "list" access causes
	a request to be denied.

	* lib/Mj/Format.pm:  (g_get)  File and directory substitutions
	only apply to the "get" command.

	* lib/Mj/List.pm:  (is_subscriber)  Add a definition test
	to avoid crashing.

2004-09-08  Michael Yount <csf@moscow.com>

	* bin/mj_confirm:  Clear the token after the accept or
	reject command is issued.  Thanks to Steven Orr.

	* bin/mj_wwwusr:  Bugfix:  Initialize variable to
	avoid access check crash.  Thanks to Roger Klorese.

	* lib/Majordomo.pm:  (_faq, help_start, _info, _intro)
	Allow files to be mailed from the wwwadm interface.

	* lib/Mj/Format.pm:  (help, g_get)  Allow files to be
	mailed from the wwwadm interface.

	* lib/Mj/Parser.pm:  (parse_part)  Add blank lines for
	readability.

2004-09-06  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_changeaddr)  Preserve 
	subscriptions from aliased addresses.
	(_unalias)  Correct subscription addresses and alias
	targets.

2004-09-05  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_alias_reverse_lookup)  Base the
	lookup on the target, not the striptarget, field.
	(_changeaddr)  Issue an error if the old and new addresses
	are identical.
	Bugfix:  Adjust aliases properly when the changeaddr command
	is issued from an alias.  Thanks to Roger Klorese.

	* lib/Mj/Format.pm:  (show)  Substitution correction.

2004-09-04  Michael Yount <csf@moscow.com>

	* lib/Mj/FileSpace.pm:  (index)  Return 1 instead of 0
	if the directory is empty.

	* lib/Mj/Format.pm:  (index)  Add format file support.

2004-09-03  Michael Yount <csf@moscow.com>

	* bin/mj_email, mj_queuerun:  Remove temporary files.

	* lib/Mj/Access.pm:  (_a_reply, _a_replyfile)  Return
	"NONE" instead of an empty string for the "NONE" reply.

	* lib/Mj/Format.pm:  Don't print anything if a command
	does not succeed and a reply of "NONE" is specified.

	* lib/Mj/Parser.pm:  (parse_part)  Don't print the
	results if a command does not succeed and a reply
	of "NONE" is specified.

2004-09-02  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Add support for an archive search form
	on the archive summary page.

	* lib/Majordomo.pm:  Version number is now 0.1200409020.
	(archive_chunk)  Mail messages retrieved with the archive-get
	command to the victim, not to the user.

	* lib/Mj/Format.pm:  (archive)  Support the YEARS substitution
	in summary mode, which contains a list of the years for
	which archives are available.

2004-09-01  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Bugfix:  Process configshow arguments
	correctly.

2004-08-31  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_archive)  Only show archives for
	the specified sublist when the archive-summary command
	is used.

	* lib/Mj/Archive.pm:  (summary)  Only summarize archives
	for the specified sublist.

2004-08-30  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Support the plain who command.

	* lib/Mj/Format.pm:  (who)  Add format file support for
	the who-summary command.
	(archive)  Allow the web interfaces to break long lines in
	plain text message parts.  Implemented by Peter Ajamian.

2004-08-29  Michael Yount <csf@moscow.com>

	* bin/mj_wwwusr:  Allow the archive-get and archive-get-digest
	commands to work.

	* lib/Majordomo.pm:  (_list_file_get_string)  Unlink the
	temporary file if substitutions are provided.
	(archive_chunk)  Replaced hard-coded English with error files.
	Use digest_archive_preindex and related files to format digests
	retrieved by the archive-get-digest command.
	(_digest_get_headers)  New method.  Retrieve headers from
	message_headers and other settings and perform variable 
	substitution.
	(_set)  Use digest_partial_preindex and related files to 
	format partial digests.

	* lib/Mj/Format.pm:  (archive)  Add format file support for
	the archive-get and archive-get-digest commands.
	(configshow)  Convert comments from plain text to HTML for
	the web interfaces.

	* lib/Mj/Resend.pm:  (do_digests)  Call _digest_get_headers
	to obtain headers.

	* lib/Mj/Util.pm:  (text_to_html)  New routine.  Convert
	text to HTML in a way that allows new line breaks.

	* lib/Mj/Digest/Build.pm:  (build)  Remove redundant "To"
	and "From" headers.

2004-08-26  Michael Yount <csf@moscow.com>

	* lib/Mj/Format.pm:  (lists)  Use separate head and foot
	format files for the lists-full command.

2004-08-22  Michael Yount <csf@moscow.com>

	* bin/mj_wwwusr:  Ask for an e-mail address with optional
	name as needed, instead of displaying an error message.
	Require a valid e-mail address to use the archive command.

	* lib/Majordomo.pm:  (connect)  Allow the web interfaces
	to perform their own e-mail address authentication.

2004-08-21  Michael Yount <csf@moscow.com>

	* bin/mj_wwwusr:  Ask for a list name or login as needed
	instead of displaying an error message.
	Thanks to Steven Orr.

2004-08-09  Michael Yount <csf@moscow.com>

	* lib/Mj/Resend.pm:  (post)  Initialize the admin and
	taboo access variables.

2004-08-03  Michael Yount <csf@moscow.com>

	* lib/Mj/Resend.pm:  (do_digests)  Bugfix:  Override the
	SENDER substitution using the actual sender.
	Thanks to Dean Collins.

2004-07-12  Michael Yount <csf@moscow.com>

	* setup/setup_func.pl:  (read_mj_config)  Allow values
	to be read from an installed .mj_config file.
	Thanks to Peter Ajamian.

2004-07-11  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_createlist)  Copy the MTA options
	to avoid persistently changing them in "nocreate" mode.
	Thanks to Darren Stalder.

	* setup/query_util.pl:  (get_passwd)  Do not allow commas
	in passwords.
	Thanks to Darren Stalder.

	* setup/setup_func.pl:  (install_response_files)  Install
	the setup scripts to allow site/domain reconfiguration
	outside the source directory.

2004-07-10  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  Version number is now 0.1200407100.

	* lib/Mj/Parser.pm:  (parse_part)  Support the SESSIONID
	substitution in the command summary.

	* lib/Mj/Resend.pm:  (_check_approval)  Issue an error
	if an "Approved" line is not followed by a blank line
	or a valid e-mail header.

2004-06-28  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_changeaddr)  Allow two addresses
	with identical xforms, which are not aliases, to be
	used.  Thanks to SRE.

2004-06-26  Michael Yount <csf@moscow.com>

	* lib/Mj/BounceParser.pm:  Add various sanity checks.
	Thanks to SRE.

2004-06-22  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_rekey)  Bugfix:  Take bookkeeping
	aliases into account when rekeying the alias database.
	Thanks to SRE.

	* lib/Mj/List.pm:  (aux_rekey)  Bugfix:  Rekey based
	upon the stripped address, to allow xforms to be reversed.
	Thanks to SRE.

2004-06-19  Michael Yount <csf@moscow.com>

	* lib/Mj/CommandProps.pm:  Bugfix:  The "info" and "intro"
	commands should also work in a GLOBAL or DEFAULT context.

2004-06-14  Michael Yount <csf@moscow.com>

	* lib/Mj/SimpleDB/Text.pm:  (get_matching_quick_regexp)  Bugfix:
	Remove anchors from the pattern more thoroughly.
	(The rekey-verify command was returning spurious results for
	text databases.)  Thanks to SRE.

2004-05-24  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_showtokens)  Show tokens for the
	"ALL" pseudo-list along with GLOBAL tokens.

	* lib/Mj/Token.pm:  (confirm)  Bugfix:  Record commands
	for the "ALL" pseudo-list under ALL rather than GLOBAL.
	Thanks to Roger Klorese.

2004-05-17  Michael Yount <csf@moscow.com>

	* lib/Mj/CommandProps.pm:  Allow the who command to use
	the "common" and "alias" modes together.

2004-04-29  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Bugfix:  Remove white space from list names.
	Thanks to SRE.

2004-04-07  Michael Yount <csf@moscow.com>

	* bin/mj_email, mj_enqueue:  (do_qmail)  Bugfix:  
	Recognize extensions to the majordomo-owner address.
	Thanks to Peter Ajamian.

	* lib/Mj/Access.pm:  (list_access_check)  Add support
	for the COMMAND substitution to reply files.

	* lib/Mj/Config.pm:  (parse_bounce_rules)  Bugfix:
	eliminate rule duplication.  Thanks to Peter Ajamian.

2004-03-24  Michael Yount <csf@moscow.com>

	* lib/Mj/FileSpace.pm:  (_empty_dir)  Bugfix:  Call
	closedir() instead of close() for a directory.

	* lib/Mj/List.pm:  (rename_archive)  Bugfix:  Call
	closedir() instead of close() for a directory.

2004-03-02  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (who_chunk)  Bugfix:  Reduce the
	chunk size as addresses with bounces are found.

	* lib/Mj/Archive.pm:  (_dim)  Bugfix:  Cope properly
	with leap years.  Thanks to Steven Orr.

	* lib/Mj/Format.pm:  (who)  Support the MODE substitution.

2004-02-16  Michael Yount <csf@moscow.com>

	* convertdb.pl:  Add -p (list files but don't change them)
	and -c (clean up backup databases) options.  Thanks to SRE.

2004-02-11  Michael Yount <csf@moscow.com>

	* lib/Mj/BounceHandler.pm:  (handle_bounce_token)  Bugfix:
	Use the correct sender in inform() call.

	* lib/Mj/MailOut.pm:  (mail_entity)  Add Date and Message-ID
	headers if they are not present.
	Thanks to Richard Birkett.

2004-02-10  Michael Yount <csf@moscow.com>

	* lib/Mj/Config.pm:  (parse_bounce_rules)
	Validate "remove" action modes.

2004-02-09  Michael Yount <csf@moscow.com>

	* lib/Mj/BounceHandler.pm:  (handle_bounce_probe)
	Include the reasons from the token data.
	(handle_bounce_user)  Bugfix:  Only mention that
	the subscriber was removed for no probe/no consult.
	Thanks to SRE.

2004-02-06  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (digest)  Add missing substitutions.
	Thanks to SRE.

	* lib/Mj/Format.pm:  (createlist, set, show)  Sanitize
	lists more carefully.  Thanks to SRE.

	* lib/Mj/Inform.pm:  (_inform_owner)  Remove example.com
	from two substitutions.  Thanks to SRE.

	* lib/Mj/Util.pm:  (process_rule)  Add "or" to the list
	of Safe compartment operations.  Thanks to SRE.

2004-02-04  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (connect)  Initialize variables
	sooner to avoid warnings.  Thanks to Brock Rozen.

2004-02-03  Michael Yount <csf@moscow.com>

	* convertdb.pl:  Remove parentheses in "grep" arguments.
	Thanks to SRE.

	* bin/mj_queueserv:  (in, out) Validate file handle.
	Thanks to SRE.

	* lib/Majordomo.pm:  (_make_list)  Add valid_list
	callback.

	* lib/Mj/Access.pm:  (_d_post)  Add anchors to restrict_post
	tests.

	* lib/Mj/Config.pm:  (parse_restrict_post)  Validate
	the list names.
	(_compile_rule)  Bugfix:  Separate right parens from
	comparisons.  Thanks to SRE.

	* lib/Mj/Util.pm:  (shell_hook)  Do not use ".." in
	scripts directory name in consideration of symlinks.  
	Thanks to SRE.

	* setup/install_util.pl:  (copy_file, rcopy)  Unlink
	the destination before copying.  Thanks to SRE.

2004-01-27  Michael Yount <csf@moscow.com>

	* lib/Mj/Config.pm:  (parse_keyed)  Bugfix:  Count
	array elements before splicing them.
	Thanks to Brock Rozen.

2004-01-23  Michael Yount <csf@moscow.com>

	* lib/Mj/Access.pm:  (list_access_check)  Bugfix:  Arrange 
	to delete the spool file for a posted message if the only
	terminal action is "forward".

	* lib/Mj/Resend.pm:  (post)  Delete any temporary files
	(In particular, the spool file if a message was forwarded.)

2004-01-20  Michael Yount <csf@moscow.com>

	* lib/Mj/Resend.pm:  (post, _post, _check_approval, do_digests)  
	Bugfix:  Record the correct interface in the log.
	Thanks to Brock Rozen.

2004-01-19  Michael Yount <csf@moscow.com>

	* lib/Mj/Access.pm:  (check_headers)  Bugfix:
	Add missing Safe compartment operations for perl 5.8.
	Thanks to Brock Rozen.

2004-01-17  Michael Yount <csf@moscow.com>

	* lib/Mj/Parser.pm:  (parse_part)  Bugfix:  fix typo
	that prevented results from being mailed to a 3d party.
	Thanks to Dean Collins.

2004-01-14  Michael Yount <csf@moscow.com>

	* bin/mj_shell:  Add support for the "default list" command.

2004-01-13  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  Version number is now 0.1200401130.
	(get_all_lists, help_start)  Set the "nostall" access
	variable to avoid delays.
	(_get_stock)  Disable all warnings briefly to avoid
	perl 5.8.2 spurious warnings.  Thanks to Brock Rozen.
	(alias, createlist, et al.)  Call list_access_check
	instead of global_access_check for all GLOBAL commands
	to accommodate list admin credentials for the commands.

	* lib/Mj/Access.pm:  (list_access_check)  Support
	the list_password access variable, which will recognize
	list admin credentials used in a GLOBAL context.
	Instead of reporting an invalid password, by default
	a valid list admin password will be ignored.

	* lib/Mj/CommandProps.pm:  Add support for the "list"
	and "list_password" general access variables, and
	the "newlist" access variable for the createlist
	command.
	Bugfix:  The unsubscribe command does not support
	the "ALL" list.

	* lib/Mj/Config.pm:  (_compile_rule)  Bugfix:  Fix
	quoting problems when access variables appear on
	the right-hand side of comparisons.

	* lib/Mj/MailOut.pm:  (mail_message)  Do not mail
	messages to example.com addresses.

	* lib/Mj/Parser.pm:  (parse_part)  Improve support
	for the "default list" command.

	* lib/Mj/Token.pm:  (confirm)  Ensure that GLOBAL
	commands result in GLOBAL tokens.

2003-11-19  Michael Yount <csf@moscow.com>

	* convertdb.pl:  Support db->text conversions, and 
	improve error checking.
	Thanks to Mohamed Lrhazi.

	* bin/mj_shell, mj_wwwadm:  Use "default" descriptions
	for the newfaq, newinfo, and newintro commands.

	* lib/Majordomo.pm:  Version number is now 0.1200311190.
	(_get_stock)  "no warnings" directive is not supported
	by perl 5.5.  Thanks to Marc Fournier.

2003-11-18  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_put)  If the file description is
	the word "default," use the existing description.
	(_get_stock)  Avoid spurious "deprecated" warnings from 
	perl 5.8.2.  Thanks to Brock Rozen.

	* lib/Mj/Parser.pm:  Remove hard-coded English.
	Use a file's description in the Subject header if the 
	output of a command is mailed to another person.

2003-11-16  Michael Yount <csf@moscow.com>

	* lib/Mj/Addr.pm:  (_validate)  Bugfix:  Return the full domain.
	Thanks to Roger Klorese.

2003-11-12  Michael Yount <csf@moscow.com>

	* lib/Mj/BounceHandler.pm:  (handle_bounce_message)  Override
	the address found by the parser with the VERP address if
	necessary.
	(handle_bounce_removal)  Bugfix:  Convert the address from 
	an object to a string when substituting.
	Thanks to Roger Klorese and Jeff Wasilko.

2003-11-08  Michael Yount <csf@moscow.com>

	* lib/Mj/MailOut.pm:  (welcome)  Increase the message count
	only if a welcome file has already been processed.
	Thanks to Roger Klorese.

2003-11-04  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  Version number is now 0.1200311040.
	(_createlist)  Pass the domain name to the shell hook.

	* lib/Mj/BounceHandler.pm:  (_hbr_noprobe)  Pass the
	domain, list, and user to the shell hook.

	* lib/Mj/Resend.pm:  (_r_strip_body)  Add missing ops
	for perl 5.8.1 compatibility.  Warn if an error occurs
	in the filtering code.

2003-11-03  Michael Yount <csf@moscow.com>

	* setup/install_util.pl:  (copy_file)  If a link was requested
	and the Mj2 and CGI directories occupy different partitions,
	use a symbolic link.
	Thanks to Eric Sorenson.

2003-11-02  Michael Yount <csf@moscow.com>

	* lib/Mj/Addr.pm:  (_xform)  Add safe ops for perl 5.8.1
	compatability.

	* lib/Mj/Resend.pm:  (_check_header, _check_body, _r_strip_body)
	Add safe ops for perl 5.8.1 compatibility.

	* lib/Mj/Util.pm:  (process_rule, re_match)  Add safe ops
	for perl 5.8.1 compatibility.
	Thanks to Brock Rozen.

2003-11-01  Michael Yount <csf@moscow.com>

	* Makefile.PL:  Compensate for changes in the MakeMaker
	installbin routine.  Thanks to Devin Reade.

2003-10-29  Michael Yount <csf@moscow.com>

	* lib/Mj/MIMEParser.pm:  (parse_open)  Bugfix:  Call
	parse_in() instead of parse_open() as needed to allow
	Mj2 to work with MIME::Tools version 4 again.

	* lib/Mj/Resend.pm:  (_r_ck_header)  Bugfix:  Initialize
	the dup_msg_id access variable correctly to avoid 
	tickling the tainting bug in perl 5.5 and earlier versions.

2003-10-28  Michael Yount <csf@moscow.com>

	* bin/mj_enqueue:  Cope better with empty messages.
	Thanks to SRE.

	* lib/Mj/BounceHandler.pm:  Rewrite to use messages
	instead of hard-coded English.
	(handle_bounce_message)  Compensate for truncated VERP
	addresses.  Thanks to Jeff Wasilko.

	* lib/Mj/BounceParser.pm:  (parse_dsn)  Cope with DSN
	irregularities.  Thanks to Jeff Wasilko.

	* lib/Mj/CommandProps.pm:  Allow the "reason" action
	to be used in the bounce_rules setting.

	* lib/Mj/Config.pm:  (_compile_rule, _ck_var)  Bugfix:
	Allow variables to be used on the right side of comparisons.
	Thanks to SRE.

	* lib/Mj/SimpleDB/Text.pm:  (get_matching*regexp)  Bugfix:
	Remove anchors before calling Mj::File::search().
	Thanks to Eric Luhrs.

2003-10-07  Michael Yount <csf@moscow.com>

	* lib/Mj/Access.pm:  (_d_post)  Bugfix:  Use the correct
	sublist name when testing for Mj1-style restrict_post groups.

2003-09-22  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (substitute_vars_format)  Bugfix:
	Restore newline replacement trick to preserve formatting
	alignment.  Thanks to Roger Klorese.

2003-09-18  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (substitute_vars_format)  Bugfix:
	Remove backslashes before dollar signs on lines that
	have no substitution variables.  Account for newlines
	in regular expressions.  Thanks to Roger Klorese.

	* lib/Mj/Addr.pm:  (new)  Bugfix:  Unfold the address
	before parsing it.  Thanks to David Miller.

2003-09-14  Michael Yount <csf@moscow.com>

	* lib/Mj/Config.pm:  (_compile_rule)  Bugfix:  A sublist
	followed by a right paren (e.g., "(!@MAIN)") in a rule
	would result in a syntax error because the paren was discarded.

	* lib/Mj/Util.pm:  (process_rule)  Bugfix:  The default 
	"ignore" is not a terminal action.

2003-09-12  Michael Yount <csf@moscow.com>

	* lib/Mj/Format.pm:  (configset, configshow, sescape)
	Escape dollar signs to avoid unwanted substitutions.
	Thanks to SRE.

2003-08-30  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_get_msg_data)  Improve MIME
	entity validation.

	* lib/Mj/Resend.pm:  (_r_ck_body, _add_fters) Improve 
	validation of MIME body parts.

2003-08-13  Michael Yount <csf@moscow.com>

	* lib/Mj/Resend.pm:  (_r_strip_body)  Bugfix:  allow
	single-part HTML messages to be cleaned.
	(clean_text)  Distinguish empty elements from elements
	with content.
	Process the decoded, not encoded, text.

	* lib/Mj/Util.pm:  (plain_to_hyper)  Change the escape()
	calling conventions
	(clean_html)  Distinguish empty elements from elements
	with content.
	
2003-08-12  Michael Yount <csf@moscow.com>

	* lib/Mj/Resend.pm:  (_r_strip_body)  Bugfix:  preserve
	the original character set and encoding of altered
	message parts.
	(_format_text)  Process the decoded, not encoded, text.

2003-06-20  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (connect)  Close the session handle
	explicitly to avoid potential descriptor leak.

	* lib/Mj/Token.pm:  Improve error checking when 
	_make_tokendb is called.

2003-06-12  Michael Yount <csf@moscow.com>

	* bin/mj_wwwusr:  Give a clearer response when someone signs
	in.  Suggested by Roger Klorese.

2003-06-08  Michael Yount <csf@moscow.com>

	* lib/Mj/Config.pm:  (parse_taboo_body, parse_taboo_headers)
	Bugfix:  Skip lines that have no pattern.
	Thanks to Roger Klorese.

2003-06-06  Michael Yount <csf@moscow.com>

	* lib/Mj/Config.pm:  (parse_bounce_rules)  Bugfix:  Add
	missing "use" declaration.

2003-05-29  Michael Yount <csf@moscow.com>

	* bin/mj_email, mj_queuerun:  (connect_and_parse)  Discard the
	message instead of forwarding it if the connection fails.

	* lib/Majordomo.pm:  Version number is now 0.1200305290.
	(connect)  Integrate the block_headers setting with the
	access_rules setting.

	* lib/Mj/Access.pm:  (check_headers)  Integrate the
	block_headers setting with the access_rules setting.
	(_d_access)  Deny connections if one of the block_headers
	patterns matched.
	(_d_post)  Consult the owners if any non-capitalized taboo
	variable matched.
	(describe_taboo)  Rename Mj::Resend::_describe_taboo and
	add error file support.

	* lib/Mj/CommandProps.pm:  Add "block" variable for
	the "access" command and the "reason" action for the
	"access" and "advertise" commands.

	* lib/Mj/Config.pm:  (parse_access_rules, _compile_rule)  
	Add support for "block" variables from the block_headers 
	setting.

	* lib/Mj/Resend.pm:  (_ck_tbody_line)  Make this function
	a method to allow error file support.
	(_describe_taboo)  Relocate to Mj::Access::describe_taboo.

2003-05-27  Michael Yount <csf@moscow.com>

	* lib/Mj/Archive.pm:  (add_start)  Add workaround for
	tell() bug in some versions of Perl.
	Thanks to Erich Schraer.

2003-05-20  Michael Yount <csf@moscow.com>

	* lib/Mj/Format.pm:  (showtokens)  Add support for the 
	VICTIM substitution.  Suggested by Cory Daehn.

	* lib/Mj/Resend.pm:  (post)  Bugfix:  Allow newlines
	when untainting moderation reasons.
	Supply a reason when an author's address is invalid.

2003-05-07  Michael Yount <csf@moscow.com>

	* lib/Mj/Access.pm:  (_a_default)  Add error file support 
	for several messages.

2003-04-30  Michael Yount <csf@moscow.com>

	* lib/Mj/CommandProps.pm:  Add support for the "recipients"
	access variable, which contains the number of e-mail addresses
	in the To and Cc headers of a posted message.

	* lib/Mj/Resend.pm:  (_r_ck_header)  Count the number of
	recipients in the To and Cc headers of a message.
	(_exclude)  Check all To and Cc headers.
	(_post)  Create exclusion list before the headers are munged.
	
2003-04-29  Michael Yount <csf@moscow.com>

	* lib/Mj/Resend.pm:  (_post)  Apply "From" header changes
	to the archived copy of a message.

2003-04-23  Michael Yount <csf@moscow.com>

	* lib/Mj/Resend.pm:  (post)  Bugfix:  Untaint moderation
	reasons to avoid tainting bug in old versions of Perl.
	Thanks to John Levine.
	(_post)  Issue a warning if any of the access variables is
	tainted.
	(_check_header, et al.)  Avoid warnings for taboo code eval
	when no patterns are defined.

2003-04-19  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Resend.pm (post): Add some additional access variables to
	$any.

	* lib/Mj/Access.pm (_d_post): Add invalid_from as an access
	variable causing consultation by default.
	(list_access_check): Turn logging of access variables back on;
	it's too useful.

2003-04-17  Michael Yount <csf@moscow.com>

	* lib/Mj/Access.pm:  (_a_forward)  Use reply files
	to allow for language translation.

	* lib/Mj/Resend.pm:  (_post)  Bugfix:  Extract the
	author's address from the headers again when the
	message is archived; it may have been changed.
	Thanks to Brock Rozen.

2003-04-16  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/List.pm (is_subscriber): Add better logging for invalid
	and anonymous addresses.

2003-04-12  Michael Yount <csf@moscow.com>

	* lib/Mj/BounceHandler.pm:  (handle_bounce_user)  Add a
	"digest" bounce variable to support special bounce rules
	for digest users.  The variable will contain the name of
	the digest or an empty string.  Suggested by John Levine.

	* lib/Mj/CommandProps.pm:  Add support for the "digest"
	bounce variable.

	* lib/Mj/Digest/Build.pm:  (build)  Omit the leading "From "
	line when extracting messages from the archive.
	Thanks to Roger Klorese.

2003-04-11  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_announce)  Use the whoami_owner
	address in the From header of each announcement.

2003-04-10  Michael Yount <csf@moscow.com>

	* lib/Mj/Resend.pm:  (do_digests)  Prevent "To" and "From"
	headers from being duplicated by the message_headers setting.

2003-04-08  Michael Yount <csf@moscow.com>

	* lib/Mj/List.pm:  (_make_aux)  Bugfix: Return undef if
	the sublist was not initialized.  Thanks to Mathieu Arnold.

	* setup/query_util.pl:  (prompt)  Allow answers to be read
	from a response file.  Implemented by Rudolph Maceyko.

2003-03-25  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/BounceParser.pm (parse): Accept owner-list as well as
	list-owner in To: lines when extracting special envelope info.
	(parse_dsn): Be more tolerant of weird Action: entries.
	(parse_dsn): Parse Postfix-format continued per-user entries
	properly.

2003-03-11  Michael Yount <csf@moscow.com>

	* lib/Mj/Archive.pm:  (_sync_msgs)  Declare undeclared variables.

	* lib/Mj/Resend.pm:  (_check_mime)  Change calling conventions
	to support format files.

2003-03-09  Jason Tibbitts <tibbs@math.uh.edu>

	* lib/Mj/Deliver/Dest.pm (make_bsmtpenvelope): 
	* lib/Mj/Deliver/Dest.pm (make_envelope): 
	Pass the substitution string down to the envelope.
	
	* lib/Mj/Deliver/Envelope.pm (send): 
	* lib/Mj/Deliver/BSMTPEnvelope.pm (send):
	Substitute the contents of $self->{personal} instead of hardcoding
	$MSGRCPT.

2003-03-09  Michael Yount <csf@moscow.com>

	* lib/Mj/Config.pm:  (lock)  Bugfix:  Load the configuration
	file immediately if it has not already been loaded.
	Thanks to Robert.

2003-03-06  Michael Yount <csf@moscow.com>

	* bin/mj_confirm, mj_wwwadm, mj_wwwusr:  Accommodate IPv6
	addresses.  Thanks to Michael Richardson.

2003-03-04  Michael Yount <csf@moscow.com>

	* lib/Mj/Archive.pm:  (_sync_msgs)  Bugfix:  Collect stats
	about the final message instead of the original message.
	Thanks to Robert.

2003-03-03  Michael Yount <csf@moscow.com>

	* bin/mj_confirm, mj_wwwadm, mj_wwwusr:  Include the character
	set when displaying part of a message with the archive or
	tokeninfo command.  Thanks to Roger Klorese.

	* lib/Majordomo.pm:  (_get_msg_data)  Set the charset for
	message part 0.

	* lib/Mj/Config.pm:  (parse_access_rules)  Do not issue a
	warning for replyfile=NONE.

	* lib/Mj/MIMEParser.pm:  (get_entity_structure)  Include the
	character set for each part in the results.

	* lib/Mj/Resend.pm:  (post)  Bugfix:  Remove the spool file
	if a message is denied and no reply is necessary.
	Thanks to Mathieu Arnold.
	(_within_limits, _check_header)  Use error files 
	instead of hard-coded English.

	* lib/Mj/Util.pm:  (process_rule)  Place reply and replyfile
	actions last to prevent other actions from overriding them.
	(str_to_offset)  Remove unnecessary white space from the
	time description.

2003-02-25  Mathieu Arnold <m@absolight.net>

	* setup/setup_func.pl, lib/Mj/SimpleDB.pm, lib/Mj/SimpleDB/SQL.pm,
	Pg.pm, MySql.pm: Use the real config values for databases backends
	connections.

2003-02-21  Mathieu Arnold <m@absolight.net>

	* lib/Mj/SimpleDB/SQL.pm, Pg.pm, MySql.pm: All the Tables needed are
	now created on demand.

	* setup/ask_basic.pl, setup_func.pl: Add back the possible use of the
	experimentals SQL backends.
	
2003-02-18  Mathieu Arnold <m@absolight.net>

	* lib/Mj/SimpleDB/SQL.pm, Pg.pm, MySql.pm: Add the PostgreSQL and
	MySQL Database backends.

2003-02-12  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (subscribe)  Prevent a variety of reserved
	addresses from being subscribed to a mailing list.
	Suggested by Brock Rozen.

	* lib/Mj/Token.pm:  (confirm)  Bugfix:  Use the correct
	address in To: headers of confirmation messages.
	Thanks to Jeff Wasilko.

2003-02-07  Michael Yount <csf@moscow.com>

	* Makefile.PL:  "make siteconfig" will allow some sitewide
	configuration values to be changed without reinstalling.

	* setup/siteconfig.pl:  Allow the site master password and
	MTA configuration values to be changed without reinstalling.

2003-02-05  Michael Yount <csf@moscow.com>

	* bin/mj_wwwusr:  (surrender)  Add a domain parameter to make
	reconnecting easier.

	* lib/Majordomo.pm:  (archive_chunk, tokeninfo_chunk)  Clean
	HTML message parts if "clean" mode is specified.
	(_set)  Bugfix:  Change only one address for a pattern unless
	allmatching mode is specified.

	* lib/Mj/CommandProps.pm:  Add support for "clean" mode for
	the archive and tokeninfo commands.

	* lib/Mj/Format.pm:  (who)  Convert the nomail return time
	into a readable date.

	* lib/Mj/List.pm:  (add)  Use "each" as the default class
	for sublists.

	* lib/Mj/MIMEParser.pm:  (get_entity_structure)  Use "file"
	instead of "path" for consistency.

	* lib/Mj/Resend.pm:  Add error messages and XLANG markers.
	(clean_text)  Rename _clean_text to reflect external use.

2003-02-03  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/mj_cf_defs.pl: Change default who_access and which_access to
	closed.

2003-01-27  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (dispatch)  Bugfix:  Improve sublist validation
	to avoid taint problems.  Thanks to Roger Klorese.

	* setup/ask_domain.pl:  Bugfix:  Incorporate qmail code as
	needed.  Thanks to Tim Treaster.

2003-01-21  Michael Yount <csf@moscow.com>

	* bin/mj_shell:  Fail gracefully if no domains are defined.
	Thanks to Gary Schrock.

2003-01-18  Michael Yount <csf@moscow.com>

	* bin/mj_queuerun:  (parse_commands) Do not return a result
	if the result file is empty.

	* bin/mj_shell:  (parse_command)  Initialize variable to prevent
	warnings.  Thanks to Brock Rozen.

	* lib/Majordomo.pm:  Version number is now 0.1200301180.
	(_get_msg_data)  Return an error if part 0h is referenced.
	  Thanks to Brock Rozen.

	* lib/Bf/Sender.pm:  Reverse the order of the host and
	user in envelope extensions.  Implemented by John Levine.

	* lib/Mj/Addr.pm:  (_validate)  Bugfix:  Change the list
	separator character temporarily.  Thanks to Tim Treaster.

	* lib/Mj/BounceParser.pm:  (parse)  Reverse the order of
	the host and user in envelope extensions.  Implemented
	by John Levine.

	* lib/Mj/Format.pm:  (who)  Do not display the date and
	previous class for people on temporary vacation.

	* lib/Mj/Deliver/QQEnvelope.pm:  (sender)  Add a VERP
	to any sender address that does not already contain it.
	Implemented by John Levine.

2002-12-19  Michael Yount <csf@moscow.com>

	* lib/Mj/Digest.pm:  (examine)  Bugfix:  Copy the decision
	information to avoid altering it.  Thanks to Brock Rozen.

2002-12-02  Michael Yount <csf@moscow.com>

	* bin/mj_confirm, mj_wwwadm, mj_wwwusr:  Add support for a
	"mode" CGI parameter.

	* lib/Majordomo.pm:  (lists)  Move the pattern validation
	code to _lists to preserve the original pattern.

	* lib/Mj/Format.pm:  (lists)  Use an empty USER substitution
	if a fake address is given.

2002-11-30  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (dispatch)  Differentiate token, probe, and
	regular bounces.

	* lib/mj_cf_defs.pl:  Inform about tokenbounce events by
	default.

	* lib/Mj/BounceHandler.pm:  (handle_bounce)  Return the bounce
	type.
	(handle_bounce_token)  Send the bounce message to the owners
	based upon the inform configuration setting.

	* lib/Mj/Config.pm:  Include probebounce and tokenbounce in the
	list of logged events.

	* lib/Mj/Inform.pm:  (inform)  Do not send notices for
	tokenbounce events.

	* lib/Mj/MailOut.pm:  (owner_done)  Return the bounce type.

2002-11-28  Michael Yount <csf@moscow.com>

	* bin/mj_confirm, mj_wwwadm, mj_wwwusr:  Move hard-coded English
	into format and error files.

	* bin/mj_shell:  Save debugging info to a file (mj_shell.debug)
	instead of using syslog.

	* lib/Majordomo.pm:  Version number is now 0.1200211280.
	Use error files for invalid address messages.

	* lib/Mj/Addr.pm:  (_validate)  Return error message names instead
	of hard-coding the messages themselves.

	* lib/Mj/Config.pm:  (parse_address)  Obtain the error message
	for an invalid address with a callback.

	* lib/Mj/Format.pm:  (lists)  Bugfix:  escape list information
	more thoroughly.

	* lib/Mj/Log.pm:  (add)  Set autoflush on the file handle for
	the "file" method of logging.

2002-11-14  Michael Yount <csf@moscow.com>

	* lib/Mj/Token.pm:  (get_moderator_alias)  Determine the
	mail address at which a group of moderators can be contacted.
	(confirm)  Use the moderators' address in the To header of
	CONSULT messages.  Suggested by SRE.

2002-11-12  Michael Yount <csf@moscow.com>

	* bin/mj_enqueue:  Untaint alias-dependent information to
	cooperate with stricter checking under perl 5.8.0.
	Thanks to Olivier Prenant.

	* lib/Majordomo.pm:  (reject)  Bugfix:  attach the session
	file correctly in messages to administrators.

	* lib/Mj/Digest/Text.pm:  (get_text)  Convert single-part
	HTML messages into plain text in text digests.  Suggested
	by Roger Klorese.

2002-11-08  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  Make use of the password_level and
	make_list error files to replace some hard-coded English.

	* lib/mj_cf_defs.pl:  Use the special "default" keyword
	in welcome_files and farewell_files to support list-specific
	language customizations by default.

	* lib/Mj/List.pm:  Mark hard-coded English messages.

	* lib/Mj/MailOut.pm:  (welcome)  Support the use of the 
	"default" keyword in file descriptions to use the description
	from the file space.  This allows per-list language
	customizations to be supported by default.

	* lib/Mj/Token.pm:  (t_gen)  Adjust the algorithm to avoid
	character wrapping warnings.

2002-10-22  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* setup/install_util.pl (copy_file): Fix precedence error causing
	problems making hard links to be ignored.

2002-10-14  Michael Yount <csf@moscow.com>

	* lib/Mj/SimpleDB/Base.pm:  (_unstringify)  Untaint the data
	as a preliminary workaround for DB_File 1.8xx tainting problems.

2002-09-15  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Config.pm (_upgrade): Restructure; break out upgrade
	functions.

2002-08-10  Michael Yount <csf@moscow.com>

	* lib/Mj/Access.pm:  (_a_mailfile)  Bugfix:  convert Mj::Addr
	objects into strings where necessary.  Thanks to Roger Klorese.

2002-08-09  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (tokeninfo_start)  Add support for
	the token_type access variable.

	* lib/Mj/Access.pm:  (_d_tokeninfo)  By default, deny use
	of the "tokeninfo-replace-part" command for confirm tokens.

	* lib/Mj/CommandProps.pm:  Add support for the token_type
	access variable.

	* lib/Mj/MIMEParser.pm:  (replace_part)  Bugfix:  Reparse
	the message file if part 0 was replaced.

2002-08-06  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (tokeninfo_start)  Add list-specific
	access check with no stall allowed as an interim solution
	for tokeninfo-edit security problems.  Thanks to Nick Simicich.

	* lib/Mj/CommandProps.pm:  Add access information for the
	tokeninfo command.  

	* lib/Mj/Format.pm: (tokeninfo)  Use the token's list to
	retrieve format files.  Thanks to Roger Klorese.

2002-08-05  Jason Tibbitts  <tibbs@math.uh.edu>

	* bin/mj_queuerun (parse_commands): 
	* bin/mj_email (parse_commands): Eliminate any default filename
	from the generated reply message.

2002-07-30  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (format_error)  Allow list-specific
	error file customization.
	(reject)  Account for the new session directory structure
	when attaching the session file.
	
	* lib/mj_cf_defs.pl:  Add "Disposition-Notification-To" to
	the delete_headers setting.  Suggested by Roger Klorese.

	* lib/Mj/Format.pm:  (accept, reject)  Use the token's list
	when retrieving format files.  
	Escape error message.  Thanks to Roger Klorese.

2002-07-28  Jason Tibbitts  <tibbs@math.uh.edu>

	* bin/mj_shell: Fix crash with -D.

	* lib/Majordomo.pm (_lists): Don't modify the values we get from
	_list_config_get; they're just references and changing them will
	change the internal structures.

2002-07-22  Michael Yount <csf@moscow.com>

	* bin/mj_wwwusr:  Allow continued session information to
	be saved in a single file.

2002-07-19  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Majordomo.pm (connect): Add modes to mkdir calls to appease
	old versions of Perl.  When trying to make directories a second
	time, add some debugging output.
	(s_recognize): Don't return $dir2 with a trailing slash.

2002-07-17  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/BounceHandler.pm (_hbr_noprobe): Call a hook when users
	are removed due to bounces.

	* lib/Majordomo.pm (_createlist): Add another call to the
	createlist-regen hook.

2002-07-16  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_register)  Add missing semicolon.

2002-07-16  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Majordomo.pm (s_expire): Expire recursively.  Attempt to
	delete session directories as well.

2002-07-14  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Majordomo.pm (s_recognize): Look for the session in the
	appropriate subdirs as well.  Return the full path to the session
	and other useful info.  Take a flag to turn off file existence
	checks and just check the form of the session (and return a full
	pathname).
	
	(connect): Make session subdirs as necessary.
	(sessioninfo_start): Look where s_recognize says to look instead
	of in a hardcoded directory.

2002-07-12  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/CommandProps.pm: Add nofarewell mode.

	* lib/Majordomo.pm (_unsubscribe): Call welcome() with the
	appropriate data to send a farewell message if needed.

2002-07-11  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/mj_cf_defs.pl: Add defaults for farewell and farewell_files
	settings.

	* lib/mj_cf_data.pl: Add farewell and farewell_files settings.

	* lib/Majordomo.pm (_register, _subscribe): Pass the GLOBAL
	welcome_files setting to welcome().

	* lib/Mj/MailOut.pm (welcome): Take the file table as an argument.

2002-07-10  Jason Tibbitts  <tibbs@math.uh.edu>

	* bin/mj_shell (parse_command): New "default" action: debug, sets
	debug level.
	(debug_log): New function: set up a debug log and change its level.

2002-07-10  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Display the validation error message if a
	list name is invalid.

	* lib/Majordomo.pm:  (standard_subs)  Cope with relocated
	lists.
	(format_get_string)  Bugfix:  Validate the list name.
	Thanks to Roger Klorese.

2002-07-09  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Majordomo.pm (standard_subs): Add the DATE substitution.  No
	reason it can't be available everywhere.

	* lib/Mj/Resend.pm (post): Remove DATE substitution.

	* lib/Majordomo.pm (standard_subs): Add the fronter/footer stuff,
	so the substitutions are available everywhere.  Make sure we don't
	have any recursion.

	* lib/Mj/MailOut.pm (welcome): Remove the fronter/footer stuff.
	
2002-07-08  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Fix typo.

2002-07-08  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/mj_cf_defs.pl: Fix welcome_files; had put 'E' flag on the
	wrong file before.

	* lib/Mj/MailOut.pm (welcome): Handle case where fronters or
	footers don't exist.

	* setup/ask_domain.pl (ask_domain): Fix botched default for strict
	domain checking.

2002-07-07  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Util.pm (shell_hook): New function: implement hooks by
	calling out to shell scripts in a known directory.

	* lib/Majordomo.pm (_createlist): Call a hook after aliases have
	been regenerated.

	* lib/Mj/Resend.pm (_exclude): Also generate lists of list members
	and nonmembers appearing in the To: and CC: headers.
	(_reply_to): Generate NEEDCOPY substitution based on the the
	nonmembers hash.
	(_post): Call _exclude earlier.  Capture $members and $nonmembers
	hashes as well.  Pass $nonmembers to _reply_to.

	* files/en/help/variables: Document NEEDCOPY.

	* files/en/help/configset_reply_to: Mention NEEDCOPY.

	* lib/mj_cf_data.pl: Changed type of reply_to to "string" since it
	since there's no reason it can't contain spaces.

	* files/en/help/variables: Added new welcome files substitutions.

	* lib/Mj/MailOut.pm (welcome): Add FRONTER, FOOTER,
	RANDOM_FRONTER, RANDOM_FOOTER, ALL_FRONTERS, and
	ALL_FOOTERS substitutions.

	* files/en/help/configset_welcome_files: Updated to reference 'E'
	flag.
	
	* setup/setup_func.pl (do_default_config): Substitute
	addr_strict_domain_check as appropriate.

	* setup/query_util.pl (get_addr): New $strict parameter; pass
	'strict_domain_check' to Mj::Addr::new() as appropriate.

	* setup/mta_exim.pl (get_exim_version): New function to detect
	Exim version by calling exim -bV.
	(ask_exim): Use it.

	* setup/ask_domain.pl (ask_domain): Ask about strict domain
	checks, and turn off strict address parsing as appropriate.

	* setup/ask_basic.pl (ask_basic): Suggest Exim as an MTA if its
	binaries exist.

	* lib/Mj/MailOut.pm (welcome): Obey new 'E' flag: force file to
	exist in explicit search path, else just ignore it.

	* lib/Mj/Config.pm (parse_welcome_files): Support new 'E' flag.

	* lib/Mj/Addr.pm (new): Fix long-standing bug: named arguments
	passed along with the address didn't work at all.

	* lib/mj_cf_defs.pl: Make addr_strict_domain_check conditional on
	the install process.
	New default for welcome_files includes 'E' flag for the info
	document, so the useless "no info document exists" message will
	not be sent by default.  If an info document is specified, it will
	be sent as normal.

	* Makefile.PL: Bump config version to 13.

2002-07-06  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_changeaddr)  Log "subscribe" and
	"unsubscribe" events for subscriptions that are changed
	by the changeaddr command.

	* lib/Mj/Access.pm:  (list_access_check)  Bugfix:
	check the password against the session user before checking
	against the requester.

2002-07-04  Michael Yount <csf@moscow.com>

	* bin/mj_confirm, mj_wwwadm, mj_wwwusr, 
	lib/Majordomo.pm, lib/Mj/Format.pm:  Include the list
	name in the arguments when calling Majordomo::format_get_string.

2002-06-30  Michael Yount <csf@moscow.com>

	* Makefile.PL:  Add language choice support.

	* bin/mj_wwwadm:  The report command now has format file
	support.

	* lib/Mj/Format.pm:  (report)  Add format file support.

	* setup/ask_basic.pl:  Offer "fr" language option.
	Thanks to Mathieu Arnold.

	* setup/newdomain.pl:  Add language choice support.

2002-06-28  Michael Yount <csf@moscow.com>

	* lib/Mj/SimpleDB/MySql.pm:  New module, unfinished.
	Thanks to Racheli Neuberger.

	* setup/ask_basic.pl:  Allow the domain list to 
	be empty.

	* setup/newdomain.pl:  Fix domain name typo.  Thanks to
	Brock Rozen.

2002-06-26  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (new) Add domain validity test.
	(reject) Use "IP address" substitution for anonymous
	rejections.  Thanks to Mohamed Lrhazi and Nick Simicich.

	* lib/Mj/Inform.pm:  (_inform_owner)  Use "IP address"
	substitution for anonymous requesters.

	* setup/ask_domain.pl:  Fix typos.  Thanks to Brock Rozen.

	* setup/newdomain.pl:  Ask if the domain should be installed
	or just recorded in the .mj_config file.

2002-06-24  Michael Yount <csf@moscow.com>

	* Makefile.PL:  Move configuration questions into message
	files.  Increase the version number to 12.

	* postinstall:  Move installation messages into message
	files.

	* bin/mj_confirm, mj_wwwusr:  Allow customized "welcome"
	files to be displayed using the "doc" CGI parameter.
	For example, the CGI parameters func=welcome&doc=foo would 
	cause the "welcome_foo" file to be displayed.  The stock 
	welcome file will be displayed if the requested file is
	not found.

	* lib/Mj/Config.pm:  (set)  Return an error message if
	a setting is nonexistent or used out of scope.
	Thanks to Mohamed Lrhazi.

	* setup/ask_basic.pl:  (ask_clear, ask_continue, ask_lang)
	Add functions which prompt for screen clearing, pressing
	enter to continue, and message language.
	Move questions into message files.
	Add the framework for future mysql backend support.

	* setup/ask_domain.pl, ask_queueing.pl, ask_sendsep.pl:  
	Move questions into message files.

	* setup/install_util.pl: (chownmod)  Separate failure cases
	and treat errors individually.

	* setup/mta_exim.pl:  Add Exim 4 support.
	Move messages into message files.

	* setup/mta_postfix.pl, mta_qmail.pl, mta_sendmail.pl:  
	Move questions into message files.

	* setup/newdomain.pl:  Move questions into message files.
	Allow the parameters of an existing domain to be changed.

	* setup/query_util.pl:  (get_addr)  Request and validate
	an e-mail address.
	(get_enum)  Allow unambiguous, case-insensitive abbreviations
	of enumerated values (e.g., "i" for "ignore").
	Move error messages into message files.
	(get_passwd)  Request and validate a password, which must
	not contain internal spaces or tabs.
	(retr_msg)  Return the contents of a message file.

	* setup/setup_func.pl:  Move messages into message files.
	
2002-06-21  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_list_file_get)  Add "STOCK:"
	to the tail end of the file search path.
	Thanks to Roger Klorese.

	* lib/Mj/Config.pm:  (parse_access_array)  Bugfix:
	validate the wizard level correctly.
	Thanks to Roger Klorese.

2002-06-20  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Bugfix:  do not give an error if a
	sublist is used.  Thanks to Roger Klorese.

	* lib/Mj/Access.pm:  (validate_passwd)  Check the
	validity of the mailing list.

	* lib/Mj/Format.pm:  (g_sub)  Escape the victims' addresses.

2002-06-15  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  The digest command has format file support.

	* lib/Majordomo.pm:  (_digest)  Reduce the number of 
	hard-coded response messages.

	* lib/Mj/Format.pm:  (digest)  Add format file support.

	* lib/Mj/List.pm:  (digest_incvol)  Comment out debug info.

2002-06-13  Michael Yount <csf@moscow.com>

	* bin/mj_confirm, mj_wwwadm, mj_wwwusr:  
	Preformatting command results is no longer necessary
	in the mj_confirm and mj_wwwusr interfaces.
	Give precedence to query data over path info in
	determining the domain.
	Escape data more consistently to avoid vulnerabilities.
	Make the "surrender" output more consistent.

	* lib/Majordomo.pm:  (standard_subs)  If the list name
	is invalid, the LIST substitution is set to the 
	empty string.
	
	* lib/Mj/Access.pm:  (list_access_check)  Test admin
	passwords against the sessionuser.
	Thanks to Nick Simicich.

	* lib/Mj/Addr.pm:  (_validate)  Initialize lengths
	to avoid warnings.

	* lib/Mj/Config.pm:  (parse_address)  Bugfix:  Use
	a callback to determine the "whereami" domain.
	(parse_attachment_filters)  Support the "clean"
	action, which sanitizes HTML.

	* lib/Mj/Format.pm:  (help, post, put)  Add format file
	support.
	(show)  Add *_CHECKBOX substitution support for personal
	settings.
	(escape, uescape, qescape)  Return the empty string in response 
	to undefined input.

	* lib/Mj/Resend.pm:  (_r_strip_body, _clean_text)  Support the
	"clean" attachment filter, which removes potentially dangerous
	content from text/html body parts.

	* lib/Mj/Util.pm:  (clean_html)  Given a file containing
	HTML and lists of unwanted attributes and elements, remove
	them from the file.

2002-06-11  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Majordomo.pm (_list_file_get): Accept nodefsearch argument,
	which turns off searching default locations for files.

2002-06-10  Michael Yount <csf@moscow.com>

	* lib/Mj/Filespace.pm:  (index)  Return data in a hashref
	instead of a list.

	* lib/Mj/Format.pm:  (configset)  Bugfix:  Display warnings,
	if present, if the command succeeds.

2002-06-10  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Majordomo.pm (_list_file_get): New calling convention.
	Adapt all _list_file_get callers to new calling convention.

	* lib/Mj/Token.pm:
	* lib/Mj/Resend.pm:
	* lib/Mj/MailOut.pm:
	* lib/Mj/Inform.pm:
	* lib/Mj/Config.pm:
	* lib/Mj/BounceHandler.pm:
	* lib/Mj/Access.pm: New _list_file_get calling convention.

2002-06-10  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  The configdef, configset, and sessioninfo
	commands have format file support.
	Bugfix:  Do not require a valid owner for the createlist
	command unless a list is created.  Thanks to Duncan Hill.

	* lib/Majordomo.pm:  (sessioninfo_start, s_recognize)
	Distinguish invalid session IDs from missing session files.

	* lib/Mj/Format.pm:  Escape CMDPASS data.
	(announce, configdef, configset, sessioninfo)  Add format
	file support.

2002-06-08  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Add format file and supplementary display
	support for the which command.

	* lib/Majordomo.pm:  (_set) Return the stripped address in
	the "stripaddr" variable and the full address in the 
	"victim" variable.
	(_which)  Add a back end for the which core routine to
	allow the command to stall.

	* lib/Mj/CommandProps.pm:  Remove support for the which-regex
	and which-pattern commands.

	* lib/Mj/Format.pm:  (accept, reject) Place the requester's 
	address in quotes for the sake of substitutions.
	(set)  Support the QSADDR substitution.
	(which)  Add format file support.

	* lib/Mj/Token.pm:  (t_accept)  Convert the token data args
	to their request hash equivalents earlier.

2002-06-06  Michael Yount <csf@moscow.com>

	* bin/mj_shell:  Turn ornaments off explicitly if they
	were disabled.

	* bin/mj_wwwusr:  The changeaddr command now has format
	file support.

	* lib/Mj/Format.pm:  (changeaddr)  Add format file support.

2002-06-05  Michael Yount <csf@moscow.com>

	* bin/mj_wwwusr:  The alias and unalias commands now have
	format file support.

	* lib/Mj/Format.pm:  (alias, unalias)  Add format file support.

2002-06-04  Michael Yount <csf@moscow.com>

	* bin/mj_wwwusr:  The password command now has format file
	support.

	* lib/Majordomo.pm:  (_password)  Add support for the 
	password-show command.

	* lib/mj_cf_defs.pl:  Add the RFC 2369 headers to the
	delete_headers default values.  Thanks to Roger Klorese.

	* lib/Mj/CommandProps.pm:  Add support for the password-show
	command.

	* lib/Mj/Deliver.pm:  (_setup)  Bugfix:  Initialize the
	sender variable properly when setting up Probers.

	* lib/Mj/Format.pm:  (accept)  Add support for the accept_stall
	format file.  Thanks to Roger Klorese.
	(accept, reject)  Change the "NOTIFY" substitution to "NOTIFIED".
	(password)  Add format file support.

	* lib/Mj/Token.pm:  (t_accept)  Initialize the "expire" arg
	to avoid warnings.

	* lib/Mj/Deliver/Dest.pm:  (sendenvelope)  Respond to timeouts
	more predictably by forcing the envelope to be reinitialized.
	(flush)  Bugfix:  Initialize the sender for deferred recipients
	correctly.
	
	* lib/Mj/Deliver/Envelope.pm:  (address)  Bugfix:  Repair
	off-by-one response counting error for "452" errors.
	Issue RSET if the address array is empty but the envelope
	is not addressed.
	(send)  Issue RSET if the DATA command produced an error
	response.

	* lib/Mj/Deliver/Prober.pm:  (new)  Bugfix:  Initialize the
	"lhost" argument correctly.

2002-06-02  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Deliver/Dest.pm (_gen_bounces): New Dest calling convention.

	* lib/Mj/Deliver/Sorter.pm (flush): New Dest calling convention.

	* lib/Mj/Deliver/Prober.pm (new): New Dest calling convention.

	* lib/Mj/Deliver.pm (_setup): New Dest calling convention.

	* lib/Mj/Deliver/Dest.pm (new): Take a hash of named args instead
	of a list.  This makes it easier to pass additional arguments.

2002-06-02  Michael Yount <csf@moscow.com>

	* lib/Mj/Format.pm:  Bugfix:  ignore hashrefs in data 
	structures when creating substitution lists.
	Thanks to Roger Klorese.

	* lib/Mj/List.pm:  (make_setting)  Bugfix:  return
	immediately if no setting was provided.

2002-06-01  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Use CHUNKSIZE and EXTRA substitutions to
	allow commands to be completed if the sign in process must
	be completed.  Thanks to Roger Klorese.

	* bin/mj_wwwusr:  Bugfix:  Do not print the HTTP header
	twice when displaying the login page.

	* lib/Majordomo.pm:  (new)  Bugfix:  Untaint any domain names
	retrieved from the mj-domains file.  Thanks to Brock Rozen.
	(_list_sync_owners)  Bugfix:  Test addresses for definition 
	before testing for validity.  Thanks to Roger Klorese.
	(_password)  Add QSADDR and STRIPADDR substitution support
	to the new_password reply file.
	(_createlist)  Pass both the Internet domain and the Mj2
	domain to the MTA configuration module.  Thanks to Matt
	Armstrong.
	(_unsubscribe)  Add QSADDR and STRIPADDR substitution support
	to the farewell reply file.

	* lib/Mj/Access.pm:  (validate_passwd)  Retrieve the latchkey
	from the "chain1" field instead of the "arg1" field.
	(_build_passwd_data)  Bugfix:  Test addresses for definition
	before testing for validity.  Thanks to Brock Rozen.
	(_a_confirm, _a_confirm2)  Bugfix:  Use the repl_confirm_req
	reply file by default if the requester, not the victim, will
	be sent a confirmation message.  Thanks to Nick Simicich.

	* lib/Mj/Format.pm:  (show)  Add support for the QSADDR
	and STRIPADDR substitutions.

	* lib/Mj/List.pm:  (post_gen_stats)  Bugfix:  correct 
	off-by-one error.  Thanks to Matt Armstrong.

	* lib/Mj/MTAConfig.pm:  (add_alias)  Allow the Mj2
	domain and Internet domain to be different.

	* lib/Mj/MailOut.pm:  (welcome)  Add support for the 
	VICTIM substitution.

	* lib/Mj/Token.pm:  (t_add)  Change the chain4 field to
	the approver field.
	(confirm)  Store the group name of the confirmation notice
	recipient in the approver field.  Use the repl_confirm_req
	reply file by default if the requester is sent the confirmation
	notice.
	(t_remind) Determine where the reminder notice should be
	sent more consistently.
	(gen_latchkey)  Store the latchkey in the chain1 field, not
	the arg1 field.

	* lib/Mj/TokenDB.pm:  Change the "chain4" field name to
	"approver".

	* setup/mta_exim.pl:  If the Mj2 domain and the Internet domain
	differ, suggest a domain-specific director/router.
	
2002-05-31  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Majordomo.pm: Update version number to 200205310.

	* lib/Mj/Deliver/Envelope.pm (address): When storing a failed
	address, also store the current sender.

	* lib/Mj/Deliver/Dest.pm (_gen_bounces): Rewrite to generate one
	bounce message per failed address.  Instead of messing with the
	current Dest object's state, allocate a new Dest object.  Pass
	'nobounces' in the argument hash so that we don't bounce
	recursively.

2002-05-31  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Deliver/Connection.pm (getline): Explicitly check for
	error conditions on the SMTP output filehandle and complain if
	found.
	
2002-05-29  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Add support for the register command.
	Bugfix:  Issue an error if no addresses are specified
	for the set, subscribe, and related commands.
	Thanks to Deb Heller-Evans.

	* bin/mj_wwwusr:  The register, unregister, subscribe, and
	unsubscribe commands have format files.

	* lib/Majordomo.pm:  (substitute_vars_format)  Issue a
	warning if a non-ARRAY substitution reference is used.

	* lib/mj_cf_defs.pl:  The default block_headers setting will
	cause messages with "bulk" or "junk" precedence which are sent 
	to the server to be discarded, to prevent mail loops.

	* lib/Mj/Format.pm:  (g_sub)  Add format file support for
	the subscribe, unsubscribe, register, and unregister commands.

	* lib/Mj/MailOut.pm:  (welcome)  Add support for the QSADDR
	substitution, which presents a stripped address in a format
	suitable for URL query strings.

2002-05-27  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Deliver/Dest.pm (new): Save original sender away, in case
	it is useful.
	(_gen_bounces): Send bounces by allocating a new Dest object
	instead of messing around in the current ogbject's internal
	state.

	* lib/Mj/Deliver/Prober.pm (add): Pass on the initial sender to
	the sub-Dest object.

2002-05-27  Michael Yount <csf@moscow.com>

	* bin/mj_confirm, mj_wwwadm:  The accept and reject commands
	now have format files.

	* lib/Majordomo.pm:  (substitute_vars_format)  Use SGML
	entities in CGI data.  Thanks to Mathieu Arnold.
	(accept, reject, tokeninfo_start)  Support error files
	for absent and invalid tokens.

	* lib/Mj/Format.pm:  (accept, reject)  Use format files.
	(indicate)  Do not use indicators for the WWW interfaces.

2002-05-25  Michael Yount <csf@moscow.com>

	* bin/mj_confirm:  Minor CGI data adjustments.

	* bin/mj_shell:  Improve error messages for the 
	"approve" command and invalid commands.

	* bin/mj_wwwadm, mj_wwwusr:  Do not record an error if an
	expired latchkey is used; simply display the login page.

	* lib/Majordomo.pm:  (connect)  Include session expiration
	time in return values.
	(put_start)  Allow "force" mode to create parent directories.
	(_changeaddr)  Fix false aliases bug.  Thanks to Nick Simicich.
	(_createlist)  Do not allow the "global" or "default" list
	to be created.
	(reject)  Bugfix:  display the appropriate message if the
	list of a rejected token has no owners or cannot be initialized.
	(s_recognize)  Recognize the ID of an existing session.

	* lib/Mj/Access.pm:  (list_access_check)  Do not perform
	"mismatch" or "posing" comparisons for two invalid addresses.

	* lib/Mj/CommandProps.pm:  The "force" command mode can be
	used with any variant of the put command.

	* lib/Mj/FileSpace.pm:  (put_start, mkdir)  Create parent
	directories automatically if "force" mode is in use.

	* lib/Mj/Format.pm:  The cgidata request element will be
	supplied directly by each CGI program.
	(qescape)  Convert special characters in a string into
	a format acceptable for a URL query string.

	* lib/Mj/List.pm:  (get_post_data, post_add)  Cope with
	invalid author addresses.  Thanks to Brock Rozen and SRE.

	* lib/Mj/Parser.pm:  (parse_part)  Improve error messages
	for the "approve" command.

	* lib/Mj/Token.pm:  (t_accept)  Check list validity.
	(_make_tokendb, _make_latchkeydb)  Improve error checking.
	(gen_latchkey)  Return expiration time if an array is
	requested.

2002-05-24  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Deliver/SMTP.pm: Add a DUMMY mode, for debugging
	purposes.  When set, no actual SMTP will happen and no mail will
	get sent.
	(send): Dummy mode.
	(getresp): Dummy mode.
	(senddata): Dummy mode.

	* lib/Mj/Deliver/Prober.pm (add): Don't explicitly flush until
	DESTROY time; let the underlying Dest object handle the batching.

	* lib/Mj/Deliver/Dest.pm: Major work to delay all SMTP until flush
	time.  Store batches of adresses+sender but instead of flushing
	when a batch is full or the sender is changed, save off the batch
	and start with a clean one.  When flush is called, go over each
	batch and perform processing as before.
	Add some preliminary BSMTP work.
	(make_bsmtpenvelope): New function: make a BSMTP Envelope.
	(sendenvelope): Make a BSMTP Envelope when the magic @bsmtp host
	is seen.
	(sendenvelope): Explicitly set the sender on the envelope we're
	about to address.
	(add): Use the batch method, which handles the batching and cleans
	up the code a bit.
	(batch): New function to save the current address list and sender
	away for later processing.
	(flush): Loop over batches, sending each one.
	(sender): Force a new batch when the sender is changed.

	* Makefile.PL: Add BSMTPEnvelope module.

2002-05-16  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Parser.pm (parse_part): Fix a couple of undef warnings.

	* bin/mj_queuerun (run_queue): Perform date sorting differently to
	guard against warnings when queue files are deleted by another
	process.
	
2002-05-11  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* bin/mj_queuerun: Add commented block to enable backtraces for
	warnings.

2002-05-10  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* bin/mj_shell (tempfile): Include directory name in error
	message.
	
2002-05-08  Michael Yount <csf@moscow.com>

	* t/*.t  Change "perl-latest" to "perl" in test files to 
	avoid errors from recent versions of Test::Harness.
	Thanks to Deb Heller-Evans.

2002-05-07  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/BounceParser.pm (parse_compuserve, parse_compuserve2):
	Make sure that there actually is a From: header.

2002-05-06  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Deliver/Dest.pm (_gen_bounces): New function: generate a
	bounce for each failed address.
	(flush): Remove bounce generation and call _gen_bounces instead.

2002-05-06  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm, bin/mj_wwwusr:  
	Deal with special characters in query strings more thoroughly.
	Bugfix:  Display user address more clearly if an invalid list
	is given.  Validate the user address more robustly.
	Thanks to Larry Rosenbaum and Roger Klorese.
	
	* lib/Mj/Format.pm:  (cgidata)  Bugfix:  Escape 
	non-alphanumeric characters in query strings.  
	Thanks to Nick Simicich.

	* lib/Mj/Log.pm:  (message)  Bugfix:  Double percent signs
	to avoid warnings.  Thanks to Nick Simicich.
	
2002-05-05  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Deliver/Dest.pm (flush): When generating a bounce for an
	address that timed out, include a useful error message instead of
	printing a blank and generating some undef warnings.

2002-05-04  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Lock.pm: Use Time::HiRes if available.
	(lock): Store the time the lock was acquired.
	(unlock): Log the time elapsed since the lock was acquired.

2002-04-26  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (connect, dispatch)  Determine if an
	address is defined before testing its validity.
	Thanks to Brock Rozen.

2002-04-25  Michael Yount <csf@moscow.com>

	* lib/Mj/Archive.pm:  (_sort_archives, _by_date)  Use a
	separate routine for archive sorting for compatibility
	with perl 5.005.02 and earlier versions.  Thanks
	to Larry Rosenbaum.

	* lib/Mj/Format.pm:  (archive)  Bugfix:  remove unnecessary
	array reversal.

	* lib/Mj/Resend.pm:  (_r_ck_header)  Recursively check
	the parts of a message for headers which match the admin_headers,
	noarchive_headers, and taboo_headers settings.  Those three
	settings now apply to all headers within a message, rather than
	just the top-level headers.

2002-04-20  Michael Yount <csf@moscow.com>

	* bin/mj_queuerun, mj_queueserv, mj_shutdown:  Add 3rd
	argument to syswrite() calls for compatibility with
	perl 5.005.02 and earlier versions.  Thanks to Larry Rosenbaum.

	* bin/mj_trigger:  Issue error if the "-t" option is absent.
	Thanks to Brock Rozen.

	* lib/Mj/Parser.pm:  (parse_args)  Split on multiple spaces
	by default.  Thanks to Duncan Hill.

2002-04-18  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* Makefile.PL (generate_wrappers): Use standard C instead of
	obsolete K&R.

	* lib/Majordomo.pm (connect): Turn on autoflush for the session
	info file.

2002-04-16  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_request_response)  Add headers
	to the response message and safeguards against mail
	loops.

2002-04-08  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Allow special-purpose welcome files to
	be supported using the "doc" CGI parameter.  The first
	such file is welcome_showtokens.

	* lib/Majordomo.pm:  (help_start)  Support TOPIC substitution,
	which allows the help file name to be displayed within the 
	help file.
	(_showtokens)  Sort tokens in Mj::Format::showtokens.
	(trigger)  Support GLOBAL file triggers.  Thanks to Brock Rozen.
	(_list_file_execute)  New routine.  Parse commands within a
	file and execute them.

	* lib/Mj/Addr.pm:  (new)  Return immediately if an address
	was not supplied.

	* lib/Mj/Archive.pm:  (_sync_msgs)  Improve error handling.
	Thanks to Roger Klorese.

	* lib/Mj/CommandProps.pm:  Add support for the 
	showtokens-consult and showtokens-confirm commands.

	* lib/Mj/Digest.pm:  (decide)  Add existence test to
	eliminate warnings.
	(examine)  Add a "stateonly" parameter that prevents 
	decision values from being returned.  Thanks to Brock Rozen.

	* lib/Mj/Format.pm:  (accept)  If the results of the 
	acceptance are sent to the victim, give an indication
	of the result of the command.
	(showtokens)  Use the showtokens file to display a list-specific
	heading.  Use the showtokens_all file to display a summary
	at the end.  The showtokens_data file is now used for the
	ALL pseudo-list also.  Sort the tokens by list.

	* lib/Mj/List.pm:  (default_class) Return a non-default
	digest if one is specified in the default_class setting.
	(moderators)  Use the "owners" setting before the "whoami_owner"
	setting.

	* lib/Mj/Resend.pm:  Minor rearrangements for readability.

	* setup/ask_basic.pl:  Place the tmp directory under the
	installation directory by default.
	Bugfix:  set the database backend to "text" if DB_File
	is not available.

2002-04-04  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Token.pm (_del_spooled_files): New function: delete any
	files spooled with a token.
	(t_expire, t_reject): Call _del_spooled_files.

2002-04-02  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (common_subs)  Bugfix:  supply 
	default value for chunksize.
	(_set)  Bugfix:  correct syntax error.  Thanks to Brock Rozen.

2002-03-30  Jason Tibbitts  <tibbs@math.uh.edu>
 
	* lib/Majordomo.pm (_showtokens): Add 'confirm' and 'consult'
	modes, make "confirm-consult" the default if no modes were given.
 
	* lib/Mj/CommandProps.pm: Add additional modes for showtokens.

2002-03-27  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  Version number is now 0.1200203270.
	(_createlist)  Bugfix:  initialize "oldaliases" result.
	Thanks to Roger Klorese.
	Move "aliases" format conversion code to Mj::Config::_upgrade.

	* lib/Mj/Addr.pm:  Support the ".eu" top-level domain.

	* lib/Mj/BounceHandler.pm:  (_hbr_consult, _hbr_probe)
	Add second argument to n_defaults calls.

	* lib/Mj/Config.pm:  Version number is now 1.1.
	(_upgrade)  New routine.  Convert settings from old to
	new formats if required.  Add a version number to each 
	configuration file.
	(parse_digests)  Use a new one-field-per-line format.
	Add support for a new "newmsg" field, which controls
	whether or not incoming messages will cause digests to
	be checked.

	* lib/Mj/Digest.pm:  (add, trigger, choose)  Add 
	support for the "newmsg" field.

	* lib/Mj/MIMEParser.pm:  (collect_data, _r_ct_lines)
	Add sanity checks.  Thanks to Brock Rozen.

	* lib/Mj/Token.pm:  (confirm)  Bugfix:  remove inappropriate
	array reference.
	(t_accept)  Add second argument to n_defaults call.

	* lib/Mj/Util.pm:  Support "true" for "yes" and "false" for "no".
	(str_to_offset)  Bugfix:  use a definition test instead of
	defaulting to an empty string.

2002-03-19  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Resend.pm (post): Remove warning when return from
	_check_approval is undef.
  
2002-03-19  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Addr.pm (_validate): Add Soviet Union domain back in;
	folks are still using it.

2002-03-19  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm: (_lists)  Bugfix:  initialize
	variable.  Thanks to Roger Klorese.
	(_subscribe)  Support the already_subscribed error file.

2002-03-17  Michael Yount <csf@moscow.com>

	* bin/mj_enqueue:  Exit after sending a "Hello" message
	to the queue server.  Record the total time taken.

	* bin/mj_queueserv:  (ping_runners)  Return immediately
	if a valid runner is found.
	Do not respond to clients.

	* bin/mj_queuerun:  Sort messages within a queue directory
	in date order, oldest first.  Suggested by Brock Rozen.

2002-03-16  Michael Yount <csf@moscow.com>

	* bin/mj_queuerun:  Shut down if a "Bye" ping is received 
	from the queue server.

	* bin/mj_queueserv:  After a timeout, ping runners and do
	not shut down until all queue runners have finished.
	Thanks to Brock Rozen.

	* lib/Majordomo.pm:  Version number is now 0.1200203160.
	(_password)  Use the GLOBAL message_headers setting in the 
	headers of the password notice that is mailed to the victim.
	(reject)  Use a list-specific whoami_owner address in the
	From header of a rejection notice to the victim.
	Suggested by Roger Klorese.
	(alias)  Bugfix:  use length() instead of exists() test
	for the presence of an address.  Thanks to Brock Rozen.

	* lib/Mj/Access.pm:  (_a_confirm2)  Use only 2 parameters,
	file names for the victim and requester.
	(_a_forward)  Use the whoami_owner address if no parameter
	is given.
	(_a_mailfile)  Use the whoami_owner address instead of the
	sender address.

	* lib/Mj/Config.pm:  (_compile_rule)  Test filename parameters
	in notify variables.

	* lib/Mj/Format.pm:  (alias)  Make minor improvements to the
	result message.

	* lib/Mj/Token.pm:  (confirm, t_accept)  Support "notify"
	customizations for the chain file and expiration time.

	* lib/Mj/Util.pm:  (n_defaults)  Support the new chainfile
	and expire notify variables.

2002-03-12  Michael Yount <csf@moscow.com>

	* bin/mj_queuerun:  Cease shuffling messages within a directory.

	* bin/mj_wwwadm:  Support formatted output from the createlist
	command.  Validate passwords against "ANY" command to allow
	subsidiary passwords to work.

	* lib/Majordomo.pm:  (configshow)  Return a list of settings
	in each category in "categories" mode.
	(_createlist)  Return a hash of aliases, owners, et cetera
	if the command succeeds.  Add support for "inactive" mode.
	
	* lib/mj_cf_data.pl:  Fill in default wizard levels (1-9) for 
	all configuration settings.  Currently, all settings are
	in level 1 or level 9.

	* lib/mj_cf_defs.pl:  Add support for the new "active"
	configuration setting, which allows a list to be disabled.

	* lib/Mj/Access.pm:  (validate_passwd)  Add support for
	the ANY test, which determines if a password is valid for
	any action on a mailing list.
	(list_access_check)  Add support for the "active" configuration
	setting; inactive lists will have all requests denied unless
	an administrative password is used.

	* lib/Mj/CommandProps.pm:  Remove support for the 
	createlist-noheader command.  Add support for the 
	createlist-inactive command.

	* lib/Mj/Config.pm:  (wizard)  New routine.  Return the
	"wizard" skill level, a number between 1 and 9.
	(vars)  Simplify the code.
	(parse_access_array)  Add support for configuration of
	the wizard level of configuration settings.

	* lib/Mj/Format.pm:  (configshow)  Revise the formatting
	of the configshow-categories command.
	(createlist)  Add format file support.
	
	* lib/Mj/MTAConfig.pm:  Remove the "header" hash.

2002-03-02  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  (newlist)  Add support for list creation,
	renaming, and deletion for site and domain administrators.

	* lib/Majordomo.pm:  (_createlist)  Clarify success message.

	* lib/Mj/Archive.pm:  (_parse_archive_arg)  Bugfix:  distinguish
	dates from message counts more intelligently.

	* lib/Mj/CommandProps.pm:  Add support for the who-summary
	command.

	* lib/Mj/Format.pm:  (rekey)  Do not display results for the
	DEFAULT or GLOBAL pseudo-list.  Thanks to Chan Wilson.
	(who)  Add support for the who-summary command, which shows
	the number of subscribers in each delivery class.

2002-02-25  Michael Yount <csf@moscow.com>

	* lib/Mj/Util.pm:  (process_rule)  Bugfix:  add "negate" and 
	"stringify" ops to the Safe compartment, to support conditions
	like "$host = example.com" and "$days_since_subscribe > -1"
	in the access rules.

2002-02-21  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Add formatting for the set command.
	Support separate name and address fields (name and victims)
	for subscriptions.

	* bin/mj_wwwusr:  Support separate name and address
	fields in the subscription form.  Suggested by David Miller.

	* lib/Majordomo.pm:  Version number is now 0.1200202210.
	(gen_cmdline)  Include the token ID in the command line
	of the accept or reject command.  Suggested by Roger Klorese.

	* lib/Mj/Addr.pm:  (setcomment)  New routine.  Change
	the name/comment of an address.
	(local_part)  New routine.  Return the local part of an
	address.
	(domain)  New routine.  Return the full domain of an address.

	* lib/Mj/Archive.pm:  (_sort_archives)  New routine.
	Sort archives chronologically.
	(sync)  Bugfix:  sort the archives if a new archive was
	added.  Thanks to Brock Rozen.

	* lib/Mj/Config.pm:  (parse_inform)  Include "newtoken"
	in the list of actions.

	* lib/Mj/Format.pm:  (set)  Add wwwadm support for the
	expanded "set-check" page.
	(report)  Show the command line in the output of the
	report-full command.

	* lib/Mj/Inform.pm:  (inform)  Do not record "newtoken"
	events in the session log.

	* lib/Mj/List.pm:  (make_setting)  Bugfix:  avoid
	hideaddress/hideall conflicts; allow both settings to be
	turned on.
	(expire_bounce_data)  Bugfix:  remove old data from the
	subscriber database.
	(bounce_gen_stats)  Bugfix:  always count bounces this
	month, for the benefit of the who-bounce command.

	* lib/Mj/Token.pm:  (t_add)  Log the creation of the token
	for diagnostic purposes.  Suggested by Roger Klorese.

	* lib/Mj/SimpleDB/DB.pm:  Bugfix:  always obtain the lock 
	before opening the database, to avoid caching stale data.
	
2002-02-16  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (standard_subs)  Incorporate
	ARCURL into the standard substitutions.

	* lib/Mj/Archive.pm:  (new, _split_name)  Sort archive
	file names, accounting for sublists, quarter-years, 
	and two-digit years. 
	(_secs_start, _secs_end)  Support two-digit years.
	Suggested by Brock Rozen.
	(_parse_message_range)  Eliminate potential infinite loop.


2002-02-09  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/SimpleDB/DB.pm (DESTROY): Undef the database before
	unlocking.
	(add, remove, replace, mogrify, lookup_quick,
	lookup_quick_regexp): Undef the database before exiting.

2002-02-06  Michael Yount <csf@moscow.com>

	* lib/Mj/Archive.pm:  (_write_counts)  Remove database
	files for archives with no messages.
	(summary)  Ignore archives with no messages.  Suggested
	by Brock Rozen.

2002-02-05  Michael Yount <csf@moscow.com>

	* bin/mj_shell:  Add editor support for the archive-part-edit
	command.

	* bin/mj_wwwadm, mj_wwwusr:  Add "raw" message part support
	for the archive-part-* commands.

	* lib/Majordomo.pm:  Version number is now 0.1200202050.
	(archive_start)  Add support for the archive-part-*
	commands, which allow individual message parts to be
	viewed, changed, or deleted.

	* lib/Mj/Access.pm:  (list_access_check)  Quell delay warning.
	Thanks to Brock Rozen.

	* lib/Mj/Archive.pm:  (remove)  Give two return values,
	the status and the data or error message.
	(replace)  New routine.  Replace a particular message
	with the contents of a file.

	* lib/Mj/CommandProps.pm:  Add support for the archive-part-*
	commands.

	* lib/Mj/Format.pm:  (_archive_part)  New routine.  Add support
	for the archive-part-* commands.
	(tokeninfo)  Bugfix:  Perform substitutions after retrieving
	the headers.
	(g_get)  Bugfix:  Use a value of 1000 if no chunksize is given.

	* lib/Mj/List.pm:  (archive_get_data)  Wrapper for
	Mj::Archive::get_data().
	(archive_replace_msg)  Wrapper for Mj::Archive::replace().
	(archive_delete_msg)  Adjust for new return values.
	(digest_sync)  Resynchronize more judiciously.

	* lib/Mj/MIMEParser.pm:  (collect_data)  Quell warning.
	Thanks to Brock Rozen.

	* lib/Mj/Resend.pm:  (_post)  Change the ARCNO substitution
	to MSGNO.

	* lib/Mj/Util.pm:  (sort_msgs)  Sort by author and subject
	more quickly.  Thanks to Roger Klorese.

2002-02-04  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Majordomo.pm (substitute_vars): Tolerate trailing spaces in
	an $INCLUDE directive.

2002-02-03  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Config.pm (parse_taboo_body, parse_taboo_headers): Escape
	backslashes and	single quotes present in the "just for display"
	pattern in order to prevent lots of warnings.

2002-01-30  Todd Miller <Todd.Miller@courtesan.com>
 
	* bin/mj_queuerun: Unbuffer standard output.

	* bin/mj_queuerun: Add a select() to out() to timeout
	attempted writes at .25 seconds.
 
	* bin/mj_queueserv: Use waitpid() as CHLD signal handler so
	we can catch multiple children and are guaranteed not to hang.
 
	* bin/mj_queueserv: Add a select() to out() to timeout
	attempted writes at .25 seconds.
 
	* bin/mj_shutdown: Use syswrite, not print when writing to
	the queue server socket to guarantee that the string is sent
	in a single system call.

2002-01-25  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_archive)  Collect information about
	neighboring messages when the archive-get-immediate command
	is used.
	(_lists) Fix typo.  Thanks to Roger Klorese.

	* lib/Mj/Archive.pm:  (get_neighbors)  Determine the next
	and previous messages within an archive for a particular
	message.

	* lib/Mj/Format.pm:  (archive)  Add message-specific formatting
	for the archive-get-immediate command.

	* lib/Mj/List.pm:  (archive_get_neighbors)  Add a wrapper
	for Mj::Archive::get_neighbors().

	* lib/Mj/Resend.pm:  (_post)  Change the ARCHIVE substitution
	to ARCNO.

2002-01-21  Jason Tibbitts  <tibbs@math.uh.edu>

	* setup/ask_basic.pl (ask_basic): Ask for majordomo.cf location.

	* postinstall: Add mj_setup.

	* installbin: Add CONFFILE substitution.

	* Makefile.PL: Bump config version.  Add mj_setup.

	* bin/mj_setup: New file.

2002-01-20  Jason Tibbitts  <tibbs@math.uh.edu>

	* bin/mj_shell: Delay module loading until runtime.
	Add -W option, load and import Carp at runtime, and fixup warnings
	to spit out a backtrace.
	

2002-01-19  Jason L Tibbitts III  <tibbs@math.uh.edu>

	Add Encoding=>'8bit' to generated MIME Entities:
	* bin/mj_email (parse_commands)
	* bin/mj_queuerun (parse_commands)
	* lib/Mj/Digest/Text.pm (new)
	* lib/Mj/Digest/MIME.pm (new, add, done)
	* lib/Mj/Digest/Index.pm (done)
	* lib/Mj/Token.pm (confirm, t_accept)
	* lib/Mj/Resend.pm (post, _post, _add_fters)
	* lib/Mj/Parser.pm (parse_entity, parse_part)
	* lib/Mj/MailOut.pm (welcome)
	* lib/Mj/BounceHandler.pm (handle_bounce_message, handle_bounce_token)
	* lib/Mj/Access.pm (_a_forward)
	* lib/Majordomo.pm (reject, tokeninfo_start)
	
	* lib/Mj/Addr.pm (_validate): Accept dots in the phrase portion of
	a route address.

2002-01-18  Michael Yount <csf@moscow.com>

	* bin/mj_wwwusr:  Add support for the archive command.

	* lib/Majordomo.pm:  (_lists)  Determine if access to the
	archive command is allowed, and store the result in the
	can_read variable.

	* lib/mj_cf_defs.pl:  Add "signoff" to the default administrivia
	patterns.

	* lib/Mj/CommandProps.pm:  Allow the summary and reverse
	modes of the archive command to work together.

	* lib/Mj/Format.pm:  (archive)  Add format file support
	for the archive-summary command.
	(lists)  Add support for the CAN_READ substitution, a boolean
	variable that indicates if the archive command is accessible.

	* lib/Mj/Inform.pm:  (_inform_owner)  Use the whoami_owner
	setting for the owner's address, not the sender setting.
	Thanks to Duncan Hill.

	* lib/Mj/MailOut.pm:  (mail_message)  Skip empty or undefined
	addresses.  Thanks to Stephen Frost.

	* setup/ask_domain.pl:  Fix warning.  Thanks to Brock Rozen.
 
2002-01-15  Michael Yount <csf@moscow.com>

	* lib/Mj/List.pm:  (digest_sync)  Bugfix:  supply the
	correct arguments to digest_examine.  Thanks to Roger Klorese.

2002-01-13  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Majordomo.pm (dispatch): Initialize $request->{modes} to an
	empty hashref.

	* lib/Mj/MailOut.pm (owner_done): Don't call bounce parser of
	'nobounce' mode is present.
	* lib/Mj/CommandProps.pm: Add nobounce mode to owner functions.

2002-01-13  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Majordomo.pm (dispatch): Add 'modes' member of the request
	structure.  This is a hash containing one key per mode present.
	Now you can check for a mode with if ($request->{modes}{whatever})
	instead of using a regexp.  You can still use the old method, of
	course.

2002-01-13  Todd Miller  <Todd.Miller@courtesan.com>

	* bin/mj_queueserv: Fix warning on exec if SIG_CHLD_IGNORE == 1.

2002-01-12  Todd Miller  <Todd.Miller@courtesan.com>

	* lib/Mj/Resend.pm (_describe_taboo): Fix warning on undef $match.

2002-01-11  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (list_config_set)  Add support for
	"noforce" mode, which will cause the configset command to
	fail if the new and old values are identical.

	* lib/Mj/Access.pm:  Add support for the "nostall" access
	variable, which will prevent a command from being delayed,
	because of an explicit delay, or because the command requires
	someone's approval.

	* lib/Mj/CommandProps.pm:  Add support for the "nostall"
	access variable and the "noforce" command mode.

	* lib/Mj/Config.pm:  (compile_pattern)  Add a third return
	value if a failure occurs, to stop warnings.  Thanks to
	Brock Rozen.

	* lib/Mj/Format.pm:  (configshow)  Use "noforce" command
	mode in the configset commands if it was requested.

	* lib/Mj/Util.pm:  (process_rule)  The rule set=VARNAME
	should establish a true value.

2001-12-21  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Bugfix:  Do not use "immediate" mode with "edit"
	mode in the get command.  Thanks to Roger Klorese.

2001-12-20  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_createlist, _set, _who)
	Mj::List::get_start may return two values if an error occurs.

	* lib/Mj/List.pm:  (count_subs, moderators)
	Mj::List::get_start may return two values if an error occurs.
	Thanks to Paul Hancock.

2001-12-19  Michael Yount <csf@moscow.com>

	* bin/mj_queueserv, mj_shutdown:  Allow a delay before
	shutdown to be specified.

	* lib/Mj/Config.pm:  (parse_enum, parse_enum_array)
	Lower the case of enumerated values.
	Thanks to Mathieu Arnold.

2001-12-19  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Addr.pm (_validate): Update list of TLDs.

2001-12-15  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (r_expire)  New routine.  Remove
	inactive registration entries, based upon the age in
	the GLOBAL inactive_lifetime setting.
	(tokeninfo) Support case-insensitive token matches.
	(trigger)  Separate the bounce and vacation triggers.
	Add an "inactive" trigger for expiring inactive addresses.

	* lib/mj_cf_data.pl, mj_cf_defs.pl:  Add support for
	the inactive_lifetime and post_lifetime settings.

	* lib/Mj/CommandProps.pm:  Add support for "i"nactive
	mode for the trigger command.

	* lib/Mj/Config.pm:  (parse_triggers)  Warn, rather than
	fail, if a trigger is missing.  Run missing triggers daily.

	* lib/Mj/List.pm:  (expire_inactive_subs)  Remove subscribers
	that have been in "nomail" mode without any return date for
	longer than the number of days in the "inactive_lifetime"
	setting.
	(expire_subscriber_data)  Remove the bounce elimination
	code, which is duplicated in expire_bounce_data().

	* lib/Mj/Resend.pm:  (_check_approval)  Test a token for
	validity.

	* lib/Mj/Token.pm:  (t_recognize)  Make recognition
	case-insensitive.

	* lib/Mj/Util.pm:  (str_to_offset)  Add support for times
	of day, such as "5pm".
	(str_to_time)  Bugfix:  Time spans are future, not past.

2001-12-11  Michael Yount <csf@moscow.com>

	* convertlist.pl:  Convert the Mj1 "moderator" setting into
	the Mj2 "moderators" setting.

	* bin/mj_email, mj_queuerun:  Cope with inaccessible configuration 
	settings.  Thanks to Brock Rozen.
	Add a Date header to all reply messages.  Thanks to John Levine.

	* lib/Majordomo.pm:  (standard_subs)  Expand the TOKEN
	substitution in the CONFIRM_URL substitution.

	* lib/mj_cf_data.pl, mj_cf_defs.pl:  Remove the "moderator" 
	configuration setting.

	* lib/Mj/Access.pm:  (_a_forward, _a_mailfile)  Add a
	Date header to outgoing messages.

	* lib/Mj/Config.pm:  (regen)  Convert the "moderator" setting
	into the "moderators" setting if necessary.

	* lib/Mj/Format.pm:  Cope with inaccessible configuration
	settings.
	(set)  Bugfix:  Correct typo in PARTIAL substitution.

	* lib/Mj/Inform.pm:  (_inform_owner)  Add a Date header to
	all inform messages.

	* lib/Mj/List.pm:  (moderators)  Remove support for the
	"moderator" configuration setting.

	* lib/Mj/MailOut.pm:  (welcome)  Add a Date header to all
	welcome messages.

	* lib/Mj/Parser.pm:  (parse_part)  Add a Date header to
	all reply messages.

	* lib/Mj/Resend.pm:  (post, _post)  Add a Date header to
	all acknowledgement messages.

	* lib/Mj/Digest/Index.pm, MIME.pm, Text.pm:  Add a Date header
	to each digest.

2001-11-29  Michael Yount <csf@moscow.com>

	* bin/mj_wwwusr:  Add support for the unalias command.

	* lib/Majordomo.pm:  (_unalias)  Do not allow a 
	bookkeeping alias to be removed.
	(_unregister)  Consider the nolog and noinform modes
	when informing about subscription removal.  
	Thanks to Paul Hancock.

	* lib/Mj/Format.pm:  (set)  Treat the output of the
	set-check command specially.

2001-11-28  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Restore sublist support.  Thanks to
	Roger Klorese.  
	Support "select multiple" menus for configuration 
	settings.

	* bin/mj_wwwusr:  Display an HTML form with the
	current settings when the set command is used.

	* lib/Majordomo.pm:  (_set)  Return additional information,
	such as details about the allowed flags and classes.

	* lib/mj_cf_data.pl:  Support the LIST-subscribe-unique
	alias.

	* lib/Mj/Format.pm:  (configshow)  Support menus for
	enum_array configuration settings.
	(set)  Add format file support.

	* lib/Mj/List.pm:  (set)  Return the subtime and changetime
	data.

	* lib/Mj/MTAConfig.pm:  (add_alias)  Support the
	LIST-subscribe-unique alias.

	* lib/Mj/Resend.pm:  (_within_limits)  Do not display the
	soft limit reasons if a hard limit has been exceeded.

	* lib/Mj/Util.pm:  Support "on" for yes and "off" for no.

2001-11-23  Michael Yount <csf@moscow.com>

	* bin/mj_confirm, mj_wwwadm, mj_wwwusr:  Make domain
	comparisons using the HTTP_HOST environment variable
	case-insensitive.

	* bin/mj_shell:  Use revised str_to_offset parameters
	when determining delay lengths.

	* lib/Majordomo.pm:  (new)  Test for case-insensitive
	equivalence in domain names.

	* lib/Mj/Access.pm:  (_d_post)  Add limit_lower to the
	list of consult variables.

	* lib/Mj/Archive.pm:  (expand_range)  Use new str_to_offset
	parameters.

	* lib/Mj/CommandProps.pm:  Support the limit_lower access
	variable.

	* lib/Mj/Config.pm:  (parse_digests)  Parse time spans
	in the minage, separate, and maxage fields at run time.
	(parse_limits)  Add support for a lower limit.
	(compile_pattern)  The ALL pattern will now match anything.

	* lib/Mj/Digest.pm:  (decide)  Parse time spans at
	run time.  Clarify log messages.

	* lib/Mj/Format.pm:  (digest)  Parse time spans at
	run time.

	* lib/Mj/Parser.pm:  (parse_part)  Use revised str_to_offset
	parameters when determining delay lengths.

	* lib/Mj/Resend.pm:  (_within_limits)  Add support for lower
	limits.

	* lib/Mj/Util.pm:  (str_to_offset)  Add support for calendar
	days, weeks, months, and years.  Present the result as
	a string instead of a second count if requested.

	* setup/mta_sendmail.pl:  Bugfix:  do not use the "noheader"
	mode with the createlist-regen command.

2001-11-21  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/CommandProps.pm: Add posts_this_day/week/month variables.

	* lib/Mj/List.pm (post_gen_stats): Generate counts frojm the
	beginning of the current day/week/month.

2001-11-19  Michael Yount <csf@moscow.com>

	* lib/Mj/Config.pm:  (parse_bool)  Move code to
	Mj::Util::str_to_bool for external use.
	(parse_delivery_rules)  Bugfix:  rearrange loops.  Thanks
	to Roger Klorese.

	* lib/Mj/Format.pm:  (configshow)  Format boolean settings
	separately.  Thanks to Gavin Walker.

	* lib/Mj/Util.pm:  (str_to_bool)  New routine.  Convert
	a string to a true or false value (1 or 0).

2001-11-18  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Resend.pm (_check_poster): Get post stats and fill in
	access variables.

	* lib/Mj/List.pm (post_gen_stats): New function: generate
	statistics from post data.

	* lib/Mj/CommandProps.pm: Add new post-related access variables.

2001-11-13  Michael Yount <csf@moscow.com>

	* bin/mj_confirm, mj_wwwadm:  Add support for the tokeninfo-part 
	commands, including the ability to display message parts with their
	appropriate content types.  This makes it possible to display
	images and other parts inline or in separate browser windows.

	* bin/mj_shell:  Automatically invoke an editor for the
	tokeninfo-part-edit command.

	* bin/mj_wwwusr:  Always validate the password during to the login
	process.  Thanks to Roger Klorese.

	* lib/Majordomo.pm:  Version number is now 0.1200111130.
	(dispatch)  Make mode checking stricter, including tests
	for incompatible modes and missing prerequisites.
	(sessioninfo_start)  Cease dealing with message spool files.
	The tokeninfo-full command is no longer supported.
	(tokeninfo_start)  The tokeninfo command is now iterated.
	Iteration allows the contents of message parts to be obtained
	in chunks.  Add support for the tokeninfo "part" modes:
	part, part-delete, part-edit, and part-replace, which deal
	with body parts of moderated messages and their headers.
	(_get_msg_data)  Obtain or alter a table of entities within 
	a moderated message and return the revised table.  Each entity 
	is numbered, which allows parts to be altered or removed using 
	the appropriate number.  Part "0" refers to the whole message.

	* lib/Mj/CommandProps.pm:  Add command mode data to determine
	which modes are incompatible and which modes require the use
	of other modes.  Add support for the tokeninfo-part commands,
	and remove support for the tokeninfo-full command.

	* lib/Mj/Format.pm:  (_tokeninfo_post)  Move code to handle
	tokens for moderated messages into a separate routine.  Add
	support for the new tokeninfo-part commands.

	* lib/Mj/MIMEParser.pm:  (get_entity_structure, remove_part,
	replace_part)  New routines.  Given a file containing a message,
	obtain or alter the structure of the message.  Each part within
	a message is given a number:  "1" for the top-level
	part, "1h" for its headers, "1.3" for the third subpart,
	"1.3.2" for the second subpart of the third subpart, and so on.

2001-11-03  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_list_file_get_string)  Return undef
	instead of an error message if the file is unavailable.
	(reject)  Bugfix:  do not send a rejection notice to
	majordomo-owner twice for GLOBAL command rejections.
	
	* lib/Mj/Format.pm:  (accept)  Bugfix:  use the actual
	interface type when formatting command results.  This
	means that any interface which can issue the "accept" command
	must have format files for every command that can stall.

	* lib/Mj/Parser.pm:  (parse_entity)  Delete the HTML tree
	explicitly to free memory.

	* lib/Mj/Resend.pm:  (_format_text)  Delete the HTML tree
	explicitly to free memory.

	* lib/Mj/Token.pm:  (t_accept)  Bugfix:  convert the 
	user and victim addresses into Mj::Addr objects.
	
2001-10-30  Michael Yount <csf@moscow.com>

	* lib/Mj/Config.pm:  (parse_delivery_rules)  Add validation
	checks for parameter names and values.  Thanks to Marc Fournier.

2001-10-29  Michael Yount <csf@moscow.com>

	* bin/mj_confirm:  Revise the appearance to resemble the
	other WWW interfaces more closely.

	* lib/Majordomo.pm:  (_show)  Determine which lists are
	owned by the address in question.  Suggested by Roger Klorese.

	* lib/Mj/Format.pm:  (tokeninfo)  Add ISPOST and VICTIM
	substitutions to support conditional "accept" buttons and
	clearer instructions.

	* lib/Mj/Util.pm:  (n_defaults)  Bugfix:  remove suffixes
	from iterated commands.  

2001-10-28  Michael Yount <csf@moscow.com>

	* lib/Mj/Format.pm:  (archive)  Add KILOBYTES and
	TOTAL_KILOBYTES substitutions to allow message size statistics
	to be displayed by the archive-stats command.
	
2001-10-27  Michael Yount <csf@moscow.com>

	* bin/mj_shell,mj_wwwadm:  Use the message returned by 
	Majordomo::valid_list if a list validation error occurs.

	* lib/Majordomo.pm:  (valid_list)  Make use of the
	relocated_lists configuration setting to rewrite old list names.
	(rekey)  Allow the use of a pattern with the rekey-verify and
	rekey-repair commands.  Suggested by Roger Klorese.

	* lib/mj_cf_data.pl,mj_cf_defs.pl:  Add support for the GLOBAL
	relocated_lists configuration setting.

	* lib/Mj/CommandProps.pm:  Add support for the use of a pattern
	with the rekey-verify and rekey-repair commands.

	* lib/Mj/Config.pm:  (parse_relocated_lists)  New routine.
	Parse the GLOBAL relocated_lists configuration setting.

	* lib/Mj/Parser.pm:  (parse_part)  Use the message returned
	by Majordomo::valid_list if a list validation error occurs.

2001-10-23  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (substitute_vars_format)  Bugfix:
	unescape dollar signs if no array substitutions are present.
	(_register, _subscribe)  Add support for 'R' and 'U' flags
	in the welcome_files setting.

	* lib/Mj/Config.pm:  (parse_welcome_files)  Add support
	for the 'R' and 'U' flags.

	* lib/Mj/Format.pm:  (rekey)  Bugfix:  Include the count
	of missing subscription entries in the total.  Thanks
	to Roger Klorese.
	(g_get)  Bugfix:  escape substitution variables in the
	file description when the "get-edit" command is used.

	* lib/Mj/Inform.pm:  (_inform_owner)  Make the full set
	of substitutions available in the body and subject of
	an inform message.

	* lib/Mj/MailOut.pm:  (welcome)  Make use of the 'R' and 'U'
	flags from the welcome_files setting.

	* lib/Mj/Util.pm:  (n_defaults)  Bugfix:  do not issue reminders
	for bounce probes.  Thanks to Roger Klorese.

2001-10-18  Michael Yount <csf@moscow.com>

	* bin/mj_confirm, mj_wwwadm, mj_wwwusr:  Bugfix:  complete
	the transition from the PASSWORD substitution to the CMDPASS
	substitution.  Thanks to Roger Klorese.

2001-10-16  Michael Yount <csf@moscow.com>

	* lib/Mj/CommandProps.pm:  Turn off the "noaddr" option for
	the unregister and unsubscribe commands.  "pattern" mode is
	again necessary to remove invalid addresses.

2001-10-15  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (new)  Abort if the registry or alias
	database cannot be initialized.
	(standard_subs)  Add the "UCLIST" expansion, which displays
	the name of a mailing list in capital letters.

	* lib/mj_cf_defs.pl:  Remove the unsupported 'P' flag from
	the welcome_files setting.

	* lib/Mj/Access.pm:  (validate_passwd)  Bugfix:  do not
	initialize passwords for the GLOBAL list twice.

	* lib/Mj/Format.pm:  Use the CMDPASS substitution instead
	of the PASSWORD substitution to represent the password that
	was used with the current command.

2001-10-03  Michael Yount <csf@moscow.com>

	* lib/Mj/Config.pm:  (parse_table)  Bugfix:  Only split on
	colons and pipe symbols if necessary.  Thanks to Roger Klorese.
	Strip trailing white space from elements of a comma-separated
	list.

2001-10-02  Michael Yount <csf@moscow.com>

	* bin/mj_queuerun:  Log the file being processed after the
	debugging level has been determined.

	* lib/Mj/BounceHandler.pm:  (handle_bounce_token)  Bugfix:
	Do not call inform() or send notices if the token is missing
	from the database.

	* lib/Mj/Format.pm:  (accept)  Bugfix:  always use the 
	"text" type to format the results from the accepted command.
	Thanks to Roger Klorese.

2001-09-27  Michael Yount <csf@moscow.com>

	* Makefile.PL:  Work around MakeMaker bug by using '$(PREFIX)'
	in place of the actual prefix in makefile variables.

	* bin/mj_wwwusr:  Remove white space from new passwords.

	* lib/Majordomo.pm:  (reject)  Allow an explanation to be
	used when confirm tokens are rejected.  Use the whoami_owner
	setting address instead of the sender setting address to
	receive rejection notices.  Allow the ack_attach_original
	setting to determine if a posted message should be attached
	to the rejection acknowledgement.  Display the session
	file as an attachment.

	* lib/mj_cf_data.pl:  Support the "reject" option in the
	ack_attach_original configuration setting.

	* lib/Mj/CommandProps.pm:  Support the "blind_copy" access
	variable for the post command.

	* lib/Mj/Format.pm:  (archive)  Spell out "kilobytes."
	(password)  Format error message consistently.

	* lib/Mj/Resend.pm:  (post)  Supply a default subject if
	the access rules do not supply a reply file.
	(_ck_theader)  Add support for the blind_copy access variable,
	which is set if the list's full address is not present in
	a To or Cc header.

2001-09-25  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (archive_chunk)  Use listref as
	argument to digest_examine().
	(_set)  Use the digest's index format when a partial digest
	is issued.
	(_showtokens) Fix typo in mode test.
	(_unsubscribe) Test validity of a sublist only if one is
	specified.

	* lib/mj_cf_data.pl:  Support new "numbered_name" and
	"subject_name" digest index formats.

	* lib/Mj/Archive.pm:  (expand_date)  Bugfix:  continue
	looking for messages in an archive which is not in chronological
	order.  Thanks to Roger Klorese.

	* lib/Mj/BounceHandler.pm:  (_hbr_probe)  Use "unsubscribe"
	as the command for a probe token to allow the token to be
	accepted.  Thanks to Roger Klorese.

	* lib/Mj/Config.pm:  (parse_digests)  Add support for digest
	sorting and digest-specific index formats.

	* lib/Mj/List.pm:  (set)  Use a listref as the argument to
	digest_examine().

	* lib/Mj/MIMEParser.pm:  (collect_data) Add definition test
	to stop warnings.

	* lib/Mj/Resend.pm:  (do_digests)  Add support for digest
	sorting and digest-specific index formats.

	* lib/Mj/Token.pm:  (t_accept)  Do not send the results of
	an accepted probe token to the victim.

	* lib/Mj/Digest/Build.pm:  (idx_numbered_name, idx_subject_name)
	New routines.  Support the numbered_name and subject_name index
	formats, which display the authors' names but not their
	addresses.

2001-09-24  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_unsubscribe)  Bugfix:  do not close the
	farewell filehandle; substitute_vars already does that.

2001-09-22  Michael Yount <csf@moscow.com>

	* lib/Mj/Parser.pm:  (parse_part)  Bugfix:  account for hyphenated
	interface names in command validity tests.  Thanks to
	Marc Fournier.

	* lib/Mj/Resend.pm:  (_r_strip_body)  Do not allow multipart
	subparts to be discarded wholesale.
	Bugfix:  call make_singlepart after the subparts have been
	processed.  Thanks to Roger Klorese.

2001-09-20  Michael Yount <csf@moscow.com>

	* lib/mj_cf_defs.pl, lib/mj_cf_data.pl:  add support for
	the attachment_filters configuration setting.

	* lib/Mj/Config.pm:  (parse_attachment_filters)  New routine.
	Parse the attachment_filters configuration setting.

	* lib/Mj/Resend.pm:  (_post)  Use the attachment_filters
	setting to determine how messages should be altered.

2001-09-19  Michael Yount <csf@moscow.com>

	* bin/mj_shell:  Bugfix:  use str_to_offset to determine
	the length of a delay.

	* lib/Majordomo.pm:  (_report)  Use Mj::Util::str_to_offset()
	to determine the time period for a report.

	* lib/mj_cf_data.pl:  support the "quarterly" option for
	the archive_split setting.

	* lib/Mj/Access.pm:  (list_access_check)  Remove unneeded 
	support for the check_main condition.
	(_a_delay)  Use Mj::Util::str_to_offset() to determine a
	delay.

	* lib/Mj/Archive.pm:  (_secs_start, _secs_end)  Treat
	a five-digit number, such as 20012, as an indication of
	a quarter-year instead of a month.
	(expand_range)  Use Mj::Util::str_to_offset().

	* lib/Mj/Config.pm:  (_str_to_offset)  Move to Mj::Util.
	(parse_limits)  Bugfix:  make a leading digit in a
	time span optional.

	* lib/Mj/Parser.pm:  (parse_part)  use Mj::Util::str_to_offset().

	* lib/Mj/Util.pm:  (str_to_offset)  Rename
	Mj::Config::_str_to_offset.
	(str_to_time)  Call str_to_offset() for syntax consistency.
	
2001-09-18  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_archive)  Add support for the "subject,"
	"author," "date," and "thread" command modes, which sort the results 
	accordingly, and the "reverse" command mode, which reverses the 
	order of the results.
	(_digest)  Use the whoami_owner setting instead of the sender
	setting in the From: address of digests.
	The version number is now 0.1200109180.
	(connect)  Do not display the password provided in an Approved
	header.
	(gen_cmdline)  Display "PASSWORD" in place of a new password
	in the command line.

	* lib/Mj/Archive.pm:  Add "msgid" to the list of index fields
	in anticipation of message threading.
	(add_start)  Force message counts to be reread to avoid a 
	race condition.  Thanks to Roger Klorese.

	* lib/Mj/CommandProps.pm:  Add support for the author, date,
	rev, subject, and thread modes of the archive command.

	* lib/Mj/Config.pm:  (_compile_rule)  Bugfix:  replace
	leading and trailing quotes, and quote metacharacters in string
	comparisons.  Thanks to Marc Fournier.

	* lib/Mj/Deliver/Dest.pm:  (sender)  Bugfix:  test to
	see if the envelope is defined before changing the sender.

	* lib/Mj/Format.pm:  (digest)  Add missing 'maxmsg' and 
	'minsize' data to the output of the digest-status command.
	(archive)  Bugfix:  call the archive_done core routine when
	no messages were found to avoid continuation of admin
	privileges.
	(help)  Bugfix:  include the list name in help links.  Thanks to
	Roger Klorese.
	
	* lib/Mj/List.pm:  (should_ack)  Return 0 if the ack
	would be sent to the list's address.  Thanks to Roger Klorese.

	* lib/Mj/MIMEParser.pm:  (collect_data)  Include the message-id
	in the data collected.

	* lib/Mj/Resend.pm:  (post)  Use the whoami_owner address
	in the From header of acks.
	(_post)  Include the message-id in the archive data.
	Bugfix:  exclude invalid headers from the message_headers
	setting.
	(do_digests)  Add headers here rather than in _post() and
	elsewhere.

	* lib/Mj/Token.pm:  (t_remind)  Use the whoami_owner address
	in the From header of reminders.

	* lib/Mj/Util.pm:  (sort_msgs, find_thread_root)  New routines.
	Sort messages by author, date, subject, or thread, or present
	them in reverse order.

2001-09-16  Jason Tibbitts  <tibbs@math.uh.edu>

	* bin/mj_email (parse_commands): 
	* bin/mj_queuerun (parse_commands): If an Approved: header is
	present, use what follows as a default password.

2001-09-12  Michael Yount <csf@moscow.com>

	* Makefile.PL:  List the Text::Reflow and Time::HiRes modules
	as optional modules.  Comment out DBI and DBD::Pg.

	* lib/Majordomo.pm:  (legal_list_name)  Untaint and return
	the list name.  This is useful for cleansing new list names
	for the createlist command.
	(_changeaddr)  Bugfix:  do not allow the change if the two
	addresses are aliases.
	(_createlist)  Support the "rename" command mode.
	(_digest)  Improve error checking.  Add support for
	comma-separated lists of digests.  Add support for the
	"repeat" command mode, which allows more than one issue
	of a digest to be delivered with one command.
	(_set)  Bugfix:  make certain at least one message is
	waiting before issuing a partial digest.
	(trigger)  Use the digest-check-repeat command to allow
	more than one issue to be delivered with one trigger.

	* lib/Mj/CommandProps.pm:  Support the accept-intact,
	createlist-rename, digest-repeat, and post-intact commands.

	* lib/Mj/Config.pm:  (parse_digests)  Set the default value
	of the "separate" field to 900 (15 minutes).  Validate the
	digest type.

	* lib/Mj/Digest.pm:  (examine)  Take a list of digests
	as an argument. 

	* lib/Mj/Format.pm:  (set)  Bugfix:  make certain at least
	one message is waiting before indicating that a partial digest
	was mailed.

	* lib/Mj/List.pm:  (aux_rekey)  Bugfix:  determine the 
	number of verified/repaired addresses after the databases
	have been examined.
	(rename_archive)  New routine.  Change the names of all
	of the archive files to reflect the current list name.
	This is used by the createlist-rename command.

	* lib/Mj/Parser.pm:  (parse_entity)  Unlink a converted
	HTML body part after the commands have been processed.

	* lib/Mj/Resend.pm:  (_post)  Support the "intact" mode,
	which causes message alterations by the attachment rules
	to be avoided.
	(_format_text)  Make use of Mj::Util::reflow_plain() if the
	Text::Reflow module is available.
	(_add_fters)  Only add f'ters to a multipart message if the
	subtype is "mixed."

	* lib/Mj/Util.pm:  (enriched_to_hyper, plain_to_hyper)  Bugfix:
	convert special characters into HTML entities.
	(reflow_plain)  New routine. Make use of the Text::Reflow module to 
	reformat unindented paragraphs containing long lines, with
	comment continuation.

2001-09-03  Michael Yount <csf@moscow.com>

	* Makefile.PL:  Require the HTML::FormatText and
	HTML::TreeBuilder perl modules.

	* bin/mj_wwwadm:  Allow the createlist command to be issued
	from this CGI script.

	* lib/Majordomo.pm:  Version number is now 0.1200109030.
	(_announce) Abort if close() fails.
	(reject) Do not send rejection messages to list/domain owners
	if the nolog or noinform command mode is used.
	(rekey_start, rekey_chunk, rekey_done)  Make the rekey command
	an iterated command to provide faster responses in the shell
	interface.  Rekey the GLOBAL aliases database.  Separate the
	xform functionality from the verify/repair functionality.
	Thanks to SRE.
	(_unsubscribe)  Abort if close() fails on a filehandle
	opened for writing.

	* lib/Mj/Archive.pm:  Abort if open() or close() fails on
	a filehandle opened for writing.

	* lib/Mj/CommandProps.pm:  Support the "mime_require" access
	variable for the post command, and the "noxform" mode for
	the rekey command.

	* lib/Mj/Config.pm:  Bugfix:  add existence tests to prevent
	autovivification of configuration variables.
	Thanks to Roger Klorese.
	(parse_attachment_rules)  Add support for the "format" and
	"require" actions.  The format action converts HTML or
	enriched text into plain text.  The require action sets the
	mime_require access variable.
	(compile_pattern)  Escape unescaped solidi and dollar signs.

	* lib/Mj/Digest.pm:  (_open_state)  Bugfix:  return an
	empty hashref if the _digests file does not already exist.

	* lib/Mj/File.pm:  (close)  Make the abort message consistent
	with changes in other modules.

	* lib/Mj/FileRepl.pm:  (open)  Abort if a new file could
	not be created.

	* lib/Mj/FileSpace.pm:  Abort if close() fails on a filehandle
	opened for writing.

	* lib/Mj/Format.pm:  (rekey)  Give a better indication of
	the keys that were changed, verified, or repaired.

	* lib/Mj/Inform.pm:  (inform)  Make the abort message consistent
	with changes in other modules.

	* lib/Mj/List.pm:  (aux_rekey)  Separate the xform and
	verification tasks.

	* lib/Mj/MailOut.pm:  Abort if close() fails on a filehandle
	opened for writing.

	* lib/Mj/Parser.pm:  (parse_entity)  Remove formatting from
	HTML parts and attempt to process the commands.

	* lib/Mj/Resend.pm:  (_post)  Abort if close() fails on a
	filehandle opened for writing.  
	Add "X-Content-Reformatted" and "X-Content-Discarded" headers 
	to messages that have been altered due to the attachment rules.  
	Add headers to digests based upon the precedence, reply_to, and 
	message_headers settings, for consistency with Mj1 digests.
	Thanks to Roger Klorese.
	(_r_strip_body)  Remove the "concat" and "regcreset" ops from
	the Safe compartment for compatibility with perl 5.004.
	Instead of substituting for scalar variables, non-terminal
	dollar signs are automatically escaped.
	Thanks to Olivier Prenant.
	Add support for the "format" action, which converts HTML or
	enriched text into plain text.
	Thanks to Brian Heess.
	(_format_text)  New routine.  Convert enriched text or
	HTML into plain text, or break long lines in a plain text
	body part.
	
	* lib/Mj/Token.pm:  Abort if close() fails on a filehandle
	opened for writing.

	* lib/Mj/Util.pm:  (re_match)  Remove the concat and
	regcreset ops from the Safe compartment for compatibility
	with perl 5.004.
	(enriched_to_hyper, plain_to_hyper)  New routines.  Convert
	enriched or plain text into HTML for conversion into formatted
	plain text by the HTML::FormatText module.

	* lib/Mj/Deliver/Connection.pm:  (getline)  Bugfix:  do not
	override a zero timeout multiplier, which is used for
	pipelining RCPT commands.

	* lib/Mj/Deliver/Dest.pm:  (flush)  Abort if the error message
	filehandle cannot be closed.

	* lib/Mj/Deliver/Envelope.pm:  (address)  Revise code to
	deal properly with unusual responses.

	* lib/Mj/Deliver/QQEnvelope.pm:  Abort if close() fails on
	a filehandle opened for writing.

	* lib/Mj/Deliver/SMTP.pm:  (getresp)  Treat a 552 response
	as a failure.

	* lib/Mj/Digest/Index.pm:  Abort if close() fails on
	a filehandle opened for writing.

	* lib/Mj/Digest/MIME.pm:  Abort if close() fails on
	a filehandle opened for writing.

	* lib/Mj/Digest/Text.pm:  Abort if close() fails on
	a filehandle opened for writing.

	* lib/Mj/SimpleDB/Text.pm:  Abort if close() fails on
	a filehandle opened for writing.

2001-08-23  Jason Tibbitts  <tibbs@math.uh.edu>

	* bin/mj_shell (parse_command): Handle "default" with no
	arguments and show a more informative message for "default list".
	
2001-08-22  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Majordomo.pm (reject): Accept -quiet mode for turning off
	notifications.  Stop overloading nolog and noinform for this
	purpose.

2001-08-22  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (substitute_vars)  Bugfix:  use the
	correct pattern match variable in error messages if a
	loop or missing file is encountered.

2001-08-21  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_unregister)  Bugfix:  treat "regex"
	and "pattern" modes identically.

	* lib/Mj/Format.pm:  (show)  Escape HTML special characters
	in registration data substitutions.

	* lib/Mj/SimpleDB/DB.pm:  (get_matching, get_matching_quick)
	Bugfix:  take into consideration values at the beginning
	of a catenated string of data.

	* lib/Mj/Util.pm:  (process_rule)  Bugfix:  use the \003 character
	to separate reasons.

2001-08-20  Michael Yount <csf@moscow.com>

	* bin/mj_wwwusr:  Allow subscribers to specify the new password
	they want.  Thanks to Roger Klorese.

	* lib/Majordomo.pm:  (_make_list)  Use the _list_config_search
	callback to allow default values to be obtained directly from
	the DEFAULT list.
	(_createlist)  Add support for the "pass" command mode, which
	allows the master password to be specified on the command line.
	Bugfix:  Bypass the default_digest digest in MTAConfig.pm 
	instead of deleting it.  Thanks to Roger Klorese.
	(_list_config_search)  Wrapper for Mj::List::config_search.

	* lib/mj_cf_data.pl:  Make the password_min_length setting
	visible to everyone.

	* lib/Mj/Access.pm:  Bugfix:  Use \003 to separate reasons to
	avoid conflict with the \002 character used to separate access
	variables.

	* lib/Mj/CommandProps.pm:  Add support for the createlist-pass
	command.

	* lib/Mj/Config.pm:  (search)  New routine.  Look for a
	configuration value in a series of templates and return the
	template and value.
	(get, default, intro) Use the _list_config_search callback 
	to obtain default values directly from the DEFAULT list.
	(regen) Remove outdated settings from the configuration file
	automatically.

	* lib/Mj/Format.pm:  (tokeninfo) Bugfix:  use the \003
	character to separate reasons.

	* lib/Mj/List.pm:  (config_search)  Wrapper for 
	Mj::Config::search.

	* lib/Mj/MTAConfig.pm:  (add_alias)  Bugfix:  skip the 
	default_digest digest when expanding the subscribe-digest-all
	alias.

	* lib/Mj/Resend.pm:  (post)  Bugfix:  use the \003 character
	to separate reasons.

	* lib/Mj/Token.pm:  (confirm)  Bugfix:  use the \003 character
	to separate reasons.

2001-08-19  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Config.pm (parse_digests): Change parsing; second line
	now has two fields, the second one contains the subject header for
	the digest and is optional.  Default to a subject like the old
	one, but inculde the list name in brackets.

	* lib/Mj/Resend.pm (do_digests): Take the subject for the digest
	from the digests variable.  Perform variable substitutions on
	the subject.  Add MESSAGECOUNT substitution.

2001-08-18  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Majordomo.pm (_createlist): Use new parsed version of
	'sublists' to eliminate a bunch of redundant parsing code
	scattered throughout.
	(_lists): Use parsed version of 'sublists' and clean up a bit.

	* lib/Mj/Config.pm (parse_sublist_array): Make the sublist_array
	type parsed; parse it as a table.

2001-08-17  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/List.pm (_fill_config): Return the list of available
	templates.  Helps eliminate a couple of layering violations.

	* lib/Majordomo.pm (_createlist): Regenerate all configurations of
	all lists on createlist-regen.

	* lib/Majordomo.pm (_lists): Make use of _fill_config returning
	the list of templates.
	
2001-08-16  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Remove spaces from list names.

	* lib/Majordomo.pm:  (_createlist)  Bugfix:  if a list
	exists, use its settings to determine the parameters
	for alias creation.  Otherwise, use both the DEFAULT list
	and any default templates.
	Bugfix:  Display the aliases if createlist-nocreate is used
	and the maintain_config option is turned on.
	(who_start)  Correct the second list validity test for
	the who-common command.  Thanks to Roger Klorese.

2001-08-16  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Majordomo.pm (_createlist): Parse digests variable from
	DEFAULT for use when creating new lists.  Also pass in priority
	and domain_priority.	

2001-08-15  Jason Tibbitts  <tibbs@math.uh.edu>

	* t/shell.t: Fix test 15 to match changes in "password" format
	file.

	* lib/Majordomo.pm (configshow): Bugfix: in the case of a single
	scalar variable, returned $auto where we meant to return $data.

2001-08-15  Michael Yount <csf@moscow.com>

	* lib/Mj/Format.pm:  (show,who)  Bugfix:  include the third part of
	the delivery class when determining which class applies to a
	subscription.

2001-08-14  Michael Yount <csf@moscow.com>

	* bin/mj_shell:  Invoke an editor automatically when
	the faq-edit, get-edit, info-edit, or intro-edit commands
	are used.

	* bin/mj_wwwadm:  Add support for the newfaq, newinfo, newintro,
	and put commands.  Use format files with the faq, get, info, and 
	intro commands.

	* bin/mj_wwwusr:  Use format files with the faq, info, and intro
	commands.  Support the hidepost personal setting.

	* lib/Majordomo.pm:  Version number is now 0.1200108140.
	(_get, _put, _index)  Improve error checking on file names.
	(_get)  Make use of substitutions in the file_sent file.
	(_faq, _info, _intro)  Add support for the "edit" command mode.
	This will, for example, wrap the faq document in a newfaq
	command to make editing and replacing the document easier.
	(_put)  Add support for the "delete" command mode, which
	will remove files or empty directories, and the "force"
	command mode, which will recursively delete directories.
	(_archive) Add support for the "hidden" command mode, which
	displays only hidden messages (those that were posted by
	people with the "hidepost" flag set, for example).
	(archive_chunk)  Change the use of the "delete" command mode
	to avoid deleting messages from the archive that are awaiting
	delivery in a digest unless the "force" command mode is also used.  
	This allows the archive-delete-hidden command to be used to 
	clean "hidden" messages from the archive using a trigger.
	(_set)  Bugfix:  do not send a partial digest of messages
	if no messages are scheduled for delivery.  Also, use
	only the message numbers in constructing the digest, to
	cause the correct information to be extracted.

	* lib/mj_cf_data.pl, mj_cf_defs.pl:  Add support for the "mail" 
	delivery class, the "hidepost" personal setting, and the 
	noarchive_body and noarchive_headers configuration settings.

	* lib/Mj/Archive.pm:  Add the "hidden" field to the archive
	database, which indicates whether or not a message should be
	made public.
	(expand_range)  Allow "hidden" messages to be excluded from
	the results.
	(remove)  Bugfix:  correct off-by-one error in revised byte
	count.

	* lib/Mj/CommandProps.pm:  Add support for the following
	commands:  accept-hide, archive-delete-force, archive-hidden,
	faq-edit, info-edit, intro-edit, post-hide, put-delete and
	put-delete-force, as well as the hide_post and noarchive
	access variables.

	* lib/Mj/Config.pm:  (parse_access_rules, _compile_rule):
	Add support for the noarchive_body and noarchive_headers
	configuration settings.

	* lib/Mj/Digest.pm:  (sync)  New routine.  Replace the
	state data for one or more digests.  This is used to update
	the digest data after the archives have been changed by
	the archive-delete or archive-sync command.

	* lib/Mj/FileSpace.pm:  (legal_file_name)  Rename
	_legal_file_name (it is now used by the Mj::List module.)
	Bugfix:  do not allow a leading dot in any component of a path.
	(delete, index) Improve error checking.
	(_empty_dir) New function:  remove the contents of a 
	directory recursively.

	* lib/Mj/Format.pm:  (accept)  Display the token number
	in the result.
	(archive)  Mark "hidden" messages with an asterisk.
	(g_get)  Use format files to display the results.

	* lib/Mj/List.pm:  Add support for the hidepost personal
	setting.
	(describe_class)  Include the digest format in the 
	description.
	(get_setting_data)  Include information about each digest
	format in the result.
	(fs_legal_file_name)  New routine.  Determine if a path
	is potentially valid for file space purposes.
	(archive_delete_msg, archive_sync)  Call digest_sync
	to update digest information after an archive change.
	(digest_sync)  New routine.  Obtain a message list for
	each digest, extract the current information from the
	archives, and update the digest information.
	(should_ack)  Test the validity of the address.
	Thanks to Ron Kuris.

	* lib/Mj/MIMEParser.pm:  (collect_data)  Mark a message as
	"hidden" if it has an "x-no-archive: yes" or 
	"restrict: no-external-archive" header.

	* lib/Mj/Resend.pm:  (_post)  Add support for "hidden" messages,
	which occur when:  (1) the "hide" command mode is used;
	(2) the "hidepost" flag is set; or (3) when the message matches
	one of the patterns in the noarchive_body and noarchive_headers
	settings.  Add an "X-No-Archive: yes" header to every hidden
	message, in both the archived and the distributed copy.
	(_check_approval)  Log/inform a rejection of a token
	using the "Approved" feature.
	(_check_poster)  Add support for the hide_post access variable,
	which is set if the "hidepost" setting applies to the author
	of a message.
	(_check_body, _ck_tbody_line)  Add support for the 
	noarchive_body configuration setting.
	(_ck_theader)  Add support for the noarchive_headers setting.

	* lib/Mj/Token.pm:  (confirm)  Improve comments about
	the notify structures.
	
	* lib/Mj/SimpleDB/DB.pm:  (lookup_quick)  Bugfix:  return
	immediately if the key is absent.

	* lib/Mj/SimpleDB/Text.pm:  (lookup_quick)  Bugfix:
	issue a warning and return if the key is absent.

2001-08-14  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/MTAConfig.pm (add_alias): Bugfix - remove extra dash in
	VUT setup for list owner.

2001-08-08  Michael Yount <csf@moscow.com>

	* lib/Mj/BounceHandler.pm:  (handle_bounce_message) 
	Return any identified bad addresses, even if the owners
	were not notified.  This allows all message bounces to be 
	logged as such.

2001-08-07  Michael Yount <csf@moscow.com>

	* lib/Mj/Access.pm:  (_a_forward)  Bugfix:  alter
	the command line before changing the destination.

	* lib/Mj/CommandProps.pm:  Bugfix:  support the "m"
	mode of the owner command, which handles mail sent to
	the LIST-moderator address.

	* lib/Mj/List.pm:  (moderators)  Use the whoami_owner
	setting instead of the sender setting for the fallback
	address.

	* lib/Mj/Token.pm:  (confirm)  Use the whoami_owner
	setting instead of the sender setting in the From
	header of confirmation messages.

2001-08-05  Michael Yount <csf@moscow.com>

	* bin/mj_email:  Bugfix:  handle "-c" commands in the
	request section, not the majordomo section.
	
	* bin/mj_email, bin/mj_queuerun:  Differentiate the
	"email," "email-request," and "email-command" interfaces.
	The email-request interface is used if commands are processed
	by a LIST-request address.  The email-command interface is
	used if a blank message is sent to a command alias, such
	as LIST-subscribe.

	* bin/mj_shell:  Bugfix:  Work around Net::Domain bareword
	problem by invoking "use strict" after external modules
	have been loaded. 
	Store session information in a form resembling e-mail headers.

	* files/en/token_bounce:  New file, used for notifications
	when confirmation instructions cannot be delivered.

	* lib/Majordomo.pm:  (connect)  Allow hyphens in the interface
	name.
	(gen_cmdline)  Bugfix:  Use "majordomo-owner" instead of
	"GLOBAL-owner" when a message is sent to domain managers.
	(reject)  Do not send informative messages about rejected
	confirm tokens if the "noinform" or "nolog" command mode
	is used.
	(showtokens)  Add support for the "probe" command mode,
	which will allow probe tokens to be displayed.

	* lib/Mj/BounceHandler.pm:  (handle_bounce_token)  Send
	notices concerning bounced tokens to list owners, and
	possibly the requester, instead of domain owners.

	* lib/Mj/CommandProps.pm:  Support the report-full and
	showtokens-probe commands.

	* lib/Mj/Config.pm:  Support the "expire" action, which
	occurs when the lifetime of a token expires.

	* lib/Mj/Format.pm:  (report)  Display the session ID
	and interface in "full" mode.
	(g_sub) Make list substitutions only once.

	* lib/Mj/Token.pm:  (t_accept)  Acceptance of an alias
	token with a negative number of approvals required will
	never result in the action being completed.  This is 
	useful if a notice bounce were configured to cause a consult
	token to be deleted.
	(t_expire)  Log/inform about the expiration of each token.

2001-08-01  Michael Yount <csf@moscow.com>

	* lib/Mj/Access.pm:  (_a_default)  Include longer error
	messages when a request is denied by default, or due to
	the use of an absolute path in a file or directory name.
	Thanks to Nathan Spencer.

	* lib/Mj/Format.pm:  Consistency:  use the indicate
	routine consistently to mark failure messages.

	* lib/Mj/Resend.pm:  (post, _post)  Use "(no subject)"
	in the SUBJECT expansion if no subject was provided.

	* lib/Mj/Token.pm:  (t_info)  Use the "unknown_token"
	error message if the tokeninfo command accesses a
	token that is not in the database.

2001-07-29  Michael Yount <csf@moscow.com>

	* Makefile.PL:  Bugfix:  make certain that the scripts are
	stored in the "bin" directory.  Thanks to David Reid.

	* bin/mj_confirm, bin/mj_wwwadm, bin/mj_wwwusr:  Store
	IP Address and other information in a form that resembles
	mail headers.

	* bin/mj_email:  Bring up to date with recent changes to
	mj_enqueue and mj_queuerun, including support for request
	data in aliases.

	* files/en/digest_preindex:  Minor formatting changes.
	Thanks to SRE.

	* lib/Majordomo.pm:  (tokeninfo)  Add support for the 
	"remind" command mode, which causes a reminder message to
	be mailed to the requester's address.
	Change the version number to 0.1200107290.

	* lib/Bf/Sender.pm:  (encode_verp, decode_verp)  Add support
	for encoding and decoding of special characters, based upon
	code by Jason Tibbitts.

	* lib/Mj/Access.pm:  (list_access_check)  Give a more
	informative error message if an invalid password is used.
	Thanks to Duncan Hill.

	* lib/Mj/BounceHandler.pm:  (handle_bounce_token)  Bugfix:
	only indicate that a token has been deleted if it actually
	happened.

	* lib/Mj/BounceParser.pm:  (parse)  Decode special characters
	in address extensions.

	* lib/Mj/Format.pm:  Consistency:  Use local time instead
	of UTC.  Thanks to Anand Narayan.
	(tokeninfo) Add "WILLACK" substitution to cause the 
	"reasons" box to be omitted if an acknowledgement will not
	be sent.

	* lib/Mj/List.pm:  (make_setting)  Add support for the
	"mail" setting, which is the opposite of "nomail".

	* lib/Mj/MTAConfig.pm:  (add_alias)  Add the "set" mode
	to subscribe-digest and related aliases to allow the
	command line to be reconstructed correctly for confirm
	and consult messages.

	* lib/Mj/Resend.pm:  (_post)  Bugfix:  do not update the 
	sequence number if the message is only archived.

	* lib/Mj/Token.pm:  (t_accept, t_reject)  Give a more
	detailed explanation if a nonexistent token is given.
	Thanks to SRE.
	(r_gen)  Create a reminder entity; this code is used
	by the tokeninfo-remind command, as well as in automated
	reminders.

2001-07-27  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/MTAConfig.pm (add_alias): Create lots of additional
	aliases for the new "aliases" settings.

	* lib/Majordomo.pm (_createlist): Clean up calling convention for
	MTAConfig routines a bit.  Pass in list of digests.

2001-07-16  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/mj_cf_data.pl: Add subscribe-digest, subscribe-digest-all
	and subscribe-nomail as legal values for the aliases setting.

2001-07-16  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* bin/mj_enqueue: Left an important option out of the GetOptions
	list.

2001-07-15  Jason Tibbitts  <tibbs@math.uh.edu>

	* bin/mj_email (parse_commands): Fix typo.

	* bin/mj_queuerun (parse_commands): Unpack additional key=value
	items from the queue filename and pass them as part of the request
	structure.  Allow the command part of the queue filename to
	contain a command-mode instead of just a mode.  Split and pass
	this in the request structure.

	* bin/mj_enqueue: Switch to Getopts::Long.  Accept a hash-type
	argument --req which specifies additional items to be included in
	the queue filename.

	* bin/mj_email: Switch to Getopts::Long.  Accept a hash-type
	argument --req which specifies additional elements for the request
	structure.  Allow the -c option to specify a command-mode instead
	of just a command.

2001-07-14  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Use an empty list name by default instead of
	the GLOBAL list.  Suggested by Roger Klorese.

	* lib/Majordomo.pm:  (accept)  When a posted message is
	approved with the accept-archive command, log it as a "post"
	instead of a "consult".
	(configset)  Give an error immediately if the setting name
	is not supplied.  Thanks to Roger Klorese.

	* lib/Mj/List.pm:  (bounce_gen_stats)  Add missing dereference.

	* lib/Mj/Resend.pm, lib/Mj/Util.pm:  Allow the "concat" and
	"regcreset" actions in Safe compartments for greater flexibility
	in regular expressions.  Thanks to Paul Hancock.
	
2001-07-12  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Config.pm (parse_access_rules, parse_bounce_rules,
	_compile_rule): Slightly better error messages.

	* lib/Mj/BounceHandler.pm (handle_bounce_user): Pass the
	'diagnostic' variable to the rules parser.

	* lib/Mj/CommandProps.pm: Add 'diagnostic' as a legal bounce_rules
	variable.

2001-07-09  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (get_all_lists)  Bugfix:  Use the first return
	value to determine if access is permitted.  Thanks to David
	Roodman.

	* lib/Mj/MTAConfig.pm:  (add_alias)  Correct the VUT entries
	for -(un)subscribe addresses.  Thanks to Roger Klorese.

	* setup/newdomain.pl:  Bugfix:  Consider $config a global
	variable.  Thanks to Roger Klorese.

2001-07-04  Michael Yount <csf@moscow.com>

	* lib/Mj/Format.pm:  (lists)  Use an empty string instead
	of a question mark in variable expansions to avoid incorrect
	URLs.  Thanks to Gavin Walker.

2001-06-23  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/BounceHandler.pm (handle_bounce_user): Add addr,
	fulladdr, and host variables to bounce_rules.

	* lib/Mj/CommandProps.pm: ditto.
	
2001-06-23  Michael Yount <csf@moscow.com>

	* lib/Mj/Config.pm:  (regen)  Bugfix:  Do not parse 
	addresses in DEFAULT configuration files.

2001-06-22  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_make_list)  Bugfix:  Use the "_install"
	template instead of the GLOBAL defaults to initialize 
	mailing lists.

2001-06-22  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Util.pm (n_defaults): The default file for a bounce probe
	is "bounceprobe".

	* lib/Mj/Token.pm (confirm): Set token type to 'probe' as
	appropriate.  Set envelope extention properly for probe tokens.

	* lib/Majordomo.pm (_put): Preliminary: allow put-delete.
	(_list_file_get): Search per-language default files before
	searching non-language-specific default files.

2001-06-20  Michael Yount <csf@moscow.com>

	* bin/mj_shell:  Note that the -D option causes the debugging
	output to be sent to stderr, not stdout.  Thanks to Paul
	Hancock.

	* lib/Majordomo.pm:  (_list_sync_owners)  Bugfix:  Use the
	correct address when the GLOBAL:owners auxiliary list is
	changed.

	* lib/Mj/Archive.pm:  (_expand_message_range) Bugfix: 
	Initialize the archive name and number correctly.
	(remove) Bugfix:  Always look up the data for each message.
	Thanks to SRE.

	* lib/Mj/Config.pm:  (load)  Bugfix:  Use the GLOBAL 
	installation defaults with the DEFAULT list.
	(regen, set) Bugfix:  Do not parse addresses for the DEFAULT list.
	(isparsed)  Move the DEFAULT/address exception to the
	regen and set routines.  Thanks to Paul Hancock.

	* lib/Mj/Format.pm:  (configshow)  Bugfix:  check for
	equivalence when comparing enumerated values.  Thanks to Duncan
	Hill.
	(lists) Bugfix:  Initialize "legend" variable for the
	lists-enhanced command.  Thanks to Paul Hancock.

2001-06-15  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/CommandProps.pm: Add consecutive_days as a legal variable
	for bounce_rules.

2001-06-14  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/List.pm (bounce_gen_stats): Calculate consecutive_days
	statistic.

	* lib/Mj/BounceHandler.pm (handle_bounce_probe): New function:
	deal with bouncing bounce probes.
	(handle_bounce): Deal with bounces of type 'P' by calling
	handle_bounce_probe.
	(_hbr_probe): New function: send a bounce probe.
	(handle_bounce_user): Add failure variable.

2001-06-13  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/BounceHandler.pm (_hbr_noprobe): Accept 'reason' argument
	so the caller can supply its own removal reason.

	* lib/Mj/BounceParser.pm (parse): Allow type 'P' envelopes (for
	bounce probes) as well.

2001-06-05  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* bin/mj_shell: Don't rely on $ENV{LOGNAME}; use getpwuid($<)
	instead.

2001-06-05  Michael Yount <csf@moscow.com>

	* lib/Mj/Config.pm:  Do not parse the config_array data.
	Thanks to Paul Hancock.

2001-06-04  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm: (configshow) Bugfix:  allow the append,
	declared, and merge modes to work with the nocomments mode.
	(_show)  Allow the password to be displayed.

	* lib/Mj/Archive.pm: (expand_date)  Bugfix:  verify that the
	date is defined before making comparisons.

	* lib/Mj/Config.pm: (load)  Bugfix:  use an array instead of a
	scalar to hold the list of configuration templates.  Thanks to
	Paul Hancock.

	* lib/Mj/List.pm: (describe_class)  Bugfix:  return the setting
	name instead of the setting description if requested (the
	who-export command was displaying "no messages" instead of
	"nomail".)

	* lib/Mj/Resend.pm: (_post)  Bugfix:  allow multi-line subject
	and date headers when untainting.  Use the body length instead
	of a checksum to determine if the uniqueness test should be
	skipped.
	(_munge_subject)  Bugfix:  preserve a multi-line subject when
	"Re:"s are being stripped.

	* lib/Mj/SimpleDB/Base.pm:  (_stringify)  Bugfix:  convert
	returns and newlines to spaces.

	* lib/Mj/Util.pm:  (re_match)  Bugfix:  allow "concat" and 
	"regcreset" operations in the safe compartment.

2001-05-11  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Majordomo.pm (_list_file_get): DEFAULT:$LANG should be
	searched before DEFAULT.

	* lib/Mj/BounceParser.pm (parse_exchange, parse_msn): Fix undef
	warning due to nonexistent subject.

2001-05-08  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/BounceHandler.pm (_hbr_consult): Make sure that the
	bounce data does not indicate that the owners have already been
	consulted.  If not, consult as normal and add a type 'C' bounce
	event.

	* lib/Mj/Token.pm (confirm): Return the token ID which was
	generated.

	* lib/Mj/List.pm (bounce_add): Add 'P' and 'C' events at the head
	of the list.  Change argument names to reflect that the function
	takes bounce event data, not just info on bounced messages.
	(expire_bounce_data): Don't count 'C' or 'P' events.

2001-05-07  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Util.pm (n_defaults): The default for 'attach' should
	only be '1' for posts; take a 'command' argument to determine
	this.

2001-05-06  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Token.pm (confirm): Rework how attach works, so actions
	other than post can have attachments and so that so that the
	attachment parameters can be specified.

	* lib/Mj/BounceParser.pm (parse_exim): Tweak.

	* lib/Mj/BounceHandler.pm: Lay groundwork for consulted and probed
	removals.

	* lib/Mj/CommandProps.pm: Add 'notify' as a legal action for
	_bounce.

	* lib/Mj/Config.pm (parse_bounce_rules): Add notify processing.

2001-05-03  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/CommandProps.pm: nonempty_lines is a legal access
	variable.

	* lib/Mj/Resend.pm (_r_ck_body): Count lines containing something
	other than whitespace in the "nonempty_lines" variable.

2001-04-17  Michael Yount <csf@moscow.com>

	* lib/Mj/Token.pm:  (t_accept)  Bugfix:  do not chain
	the expiration data.

2001-04-13  Michael Yount <csf@moscow.com>

	* lib/Mj/Access.pm:  (list_access_check)  Bugfix:  ensure
	that address-related access variables are initialized.
	(Thanks to Peter Ajamian)

2001-04-11  Michael Yount <csf@moscow.com>

	* lib/Mj/FileSpace.pm:  (put_chunk, put_done)  Bugfix:
	do not use object methods with the file handle.

2001-04-10  Michael Yount <csf@moscow.com>

	* convertlist.pl:  Do not remove hyphen escapes from here
	documents in Mj1 configuration files.

2001-04-09  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Bugfix:  Do not include the password
	in the CGIDATA expansion until it has been converted
	into a temporary password.

2001-04-07  Michael Yount <csf@moscow.com>

	* convertlist.pl:  Bugfix:  Do not convert the "filedir"
	configuration setting.
	Bugfix:  Do not add subscribers to a new list if the 
	subscriber file is empty or absent.
	Bugfix:  Use the subscribe command, not the auxadd command,
	to add addresses to an auxiliary list.

	* lib/Majordomo.pm:  (dispatch)  Bugfix:  Test the validity
	of each victim's address individually, allowing partial
	success if some of the addresses are valid.
	(archive_start)  Feature:  Allow the use of patterns within
	a here document to narrow the scope of the messages retrieved
	by the archive command.  Patterns beginning with "~a" will
	be matched against the authors' e-mail addresses.  Patterns
	beginning with "~s" will be matched against the message
	subjects.  (Thanks to Scott Garee, Paul Hancock, and Duncan
	Hill)
	The version number is now 0.1200104070.

	* lib/Mj/Archive.pm:  (expand_range)  Bugfix:  Remove redundant
	"\d" from a regular expression.

	* lib/Mj/CommandProps.pm:  Bugfix: Use "mismatch" by default
	for the lists command to prevent leaking private information
	with the lists-enhanced command.
	Bugfix:  Do not require strict address validation for the 
	unsubscribe and unregister commands.  (Thanks to Duncan Hill)
	Bugfix:  Use long names for bounce rule variable types.

	* lib/Mj/Format.pm:  (help, lists)  Bugfix:  Remove unnecessary
	"select" statements. (Thanks to Duncan Hill)
	(post)  Bugfix:  Use the "post_chunk" command only if necessary.

	* lib/Mj/Token.pm:  (t_accept)  Bugfix:  When testing the 
	command name, account for the "_" prefix.

	* t/core.t:  Use a valid but fictitious requester address 
	to avoid stalled commands.

2001-03-25  Michael Yount <csf@moscow.com>

	* bin/mj_shell: (parse_interactive)  Bugfix:  allow continuation
	lines and a here document in the same command.

	* lib/Majordomo.pm: (dispatch)  Bugfix:  reset the timer after 
	inform() is called to log the correct elapsed time for multiple
	commands.
	(who_chunk)  Bugfix:  allow the alias and common command modes
	to work together.

	* lib/mj_cf_data.pl, mj_cf_defs.pl:  Support the new config_defaults
	configuration setting.

	* lib/Mj/Archive.pm:  (expand_range) Bugfix:  support the time
	span format with full names (e.g., "months" instead of "m").

	* lib/Mj/Config.pm:  (load, parse_config_array)  Add support
	for configuration templates through the config_defaults setting.
	This setting has higher priority than the DEFAULT list, but
	lower priority than a list's main configuration settings.
	All templates must be stored under the DEFAULT list.
	(parse_limits) Bugfix:  support the time span format with
	full names.

	* lib/Mj/Format.pm:  (who) Include "noinform" in the commands
	displayed by the who-export command.

	* lib/Mj/Parser.pm:  (parse_line) Bugfix:  trim backslashes after
	removing leading and trailing white space.
	(parse_args)  Remove trailing white space from the arguments.

	* lib/Mj/Util.pm:  (str_to_time)  Add support for "mi"
	abbreviation for minutes.

2001-03-24  Jason Tibbitts  <tibbs@math.uh.edu>

	* bin/mj_shell (parse_command): Look for both /usr/bin/more and
	/bin/more.

2001-03-20  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* bin/mj_queuerun (call_format): New function to load the
	Mj::Format library and call the formatter.

2001-03-13  Michael Yount <csf@moscow.com>

	* lib/Mj/Util.pm:  (n_validate)  Bugfix:  Convert "remind"
	variable time spans from a string into a number of seconds.
	(str_to_time)  Support the "s" abbreviation for seconds.

2001-03-11  Michael Yount <csf@moscow.com>

	* README.LINUX:  Describe a workaround for a MakeMaker module
	bug in some versions of linux.

	* lib/Mj/Format.pm:  (g_get)  Bugfix:  Changing the request hash
	for sessioninfo commands prevented mj_wwwadm from executing more
	than one tokeninfo command.

	* lib/Mj/Token.pm:  (confirm)  Bugfix:  Testing the 'ackstall'
	flag could in some cases cause CONSULT notices not to be mailed.

2001-03-09  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  Version number is now 0.1200103090.
	(common_subs, et al.) Declare undeclared variables.
	(list_config_set_to_default) Bugfix:  correct the list variable name
	for the unknown_setting error.
	(report_start, _report) Bugfix: join and split values using \002
	in double, not single, quotes.
	(_showtokens) Add support for the alias token type, which is a way 
	to assign more than one token identifier to the same request.

	* lib/Mj/Access.pm:  (list_access_check)  Add support for the chain
	access variable, which determines whether confirmation notices are
	sent consecutively or simultaneously;  the expire variable, which
	determines the lifetime of a token; and the notify action, which
	changes the attributes of a token.
	(_a_conf_cons, et al.)  Adapt to use data from "notify" actions.
	(_a_replyfile)  Use a local symbol instead of a global filehandle
	for reading the reply file.

	* lib/Mj/Archive.pm:  (sync) Declare undeclared variable.
	(get_to_file)  Add file handle error checks.

	* lib/Mj/BounceHandler.pm:  (handle_bounce_token) Call
	Mj::Token::t_reject instead of t_remove, to account for potential
	alias tokens.

	* lib/Mj/BounceParser.pm:  (parse_dsn)  Cope with missing
	delivery-status parts.

	* lib/Mj/CommandProps.pm:  Add support for the "notify" action
	in the access rules.  Give access variables type names instead
	of type numbers.  Make the "mkdigest" command an alias for the
	digest command.  Add support for the showtokens-alias command.

	* lib/Mj/Config.pm:  (parse_access_rules)  Add support for the
	notify action, including validation of the variables names.

	* lib/Mj/Format.pm:  (archive, et al.)  Declare undeclared 
	variables.

	* lib/Mj/List.pm:  (default_class, et al.)  Declare undeclared
	variables.

	* lib/Mj/MIMEParser.pm:  (_r_ct_lines)  Declare undeclared
	variables.

	* lib/Mj/Resend.pm:  (post) Include CMDLINE substitution in
	stall/denial acknowledgment messages.
	(_post)  Bugfix:  Use the correct content data in delivery
	acknowledgment messages.
	(_check_poster)  Add a message to the list of reasons if the
	postblock flag is set.

	* lib/Mj/Token.pm:  (consult, delay)  Removed.  The code for
	these two methods has been merged into the confirm method.
	(get_moderators)  Obtain a list of moderator addresses, given
	a mailing list name, moderator group, and pool size.
	(confirm, t_accept)  Adapt to use "notify" hash refs to determine
	the attributes of a token.  The "chain" fields of the token data
	are now used to store packed representations of the "notify"
	data, allowing up to five approval steps to be required.

	* lib/Mj/Util.pm:  (condense, n_build, n_defaults, n_validate,
	reconstitute)  These new routines are used to construct,
	validate, pack, and unpack "notify" hash refs.
	(process_rule)  Add support for the "notify" action.

	* lib/Mj/Deliver/Dest.pm:  (sendenvelope) Declare undeclared
	variable.

	* setup/ask_basic.pl:  (ask_basic) Comment out pgsql question.

	* setup/setup_func.pl:  (mta_setup) Bugfix:  change ownership 
	of the mj-domains file after it is created.  Suggested by 
	David Miller.

2001-03-02  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/BounceParser.pm (parse_exim): Adapt to new exim bounce
	format: X-Failed-Recipients: may have more than one address.
	Addresses in body may or may not be followed by a colon.

2001-03-02  Michael Yount <csf@moscow.com>

	* lib/Mj/Resend.pm:  (_munge_subject)  Bugfix:  Add missing library
	requirement.

	* lib/Mj/Token.pm:  (t_accept)  Bugfix:  Create an Mj::Addr object
	before testing whether or not to send an acknowledgment to that 
	address.

2001-03-01  Michael Yount <csf@moscow.com>

	* bin/mj_shell:  Bugfix:  allow command completion to work again.
	Store multi-line commands as one history entry.
	Indicate the Term::ReadLine library in use on startup.
	Refer people to the new command_line help file.
	Allow multi-line commands in interactive mode when the first
	line ends in a backslash.

	* lib/Majordomo.pm:  (domains)  Use a local symbol for the file
	handle.
	(substitute_vars_format)  Add support for displaying help files
	in a separate web browser window.
	(config_get_mutable, config_get_visible)  Bugfix:  do not always
	use the GLOBAL context to determine if a setting is visible or
	mutable.
	(report, _report)  Change the semantics of the report command:
	allow here documents, and expect to find the date criteria
	before the action criteria.
	
	* lib/mj_cf_data.pl, lib/mj_cf_defs.pl:  Add support for the
	GLOBAL www_help_window setting, which will cause help links in
	the www interfaces to display the help files in a separate window.
	Requested by David Miller.

	* lib/Mj/CommandProps.pm:  Support the changes to the report command.

	* lib/Mj/Config.pm:  (parse_access_array)  Bugfix:  return the
	correct data.
	(parse_inform)  Verify the names of the events that are being
	monitored.

	* lib/Mj/FileSpace.pm:  (put)  Only use File::Copy if needed.

	* lib/Mj/Format.pm:  (configshow)  Add a HELPLINK substitution
	to allow help documents for the settings to be viewed in a 
	separate web browser window.
	(help)  Add support for the GLOBAL www_help_window setting, which
	allows help documents to be viewed in a separate browser window.

	* lib/Mj/SimpleDB/Base.pm:  (_stringify)  Convert ^A characters
	to spaces in individual fields as they are added to the string.

	* lib/Mj/Token.pm:  (t_accept)  Bugfix:  determine whether or
	not the request would cause an acknowledgement to be sent.

2001-02-27  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Resend.pm (_munge_subject): Bugfix: don't delete subjects
	not matching $re_regexp.

2001-02-25  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/Resend.pm (_munge_subject): Make use of
	subject_re_pattern and subject_re_strip settings.  Put the prefix
	after any existing Re: part.

	* lib/Mj/Util.pm (re_match): Accept a third argument and return
	the match array if present.

	* lib/mj_cf_data.pl: Add subject_re_pattern and subject_re_strip
	variables.

2001-02-24  Michael Yount <csf@moscow.com>

	* Makefile.PL:  Depend upon Socket instead of IO::Socket.
	Suggest reading the admin_domain help file with the new -P
	option to mj_shell.

	* bin/mj_confirm:  Add explanation box, as requested by 
	David Miller.

	* bin/mj_email, bin/mj_queuerun:  Use Symbol instead of IO::File. 
	Do not mail a reply if the request came from the server address.

	* bin/mj_queueserv:  Use Symbol instead of IO::File.  Add a
	routine to autoflush file handles.

	* bin/mj_shell:  Add "-P" option to show the output of commands
	in a pager.  The "default display" command can be used to show
	the output of any command in a pager or editor.  If an editor
	is used, mj_shell will attempt to execute commands from the file
	after the editing is completed.

	* bin/mj_wwwadm:  Increase the time before cache expiration to
	50 seconds.

	* lib/Majordomo.pm:  Version number is now 0.1200102240.
	Use Symbol instead of IO::File.
	(connect)  Reuse session files for logging if a temporary password
	is supplied.
	(_site_config_get, _global_config_get, _make_list) Move ubiquitous 
	methods above the autoload line.
	(_re_match) Move this routine to Mj::Util::re_match.
	(_get_stock) Use the FileSpace module instead of loading INDEX.pl.
	(_createlist) Include the new priority configuration setting
	when aliases are created.
	(_showtokens) Support the new "async" mode, which displays
	asynchronous tokens.  These tokens are created when a posted
	message is accepted, then delivered in the background.
	
	* lib/mj_cf_defs.pl, mj_cf_data.pl:  Support the archive_date
	and priority configuration settings.

	* lib/Bf/Sender.pm:  (open_abbrev_database)  Commented out.

	* lib/Mj/Access.pm:  (list_access_check)  Comment out
	Data::Dumper dependency.
	(_a_forward)  Use MIME::Entity::build instead of MIME::Entity::new.
	Use Symbol instead of IO::File.
	(_a_replyfile)  Remove Mj::File dependency.
	(_d_advertise)  Use Mj::Util::re_match.

	* lib/Mj/Addr.pm:  (_xform)  Only use the Safe module if needed.

	* lib/Mj/Archive.pm:  Only use the Mj::File module if needed.

	* lib/Mj/BounceHandler.pm:  (handle_bounce)  Use Symbol instead
	of IO::File.
	(handle_bounce_removal)  Call inform() to log the removal.
	(_gen_bounce_message)  Allow the possibility of multiple actions.

	* lib/Mj/CommandProps.pm:  Remove access_vars_desc_en hash.
	Support the "async" mode for the showtokens command.

	* lib/Mj/Config.pm:  (_load_new, _load_dfl)  Use Mj::Lock
	instead of Mj::File.
	(_save_new, unlock)  Use Data::Dumper only if necessary.
	(compile_pattern)  Use Mj::Util::re_match.

	* lib/Mj/Deliver.pm:  (deliver, setup)  Use Mj::Util::re_match.
	Pass the local host name (from the whereami GLOBAL setting)
	down to the other delivery modules.

	* lib/Mj/Digest.pm:  (_open_state) Use Mj::FileRepl explicitly.

	* lib/Mj/File.pm:  (search)  Use Mj::Util::re_match.

	* lib/Mj/FileRepl.pm:  (search_copy)  Use Mj::Util::re_match.

	* lib/Mj/FileSpace.pm:  Use Symbol instead of IO::File.

	* lib/Mj/Format.pm:  (lists)  Display the error if one occurs.
	Noticed by David Miller.

	* lib/Mj/Inform.pm:  Use Mj::Lock and Symbol instead of Mj::File.

	* lib/Mj/List.pm:  (_fill_config, _fill_aux)  Use Symbol instead
	of IO::Handle.

	* lib/Mj/Lock.pm:  Use Symbol instead of IO::Handle.

	* lib/Mj/Log.pm:  Use Symbol instead of IO::Handle.  Only load
	Sys::Syslog if necessary.

	* lib/Mj/MTAConfig.pm:  (add_alias)  Include the priorities
	from the priority configuration setting if queue_mode is
	enabled.

	* lib/Mj/MailOut.pm:  (mail_message, deliver, probe)  Pass
	the host name from the whereami configuration setting to
	the delivery modules for use in the EHLO/HELO SMTP commands.
	This avoids having to load Net::Domain to determine the local
	host name.
	(owner_start, owner_chunk, owner_done)  Use Symbol instead
	of IO::File.

	* lib/Mj/Parser.pm:  Load modules only as needed.
	(parse_part)  Use Mj::Util::re_match.

	* lib/Mj/Resend.pm:  (post) Store the arrival time in the
	access variables hash.
	(_post)  Add a random string to the temporary file names.
	Use the archive_date configuration setting to determine which
	date should be used to archive a message:  time of arrival,
	or time of delivery.
	(_check_poster, _r_ck_body)  Use Mj::Util::re_match.
	
	* lib/Mj/SimpleDB.pm:  Remove unneeded dependencies.

	* lib/Mj/Token.pm:  (t_accept) Allow asynchronous delivery
	of posted messages using an "async" token.  A message
	containing an accept command is mailed to the server, which
	then performs the actual delivery.

	* lib/Mj/Util.pm:  (re_match)  Rename Majordomo::_re_match().

	* lib/Mj/Deliver/Connection.pm:  Use Socket instead of IO::Socket.

	* lib/Mj/Deliver/Dest.pm:  (new)  Include the local host name.
	(flush)  Use Symbol instead of IO::File.

	* lib/Mj/Deliver/Envelope.pm:  Use Symbol instead of IO::File.

	* lib/Mj/Deliver/Prober.pm:  (new) Include the local host name.

	* lib/Mj/Deliver/SMTP.pm: (new)  Only use Net::Domain if a
	local host name was not supplied.

	* lib/Mj/Deliver/Sorter.pm:  (new) Include the local host name.

	* lib/Mj/SimpleDB/Base.pm:  Remove unneeded dependencies.

	* lib/Mj/SimpleDB/DB.pm:  Use Mj::Util::re_match.

	* lib/Mj/SimpleDB/Text.pm:  Use Mj::Util::re_match.  Remove
	IO::File dependency.

	* setup/config_commands:  Add a template, DEFAULT:rfc2369,
	to support the addition of RFC 2369 message headers, such
	as List-Post and List-Subscribe.

2001-02-16  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (connect) Use SHA-1 hex digest for session
	identifiers.
	(_lists)  Add back end to allow the lists command to stall.
	Change version number to 0.1200102160.

	* lib/Mj/Access.pm:  (validate_passwd)  Compare SHA-1 digests
	instead of clear text passwords.

	* lib/Mj/Config.pm:  (parse_passwords, parse_pw)  Convert clear
	text admin passwords to SHA-1 digests.

	* lib/Mj/Token.pm:  (validate_latchkey)  Removed.

	* lib/Mj/Util.pm:  (ep_convert, ep_recognize)  New routines to
	convert a clear text password to an SHA-1 digest, and to recognize
	an SHA-1 base 64 digest.

2001-02-14  Michael Yount <csf@moscow.com>

	* bin/mj_confirm, mj_wwwadm, mj_wwwusr:  Improve domain checking.
	Check the URL path, CGI parameters, and HTTP_HOST, in that order.
	Add "Expires" header (set to 10 seconds in the future) to avoid
	caching.  Thanks to Peter Ajamian and David Miller for the 
	suggestions.  Fix set command bug in mj_wwwusr.  Add a "Sign Out"
	button to mj_wwwadm and mj_wwwusr, which invalidates the 
	temporary password.

	* lib/Majordomo.pm:  Change version number to 0.1200102140.
	(dispatch) Improve mode validation: no modes over 11 characters
	in length are allowed.
	(legal_list_name)  Make this routine a function instead of an
	object method.

	* lib/Mj/Token.pm: (del_latchkey)  New routine.  Remove a 
	latchkey from the temporary password database.

2001-02-13  Michael Yount <csf@moscow.com>

	* files/en/help/admin*:  Revise and expand the introductory
	documents for list owners.

2001-02-11  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm: (_set) Return an error if a pattern was
	used and no matches were found.

	* lib/Mj/Access.pm: (_d_advertise) Revise the order of assessment
	for compatibility with Mj1.  The noadvertise patterns take
	precedence over the advertise patterns.

	* lib/Mj/Config.pm: (parse_inform) Move inform setting defaults
	out of the code and into the default configuration file.

2001-02-05  Michael Yount <csf@moscow.com>

	* lib/Mj/Access.pm: (list_access_check) Minor cleanup. 
	(_gen_pw)  Moved to Mj::Util::gen_pw.

	* lib/Mj/CommandProps.pm:  Add "nopass" command property
	to the help and lists commands.
	
2001-02-04  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Format.pm (who): Use nowelcome for who-export GLOBAL.

	* setup/setup_func.pl (tempfile): New function copied from
	mj_shell.
	Call it where appropriate.

	* setup/mta_sendmail.pl: Call tempfile where appropriate.
	
	* bin/mj_shell (tempfile): New function to generate random
	tempfile names.
	Call it where appropriate.	

2001-02-03  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_shell (privs_user, privs_mj): New functions to drop and
	regain permissions.

	Call them throughout the code where permissions were switched.

	Add permission-changing calls around all code that opens files
	specified on the command line.

	* lib/Mj/Parser.pm (parse_part): Note if we skipped any garbage at
	the end of the part.
	Fix minor bug where we said "Skipped 1 lines..."
	
2001-02-02  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* t/shell.t: Copy the mj_shell script and take out the 'use lib'
	line so that the tests won't use already-installed libraries.

2001-02-01  Michael Yount <csf@moscow.com>

	* Makefile.PL:  (check_nr_install) Test to see if installation
	as the majordomo user is feasible, and report any problems.

2001-01-31  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm, bin/mj_wwwusr:  Various cosmetic changes,
	plus the ability to include "domain=example.com" in the 
	path_info part of the URL, to make aliasing the URL easier.

2001-01-30  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Majordomo.pm (sync_owners): Set the override flag so that
	majordomo-owner is never sent mail.

2001-01-29  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm: (trigger)  Allow private files from a 
	list's file space to be parsed for commands.  The files
	must be specified in the list's "triggers" configuration
	setting, with names beginning with a forward slash.
	(configdef, configset, configshow)  Support a five-level
	password approach.  The ability to see or change a setting
	is based upon the kind of password used, and upon any changes
	to the default levels in the new config_access setting.
	(_list_file_get)  Remove GLOBAL from the default file search path.

	* lib/Mj/Config.pm:  (mutable, visible)  Check the config_access
	setting for access level changes.
	(intro)  Return a listref of data instead of a formatted string.
	(parse_access_array) New routine.  Parse a table that controls
	what level of password is necessary to see or change configuration
	settings.
	(parse_xform_array)  Cope with blank lines.  Thanks to David
	Miller.

	* lib/Mj/Util.pm:  (in_clock) Move routine from Mj::Digest
	to Mj::Util.

2001-01-27  Michael Yount <csf@moscow.com>

	* lib/Mj/BounceParser.pm:  (parse)  Parse addresses with
	digest volume and issue number, which takes the form DVxxxNyyy.

	* lib/Mj/Deliver.pm:  (_setup)  Use a separate envelope sender for
	each destination object.  This allows VERP probing for digest
	recipients, among other things.

	* lib/Mj/Resend.pm:  (do_digests)  Manufacture a sequence
	number from the volume and issue number of each digest to 
	allow VERP probing of digest recipients.

2001-01-25  Michael Yount <csf@moscow.com>

	* bin/mj_shell:  Untaint the password.  Allow multiple
	files to be processed with the -F option.

	* lib/Majordomo.pm:  (configdef)  Do not allow the installation
	settings, in the GLOBAL:_install and DEFAULT:_install templates,
	to be reset.
	(_createlist, _list_config_regen)  Regenerate the parsed values 
	for the GLOBAL:_install and DEFAULT:_install templates.
	(_list_sync_owners)  New routine.  Assess the old and new owners
	settings and update the GLOBAL:owners sublist accordingly.
	(sync_owners)  Use the "groups" field in the SubscriberList
	to store a list of mailing lists owned by a particular address

	* lib/mj_cf_defs.pl:  Use a substitution hash to set configured
	values; this will correct the quoting problems noted by
	Peter Ajamian.

	* lib/Mj/Config.pm:  (isparsed) Addresses are not parsed
	by DEFAULT lists.  This allows "$LIST" substitutions to
	be applicable to each list using the defaults individually.
	(_defaults)  Removed.  _load_dfl is used to load
	all default values from configuration files.
	(parse_address)  Retrieve the "whereami" value with get()
	instead of always using the installation settings.
	(regen)  New routine.  Reconstruct the parsed configuration
	data from the raw configuration data, and save the result
	in the configuration file.

	* lib/Mj/Deliver.pm:  (deliver) Access address lists directly.
	Mj::SubscriberList and Mj::RegList, as well as a list of 
	addresses can be used.  This routine is now used to deliver
	all mail that Majordomo sends.

	* lib/Mj/List.pm:  (new)  Include the domain in the data stored
	by the List object.  Adjust SubscriberList instantiation arguments
	to allow future backend enhancements.
	(config_regen)  New routine.  Wrapper for Mj::Config::regen.
	(update)  New routine.  Offer a generic way to replace the
	data for an existing subscriber database entry.

	* lib/Mj/MailOut.pm:  (mail_message, deliver, probe)  Call
	Mj::Deliver::deliver using a revised set of arguments.  This
	allows the Mj::Deliver and related modules to be detached
	from Mj::List, eventually to allow asynchronous delivery.

	* lib/Mj/Resend.pm:  (post_start)  Add support for the addhdr
	command mode, which treats the here args as a (plain text) message 
	body, and generates the necessary headers.
	(_add_headers)  New routine.  Add From, To, Subject, Date,
	Message-Id, and Content-type headers.

	* lib/Mj/SubscriberList.pm:  Rename the "rewritefrom" field to
	"groups."  This field is used by the GLOBAL:owners sublist
	to store a list of supported lists.

	* setup/setup_func.pl:  (do_default_config)  Create 
	DEFAULT:_install and GLOBAL:_install configuration files.
	mj_cf_defs.pl is no longer used directly by Majordomo.
	(install_config_templates)  Do not reveal the domain password
	during installation.

2001-01-20  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (p_expire)  Remove old data from the
	parser database, using the session_lifetime setting for
	the cutoff age.

2001-01-18  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (_archive)  Add support for summary mode,
	which lists the archives available and the number of bytes,
	lines, and messages in each archive.  
	(archive_chunk) Change the default behavior
	of the "archive-get" command:  mail the messages individually,
	unless "digest" mode is also specified.
	(_createlist) Add missing MIME::Entity declaration.  Noted
	by Marc Fournier.
	The version number is now 0.1200101180

	* lib/Mj/Access.pm:  (_a_default)  Add password-only access
	settings to the *_access and *_policy configuration settings.
	_access settings can include open+password or list+password,
	and _policy settings can include open+password or auto+password.

	* lib/Mj/Archive.pm:  (summary)  New routine. Return the message, 
	byte, and line count of each archive file.

	* lib/Mj/List.pm:  (archive_get_to_file, archive_summary) 
	New routines.  Wrappers for Mj::Archive::{get_to_file,summary}.

	* lib/Mj/Deliver/Envelope.pm:  (new)  Allow an empty envelope
	sender.  Suggested by Rudolph T Maceyko.

2001-01-12  Michael Yount <csf@moscow.com>

	* bin/mj_queuerun:  (parse_commands)  Record data for messages
	which contain no valid commands.  After a threshold is reached,
	send the results to the domain owner instead of replying to
	the originator.  This will prevent an autoresponder mail loop
	with Majordomo if the message contains no valid commands.

	* lib/Majordomo.pm:  (record_parser_data, _make_parser_data)  
	Store a record containing the date and count of commands issued by a 
	particular address.  At the moment, this is only used to
	restrict autoresponder loops.
	(_subscribe, _unsubscribe)  Do not alter the registry when
	an address is subscribed to or unsubscribed from an auxiliary 
	list.
	(_unregister)  Log/inform for each of the individual unsubs.

	* setup/setup_func.pl:  (install_config_templates)  Run the
	Majordomo commands in the setup/config_commands file.  These
	commands currently establish the DEFAULT:personal template,
	which causes a separate copy of a posted message to be sent
	to each recipient of a mailing list.  The recipient's address
	is contained in the To: header, and a message footer with
	unsubscription instructions is added.

2001-01-05  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (announce) Add support for sending
	announcements to auxiliary lists.
	(_who) Add "owners" command mode, which displays the list
	owner addresses and the lists they administrate.  
	(sync_owners) New routine.  The GLOBAL:owners auxiliary list 
	is automatically updated to contain all of the owners' addresses, 
	including the deletion of addresses that are no longer owners.
	This routine is called by the "createlist-regen" command, by
	the "who-owners" command, and whenever the owners setting for
	a mailing list is changed.

2000-12-20  Michael Yount <csf@moscow.com>

	* lib/Mj/Format.pm:  (archive) Use format files for the archive
	command, which is supported by the text and wwwadm interfaces.

2000-12-19  Michael Yount <csf@moscow.com>

	* bin/mj_confirm:  Rewrite to use format files, have instructions,
	and be easier to navigate.

	* lib/Mj/Format.pm:  (who) Use hard-coded formatting for the
	plain who command for better speed.  The who-enhanced and who-bounces
	commands will be 5 to 10 times slower for large lists due to the 
	formatting substitutions.

	* lib/Mj/List.pm:  (_make_fs)  Cease using the filedir setting.

2000-12-17  Michael Yount <csf@moscow.com>

	* lib/Mj/Parser.pm: (parse_part)  Inform about "parse" failure if
	no valid commands were found.

2000-12-16  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (standard_subs) Add CONFIRM_URL, WWWADM_URL
	and WWWUSR_URL variables to the standard substitutions.  These
	give the values from the GLOBAL configuration settings of the
	same names (wwwadm_url and wwwusr_url are new settings).
	(help_start)  Use "help overview" as the default help page;
	"help help" instead displays a summary of the help command.
	(_faq, _info, _intro)  Allow LASTCHANGE substitution to be used
	to supply the date on which the document was last modified.

2000-12-13  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/BounceHandler.pm (handle_bounce_user): Actually call
	handle_bounce_removal to delete users.
	(handle_bounce_removal): Delete users only when -noprobe is
	specified.

	* lib/Mj/Config.pm (parse_access_rules, parse_bounce_rules):
	Accept '-' separating actions from modes in addition to '='.

2000-12-12  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/mj_cf_defs.pl: Now that reply_do and subject_prefix default
	to nonempty values, default_flags should not include replyto or
	prefix.

	* lib/Mj/BounceHandler.pm (handle_bounce_removal): New function:
	handle deleting of users or constructing tokens to do so.

2000-12-11  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (trigger): Expire additional bounce data as
	well.

	* lib/Mj/List.pm (expire_subscriber_data): Trim accidental debug
	statement.  Properly deal with excessive counts.  Unshift data
	into new list unstead of pushing it, so that order is preserved.
	
	(expire_bounce_data): New function: expire old data from _bounce
	database.

2000-12-11  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/BounceHandler.pm (handle_bounce_user): Pass $user to
	_gen_bounce_message.
	(handle_bounce_user): Stop warning "don't know how to inform".

2000-12-11  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/List.pm (bounce_gen_stats): Handle generating statistics
	even if we got no bounce data.

	* lib/Mj/CommandProps.pm: "subscribed" variable is valid in
	bounce_rules.

	* lib/Mj/BounceHandler.pm (_gen_bounce_message): New function to
	generate the bounce report message.
	(handle_bounce_message): Don't ignore warnings; let bounce_rules
	decide that.  If handle_bounce_user doesn't return a message,
	assume that the owner doesn't want to be informed about the
	bounce.
	(handle_bounce_user): Rewrite.  Pay some atttention to
	bounce_rules; don't generate a report if the owner doesn't want to
	be informed.  Generate a short report for bounces to
	majordomo-owner.  Since bounce_add can handle it, add bounce data
	even for not-subscribed addresses.

2000-12-10  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/List.pm (bounce_add): Take hash instead of lots of
	arguments.
	(_make_bounce): New function; create the simple bounce database.
	(bounce_add): If user is not subscribed, add bounce data to a
	separate database.
	(bounce_get): If no subscriber data was found, look in the bounce
	database.

2000-12-09  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* t/core.t: Add even more tests.  Now tests all of the core calls
	that shell.t does, plus a few other things.

	* lib/Mj/Addr.pm (_validate): Completely ignored case of two @
	signs outside of comments.

	* t/addr.t: Add tests for two @ signs outside of comments.

2000-12-08  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm: (_unsubscribe) Add "farewell" mode, which
	causes the farewell file to be mailed to each address that
	is removed from the list.

2000-12-08  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (_list_config_set): When addr_xforms changes,
	store the new value in the address parser.

	* lib/Mj/Config.pm (set): Return the parsed data, if there is any,
	on a successful set.

2000-12-07  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/CommandProps.pm: Make %actions the hash of all supported
	actions along with their parameters.  Make %generic_actions a hash
	of the actions supported by most commands.  Replace %actions with
	%generic_actions in {access}{actions} portion of command
	descriptions.

	* lib/Mj/BounceHandler.pm (handle_bounce_user): Fix oops in bounce
	percentage display.

	* lib/Mj/Resend.pm (_within_limits): 
	* lib/Mj/List.pm (describe_class): 
	* lib/Mj/Format.pm (digest):
	Import time_to_str from Mj::Util and call it instead of
	List::_time_to_str.

	* lib/Majordomo.pm (_report): 
	* lib/Mj/Parser.pm (parse_part): 
	* lib/Mj/List.pm (make_setting): 
	* lib/Mj/Config.pm (parse_limits): 
	* lib/Mj/Archive.pm (expand_range): 
	* lib/Mj/Access.pm (_a_delay):
	Import str_to_time from Mj::Util and call it instead of
	List::_str_to_time.

	* lib/Mj/Util.pm: Add str_to_time, time_to_str, and
	_str_to_time_dm, and export the first two.
	(process_rule): Call str_to_time instead of
	Mj::List::_str_to_time.

	* lib/Mj/List.pm: Remove _str_to_time, _str_to_time_dm, and
	_time_to_str.

2000-12-07  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (dispatch)  Alter mode checking to
	give an error instead of silently ignoring invalid punctuation.
	(_createlist)  Convert the aliases setting from flags to
	enumerated format if necessary.

	* lib/Mj/Access.pm:  (list_access_check)  The data used to 
	check time constraints on access rules are now a list
	of lists rather than a scalar value.  Treat the master_password
	variable as an integer instead of a boolean value.  This
	allows administrative passwords to be differentiated by type.

	* lib/Mj/BounceHandler.pm:  (handle_bounce_message, 
	handle_bounce_token)  Use the first owner's address as the 
	envelope sender to avoid loops if the majordomo-owner address
	malfunctions.

	* lib/Mj/Config.pm:  (get)  Return a scalar value if a
	supposed listref is not a reference.
	(parse_flags)  Remove unused routine.
	(_compile_rule)  Revise time constraints to use a 2d listref.

	* lib/Mj/List.pm:  (set)  Revise handling of flags to
	convert configuration settings automatically from the old, 
	abbreviated format to the new, enumerated format.  The
	allowed_flags setting now treats each flag individually,
	instead of grouping ack and hide flags.
	(get_flags)  Convert an enumerated list of flags into a
	a string of abbreviations.  Replaces the default_flags routine.

	* lib/Mj/MTAConfig.pm:  (add_alias)  Use the new, enumerated
	format of the aliases setting.

	* lib/Mj/MailOut.pm:  (owner_done)  Use the first owner's
	address as the envelope sender when forwarding mail to
	the majordomo-owner address.

	* lib/Mj/Resend.pm:  (_post)  Use the Date header for the 
	date in the DATE substitution.

	* lib/Mj/Util.pm:  (process_rule)  Treat the "current" time
	spec checks as a list of lists.  Revise the "args" hash to
	allow reasons and delays to be passed back to the calling routine.

2000-12-07  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/BounceHandler.pm (handle_bounce_user): Remove rule
	processing and call Mj::Util::process_rule instead.

	* lib/Mj/Util.pm (process_rule): Accept and deal with $current.
	Export process_rule.

	* lib/Mj/Access.pm (list_access_check): Remove rule processing and
	call Mj::Util::process_rule instead.

2000-12-06  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/CommandProps.pm: Remove bounce actions from %actions;
	they were in there only by mistake.

2000-12-05  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* t/bounce.t: Make sure we process the tests in numerical order.

2000-12-05  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/BounceHandler.pm: %args needs to be local so it can be
	shared with the compartment during bounce_rules processing.

	* lib/Mj/Config.pm (parse_bounce_rules): Fix off by one error in
	rule IDs.

	* lib/Mj/List.pm (bounce_gen_stats): Always generate all
	statistics.  

	Computation of consecutive bounce count was badly busted.
	
	* lib/Mj/Config.pm (parse_bounce_rules): The default action is
	'inform', not 'ignore'.

	* lib/Mj/BounceHandler.pm (handle_bounce_user): Import
	'action_terminal' from Mj::CommandProps.

	Since all stats are always generated, don't include some messages
	about statistics when they are meaningless.

	Enable the bounce_rules checking code; include the result in the
	report but don't actually do anything with is.
	
	* lib/Mj/CommandProps.pm: 'remove' is a terminal action.

2000-12-04  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/BounceHandler.pm (handle_bounce_message): Completely
	ignore warning bounces.

	* lib/Mj/CommandProps.pm: Revise actions for bounce_rules.

2000-12-04  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* setup/ask_domain.pl (ask_domain): Make it clear that the
	expected answer to "What is the email address of the
	owner of this Majordomo installation" is not "majordomo-owner".

2000-12-03  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/List.pm (expire_subscriber_data): Bug fix: when all
	bounces expired, all were kept.

2000-12-02  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (dispatch):  Add simple command mode validation.

	* lib/Mj/List.pm (search):  Allow a count of results desired.

2000-12-01  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/MTAConfig.pm (add_alias): Fix bug in VUT owner-list
	entry.

	* lib/Mj/BounceParser.pm (parse_smtp32): Fix possible infloop.

2000-11-25  Michael Yount <csf@moscow.com>

	* setup/newdomain.pl:  Allow domains to be added
	to the installation using the "make domain" shell command.

2000-11-22  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Format.pm: Correct various syntax errors.

2000-11-18  Michael Yount <csf@moscow.com>

	* README.CALLING:  Somewhat outdated file describing the 
	request hash calling conventions.

	* bin/mj_shell:  Add editing support for the get-edit
	command, which wraps a file in a put command, to allow
	easy editing and replacement using your favorite editor.

	* bin/mj_wwwadm, bin/mj_wwwusr:  Rewrite.  Move all formatting
	into Mj::Format.  List explicitly the supported commands.

	* files/en/error/*:  New error files.  Allow customization
	of error messages (only two are used at present).

	* files/en/format/*:  New format files.  Allow customization
	of command output (only commands that require special
	formatting in the WWW interfaces are included at present,
	such as the configshow, lists, and show commands.)

	* files/en/help/configset_*:  Change "Variable Groups" heading
	to "Category" and revise the categories used.

	* files/en/help/configshow:  Document "categories" mode, 
	including a list of all ten categories.

	* files/en/help/get:  Document "edit" mode, which wraps a
	file with a put command, to allow easy editing and replacement.

	* lib/Majordomo.pm:  (dispatch) Improve list validation.
	(standard_subs) Add DOMAIN and PWLENGTH substitutions.
	(substitute_vars_format)  New routine.  Allows more extensive
	line-based formatting, with the following new features:
	  $HELP:LOZENGE   add a hypertext link to the "lozenge" help file
	  ?COMMENT        skip this line if the COMMENT substitution is empty.
	Also, if a substitution value is a list reference, the formatting
	of lines in which the variable appears will be spread over multiple
	lines, one for each array element.  For example, in the lists command,
	the DESCRIPTION substitution is a list reference.  As a result,
	the following line in the format file:
	  $LIST:-23 $DESCRIPTION
	will cause the list name to be displayed only on the first line,
	while the description may span several lines, all indented.
	(format_error) New routine.  Retrieve an error file and apply
	substitutions to it.  Return the result in a string.
	(format_get_string) New routine.  Obtain a format file as a string.
	(_get) Add support for the edit command mode.
	(help_start) Allow abbreviations of configset_ topics.  For example,
	  help configset_who_access
	can be abbreviated to
	  help who_access
	(password)  Use error files instead of hard-coded messages.
	(configshow)  Add support for the categories command mode.
	(createlist)  Allow multiple list owners to be specified,
	using a here document.

	* lib/Mj/Access.pm (list_access_check, validate_passwd):  
	Perform latchkey validation.

	* lib/Mj/Archive.pm (expand_range):  Allow mwdh time expansions
	in arguments containing sublists.

	* lib/Mj/Format.pm (configshow, lists, show, showtokens,
	tokeninfo, who):  Use file formatting instead of hard-coded
	output.

	* lib/Mj/List.pm:  (get_setting_data)  New routine.  Obtain data 
	about the personal settings for a list, including default and
	allowed values.
	
2000-11-15  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/BounceParser.pm (parse_qmail): Support multiline
	diagnostics.

	* lib/Mj/Deliver/Prober.pm (add): Don't use the canonical address
	in the envelope, since it makes it difficult to get back to the
	real address later.

	* lib/Mj/List.pm (_make_post_data): New function to create the
	posts database.
	(post_add, get_post_data, expire_post_data): Call _make_post_data.

	* lib/Mj/BounceHandler.pm (handle_bounce_message): Incorrectly
	used "bounce" instead of "failure" for bounce status.

	* lib/Mj/BounceParser.pm (parse_mms): Accept WorldSecure SMTP
	Relay bounces as well.
	(check_dsn_netscape): Handle an additional format.
	(parse_dsn): Call check_dsn_netscape when appropriate to pull out
	additional diags that check_dsn_diags missed.

	* bin/mj_enqueue: Support -S option for qmail.

	* lib/Mj/BounceParser.pm (parse_postoffice): Handle older
	Post.Office bounces.
	(parse_mms): New function to parse Tumbleweed MMS bounces.

2000-11-14  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* t/bounce.t: Clear out @expect array between tests.

	* lib/Mj/BounceParser.pm (parse_postoffice): Restructure to fix
	several warnings.

	* lib/Mj/Deliver/Dest.pm (add): Accept null second argument.

2000-11-01  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Parser.pm (parse_part): Fix undef warning with "default
	password".  Use a better message in this case.

	* bin/mj_shell (parse_command): Use better message when
	"default password" is used to clear out a default password.

2000-10-28  Michael Yount <csf@moscow.com>

	* files/en/help/*:  Document previously undocumented modes.
	Add a paragraph about comments within here documents to the
	appropriate configuration setting files.  Describe configuration
	templates.  Demonstrate the use of here documents with the
	subscribe and unsubscribe commands.

	* lib/Majordomo.pm:  (common_subs)  New routine.  Find the
	addresses that are present in two or more subscriber lists.
	(config_get_vars)  Make non-secure settings of DEFAULT lists
	visible.
	(list_config_set)  Support "extract" mode, which removes a
	set of values from an array, or sets an existing value to
	its default if the existing value and extracted value are
	identical.
	(compare_arrays) New routine, from the perl FAQ.
	(lists) Show the private auxiliary lists (in aux mode) and
	private configuration templates (in config mode) if a
	list-specific master password is used.  Show the DEFAULT
	templates (in config mode) if a pattern matching DEFAULT
	is used.
	(rekey) Return to old behavior:  do not verify by default.
	(set) Add support for patterns using "pattern," "regex,"
	and "allmatching" modes.
	(who) Add support for "common" mode, which displays the 
	addresses held in common by two mailing lists.

	* lib/Mj/Access.pm (list_access_check):  Do not fail if
	the lists command was provided with a non-GLOBAL password.
	List-specific passwords can be used to view private templates
	and sublists.

	* lib/Mj/CommandProps.pm:  List the supported modes
	for each command.

	* lib/Mj/Config.pm:  (parse_inform) Inform majordomo-owner
	about connection failures by default.

	* lib/Mj/Format.pm:  (configset) Support append and extract modes.
	(configshow)  Support append, extract, and merge modes.

	* lib/Mj/List.pm:  (get_chunk) Return the canonical address
	with the rest of the data.

	* lib/Mj/Resend.pm:  (post) Initialize sublist (Thanks to SRE.)

	* lib/Mj/Token.pm:  (t_accept) Propagate the reasons (Thanks to SRE.)

	* lib/Mj/Deliver/Dest.pm:  (flush) Use empty envelope sender 
	(Thanks to Jason.)

2000-10-27  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* bin/mj_queuerun (run_queue): If mj_enqueue was called with an
	explicit command to run, always run it regardless of the setting
	of request_answer.

2000-10-27  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_queuerun (run_queue): Make sure $debug2 is actually an
	integer; the config variable might be the empty string.
	(debug_to): Add some useful into to the logs to show when we
	switch to a different log.

2000-10-26  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_queuerun (run_queue): Maintain a count of how many times
	a queue file has been processed.  When this gets too large, assume
	that something is hosed, crank up the debug level, and store a
	separate debug log.

	* lib/Majordomo.pm (which): List::search now takes the sublist (or
	MAIN) as the first arg.

2000-10-26  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/BounceHandler.pm (handle_bounce_message): Include info on
	what list the bounce is from, for folks who filter all owner mail
	to one place.

2000-10-22  Michael Yount <csf@moscow.com>

	* CREDITS, README:  Suggest mj2-dev instead of majordomo-workers.

	* bin/mj_trigger:  Separate lock expiration from the other triggers.

	* lib/Majordomo.pm:  (connect)  Do not validate addresses
	for requests from the resend and owner interfaces.
	(dispatch) Simplify processing requests with multiple victims.
	(substitute_vars_string) Allow formatting widths.  For example,
	  $OWNER:48  would pad the list owner address out to 48 characters
	and right-justify it.
	(list_config_get, list_config_set, list_config_set_to_default)
	Support the storage of configuration templates on a per-list
	basis.  All variables in a configuration template are visible
	without the use of a password.
	(list_config_set)  Support "append" mode, which combines arrays
	of configuration settings.
	(list_set_config)  Change the configuration file ('MAIN' by default)
	which is used by a mailing list.  This allows configuration
	templates to be accessed without changing the call arguments.
	(lists) Use "full" mode to display supplemental data such
	as digest names, subscriber count, and list addresses.
	Add "config" mode to list configuration templates.  The
	descriptions for templates are taken from the comments setting.
	(report) Add "succeed," "stall," and "fail" modes to 
	differentiate log entries according to the result.

	* lib/Mj/Access.pm:  (list_access_check) Make the name of
	the interface available to the access rules.

	* lib/Mj/Config.pm:  (is_array) Differentiate arrays that
	require blank lines between blocks from those that do not.
	(parse_table)  Treat lines beginning with (optional white
	space and) "#" as comments, and discard them during parsing.
	(load)  Do not automatically create a configuration file
	for a template.

	* lib/Mj/Format.pm:  (report)  Display dates on a separate 
	line to conserve space.

	* lib/Mj/List.pm:  (_fill_config, _make_config, valid_config,
	set_config)  New routines to find, load, and validate 
	configuration templates.

	* lib/Mj/Resend.pm:  (post) Set the "invalid_from" access
	variable if the address in the From: header is invalid.

	* setup/setup_func.pl:  Include a crontab entry for lock expiration.

2000-10-20  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/BounceParser.pm (parse_exim): Put a space between the
	lines of a multiline diag.
	(parse_postfix): Handle warnings properly.

2000-10-20  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/BounceParser.pm (parse_exchange): Parse a variant of the
	exchange format.

2000-10-19  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Config.pm (_defaults): When an eval of the defaults
	string fails, print it out.

	* t/core.t: Clean up a bit.

	* t/shell.t: Set some variables to allow non-internet-connected
	hosts to run the tests.

	* lib/Mj/List.pm (remove): Mode "pattern" is valid for
	unsubscribe, but "regex" needs to be passed to the database
	routines.

2000-10-18  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (_who):  Display aliasing commands
	in "alias" mode for the GLOBAL list.  Display register
	commands with passwords with the "who-export GLOBAL"
	command.  Add sublist support to "export" mode.

2000-10-15  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (auxadd, auxremove, auxwho) Merge
	auxiliary list commands with their common counterparts,
	subscribe, unsubscribe, and who.
	(rekey)  Rekeying automatically verifies the contents
	of the subscriber lists and registry.  Using "repair"
	mode will cause both to be repaired.
	(who)  Add preliminary support for "alias" mode, which
	will display the contents of the aliases database.
	(_make_list)  Use the stored values for the installation
	defaults from the DEFAULT list to avoid reloading them
	for every list.
	(dispatch)  Separate list:sublist into separate request hash
	variables.
	(config_get_vars)  All settings of the DEFAULT list are visible.
	(valid_list)  Understand and untaint list:sublist combination.

	* lib/Mj/Access.pm: (list_access_check)  Use GLOBAL checks 
	for the DEFAULT list.
	(_a_default)  "deny" by default if a sublist other than 'MAIN' is used.

	* lib/Mj/Config.pm:  (parse_address, parse_pw)  Allow
	$LIST substitution to avoid having to reload the installation
	defaults for each mailing list.
	(load) Rearrange the data structures for storing configuration
	information.

	* lib/Mj/List.pm:  (add, get, is_subscriber, et cetera)  
	Merge main subscriber list and auxiliary list code.
	(aux_rekey) Always run verification checks against the registry when
	rekeying.  Return data about missing entries.

2000-10-14  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_queueserv (in): Triple timeout when waiting for queue
	runner to start up.

2000-10-11  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* bin/mj_email (connect_no_parse, connect_and_parse): Call
	Majordomo::connect in a list context so failed connects don't
	screw us up.  Log failed connects.

2000-10-07  Michael Yount <csf@moscow.com>

	* bin/mj_shell (parse_interactive):  Remove unneeded white space.

	* lib/Majordomo.pm (accept):  Track elapsed time for each token
	individually.
	(_subscribe):  Use "set" mode to allow settings to be included
	in a subscription command.  For example,
	  subscribe-set LIST digest
	is used instead of 
	  subscribe-digest LIST
	
2000-10-05  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* bin/mj_shell (parse_interactive): Term::ReadLine can spew
	warnings over files we can't control; turn warnings off when
	loading it.

	* lib/Mj/Token.pm: Clean up various undeclared variable warnings.

2000-10-04  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Access.pm (_d_post): Fix error when checking
	restrict_post.

2000-10-04  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (trigger):  Use the list-specific triggers
	setting to determine when the bounce, checksum, and post
	triggers will be run.

2000-10-03  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm: Use BounceHandler module; set ISA
	appropriately.

	* lib/Mj/MailOut.pm: Remove bounce handling stuff.

	* lib/Mj/BounceHandler.pm: New file: handle bounces.

	* bin/mj_shell: Add option to dump request and result structures.

	* lib/Majordomo.pm (dispatch): Eliminate warnings when mode is
	empty or contains all non-alphabetics.

2000-10-02  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (dispatch):  Inform on *_done commands.
	Do not inform on *_start commands if they succeed.
	Track the elapsed time taken by a request.

	* lib/Mj/Format.pm (report):  Display the elapsed time
	if one is given.

	* lib/Mj/Inform.pm (inform):  Store the elapsed time of
	the command in the log.
	(_inform_owner)  Include TIME substitution, for the elapsed time.

	* lib/Mj/Log.pm (elapsed):  New routine.  Return the amount
	of time elapsed since the first call to in().

2000-10-02  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Resend.pm (_check_mime): Don't fault messages for
	exceeding max_mime_header_length if it is zero.

2000-10-01  Michael Yount <csf@moscow.com>

	* lib/Mj/Resend.pm (_post):  Add support for the "unique"
	class.  Subscribers with this setting will not receive
	a duplicate copy if a message with the same ID or checksum
	has previously been posted to a list in the same domain.

2000-09-30  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm: Bump version number.

	* lib/Mj/BounceParser.pm (parse_msn): Handle MSN bounces with
	multiline diagnostics.
	(parse_compuserve): Old function moved to parse_compuserve2.  New
	function to parse new bounce format.
	(parse_exim): Look at X-Failed-Recipients: header as well.

	* lib/Mj/SimpleDB/Text.pm: Use Majordomo::_re_match instead of
	local version.  Delete local copy.

	* lib/Majordomo.pm: Declare various undeclared variables.

	* lib/Mj/SimpleDB/DB.pm: Use Majordomo::_re_match for all regexp
	work.  Delete the local copy.

2000-09-29  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_shell: Add commented out code to get backtraces on
	warnings.
	Set $/ to $/ to get rid of a strange Perl problem.

	* lib/Majordomo.pm (substitute_vars): Was opening the input file
	twice.

2000-09-26  Michael Yount <csf@moscow.com>

	* lib/Mj/Config.pm (_compile_rule):  Add support for a 
	time specification within asterisks, similar to the
	digest "times" field.

2000-09-24  Michael Yount <csf@moscow.com>

	* files/en/ack_delay, delay, delay_noweb, repl_delay, 
	repl_fulfill:  New reply files for "delay" tokens.
	(Idea suggested by Marc Fournier.)

	* bin/mj_email, mj_queuerun:  Determine author's address.
	This allows the global 'access' checks to restrict posted
	messages and messages to list owners.

	* bin/mj_shell:  Add support for the default command
	in interactive mode (delay, password, and user only).

	* bin/mj_wwwadm:  Obtain token reasons from the reasons
	variable instead of arg2.

	* lib/Majordomo.pm:  Simplify calls to *_access_check.
	(trigger) Add "delay" trigger to fulfill delayed requests.

	* lib/Mj/Access.pm:  (_gen_pw) Accept an argument specifying
	the minimum password length.
	(list_access_check)  Use a hash instead of a long argument list.
	If the master password is used, and a delay was requested,
	delay the command.  Simplify calls to action routines (_a_*).
	Remove _a_denymess and _d_password.  Add _a_delay routine to
	handle the new "delay" action.

	* lib/Mj/Archive.pm (find):  New routine.  Find a list of
	archive files matching a pattern.  (Suggested by SRE)

	* lib/Mj/Config.pm:  (_load_dfl) Do not allow the GLOBAL list
	to use the DEFAULT settings.
	(compile_pattern)  Allow a leading "!" to indicate inversion.

	* lib/Mj/Format.pm (archive):  Synchronize multiple archives
	with one command using one-archive chunks.

	* lib/Mj/List.pm:  (archive_find) New wrapper for Mj::Archive::find.
	(_str_to_time) Allow a whole number to indicate a number of seconds.

	* lib/Mj/MIMEParser.pm (replace_headers):  Parse a file containing
	a message and add, replace, or delete some of the message headers.

	* lib/Mj/MailOut.pm (handle_bounce_token):  Do not delete a
	delay token (type 'D') when a message bounces.

	* lib/Mj/Parser.pm (parse_part):  Add support for the 
	"default delay" command.

	* lib/Mj/Resend.pm (post):  Return the error message for
	a stalled or denied post, which will appear in 'inform'
	messages mailed to the owners.

	* lib/Mj/Token.pm:  (delay)  New routine.  Create delay tokens,
	for requests which are completed when the token expires.
	(t_accept)  Always requeue posted messages with an "Approved" header
	added, to speed the reply to the accepter.
	(t_fulfill)  New routine.  Expire delay tokens and complete
	their requests.

	* lib/Mj/TokenDB.pm:  Add "reasons" field.  Store reasons
	there instead of in the arg2 fields.

	* lib/Mj/Digest/Build.pm (idx_numbered):  Add new "numbered"
	digest index format.

2000-09-11  Michael Yount <csf@moscow.com>

	* lib/Mj/Archive.pm (remove, sync, _sync_msgs): New routines.
	Allow groups of messages to be deleted from the archives,
	and individual archive files to be indexed, with the archive-delete
	and archive-sync commands.

2000-09-06  Michael Yount <csf@moscow.com>

	* files/en/config/post_limits:  New local configuration
	setting.  Each line consists of a pattern, followed by
	comma-separated lists of soft and hard limits.  By default,
	messages exceeding a soft limit are bounced to the moderators,
	while messages exceeding a hard limit are denied.

	* lib/Majordomo.pm: (_lists) In aux mode, include a count
	of posted messages in the last 30 days.
	(trigger) Add new "post" trigger, which removed old data
	from the post database.  The data have a lifetime twice
	that of the duplicate database.

	* lib/Mj/Access.pm (_d_post):  Add "limit_soft" to the list
	of consult variables, and "limit_hard" to the list of deny
	variables.

	* lib/Mj/Archive.pm: (first_n, last_n)  Collect data more quickly.
	(expand_range)  Allow use of "mwdh" format to specify "last 3 weeks"
	and similar ages.
	(get_all_data)  New routine.  Load all data from an archive index.

	* lib/Mj/Config.pm (parse_limits):  New routine.  Parse the
	post_limits variable into a format similar to the digest times.

	* lib/Mj/List.pm:  (_time_to_str) Allow "long" format output
	("2 days" instead of "2d").
	(post_add, get_post_data, expire_post_data) New routines to 
	handle the "posts" database, which records times and sequence
	numbers for posted messages, keyed on the e-mail address of
	the authors.
	(count_posts) New routine.  Total the posts to a list over
	a number of days, based upon the archive data.

	* lib/Mj/Resend.pm:  (_post)  Add the data about a post to
	the "posts" database after delivery.
	(_check_poster)  Determine if a message falls within limits.
	(_within_limits)  New routine.  Use the post_limits setting
	and data from the posts database to determine if a hard
	or soft limit is exceeded.

2000-08-31  Michael Yount <csf@moscow.com>

	* files/en/config/block_headers:  New global configuration
	setting.  Connections on the email and request interfaces
	will be dropped (and the site administrator informed) if
	headers of the incoming message match the regular expressions
	in this setting.

	* bin/mj_email, bin/mj_queuerun:  Instead of adding a 
	hard-coded reply-to header when sending command results,
	use the global message_headers setting to add headers
	(x-loop and reply-to headers are added by default).

	* bin/mj_wwwadm and others:  Use COMMAND variable substitution
	for a majordomo command instead of REQUEST.  REQUEST is used
	to indicate the LIST-request address.

	* lib/Majordomo.pm: (connect) Block connection if request
	message headers match patterns in the block_headers setting.
	(standard_subs) New routine.  Return a hash containing 
	common variable substitutions.

	* lib/Mj/Access.pm (check_headers): New routine.  Determine
	if the headers of a request message match the patterns in
	the block_headers setting.

	* lib/Mj/Token.pm (confirm, consult, remind):  Add headers
	from the global message_headers setting.

2000-08-30  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (_set):  Issue a partial digest when the
	delivery mode changes from digest to each.

	* lib/Mj/Resend.pm (_post):  Add SUBSCRIBED substitution,
	which is converted to "not" if the message author is not
	subscribed, or an empty string otherwise.

2000-08-27  Michael Yount <csf@moscow.com>

	* bin/mj_*, setup/query_util.pl :  Allow only letters, digits, 
	period and hyphen in domain names when untainting.

	* bin/mj_email, bin/mj_queuerun:  Look for the "x-loop" header
	in messages containing commands, and forward such a message to the 
	list owner.

	* bin/mj_wwwusr:  Add a button for the alias command.

	* files/en/config/triggers:  New file.  Describe the new
	triggers configuration setting, which determines at what
	times the hourly trigger will invoke a particular trigger.

	* lib/Majordomo.pm (trigger):  Evaluate the triggers configuration
	setting during the hourly trigger.

	* lib/Mj/Config.pm (parse_triggers):  New routine.  Each line
	of the triggers setting contains a trigger name and set of
	times at which the trigger should be invoked.
	(_str_to_clock)  Parse "yearly" "quarterly" "monthly" "weekly" "daily"
	and a new abbreviated format (e.g., 7m3d(8) for July 3, 8 am).

	* lib/Mj/Digest.pm (in_clock):  Handle hours relative to the 
	start of a year, or relative to the start of a particular month.

	* lib/Mj/Resend.pm (_r_strip_body):  New routine.  Discard
	attachments as required by the attachment_rules setting.

	* lib/Mj/Token.pm (confirm, consult, remind): Add 
	X-Loop: majordomo@example.com  header, to prevent loops.

2000-08-24  Darren Stalder  <torin@daft.com>

	* README: After the setup questions are asked, mention that you
	can prepare and use a response file.

	* setup/query_util.pl (prompt): Allow prompt to read from STDIN if
	there is any data waiting there.  This allows the installer to
	prepare a response file for the questions; very useful for
	packaging mj2.

2000-08-24  Michael Yount <csf@moscow.com>

	* bin/mj_wwwusr:  Include digests when the details about
	an individual list are shown.

	* lib/Majordomo.pm: (lists) Include digest names and
	descriptions in the data.
	(_report) Allow more complicated time spans, e.g.,
	2w3d4h for the last 2 weeks, 3 days, and 4 hours.
	(Thanks to Dave Wolfe for the suggestion.)
	(trigger) Add new trigger options for finer control.
	The following abbreviations are available:
	b (bounce) or v (vacation) ... expire bounce and vacation data.
	c (checksum) ... expire duplicate checksum/id data.
	da (daily) ... all of the other tasks, except digests.
	di (digest) or h (hourly) ... issue digests.
	l (log) ... expire old log entries.
	s (session) ... expire old session data.
	t (token) ... expire old tokens and temporary passwords.

	* lib/Mj/BounceParser.pm (parse): Anchor matches at the
	beginning of the envelope information.

	* lib/Mj/Format.pm (lists):  Display digests in "aux" mode.

	* lib/Mj/List.pm: (_time_to_str) New routine.  Convert a
	time span abbreviation (such as 2w3d4h) to a count of seconds.
	(describe_class) Deal with vacation spans correctly.

2000-08-23  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (lists, who_start):  Treat a search
	pattern not enclosed in delimiters to a case-insensitive
	substring match.

2000-08-21  Michael Yount <csf@moscow.com>

	* files/en/config/archive_url:  New configuration
	variable, used by mj_wwwusr and the message_headers
	setting (ARCURL substitution in Mj::Resend::_post.)

	* files/en/config/sublists:  New configuration variable.
	The lists-aux command will only display auxiliary lists
	explicity mentioned in this setting.  The createlist-regen
	command will only create mail aliases for sublists included
	in this setting.  Each line of the array consists of
	a sublist name, followed by an optional description.
	The description appears in the output of the lists-aux 
	command.

	* bin/mj_wwwusr:  Overhaul formatting.  The introductory
	page is now very simple, offering only instructions.  The
	lists page contains a link to a separate page for each mailing 
	list.

	* lib/Majordomo.pm: (get_all_lists) Take a regular expression,
	to allow the list names to be searched.
	(list_config_set_to_default) Remove calls to inform().
	(_createlist) Create aliases only for auxiliary lists
	named in the "sublists" configuration setting.
	(lists) Allow a regular expression to be used, to search
	the list of lists.  Add new data (list address, owner
	address, number of subscribers, archive URL) to the 
	output of the lists-aux command.
	(report_done) Include a list of auxiliary lists in
	summary mode, to compensate for the new restrictions
	to the lists-aux command.
	
	* lib/Mj/Config.pm (parse_sublist_array):  New routine.
	Used with the "sublists" variable.  Each line consists
	of a list name, followed by an optional description.

	* lib/Mj/List.pm (count_subs):  New routine.  Count
	the number of subscribers in a list or auxiliary list.

2000-08-20  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm: Strip trailing whitespace in code.

	* lib/Mj/MailOut.pm (mail_message): Fix undeclared variable
	problem.
	Strip trailing whitespace in code.
	(handle_bounce_user): Take all arguments in a hash.

	* lib/Mj/Config.pm (parse_bounce_rules): New function to parse
	bounce_rules variable.  Works mostly like parse_delivery_rules.
	Strip trailing whitespace in code.
	Hook up parse_bounce_rules function to the appropriate type.
	(_compile_rule): Fix handling of two-character numeric
	comparisons, which have been broken for forever.

	* lib/Mj/CommandProps.pm: Add variables and actions for "_bounce"
	fake command, for use in bounce_rules.
	Strip trailing whitespace in code.

	* bin/mj_queuerun: Strip trailing whitespace in the code.

	* lib/Mj/MailOut.pm (handle_bounce): Split out 'M'-type bounce
	processing, like we did with 'T'-type bounces.
	(handle_bounce_message): New function to deal with bounced
	messages.

	* lib/Mj/List.pm (bounce_add): Add logging.

2000-08-19  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/BounceParser.pm (parse_msn): Add parser for MSN-format
	bounces.

	* lib/Mj/Config.pm (_compile_rule): Fix broken operator comparison
	regexp.

2000-08-19  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (_digest):  Add "status" mode,
	which allows the current state of the digests to be 
	viewed.

	* lib/Mj/Token.pm (gen_latchkey):  Use new "latchkey_lifetime"
	global configuration variable, which gives the lifetime of
	a temporary password in minutes.

2000-08-18  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (_rekey):  Allow the registry
	to be verified or repaired, based upon the subscriber
	databases, if the registry is corrupted.

2000-08-15  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Further refine the output of
	the configshow command (menus for enumerated types,
	add links to help pages).

	* files/en/config/log_lifetime:  New variable.  Log
	entries older than this age (default 31 days) will be
	deleted during the daily trigger.

	* lib/Majordomo.pm (set):  Support "check" mode, which
	allows settings to be reviewed but not changed.

	* lib/Mj/CommandProps.pm, lib/Mj/Parser.pm (parse_args):  
	Rearrange 'arguments' data to make per-mode adjustments easier.

	* lib/Mj/Inform.pm (l_expire):  New routine.  Remove log
	entries older than the log_lifetime setting.

2000-08-13  Michael Yount <csf@moscow.com>

	* files/en/ack_archive:  New file, sent when a post is
	archived but not distributed.

	* bin/mj_wwwadm:  Add forms to the output of the configshow
	command to allow settings to be changed or set to the default.
	(only one setting at a time may be changed)

	* lib/Majordomo.pm: (_alias_reverse_lookup) Optionally
	include the bookkeeping alias in the result.  Return
	keys instead of stripsource values.
	(alias) Use list instead of listref error return values.
	(configshow) Indicate if a global password is 
	required to change a particular variable.
	(_changeaddr) Replace the bookkeeping alias correctly.
	(reject) Allow DATE substitution (date of original request).
	(set, _set) Use "check" and "force" variables to allow
	settings to be seen without changing them, and to allow
	list owners to override allowed_* settings that limit
	the changes available to subscribers.

	* lib/mj_cf_data.pl: Remove ack_denials_always.
	Add values for 'flags' variables to allow sanity checks.

	* lib/Mj/Config.pm (parse_flags):  Check the validity
	of flags in list settings (allowed_flags, aliases, ...)

	* lib/Mj/List.pm: (%flags) Add ackdeny, ackpost, ackreject,
	and ackstall settings for fine-grained selection of acknowledgements.
	(set) Implement allowed_classes and allowed_flags checks,
	which limit the settings which may be changed by subscribers.
	(make_setting) Deal with group settings: the ackall and
	ackimportant flags now turn on all of the individual ack flags,
	and the noack flag turns them all off.
	(should_ack) New routine.  Determine whether a certain action
	requires an ack to be sent to the victim.
	(aux_get_member) New routine.  Return the auxiliary list
	data for a particular address.
	
	* lib/Mj/Resend.pm: (post) Include the sublist, date,
	and message author in the variable substitutions.
	(_post) Send an acknowledgement if warranted.

	* lib/Mj/Token.pm (t_accept):  Acks for posted messages
	are handled by Mj::Resend::_post.  Determine if an
	ack was sent in this case.

2000-08-12  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/mj_cf_data.pl: Add bounce_rules variable.

	* lib/Mj/MailOut.pm (handle_bounce): Fix busted indentation.

2000-08-10  Michael Yount <csf@moscow.com>

	* lib/Mj/Access.pm (list_access_check):  Allow reasons
	to be described for commands other than "post."

	* lib/Mj/Config.pm (parse_table):  Allow parens within
	quotes and vice-versa when parsing multifield lines.

2000-08-09  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm:  (dispatch) Treat an "owner" command as
	a "bounce" during inform() if a bad address was supplied.
	Set the "user" to the message author and put bad addresses
	into the command line variable.

	* lib/Mj/MailOut.pm (handle_bounce):  Return the bad
	addresses (if any were found) and message author (always).

	* bin/mj_wwwadm, lib/Mj/Format.pm (who):  Show bounce diagnostics.

	* lib/Mj/List.pm (bounce_add),  lib/Mj/SubscriberList.pm: 
	Add bounce diagnostics to saved/displayed data.

	* lib/Mj/Deliver/Dest.pm, lib/Mj/Deliver/Envelope.pm:
	Report non-fatal failures during RCPT TO as pseudo-exim bounces
	to the message sender. (Thanks to Paul Hancock.)

2000-08-08  Michael Yount <csf@moscow.com>

	* files/en/wwwadm_head, files/en/wwwadm_help:  Move the 
	command form and introduction from mj_wwwadm to separate files
	to allow easier customization.

	* lib/Mj/CommandProps.pm, lib/Mj/Parser.pm (parse_args):
	Split variable names in the configdef and configshow commands
	on either commas or spaces.

2000-08-07  Michael Yount <csf@moscow.com>
 
	* lib/Mj/Config.pm (set):  Initialize value if it is not 
	defined.  (Thanks to Todd Goodman.)

2000-08-06  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (_createlist):  Create the archive
	directory unless "noarchive" mode is specified.  Generate
	a password randomly.  Send the "new_list" file to the 
	owner unless "nowelcome" mode was specified.
	Add "destroy" mode, which will remove a list by renaming
	its directory, but only if there are no subscribers.
	Destroy mode also regenerates the aliases.

2000-08-05  Michael Yount <csf@moscow.com>

	* lib/Mj/List.pm (make_setting):  Allow nomail-return to
	work for vacations that are not timed.

2000-08-04  Michael Yount <csf@moscow.com>

	* bin/mj_email, bin/mj_enqueue:  delete unneeded envvars.

	* bin/mj_queuerun:  randomize directories and files. 
	Fix indentation.  

	* bin/mj_wwwadm:  simplify command form maintenance.

	* files/en/consult, files/en/consult_noweb:  Suggest
	that the accepter type an explanation.

	* lib/Majordomo.pm: (new) Treat the registry as
	a subscriber list for the GLOBAL list.  This allows
	the Deliver module to distribute messages to addresses
	in the registry.
	(announce) New command.  Distribute a file to one
	or more classes of subscribers.  Each message is
	sent as a probe, with the recipient in the To: header.
	This could be used for periodic reminders, or 
	announcements that need to reach 'digest' and 'nomail'
	subscribers immediately.
	(archive_chunk) Allow the type of digest for the
	archive-get command to be specified in the mode ("-mime"
	for mime; text otherwise.)
	(report) New, iterated command.  Obtain raw or summarized
	data for recent log entries for a mailing list.
	The data can be constrained by action or by date.
	(get_all_lists, _make_list) Make DEFAULT data available 
	to Mj::List::new when all of the lists are being 
	loaded, to save redundant lookups.

	* lib/mj_cf_defs.pl: Add 'MSGRCPT' to admin_header checks.

	* lib/Mj/CommandProps.pm, lib/Mj/Format.pm:  Support new
	announce and report commands.

	* lib/Mj/Config.pm:  Use existing data for the DEFAULT
	list when Majordomo::get_all_lists is run.

	* lib/Mj/Deliver.pm:  (deliver) Support delivery to 
	addresses in the registry.  Addresses subscribed to 
	at least one list are in the "each" class.  Addresses
	not subscribed to any lists are in the "nomail" class.

	* lib/Mj/List.pm:  (_digest_classes) New routine.  Return
	a list of all possible digest classes.

	* lib/Mj/MailOut.pm:  (probe) New routine.  Probe all
	addresses in the classes provided.  This is used by
	the announce command.

	* lib/Mj/Parser.pm:  (parse_entity) Test for existence
	of a bodyhandle before using it.  (Thanks to Paul Hancock.)

	* lib/Mj/Deliver/Dest.pm:  (make_envelope)  Add 'personal'
	variable, which is set if there is only one recipient.

	* lib/Mj/Deliver/Envelope.pm:  (new, address, send)
	If a message is personal, substitute the recipient's
	address for the variable $MSGRCPT during delivery.

2000-07-30  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm: (dispatch) Inform on post_done, but not
	on post_start.
	(set, who)  Use arg3 instead of arg2 for the auxiliary list,
	because arg2 is used by the access rules to offer reasons. 
	(accept)  Allow a comment to be given on the command line,
	as with the reject command.
	
	* lib/Mj/Access.pm: (list_access_check) Make the command mode 
	available to the access rules.

	* lib/Mj/Format.pm: (post) Do not print comment on success.
	(accept) Indicate whether or not the victim was notified.

	* lib/Mj/List.pm: (valid_aux) Rename validate_aux to valid_aux
	and use it to untaint the sublist name, ala valid_list.

2000-07-28  Michael Yount <csf@moscow.com>

	* lib/Mj/CommandProps.pm:  Use "auxlist" instead of "sublist."
	The argument names must be alphabetical in relation to the
	order in which the arguments appear on the command line.
	Using "auxlist" allows more flexibility in choosing names
	for the other arguments.

	* lib/Majordomo.pm, lib/Mj/Format.pm:  Combine code for
	the who and auxwho commands.
 
	* lib/Mj/List.pm (expire_subscriber_data): Expire auxiliary
	list data.

2000-07-27  Michael Yount <csf@moscow.com>

	* lib/Mj/Archive.pm:  Make archives of auxiliary lists available.
	(add_start)  Use time derived from the Date: header.
	
	* lib/Mj/Resend.pm (_post):  Archive messages sent to 
	auxiliary lists.

2000-07-26  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Add support for multiple domains.

	* bin/mj_wwwusr:  Restructure to override Mj::Format routines
	for the help, lists, and show commands.  
	Add support for multiple domains.
	Add support for the help and changeaddr commands.
	(Thanks to Sudhakar Chandrasekharan for the help suggestion.)

	* lib/Majordomo.pm (subscribe):  Set the matches_list variable
	if someone attempts to add the -unsubscribe alias to the list.

2000-07-25  Michael Yount <csf@moscow.com>

	* bin/mj_email, bin/mj_enqueue: Add options for new aliases
	  -c COMMAND    Issue a command (-subscribe, -unsubscribe)
	  -M	    Forward message to moderators (-moderator)
	  -x SUBLIST    Post a message to an auxiliary list.
	At present, qmail support does not include auxiliary lists.
	The -moderator alias follows the same conventions as the
	-owner alias.  The auxiliary list aliases follow the same
	conventions as the resend (main list) alias.
	(Thanks to Brock Rozen for suggesting the -(un)subscribe aliases.)

	* bin/mj_queuerun: Handle altered queue file names for new aliases.
	The file names will end with a comma, followed by an auxiliary
	list name or command name or 'M' (for -moderator).
	Remove the unused qmail code.

	* bin/mj_wwwadm, bin/mj_wwwusr: Add support for latchkeys. 
	Instead of sending the password back to the client with the
	results, a temporary password is created with a limited lifetime
	(one hour by default).

	* lib/Majordomo.pm: 
	(dispatch)  Convert a latchkey into a permanent password.
	(gen_cmdline) Take into consideration messages posted to
	auxiliary lists.
	(_createlist)  Use the "aliases" setting to determine
	which aliases to use.  Include alias and sublist data
	when using the MTAConfig module.
	(reject) Include datum concerning whether or not an 
	acknowledgement was sent to the victim.
	(set, _set) Allow use of the "aux" mode to change the 
	settings for an auxiliary list.

	* lib/Mj/Access.pm (_a_forward):  Allow a posted message
	to be forwarded to a different address.

	* lib/Mj/CommandProps.pm: Allow the "sublist" variable
	to be used by the access rules for the "post" command.
	Allow the use of auxiliary lists with the "set-aux" command.

	* lib/Mj/Deliver.pm (deliver):  Obtain the list of subscribers
	from an auxiliary list, if that is the destination.

	* lib/Mj/Format.pm: (auxwho)  Use expanded format, like
	the "who-enhanced" command.
	(reject) For consult tokens, indicate whether or not the
	victim was informed.
	(set) Indicate the sublist if "aux" mode is used.
	(tokeninfo) Indicate the number of approvals required.
  
	* lib/Mj/List.pm:  Cease using AddressList.pm.  Auxiliary
	lists now use the SubscriberList module.
	(set, make_setting) Allow settings to be changed for 
	auxiliary lists.  Digest mode is not supported for sublists.
	Ensure that digest names are converted to lower case.
	(aux_add) Extend the data to accommodate the fields of
	a SubscriberList.
	(aux_get_chunk) Return all of the data instead of just the address.
	(aux_get_matching) New subroutine.
	(aux_rekey) Allow an easy transition from AddressList to 
	SubscriberList by rekeying.
	(moderators) New subroutine.  Obtain a list of moderators from
	1) A named auxiliary list
	2) The 'moderators' auxiliary list
	3) The 'moderators' configuration setting
	4) The 'moderator' configuration setting
	5) The 'sender' configuration setting
	in decreasing order of precedence.
	(_make_aux) Use SubscriberList instead of AddressList
	(validate_aux) New subroutine. Initialize an auxiliary list if it
	already exists.

	lib/Mj/MTAConfig.pm: (add_alias) Allow the use of optional
	(moderator, subscribe, unsubscribe, and auxiliary list) aliases.
	(regen_aliases) Sort the lists alphabetically.

	lib/Mj/MailOut.pm: (deliver) Add the sublist to the argument list.
	(owner_done) Direct the message to the moderators instead of
	the owner, if required.

	lib/Mj/Resend.pm: (post, _post) Allow messages to be posted
	to auxiliary lists.  Add 'sublist' to the access variables.
	Do not increase the sequence number, archive the message,
	or issue digests if the message is posted to a sublist.

	lib/Mj/Token.pm: (consult) Allow moderator groups (auxiliary
	lists) and group sizes to be used.
	(t_expire) Expire latchkeys (temporary passwords).
	(_make_latchkeydb, gen_latchkey, validate_latchkey) New subroutines.
	Latchkeys are temporary passwords used by the WWW interfaces
	to prevent the CGI scripts from passing a permanent password
	back to the client.

2000-07-21  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (connect): Call inform() if a connection
	attempt fails due to access restrictions.
 
	* lib/Mj/Resend.pm (_add_fters): Avoid adding footers
	and fronters to multipart/alternative messages.
	(Thanks to Joe Tremblay.)

2000-07-18  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm (reject):  Allow an explanation or a file to
	be specified when a token is rejected.  The usual variable
	substitutions are available for use in the file.

2000-07-17  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm:  Add hypertext links to help pages.
	(Thanks to Sudhakar Chandrasekharan for the suggestion.)

2000-07-16  Michael Yount <csf@moscow.com>

	* lib/Mj/TextOutput.pm:  Remove entirely.

	* lib/Majordomo.pm:  Remove the 'auth' variable from the
	request hash, and make the 'interface' variable specific
	to each session, rather than to each request.  This reduces
	the number of arguments to routines like global_config_get
	and list_access_check by 2.

2000-07-07  Michael Yount <csf@moscow.com>

	* lib/Mj/Parser.pm (parse_args):  Deal with attachments.  If a command 
	accepts here arguments and is iterated,  set the appropriate request
	variable to the attachment file handle.  Otherwise, read
	the data from the file handle into the argument array.
	(Only the post and put commands will use the file handle.)

2000-07-03  Michael Yount <csf@moscow.com>

	* bin/mj_confirm:  Include domain in HTML form (from Olivier Prenant).
	Use Format to present output of sessioninfo.
	Show the expiration date of a token.

2000-07-01  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/BounceParser.pm (parse_lotus): Would accept an all-blank
	bounce.
	(parse_softswitch): Would accept an all-blank bounce.

2000-07-01  Michael Yount <csf@moscow.com>

	* lib/Majordomo.pm: (archive_chunk)  Use existing
	Mj::List routines to retrieve messages in 'immediate' mode.

2000-06-30  Michael Yount <csf@moscow.com>

	* bin/mj_wwwadm: Formatting rewrite; override Mj::Format 
	routines for the showtokens, tokeninfo, and who commands.

	* lib/Majordomo.pm:
	(faq_start, info_start, intro_start) Remove temporary files.
	(createlist) Use "newlist" variable instead of "list."
	(sessioninfo) Rename to sessioninfo_start.  Treat
	sessioninfo as an iterated core routine.
	(showtokens) Allow tokens shown to be limited to a
	particular command.  Include the size of the spool
	file in the output for posted messages.

2000-06-27  Michael Yount <csf@moscow.com>

	Use new core function calling conventions.

2000-06-26  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (createlist): Return values were done
	improperly for some reason.

	* lib/Mj/BounceParser.pm: Renamed from Bf/Parser.pm.

2000-06-25  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/List.pm (bounce_gen_stats): Fixed calculation of overload
	stats.

	* Rotated old ChangeLog entries.

