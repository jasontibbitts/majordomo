2000-05-09  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/MailOut.pm (owner_done): If the MIME parser didn't like
	the message, don't try to do anything with it.

2000-05-08  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Bf/Parser.pm (parse): Make sure $type is defined before
	returning.

	* lib/Mj/MailOut.pm (owner_done): Avoid undef warning when no
	diagnostic is available.

2000-05-06  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/MailOut.pm (owner_done): Report diagnostic in message to
	owner.

	* lib/Bf/Parser.pm (parse_dsn): Return Diagnostic-Code: if
	available.  Loop over all per-user bounce status blocks and return
	data on all users found there.

2000-05-04  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Bf/Parser.pm (parse): Allow lower case types because some
	sites will actually downcase them.

	* lib/Mj/Config.pm (parse_access_rules): Remove spurious debugging
	code.

	* lib/Mj/Access.pm (_d_post): Add "non-member submission" reason
	when restrict_post triggers.

	* lib/Mj/Resend.pm (post): Fix warning when no subject is present.

	* lib/Mj/List.pm (new): Don't try to create any databases if our
	directory doesn't exist.

	* lib/Mj/Config.pm (parse_restrict_post): Was completely broken.

2000-05-03  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Access.pm (list_access_check): Reindent slightly.

	* lib/Mj/Config.pm (parse_access_rules): Just use the stored class
	info that parse_taboo_* create instead of parsing the variables
	ourselves.
	Extract data from global variables as well.	

2000-05-02  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Config.pm (parse_taboo_body): Store all of the classes
	defined by any of the rules.
	(parse_taboo_headers): Ditto.

	* lib/Majordomo.pm (_make_list): Add a callback for
	_global_config_get, so global variables can be extracted internal
	to the list configuration.

	* lib/Mj/Config.pm (parse_access_rules): Extract the classes
        defined in taboo and admin rules and pass them into _compile_rule
        so they can be listed as legal variables.
	(_compile_rule): Don't blindly match against (admin|taboo)_ for
	legal variables; use the hash of variables passed in to us
	instead.

2000-04-21  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/MailOut.pm (owner_done): Handle new return from
	Bf::parse.  Build an intelligible message from all of the data we
	have available.

	* lib/Bf/Parser.pm (parse): Redo data passing.  Return information
	gleaned from envelope as well as hashref to data pulled from
	parsed bounces.
	(parse_dsn): Clean up and return bad address instead of complete
	content of final-/original-recipient line.

	* lib/Mj/MailOut.pm (owner_start): Name temp files $tmp/owner.*
	instead of $tmp/post.*.

2000-04-20  Michael Yount  <csf@moscow.com>

	* lib/Mj/CommandProps.pm, lib/Majordomo.pm:
	Tighten access to the "set" and "show" commands.  The new
	"default user" feature makes it possible not only to assume
	someone's identity, but also to see the result of commands
	that are issued.  Add list_access_check to the "set" core
	function, and change the default access for the "show"
	command from "mismatch" to "confirm."

	* lib/Mj/Token.pm:
	Add sanity checks for reminders:  if token_remind is unset,
	negative, or greater than token_lifetime, do not send a reminder.

2000-04-20  SRE  <eckert@climber.org>

	* README, README.QUICKSTART:
	improved notes about which Perl modules are required to install,
	and where/how to get them

2000-04-20  Michael Yount  <csf@moscow.com>

	* lib/Mj/Format.pm, lib/Mj/Parser.pm, lib/Majordomo.pm:
	Implement sample "unregister-replace" command, which allows one
	address to be replaced by another in the registry.

	Add "user" to the supported actions for the default command.
	This allows the address from the From: or Apparently-From: header
	to be overridden.

2000-04-19  SRE  <eckert@climber.org>

	* files/en/help/faq, files/en/help/get, files/en/help/info, files/en/help/intro, files/en/help/put, files/en/help/rekey, files/en/help/admin, files/en/help/admin_commands, files/en/help/configset_tmpdir:
	noted 'get-immediate' option, fixed obsolete references to 'filesync'

	* setup/setup_func.pl:
	if no mta config was requested, directory ALIASES wasn't created,
	and "make install" failed trying to write ALIASES/mj-domains
	at setup/setup_func.pl line 332

	* files/en/help/put:
	question on majordomo_users indicated people were confused about
	pathname to put files relative to system root, so added a note and fixed a typo

2000-04-17  Michael Yount  <csf@moscow.com>

	* bin/mj_wwwadm:
	Improve the appearance of output from the showtokens and
	tokeninfo commands.

2000-04-16  Michael Yount  <csf@moscow.com>

	* bin/mj_enqueue:
	Always read all data on stdin.  Discard any data following an
	error during print().

2000-04-16 Sudhakar Chandrasekharan <thaths@netscape.com>
	
	* README.POSTFIX:
	Indicate that the Postfix LDA should be configured to
	run as the majordomo user.

2000-04-15  Michael Yount  <csf@moscow.com>

	* setup/mta_sendmail.pl:
	Use "nobody@example.com" as an artificial address.

	* lib/Mj/Inform.pm, lib/Mj/Resend.pm:
	Log the address of the person who posts a message.  This makes
	the output of the post command and the "inform" messages
	sent to the list owners less informative, but clarifies the
	main log, which will be useful when statistics-reporting is
	implemented.

2000-04-12  Michael Yount  <csf@moscow.com>

	* lib/Mj/Log.pm:
	(add) Use the fully qualified Sys::Syslog::setlogsock() call.
	In perl 5.00404, this subroutine will not be exported on
	systems where &_PATH_LOG is undefined by the system headers.
	Thanks to David L. Potter and Michael Smith for the idea.

	* bin/mj_enqueue:
	Improve error checking.  Since stdio is buffered, print() may always
	succeed if an incoming message is small, but an error may occur when
	the output file handle is closed.  In either case, return EX_IOERR.

	If the queue file cannot be opened, return EX_CANTCREAT unless the
	error is EEXIST.

	* bin/mj_enqueue:
	Cope with a lack of disk space.  Perl's print subroutine (and fprintf
	in C) will return a value indicating success if data are written to a file
	on a full filesystem, so checking the result of print is not helpful.
	However, when close() is called, it will return an error.
	If that happens, unlink the queue file and exit with
	a status of EX_IOERR.  Sendmail and Zmailer, at least, will then
	defer delivery of the incoming message.

	* lib/Mj/Format.pm, lib/Mj/TextOutput.pm:
	(set) Allow the set command to work properly when multiple
	addresses are specified with a here document.

2000-04-11  Michael Yount  <csf@moscow.com>

	* lib/Mj/FileRepl.pm:
	(commit) Test result of close() on the replacement file.
	Do not replace the old file if it fails.

	* lib/Mj/Access.pm:
	(list_access_check) Append each "reason" to $arg2.  This will cause
	the reason to appear in the subject line of CONSULT messages.

	* setup/install_util.pl:
	Apply safe_mkdir patch from Darren Stalder.

	* lib/Mj/Config.pm:
	(unlock, _save_new) Check result of print() and do not commit if
	it fails.

	* lib/Mj/List.pm:
	(rekey) Do not run subscriber_rekey on the DEFAULT list.

2000-04-10  Michael Yount  <csf@moscow.com>

	* lib/Mj/Resend.pm:
	(post) Remove REASONS from the list of substitutions for
	acknowledgement subjects.

	* setup/ask_basic.pl:
	Allow people with DB_File installed to choose flat file databases instead.
	The database_backend variable was not being set in .mj_config.

2000-04-10  SRE  <eckert@climber.org>

	* lib/Majordomo.pm, files/en/help/configset_save_denial_checksums, MANIFEST, files/INDEX.pl:
	updated help files for new configset option "save_denial_checksum"

2000-04-10  Darren Stalder  <torin@daft.com>

	* setup/install_util.pl:
	(safe_mkdir)  Have safe_mkdir be more safe by creating all the
	directories leading up to supplied directory if necessary.

2000-04-09  Michael Yount  <csf@moscow.com>

	* lib/Mj/MailOut.pm:
	(mail_message)  Change error handling:  call inform() instead of Log::abort()
	to report an error if a message could not be addressed or delivered.

	* lib/Mj/SimpleDB/DB.pm:
	(mogrify) Add workaround for cursor incompatibilities between DB_File and
	Berkeley DB on *BSD operating systems.

2000-04-08  Michael Yount  <csf@moscow.com>

	* lib/Mj/Deliver/Envelope.pm, lib/Mj/List.pm, lib/Mj/Resend.pm, lib/Bf/Parser.pm, lib/Mj/Access.pm, lib/Mj/CommandProps.pm, lib/mj_cf_data.pl, lib/mj_cf_defs.pl, files/en/config/save_denial_checksums, files/en/repl_consult, files/en/repl_deny, files/INDEX.pl:
	Temporarily comment out parse_dsn() in the bounce parser.

	Add "save_denial_checksums" configuration variable.  This
	determines whether or not message body checksums of messages
	denied by the access rules will be saved in the duplicate
	database.  It is off by default.

	Add "reason" action to access_rules.  This allows additional
	information to be added to reply files for denied and stalled
	requests.

	Cause "unset" access rule action to set a variable to zero
	instead of deleting it.  This is used by the denial checksum
	code to determine if the checksum variables were reset
	by the access rules or never defined in the first place.
	Thus, no checksum-saving side effects are caused by changing
	the checksum variables.

	Include the checksums in the access "avars" data used by
	Mj::Resend::post.

	Cause a 450 return code from RCPT TO to defer delivery for
	that recipient.

	* bin/mj_shell:
	Allow here documents to work with commands prefaced by "approve" .

2000-04-07  Michael Yount  <csf@moscow.com>

	* lib/Mj/FileSpace.pm:
	(_find_legal_files) Return immediately if unable to create a DirHandle for
	a directory.  This will keep the index command from aborting if the
	path specified in the request does not exist.

2000-04-07  SRE  <eckert@climber.org>

	* files/en/help/put, files/en/help/variables, files/en/help/configset_reply_to, files/en/help/configset_signature_separator, files/en/help/configset_subject_prefix, files/en/help/configset_welcome_files, files/en/help/configset_message_footer, files/en/help/configset_message_fronter, files/en/help/configset_message_headers, files/en/help/configset_digests, files/en/help/configset_inform, files/en/help/configset_access_rules, files/en/help/configset_confirm_url, files/en/help/configset_delivery_rules, files/en/config/welcome, files/en/config/welcome_files, files/en/config/signature_separator, files/en/config/subject_prefix, files/en/config/taboo_body, files/en/config/taboo_headers, files/en/config/message_fronter, files/en/config/message_headers, files/en/config/reply_to, files/en/config/restrict_post, files/en/config/sequence_number, files/en/config/delivery_rules, files/en/config/digest_issues, files/en/config/digests, files/en/config/message_footer, files/en/config/addr_allow_ending_dot, files/en/config/admin_headers, files/en/config/attachment_rules, files/en/config/confirm_url, files/en/config/default_flags, files/en/config/access_rules:
	made sure contents of files/en/help/configset_* is a strict superset of files/en/config
	and moved ALL substitution variable descriptions into "help variables"

	* files/en/help/configset_welcome_files:
	added missing backslashes (variable names are supposed to show, not be evaluated)

	* files/en/help/admin:
	removed obsolete reference to FILES,
	inserted reference to new "help variables" file

	* files/en/help/unknowntopic:
	made it more clear why this file was sent

2000-04-06  SRE  <eckert@climber.org>

	* files/en/help/digest, files/en/help/put:
	moved description of digest files (preindex, postindex, and footer)
	from "help put" to "help digest"

	* files/INDEX.pl:
	added help/variables, sorted and cleaned up columns on other english entries

	* files/en/help/variables:
	new help file: a single place where all substituted/expanded variables are listed
	(mostly variables expanded for "put" files)

	* lib/Majordomo.pm:
	bug fix: print to closed file handle in substitute_vars() because
	$INCLUDE caused output file to close when nested read finished

2000-04-05  Michael Yount  <csf@moscow.com>

	* lib/Mj/Access.pm:
	(list_access_check) Finish preliminary support for "set" and "unset"
	access rule actions.  At the moment, it is only possible to set
	a variable to 1 (if previously unset) or to delete it.  Support
	for parenthesized expressions and setting variables to specific
	values will be added later.

2000-04-04  Michael Yount  <csf@moscow.com>

	* bin/mj_queueserv:
	Zmailer sets $ENV{'IFS'} when delivering mail via a pipe.  Untaint
	the value by deleting it from %ENV.

	Aside from this problem, Mj2 and Zmailer work well together.

2000-04-01  SRE  <eckert@climber.org>

	* lib/Mj/Parser.pm:
	enable "dash represents blank line" in command parser here documents

2000-03-30  SRE  <eckert@climber.org>

	* files/en/help/set:
	added a note about using 'configshow listname digests' to get list
	of available digests before sending 'set digest' to server

2000-03-30  Michael Yount  <csf@moscow.com>

	* lib/Mj/List.pm:
	(make_setting) Return an error if an attempt is made to receive
	digests on a mailing list for which no digests are distributed.

2000-03-29  SRE  <eckert@climber.org>

	* lib/Mj/CommandProps.pm:
	bug fix for command_legal() - missing "exists" test caused hash keys to be added
	added new command_list() to return all keys of %commands and %aliases

	* lib/mj_cf_data.pl:
	obsolete variable removed, some text put into help files

2000-03-28  Michael Yount  <csf@moscow.com>

	* lib/Mj/Deliver/SMTP.pm:
	(getresp) Treat the 552 error code as a fatal error.  If a 552 is received
	for a RCPT TO because the message is too large, DATA will fail.
	Exim will return a 552 for too many recipients in some cases, in
	which case DATA will fail also.

2000-03-28  SRE  <eckert@climber.org>

	* lib/Mj/TextOutput.pm, DESIGN:
	change comment reference from parser_data.pl to CommandProps.pm

	* MANIFEST:
	make manifest reflect files deleted yesterday

	* lib/Mj/Config.pm:
	removed file_header, never used and contained bad info

	* files/en/help/configset_*
	reworked heading of configset_variable help files...
	now auto-extracted from release source instead of
	re-parsing configshow output, more info and more consistent

	* files/en/help/archive, files/en/help/configset_access_rules, files/en/help/configset_digests, files/en/help/digest, files/en/help/mkdigest, files/en/help/owner, files/en/help/post, files/en/help/request_response, files/en/help/sessioninfo, files/en/help/trigger, files/en/help/access:
	Finally documented the last remaining commands, some of which
	are not intended for end users, others of which had been overlooked.
	All commands (parser and otherwise) plus aliases and configset
	variables, now have help files available.

2000-03-27  Michael Yount  <csf@moscow.com>

	* lib/Mj/Deliver/Envelope.pm:
	(address) Await and discard responses if a 452 or 552 error code is
	received in response to a RCPT TO.

2000-03-27  SRE  <eckert@climber.org>

	* files/en/help/admin:
	inserted text from README.QUICKSTART, for how to quickly set up a list

	* README.QUICKSTART:
	README.QUICKSTART now contains hints on setting up Mj2,
	and refers to "help admin" for how to quickly set up a list

	* files/en/help/put:
	changed note: README.FILES is obsolete

	* README.FILES:
	this text is a subsection of 'help put', README.FILES is obsolete

	* README:
	changed reference to ACCESS_RULES file - info is now in 'help configset access_rules'

	* files/en/help/admin:
	removed references to release file "COOKBOOK", now deleted

	* COOKBOOK:
	this text is a subsection of "help admin"

	* ACCESS_RULES:
	this text is a subsection of "help configset access_rules"

	* files/en/help/admin_commands, files/en/help/commands, files/en/help/configset, files/en/help/configshow:
	inserted the lib/mj_cf_data.pl/$file_header text into
	various help files, since the variable wasn't used anywhere
	(syntax of configset variables is now better documented)

	* lib/parser_data.pl:
	lib/parser_data.pl was completely subsumed by lib/Mj/CommandProps.pm
	a short while after it started including more than just data for the parser

2000-03-26  Michael Yount  <csf@moscow.com>

	* lib/Mj/Deliver/Envelope.pm, lib/Mj/Deliver/SMTP.pm:
	Add support for ESMTP options.  To use any of these options,
	delivery rules must have the "esmtp" option specified.

	pipelining: pipeline RCPT TO commands.  At present, no sanity
	checks have been implemented to prevent overrunning the
	remote SMTP server.

	delivery status notification: send ORCPT option with encoded
	recipient address.

	"one transaction": send ONEX immediately after EHLO/HELO to
	prevent sendmail forking a grandchild after MAIL FROM.

2000-03-25  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Bf/Parser.pm:
	More bounce parsing work.

2000-03-24  SRE  <eckert@climber.org>

	* setup/mta_sendmail.pl, setup/setup_func.pl, setup/ask_domain.pl:
	improved transcript messages to avoid invalid answers during install,
	trapped failure to open ALIASES/* files to avoid "print on closed filehandle"

	* files/en/help/auxremove:
	add "see also help auxadd" for discussion of auxiliary lists

	* files/en/help/newconfig:
	noted that newconfig is a synonym for configset

	* files/en/help/put, files/en/help/admin, files/en/help/newfaq, files/en/help/newinfo, files/en/help/newintro:
	noted that newfaq, newinfo, newintro are shortcuts for 'put' commands

2000-03-24  Jason Tibbitts  <tibbs@math.uh.edu>

	* lib/Mj/MailOut.pm, lib/Mj/Mode.pm, lib/Bf/Parser.pm, ChangeLog:
	More simple bounce handling work.

2000-03-24  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Bf/Parser.pm (parse): Actually detect some bounces now.

2000-03-23  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Bf/Parser.pm: New file; handle bounce parsing.

	* lib/Mj/MailOut.pm (owner_done): Add skeleton code for bounce
	processing.

	* Makefile.PL: Add Bf/Parser.pm to module list.

	* lib/Majordomo.pm: Bump version for snapshot.
        Fix copyright typo.
	(connect): Add better error message for failed connection due to
	bad address.

	* setup/mta_exim.pl (ask_exim): Set mta_umask as necessary to open
	permissions just a bit.

	* setup/setup_func.pl (create_dirs): Create listdir and ALIASES
	with moreliberal permissions if necessary.

	* lib/Majordomo.pm (sessioninfo): Fix security idiocy in
	sessioninfo command.

2000-03-22  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Majordomo.pm: Bump version after fix to Dest.pm.

2000-03-22  Jason Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm: Bump version in preparation for snapshot.

2000-03-21  Michael Yount  <csf@moscow.com>

	* Makefile.PL:
	Remove ".pm" from man page names.

	* lib/Mj/Deliver/Dest.pm, lib/Mj/Deliver/Envelope.pm:
	Change handling of failures while issuing RCPT TO commands during
	an SMTP session:  remove the failing address from the list of
	recipients, and place it in a "deferred" array.  Addresses in
	the deferred array are handled after all other recipients, or
	by an explicit call to Mj::Deliver::Dest::flush().

2000-03-17  Michael Yount  <csf@moscow.com>

	* lib/Mj/Archive.pm:
	Make return values consistent.  Instead of returning just the data,
	return an array of list references.  Each list reference contains
	the number of the message, followed by the data for the message.

2000-03-11  Michael Yount  <csf@moscow.com>

	* lib/Mj/Token.pm:
	(t_accept) Use correct variable to determine if a token
	refers to a posted message.

2000-03-10  Brock Rozen <brozen@torah.org>

	* setup/ask_domain.pl:
	Insist on a non-blank master password.

2000-03-10  Sudhakar Chandrasekharan <thaths@netscape.com>

	* setup/ask_basic.pl, lib/Mj/MTAConfig.pm:
	Add support for the Postfix MTA.

	* setup/mta_postfix.pl:
	Ask questions about alias configuration during installation.

	* README.POSTFIX:
	Discuss how to configure Mj2 to work properly with the
	Postfix MTA.

2000-03-07  Darren Stalder  <torin@daft.com>
 
	* lib/Mj/Config.pm
	(parse_list_array) Add a newline before the 'use Majordomo qw(...);'
	so that pod2man likes it better.  POD works in paragraphs and
	there wasn't a blank line before the use.

	* MANIFEST
	Add the appropriate files so that MakeMaker's fullcheck doesn't
	spit out:
	Not in MANIFEST: README.CONVERSION
	Not in MANIFEST: convertlist.pl
	Not in MANIFEST: files/en/who_subscriber

2000-02-26  Michael Yount  <csf@moscow.com>

	* t/shell.t:
	The results of the who command are now indented only two spaces.
	Adjust the expected output to follow suit.

	* lib/Mj/Token.pm:
	(t_accept) Only use "ackimportant" and "ackall" settings, to determine
	if a reply should be sent upon token approval, if the request was
	'post'.

	* lib/Mj/TextOutput.pm:
	(archive) Use the archive_start subroutine.

	(who) Use the output format template.

	* lib/Mj/Format.pm:
	(archive) Use iterator function (archive_chunk).  At present, the
	chunk size is unlimited; options to configure it will be considered
	later.

	(who) Move template file handling to Majordomo::_who . Supply
	default output format if a template is not present.

	* lib/Mj/CommandProps.pm:
	Make the archive command an iterated function.

	* lib/Majordomo.pm:
	(archive) Change archive to use the _start/_chunk/_done sequence.

	(who_start) Include regexp in list_access_check so the correct result
	is returned if the command is stalled.

	(_who) Obtain the subscriber listing template from a file.  A file
	is used instead of a configuration option for purposes of security.

	* bin/mj_shell:
	Deal correctly with blank lines in here documents.

2000-02-24  Michael Yount  <csf@moscow.com>

	* lib/Mj/TextOutput.pm:
	(accept, reject) Make argument handling more consistent with other
	subroutines:  if args and arglist are present, use both instead of
	one or the other.

	* lib/Mj/Archive.pm:
	Make return values consistent.  Not only the message numbers but
	also the message data will be returned by first_n, last_n, and
	other subroutines that return a list of messages.

	* lib/Majordomo.pm:
	(_archive) Remove digest message headers and trailer when using
	immediate mode.

	(lists) Add "lists-aux" mode, which causes info about auxiliary lists
	to be returned along with data on ordinary lists.

	* files/en/help/lists:
	Document the new "aux" mode, which displays auxiliary lists
	in addition to ordinary lists.

	* bin/mj_shell:
	Add support for here documents.

2000-02-22  Michael Yount  <csf@moscow.com>

	* files/en/who_registry:
	Template for results from the "who-enhanced" command when used
	with the GLOBAL list.

	* files/en/who_subscriber:
	Template for results from the "who-enhanced" command.

	* lib/Mj/Resend.pm:
	(_post) Reverse use of truncate() before unlinking a queue or
	spool file.
	(post) Only substitute variables in a file's description if
	the description exists.

	* lib/Mj/Format.pm:
	(who) Use template files to make who-enhanced configurable.
	Majordomo::who returns a hash reference with all of the data
	visible to the person making the request.  If an administrative
	password is not used, only the "fulladdr" key will have a
	defined value.  Otherwise, all data from the appropriate RegList
	or SubscriberList may be used in the output.  The results
	are configured by the files who_subscriber and who_registry
	under the SITE directory.

	* lib/Majordomo.pm:
	(who_chunk) Return a hash reference, to allow the results of
	the who-enhanced command to be configurable.

	* files/INDEX.pl:
	Add who_registry and who_subscriber, templates for results for
	the "who-enhanced" command.

2000-02-21  Michael Yount  <csf@moscow.com>

	* bin/mj_queuerun:
	Save the result of both calls to stat().

	* lib/Mj/Digest/MIME.pm:
	Fix typo: Desctiption -> Description

	* lib/Mj/TextOutput.pm:
	(configshow) Check for existence of $comment before printing it.

	* lib/Majordomo.pm:
	(who) Add "enhanced" mode.  For the GLOBAL list, enhanced mode
	will show the lists to which the address is subscribed.  For
	ordinary lists, enhanced mode will show the subscriber flags
	and mail mode.  This mode is only available to list and
	site administators.

	* files/en/help/who:
	Mention the new "enhanced" mode, which shows subscriber flags and
	mail mode for ordinary lists, and shows the lists to which an
	address is subscribed when the GLOBAL list is used.

	* files/en/help/admin_commands:
	Note that here document tags require three capital letters followed
	by any number of capital letters and digits.

	* bin/mj_wwwadm:
	Move escape() inline for slight speed improvement.

	* bin/mj_queuerun:
	Compare file handle status and file status to see if another queue
	runner accessed the queue file between open() and flock(), as suggested
	by Dave Wolfe.

2000-02-17  Michael Yount  <csf@moscow.com>

	* lib/Mj/Resend.pm:
	(post) Do not explicitly close the file handle after parsing
	the queue file.  Doing so causes a race condition on systems
	configured for SysV-style file locking.

	(_post) Truncate the queue file to zero size to prevent
	additional queue runners from processing it.

	* lib/Majordomo.pm:
	(dispatch) Use a value of 2 to indicate "nolog"; -1 is now
	used to always send mail to the owner.

	(_archive) Read files in chunks of 4096 octets instead of line-by-line.

	* files/en/config/inform:
	Note that the "report" action is not yet implemented.

	* files/en/config/default_flags, files/en/help/configset_default_flags:
	Add "rewritefrom" to the list of flags.

	* bin/mj_wwwadm:
	Limit the information printed in the session file.

	Use "mjwww" as an ID for logging.

	Select the name of the previous command in the command menu.

	* bin/mj_queuerun:
	Truncate queue file before unlinking to reduce likelihood of
	a race condition in file locking.

2000-02-13  Michael Yount  <csf@moscow.com>

	* lib/Mj/Resend.pm:
	(post) Fail gracefully if the message could not be parsed.
	The site administrator is informed, and the message is
	moved from the queue to the temporary directory.

	* lib/Mj/Format.pm:
	(post) Change "Headers" to "Details" to accommodate error messages
	if the posted message could not be parsed.

	* lib/Mj/Archive.pm:
	(get_to_file) Increase chunk size for reading from 1000 to 4096
	octets.  This makes the archive command run a little faster.

	* lib/Majordomo.pm:
	(archive) Combine code for archive-index and archive-get.  The
	only differences between the two are the digest format and the
	subject header.

	* bin/mj_wwwadm:
	Use mj_wwwadm.debug instead of syslog for logging.

	Add index-recursive and get to the list of commands.

	* lib/Majordomo.pm:
	(trigger) No action is needed for the DEFAULT list.

	* lib/mj_cf_data.pl:
	Reverse change for debug: variable must remain visible, or the default
	debugging level will not be set during resend.

	* bin/mj_wwwadm:
	Use Majordomo object reference when calling legal_list_name.

2000-02-12  Michael Yount  <csf@moscow.com>

	* lib/Mj/TextOutput.pm:
	(show) Using or ("||") caused @arglist to be treated as a scalar, making
	the show command inoperable with a here document specifying addresses.

	* lib/Mj/Resend.pm:
	(post, _post) Return the full headers.  The return value is used by
	Mj::Format::post and Mj::Inform::inform, to inform list owners and
	to send acknowledgements to users with the "ack" flag set.

	* lib/Mj/List.pm:
	(make_setting) Compensate for missing digest type to avoid
	"uninitialized" warning.

	* lib/Mj/Inform.pm:
	Use "unknown@anonymous" as the requester instead of logging the
	full mail headers.

	* lib/Mj/Format.pm:
	(post) Print line indicating impending message headers.

	* bin/mj_wwwadm:
	Added check for valid list name.

	* bin/mj_wwwadm:
	Correctly check for the presence of the command requested in
	the symbol table of Mj::TextOutput.

	Remove unused variables.

2000-02-12  Michael Yount  <csf@moscow.com>

	* lib/Mj/Digest/Build.pm:
	(build) Remove temporary files after the digests have been created.

	* lib/Mj/TextOutput.pm:
	(auxremove) Remove the user from the auxiliary list if no address is
	supplied.  This makes auxremove consistent with auxadd.

	* lib/Mj/Resend.pm:
	Correct typo in hash key: substiute -> substitute.

	* bin/mj_wwwadm:
	Set variables to avoid "uninitialized" errors.

	Add the showtokens and subscribe-nowelcome commands to the command list.

	Avoid using false address with "auxadd" and "auxremove."

	Remove use of GET, which poses potential security problems.

	Do not run the showtokens command a second time, if it was
	requested by the user.

2000-02-11  Michael Yount  <csf@moscow.com>

	* t/shell.t:
	Create a directory for the DEFAULT list when running tests.

	* setup/setup_func.pl:
	Store cgi_url in the SITE configuration script.

	* lib/Mj/TextOutput.pm:
	(configshow) Continue collecting information even if an invalid variable
	is specified.

	* lib/Majordomo.pm:
	(_archive) Add "immediate" mode handling for the archive-index command,
	which allows the message index to be printed to STDOUT instead of
	being mailed.

	* postinstall:
	Allow mj_wwwadm, the adminstrative prototype CGI script, to be installed.

	* Makefile.PL:
	Add mj_wwwadm to the list of setuid scripts.

	* MANIFEST:
	Add mj_wwwadm administrative CGI prototype.

	* bin/mj_wwwadm:
	Prototype for WWW administrative interface.

2000-02-10  Michael Yount  <csf@moscow.com>

	* lib/Majordomo.pm:
	(who) Remove the last argument from list_access_check.  This allows
	the who command to work properly with list-specific passwords.

	* files/en/help/tokeninfo:
	Repair two typos.

	* files/en/help/tokeninfo:
	Describe how majordomo uses tokens, and thereby why the tokeninfo
	command is useful.

	* files/en/help/showtokens:
	Add tokeninfo to the "see also" list.

	* files/en/help/post:
	Suggest the use of the post command to edit moderated messages.

	Document the post-archive command, which allows a message to
	be stored in the list archive but not distributed on the mailing list.

	* files/en/help/accept:
	Document the accept-archive command, which allows a posted message to
	be stored in the list archive but not distributed on the list.

2000-02-08  Michael Yount  <csf@moscow.com>

	* lib/Mj/TextOutput.pm:
	(configdef) Allow multiple variables to be set to their default
	values with one command, similar to the configshow command.

	* lib/Mj/Resend.pm:
	(post) Delay moving the unspooled message to the spool directory
	until after an acknowledgement is sent.  Previously, the
	acknowledgement would not be sent because the original message,
	which is expected to be unspooled, could not be attached to
	the acknowledgement.

	* lib/Mj/List.pm:
	(new) Set database_backend for the DEFAULT list to allow the
	"who DEFAULT" command to work without error.  It returns
	an empty list.

	* lib/mj_cf_data.pl:
	Make the debug variable invisible and the digests variable visible
	to unprivileged people.

	* lib/Majordomo.pm:
	(which) Remove total hits and pattern length checks to make
	the "which" command usable by unprivileged people.

	* files/en/help/who:
	Make minor correction to mj_shell example.

	* files/en/help/which:
	Indicate how passwords affect the which command.

	* files/en/help/set:
	Document the use of the rewritefrom flag.

	* files/en/help/filesync:
	Alert the reader that the filesync command is no longer implemented.

	* files/en/help/configset:
	Make minor language changes and explain the relationship of
	a list's settings to the GLOBAL settings.

	List the variables that require global privileges to set.

	* files/en/help/configdefault:
	Explain how the configdefault command works, including the
	setting of default values in the cf_defs_* scripts and the
	DEFAULT mailing list.

	* files/en/help/config:
	Note that the config command is a synonym for the configshow command,
	and include the text of the configshow command.

	* files/en/help/auxwho:
	Describe sublists briefly and refer the reader to the "auxadd"
	help file.

	* files/en/help/auxadd:
	Demonstrate the use of auxiliary lists of other mailing lists
	in the access rules.

	* files/en/help/archive:
	Document the archive-get and archive-index commands.

	* TODO:
	Remove list:sublist and rewritefrom documentation from ToDo list.

2000-02-06  Michael Yount  <csf@moscow.com>

	* lib/Mj/MTAConfig.pm:
	Avoid creating a mail alias for the DEFAULT list.

	* lib/Majordomo.pm:
	Display the From: Date: and Subject: headers when informing a
	list owner about a posted message.

	* files/en/help/auxadd:
	Describe how sublists are used to categorize e-mail addresses.

	* files/en/help/advertise:
	Describe how "advertise" relates to the access_rules configuration setting.

	* files/en/help/access:
	Describe how "access" relates to the access_rules configuration setting.

	* TODO:
	Remove the DEFAULT list; it has been implemented.

	* README.QUEUEING:
	The queue files are stored in the QUEUE directory.

2000-02-04  Michael Yount  <csf@moscow.com>

	* lib/Mj/Token.pm:
	(t_accept) Use an Mj::Addr instead of a plain address when calling flag_set().

	* lib/Mj/Resend.pm:
	If a spool file is missing, inform majordomo-owner with "emergency priority."

	* lib/Mj/Log.pm:
	Use a unix socket when logging with syslog.  This saves needless DNS lookups
	and makes mj_shell run faster, especially when a high debugging level
	is used.

	* lib/Mj/Inform.pm:
	The override flag, if set negative, will cause the owner always to
	be informed via e-mail.  This is useful for emergency notifications
	for failures such as missing spool files.

	* lib/Mj/Format.pm:
	A stalled post is now distinguished from a failed post.

	* lib/Mj/CommandProps.pm:
	The who command may now be used to search the address registry
	via the GLOBAL list.

	* lib/Majordomo.pm:
	The tokeninfo command will now return the full spool file for a posted message.

	Using the who command on the GLOBAL list will obtain entries from the
	address registry.

2000-01-29  Michael Yount  <csf@moscow.com>

	* lib/Mj/Token.pm:
	(t_accept) Generalize output message to victims of an accepted consult
	token; the details now provided in the return values from Mj::Resend::post
	and _post make them unnecessary.

	* lib/Mj/TextOutput.pm:
	(post) Adjust arguments to allow the post command to work properly.

	* lib/Mj/Resend.pm:
	Add informative details to return values in the post and _post subroutines.

	* lib/Mj/Inform.pm:
	Remove tabs and line feeds from lines saved to the log file.

	* lib/Majordomo.pm:
	Added empty comment argument to calls to Mj::Inform::inform.

2000-01-28  Michael Yount  <csf@moscow.com>

	* lib/Majordomo.pm:
	Accommodate DEFAULT list.

	Remove white space in variable names to make configshow more
	resilient.

	The archive-get and archive-index commands now work.

	Unlocking the list config file allows the owners variable
	to be updated properly by the createlist command, and allows
	the configdef command to work at all.

	* setup/setup_func.pl:
	Changed DEFAULT to SITE_DFLT for variable substitutions to allow
	the DEFAULT mailing list to be mentioned by name.

	* lib/Mj/SimpleDB/DB.pm:
	Work around cursor inconsistency between DB_File and some versions
	of Berkeley DB.  Previously, it was impossible to build Mj2 on
	a FreeBSD 3.2 system because of this inconsistency.

	* lib/Mj/Digest/Build.pm:
	Include message number in subject_author index digests.

	* lib/Mj/Token.pm:
	Allow an optional mode for the accept command.  In particular,
	this is used to allow "accept-archive" to be used to send
	a post to the message archive but not have it distributed on
	the mailing lists.  Other uses may be found for this feature.

	Send an error message to the author if a posted message could not be
	distributed on a mailing list.

	* lib/Mj/TextOutput.pm:
	Allow spaces to be used in argument lists for the configshow command.

	* lib/Mj/Resend.pm:
	Move the unlink command for spool files and add error checking
	for potential missing spool files.

	Add check for "archive" mode, which causes a message to be stored
	in the archive, but not distributed on the mailing list.

	* lib/Mj/MailOut.pm:
	Use majordomo-owner as the envelope sender when mailing messages
	to list owners.  This prevents a mail loop from occurring if one
	of the list owner addresses fails.

	* lib/Mj/Log.pm:
	Change debugging messages to use 3 digits after the decimal point
	when showing elapsed time.

	* lib/Mj/List.pm:
	Do not generate a subscriber list for the DEFAULT list.

	* lib/Mj/Inform.pm:
	Added COMMENT variable to allow additional information to be
	included at the end of "inform" messages.

	* lib/Mj/Config.pm:
	Added the _load_dfl subroutine to set the dfldata array, which
	contains values from the DEFAULT mailing list.

	Removed dependency on the existence of the $::mj variable.

	Allow spaces around commas in a comma-separated list.

	* lib/Mj/CommandProps.pm:
	Change default setting for unsubscribe to allow the unsubscribe_policy
	option to work.

	* lib/Mj/Archive.pm:
	Added first_n subroutine to obtain the first n messages in an
	archive following m excluded messages.

	Added  a similar "exclusion count" to the last_n subroutine.

	Reworked the expand_date subroutine to always use the earliest
	and latest possible times when determining which archives are
	applicable to a particular date range.  Added a message limit,
	which may be negative, in which case the matching of message
	times starts with the latest possible archive and works in reverse.

	Added sanity checks to the _secs_start and _secs_end subroutines
	to keep timelocal and timegm from calling "croak" for parameters
	out of bounds.

	Corrected typos in the _arc_name subroutine, which will allow weekly
	or daily archiving to work properly.

	Rewrote parameter parsing in the expand_range subroutine to
	work for any combination of parameters in a range of messages.

	Wrote the _parse_archive_arg subroutine to separate each parameter
	into the a pair of values, a date and a message number.

	Wrote the _parse_message_range subroutine to deal with ranges
	that contain at least one explicit message number.

	* lib/Mj/Access.pm:
	Added _d_unsubscribe subroutine to allow the unsubscribe_policy
	configuration variable to work.

	* lib/mj_cf_defs.pl:
	Changed DEFAULT to SITE_DFLT to accommodate the new DEFAULT list.
	Defaults for the GLOBAL list also apply to the DEFAULT list.

	* files/en/inform:
	Added COMMENT variable to allow additional details to be added
	to the end of an "inform" message.

	* bin/mj_queuerun:
	Fix typo:  change mj_email to mj_queuerun in debugging message.

Mon Oct 11 18:00:21 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Access.pm (list_access_check): Reorganization to allow
 	nonterminal rules.

	* lib/Mj/CommandProps.pm: Add 'terminal' property to relevant
 	actions, add action_terminal function and make it exportable.

Sun Oct  3 14:42:13 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_queuerun: Deal with failing access check.

Sat Oct  2 17:36:52 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_shell,bin/mj_email: Changes to stop processing if access
 	check was denied.

Fri Oct  1 17:50:16 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (connect): Check access (on 'access') and tell
 	the client to go away if necessary.

1999-08-25  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Config.pm (parse_access_rules): Typo in file not found
	  warning.

	* lib/Majordomo.pm (_make_list): Dumb typo in list_file_get
	  callback function.

Fri Aug 20 00:01:42 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* setup/ask_domain.pl (ask_domain): Make sure the domain hash gets
 	initialized.

Thu Aug 19 23:22:32 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* setup/setup_func.pl (do_default_config): Fix problem with
 	initial addr_xforms value causing test failures.

Wed Aug 18 19:58:48 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* setup/setup_func.pl (do_default_config): Replace addr_xforms.

	* setup/ask_basic.pl (ask_basic): Ask about case smashing.

Thu Aug 12 00:33:58 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* Makefile.PL: Bump config file version.

	* setup/ask_basic.pl: Pretty up questions by adding some headers
 	and reorganizing a bit.

	* setup/setup_func.pl (do_default_config): Substitute confirm_url
 	setting into default configurations.

Wed Aug 11 21:40:32 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* setup/ask_basic.pl (ask_basic): Ask about URL to get to CGIs.

	* lib/Mj/SubscriberList.pm: Added id, remind and expires fields.

Sat Aug  7 11:04:17 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* setup/ask_domain.pl (ask_domain): Typo $fg -> $cfg.

Tue Aug  3 00:02:19 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm (_post): Rename _subject_prefix to
 	_munge_subject to reflect better what it will eventually do.

Mon Aug  2 19:20:18 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Digest.pm (trigger): Initialize digest state to sane
 	values if necessary.

	* lib/Majordomo.pm (reject): Don't clobber the given token string
 	if it doesn't turn out to be a real token.
	(_showtokens): Call get_done when finished enumerating the tokens.

	* lib/Mj/Token.pm (t_recognize): Don't return the random value in
 	$1 if the string doesn't look like a token.

	* lib/Mj/SimpleDB/DB.pm: Create and destroy the database on _every
 	call_ to get rid of concurrency problems.

Sat Jul 31 00:07:25 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Config.pm (parse_xform_array): Add 'equate domain1 and
 	domain2' syntax to addr_xforms.

	* lib/Mj/Access.pm (_d_post): Deal with list:auxlist syntax in
 	restrict_post.

Fri Jul 30 17:35:03 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Config.pm (parse_restrict_post): Remove ':' as a possible
 	separator.

	* lib/Majordomo.pm (_fill_lists): Make return value a little more
 	meaningful.

Tue Jul 27 00:53:35 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* setup/ask_domain.pl (ask_domain): Turn Mj1 conversion questions
 	back on.

	* setup/query_util.pl (get_dir): Require pathnames be absolute.

Fri Jul 23 12:11:53 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/SimpleDB/DB.pm (mogrify): Dumb bug made returning
 	undefined key (implying that the entry should not be deleted) not
 	work.

1999-07-20  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* bin/mj_shell: Applied patch bu Anton Berezin to fix various
	  unquoted regexp metachars.

Sun Jul 18 14:12:55 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (new): addr_xforms is now a parsed variable, so
 	conig_get returns a ref, not an array.

	* lib/Mj/Config.pm (parse_xform_array): Make xform_array a parsed
 	type; do some simple substitutions so folks can write 'ignore
 	case' instead of /(.*)/\L$1/.

Sat Jul 17 10:13:15 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/RegList.pm:
	* lib/Mj/SubscriberList.pm:
		Add rewritefrom field.

	* t/shell.t: Store database_backend in the temp site config.

	* setup/setup_func.pl (do_site_config): Save database_backend in
 	the site config file.

	* setup/ask_basic.pl (ask_basic): Ask about DB_File support.

	* lib/Mj/SimpleDB.pm: Rip autoconversion; it causes more trouble
 	and initial lock overhead than it's worth.

	* lib/mj_cf_data.pl: Remove database_backend variable.

	* lib/Majordomo.pm (new): database_backend is now a site config
 	variable.

	* Makefile.PL: Changes to support prerequisites that aren't
 	essential.  Pause interactive configuration after prereq checks
 	and before configuration dialogue begins.
	
	* lib/Mj/SimpleDB/DB.pm (mogrify): Forgot to delete the key when
 	necessary.  Fixed some undef warnings.	

Fri Jul 16 11:54:28 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/SimpleDB/DB.pm (add): Fix typo resulting in complete
 	deadlock when calling add.

	* lib/Mj/RegList.pm (compare): 
	* lib/Mj/AddressList.pm (compare):
		Quickened up comparison function (access @_ instead of
 		using my variables).

	* lib/Mj/SubscriberList.pm (new): Forgot to add comparison
 	function.

Wed Jul 14 23:00:26 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (list_config_set): When no warnings are to be
 	returned, don't tell the user there are warnings.

Sun Jul 11 15:00:10 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/RegList.pm (new): 
	* lib/Mj/AddressList.pm (new):
		Add comparison functions.

	* lib/Majordomo.pm (substitute_vars_string): Add patch by Anton
 	Berezin to recursively substitute an arrayref.  This fixes the
 	non-substitution of variables in fronters and footers.

Sat Jul 10 19:11:53 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/SimpleDB.pm (new): New calling convention: take a hash
 	now.

	* lib/Mj/TokenDB.pm (new): 
	* lib/Mj/SubscriberList.pm (new): 
	* lib/Mj/AddressList.pm (new): 
	* lib/Mj/AliasList.pm (new): 
	* lib/Mj/Archive.pm (_make_index): 
	* lib/Mj/List.pm (_make_dup): 
	* lib/Mj/RegList.pm (new):
		Use new SimpleDB calling convention

Sun Jul  4 15:53:32 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Parser.pm (parse_entity): Deal with the fact that
 	following attachments might not have bodyhandles.

Fri Jul  2 20:00:57 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* setup/mta_exim.pl (setup_exim_domain): Don't hardcode UID; add
 	pipe transport.

Mon Jun 28 22:51:25 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/SimpleDB/DB.pm: New file: begin implementation of
 	BerkeleyDB interface.

Sat Jun 26 16:51:46 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Config.pm (set): Return "error" string even if parse
 	succeeded; these will be warnings.

	* lib/Majordomo.pm (list_config_set): Return warnings back to
 	caller.

	* lib/Mj/Config.pm (parse_access_rules): New code to check for
 	existence of files specified in actions.  Call action_files and
 	make use of the mj.list_file_get callback.

	* lib/Mj/List.pm (new): New calling semantics; take a hash.
	Use new Mj::Config::new call semantics.

	* lib/Majordomo.pm (_make_list): Use new Mj::List::new call
 	semantics.  Pass a callback to _list_file_get.

	* lib/Mj/CommandProps.pm (action_files): New function: extract
 	which arguments from an actions arglist are filenames, so they can
 	be checked.
	Rename %reg_actions to %actions.
	Attach additional information to %actions.

Thu Jun 24 00:13:23 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_email (parse_commands): Make use of unstripped address
 	where useful.
	(connect_and_parse): Return unstripped user address as well.

	* bin/mj_queuerun (parse_commands): Make use of unstripped address
 	where useful.
	(connect_and_parse): Return unstripped user address as well.

Wed Jun 23 21:44:44 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* setup/ask_domain.pl (ask_domain): Restructure a bit; ask for the
 	actual Internet domain name in case the user decided to call the
 	Majordomo domain something different.

	* setup/setup_func.pl (do_default_config): Replace 'whereami' with
 	newly configured variable instaed of just the domain colletcion
 	name.

1999-06-23  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Access.pm (_a_replyfile): Set the nofail flag.
	(_a_mailfile): Push substitution into list_file_get call and set
	nofail flag.

	* lib/Mj/Resend.pm (_check_header): Add a log statement.
	(_check_poster): Ditto.

Sun Jun 20 13:34:52 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* setup/mta_qmail.pl (setup_qmail_domain): Write out $whoami
 	argument to -Q in .qmail-default files.

	* bin/mj_enqueue: Make -Q take $whoami for this domain as an
 	argument so 'majordomo' isn't hardcoded.

	* bin/mj_email: ditto.

	* bin/mj_queueserv: Sed $SIG{CHLD} based on the value of
 	$::SIG_CHLD_IGNORE.

	* installbin: Substitute $::SIG_CHLD_IGNORE.

	* setup/setup_func.pl (do_site_config): Just put all info from all
 	available MTAs into the config; it can't hurt to be there and
 	eliminates the possibility of making some stupid errors.

	* setup/query_util.pl (get_file): Fix some dumb logic errors;
 	comment better.

	* setup/ask_basic.pl: Completely restructure MTA configuration
 	sections.

	* lib/Mj/MailOut.pm (deliver): Get the sender separator out of the
 	site config instead of hardcoded constants in MTAConfig.pm.

	* lib/Mj/MTAConfig.pm: Add Exim support; remove %sendsep
 	completely (since it's now configurable at install time).

	* bin/mj_queueserv (in): Handle the case of select returning -1;
 	previously we moved into the accept and blocked forever.

Sat Jun 19 13:15:35 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* setup/setup_func.pl (mta_setup): Restructure a bit; handle
 	making mj-domains file.

	* postinstall: Don't skip MTA configuration if not running on a
 	terminal.
	Rework MTA setup a bit.

Fri Jun 18 23:18:20 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Access.pm (_a_confirm): Hack to get unspooled filename
 	into Token::confirm.

	* lib/Mj/Resend.pm (post): Ditto.

	* lib/Mj/Token.pm (consult): Ditto.

Wed Jun  9 23:45:16 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* setup/install_util.pl (safe_mkdir): Always make sure that the
 	mode and owner are correct, even if the directory already exists.

Tue Jun  8 10:44:35 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_trigger,bin/mj_email,bin/mj_queuerun: Fix debug
 	redirects.

1999-06-10  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Resend.pm (post): Don't use Reply-To to extract user.

Sat Jun  5 11:50:49 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_queueserv: Cleaned up some || -> or confusion.

	* bin/mj_enqueue: ditto.

Thu Jun  3 20:40:32 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm: Forgot to quote 'mv'.

Tue Jun  1 22:34:01 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (dispatch): Make sure that $user is defined and
 	nonzero; when we allocate Mj::Addr objects, we want to make sure
 	that they are valid.  (They can be anomymous.)

Thu May 27 00:49:15 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm (_post): Unlink the message file appropriately.
	(post): Spool the message ourselves in the case of stalls; this
 	removes lots of the special casing from the Token.pm routines and
 	costs very little in terms of extra code here.  Use t_gen to get
 	random strings for the name and just make sure another file of
 	that name doesn't exist.  Use a different spool directory (outside
 	of the filespace) to do this.

	* lib/mj_cf_data.pl: 'sender' must be visible for emailed commands
 	to work.

	* lib/Mj/Token.pm (t_remove): No need to unspool; a higher level
 	can take care of that itself if necessary.
	(confirm): Don't do spooling.
	(consult): Ditto.
	(t_accept): Don't try to play any filename games.

	* bin/mj_queuerun (resend): Don't use the the iterative functions;
 	instead, just submit the queue file directly.  post() may move
 	this file into its spool area, so be careful not to bomb unlinking
 	it.

Wed May 26 00:25:17 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_queuerun: Change queue directory location throughout.

	* bin/mj_enqueue (in): Move location of queue directory into
 	persistent (instead of temporary) storage; this makes spooling
 	files for approval a rename instead of a copy.

	* setup/setup_func.pl (create_dirs_dom): Make new spool directory
 	outside of the filespace.

Sun May 23 00:06:44 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_shutdown: New script; ask mj_queueserv to exit.

	* postinstall: Add mj_shutdown script to be installed.

	* Makefile.PL: Add mj_shutdown script to be installed.

	* bin/mj_enqueue: Send a greeting string to the queue server at startup.

	* bin/mj_queueserv: Add logic to shut down when requested.

	* lib/Majordomo.pm (list_config_get): Don't check for validity of
 	the address if it's not defined.
	(reject): Don't delete the session of the rejected token before
 	we've had a chance to read it.

	* lib/Mj/Token.pm (confirm): Request that _list_file_get not fail.

	* lib/Majordomo.pm (_list_file_get): Accept new $nofail parameter
 	so that a file is always returned, even if it's not terribly
 	useful.

	* lib/Mj/Resend.pm (_post): _list_file_get takes six parameters
 	now.

Sat May 22 19:02:26 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_queuerun (run_queue): Add processing of queue files sent
 	to majordomo-owner (which don't have a list in the filename).

	* lib/Mj/Token.pm: Make sure everything sent has reasonable From:,
 	To: and Reply-To: headers when appropriate.

	* lib/Mj/Access.pm: Change whoami_owner to
 	sender.

	* lib/Mj/MailOut.pm: Change whoami_owner to sender.

	* lib/Mj/Token.pm: Change whoami_owner to sender.

	* lib/Mj/Resend.pm: Change whoami_owner to sender.

	* bin/mj_queuerun (parse_commands): Change whoami_owner to sender.

	* bin/mj_email (parse_commands): Change whoami_owner to sender.

	* lib/Majordomo.pm: Various changes from whoami_owner to sender.

	* lib/Mj/Access.pm (_build_passwd_data): Fix problem calling old
 	'canon' routine.

Thu May 20 22:38:28 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Token.pm (consult): Change some headers in various mailed
 	messages.

	* lib/Mj/TextOutput.pm (register): Fix bug that registered the
 	wrong address.

	* lib/Mj/Config.pm (parse_welcome_files): Remove the special
 	meaning of an "empty table".

	* lib/mj_cf_defs.pl: Add defaults for welcome_files so that
 	registrations get something more useful and to allow removal of
 	the special "empty table" checking in
 	Mj::Config::parse_welcome_files.

Mon May 17 18:41:32 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_email (connect_and_parse): Don't use Reply-To: for the
 	user address; reply-to rerely means that.

	* bin/mj_queuerun: Ditto.

Wed May 12 22:28:47 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/List.pm: Add 'noack' to flags table.

Tue Apr 20 01:13:06 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_queuerun (connect_and_parse): Don't exit if we can't
 	connect (that was dumb).  Instead return an empty list.
	(respond_with_file): If connect_and_parse didn't return anything,
 	don't call the dispatcher.
	(parse_commands): Return straight away if connect_and_parse
 	didn't return anything.

Mon Apr 19 22:56:41 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_queueserv: Use DEFAULT for SIGCHLD instead of IGNORE so
 	we at least get auto-reap.

Sun Apr 18 00:31:30 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_enqueue: Make use of hardcoded constants to avoid loading
 	Fcntl.pm.

	* installbin: Substitute in constants taken from Fcntl.pm.

	* bin/mj_queuerun (run_queue): Better debug info.

	* bin/mj_enqueue (smkdir): Don't die if we can't make the
 	directory because it exists.

	Close handles before exec'ing mj_queueserv if they're not
 	connected to a terminal.

	* setup/ask_queueing.pl (ask_queueing): Fix dumb cut-n-paste
 	error.

	* lib/Mj/Token.pm (consult): Small bug fix: put split reasons in
 	Subject:.

	* bin/mj_queueserv: Change the name of the socket.

	* bin/mj_queuerun (run_queue): Move destruction of Majordomo
 	object; always do it after running a domain, instead of lazily, in
 	order to show a sensible destructor sequence.

  	It is not really an error to fail opening a queue file because
 	another runner may have deleted it while we were processing.

	The largest of domain, list, -v debugging options wins.

	* bin/mj_enqueue (logmsg): Change socket name to
 	mj_queueserv.sock.
  	
	Not being able to create the socket is not a warning.
  	
	Do locking to make sure only one mj_enqueue is starting a server;
 	if another process has locked a file, don't bother to try to start
 	a server.

Sat Apr 17 00:48:17 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_queueserv (logmsg): Log to STDERR, not STDOUT.

	* bin/mj_enqueue (logmsg): Log to STDERR, not STDOUT.

	* bin/mj_queuerun (debug_to): New function; redirect debugging
 	info.
	(run_queue): Send debug info to an appropriate file.

	* bin/mj_enqueue (logmsg): Add logging function.

	* bin/mj_queuerun (run_queue): Solaris fix: file must be opened
 	for writing for LOCK_EX to work.

	* bin/mj_enqueue: Default -v to 0; cure warning.
	Log messages returned by mj_queueserv.

	* lib/Mj/Token.pm (consult): When consulting with no bounce
 	reasons, make sure the subject is not hosed.

	* bin/mj_queuerun (run_queue): Set debugging levels based on
 	'debug' config variables for each domain and list.

	* lib/Mj/Log.pm (set_level): New function: set logging level after
 	the fact.

	* lib/mj_cf_data.pl: Make 'debug' variable visible to the
 	interface so mj_queuerun can set the log level dynamically.

	* bin/mj_enqueue: Pass -v option value to mj_queueserv.

Fri Apr 16 18:25:38 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm (_post): Take an entity as a phantom extra
 	argument and always take the true file name.
	(post): Always pass the source file and pass the entity as an
 	extra argument.

	* lib/Majordomo.pm (help_start): Fix passing topic as the victim.

Wed Apr 14 02:32:12 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_enqueue: Take -P and -p arguments to specify domain and
 	list priorities.  Create queue files in appropriate priority
 	directories.

	* bin/mj_queuerun (run_queue): Two extra levels of nesting to
 	handle domain and list priorities.

Tue Apr 13 00:43:29 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_queueserv: More Solaris fixes.  Make sure exec'd
 	mj_queuerun has STDIN and STDOUT properly opened onto the $parent
 	filehandle.

	* bin/mj_enqueue: Fixes for Solaris: tear down and recreate socket
 	before every call to connect.

	* setup/setup_func.pl (suggest_mta): Pay attention to queue_mode
 	when creating qmail_default files.

	* postinstall: Add new queue scripts to the appropriate arrays.

	* Makefile.PL: Add new queue scripts to the appropriate arrays.

	* lib/Mj/MTAConfig.pm: Handle queue_mode by calling mj_enqueue
 	instead of mj_email.

	* setup/ask_queueing.pl (ask_queueing): New file; query for
 	timeout and concurrency.

	* setup/ask_basic.pl (ask_basic): Ask about queueing.

	* Makefile.PL: Bump config version.

	* lib/Majordomo.pm (_createlist): Pass 'queue_mode' on to
 	MTAConfig.

Mon Apr 12 19:51:29 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_queueserv: New file: manage a pool of queue runners.

	* bin/mj_queuerun: Work through a queue and process all files
 	found there appropriately.

Sun Apr 11 13:23:15 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_enqueue: Add locking of the queue file.

Fri Apr  9 19:10:45 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_enqueue: New file: push a message into an appropriate
 	queue directory and start the queue server.

	* installbin: Substitute $::BINDIR.

Sat Apr  3 22:10:51 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm (_post): Pass additional headers to do_digests.

	* lib/Mj/Digest/Build.pm (build): Pass on extra headers.

	* lib/Mj/Digest/MIME.pm (new): Add extra headers.

	* lib/Mj/Digest/Text.pm (new): Add extra headers.

	* lib/Mj/Digest/Index.pm (new): Add extra headers.

Fri Apr  2 18:01:58 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Digest/Build.pm (idx_subject): Make sure subject is
 	defined.

	* lib/Mj/Resend.pm (do_digests): Take a hash of arguments instead
 	of a pile of positional args.
	(_post): Call do_digests with a hash.

	* lib/Majordomo.pm (_digest): Call do_digests with a hash.

Thu Apr  1 01:16:24 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (list_config_set): Refine application of
 	config_CLASS and config_var subsidiary passwords.
	(substitute_vars_string): Don't turn \\ into \, just \$ into $.

Wed Mar 31 00:33:46 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm (_post): Add Precedence: header.

Sun Mar 28 02:23:03 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Archive.pm (add_start): Be sure to return the full
 	message number, not just the offset from the beginning of this
 	archive.

	* lib/Mj/Resend.pm (_post): Make sure archive number gets into
 	archived copy of message.

	* lib/Mj/CommandProps.pm: Added addr, host, fulladdr as legal
 	access variables for everything.
	(rules_var): Take a type.
	(rules_vars): Taks a type; return only vars with that type.

	* lib/Mj/Config.pm (_compile_rule): Merge %strings into %args;
 	implement =~ binding to regexp matches.

Sat Mar 27 23:19:50 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Access.pm (list_access_check): Share a %strings hash,
 	share it with the compartment and fill it with various strings the
 	user can match against.

	* lib/Mj/Config.pm (_compile_rule): /.../ matches match against
 	$strings{stripaddr}, not $victim.

Thu Mar 25 23:01:33 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Config.pm (_compile_rule): Escape backslashes and single
 	quotes in action strings, so as to avoid errors in the generated
 	code.

	* lib/Mj/Resend.pm (_post): Fix problem calling archive_add_done
 	when archive_add_start failed.

Mon Mar 22 18:57:15 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm (_post): Call archive_add_start/done.

	* lib/Mj/Archive.pm (add): Split into add_start and add_done.

	* lib/Mj/List.pm (archive_add): ditto.

Wed Mar 17 00:23:39 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* Makefile.PL: Bump $config_version.

	* setup/ask_qmail.pl (ask_qmail): Ask for location of qmail
 	binaries.

	* postinstall: Conditionalize on 'mta' the scripts that are made
 	setuid.

Mon Mar 15 23:17:02 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_email (do_qmail): If passed "-T string", trim "string"
 	from the address we get form $ENV{LOCAL}.  Trim a leading dash if
 	one is present.

Sat Mar 13 15:57:11 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* postinstall: No need to call do_config; there's nothing left to
	configure.

	* setup/setup_func.pl (create_dirs_dom): Also make the appropriate
	dotfiles.

	* lib/Mj/FileSpace.pm (_legal_file_name): Files with leading dots
 	aren't legal (to eliminate potential nasty problem with dotfiles).

	* lib/Mj/Digest.pm (decide): Improve logging.

	* Makefile.PL: Move setting of @SCRIPTS, @SIDSCRIPTS until after
 	configuration is complete, so we can change which scripts get
 	wrappers.

Fri Mar 12 01:09:18 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/FileSpace.pm (delete): Unlink the dotfile.

	* lib/Mj/List.pm: Removed 'fs_mogrify'.

	* lib/Mj/TextOutput.pm: Removed 'filesync'.

	* lib/Mj/CommandProps.pm: Removed 'filesync'.

	* lib/Mj/FileSpace.pm (get_permissions): Call getdata.

Thu Mar 11 21:35:20 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/FileSpace.pm (new): No database allocated.
	(get): Call getdata() instead of doing a database lookup.  Bail
 	based on a stat, not a database lookup.
	(getdata): New function, return data for a file based on the
 	.file.
	(_dotfile): New function.

Wed Mar 10 00:02:23 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (trigger): Add hourly tickling of digests.

	* lib/Mj/TextOutput.pm (mkdigest): Take last argument given as a
 	password.

	* lib/Mj/Format.pm (show): Return proper error in the case of a
 	denial, as opposed to an invalid address failure.

	* lib/Majordomo.pm (_digest): Delete tempfiles.

	* lib/Mj/Resend.pm (do_digests): Delete tempfiles.

	* lib/Majordomo.pm (_digest): Correct typo.

	* lib/Mj/Config.pm (parse_digests): Change the way a default time
 	is handled.
	(_str_to_clock): Deal with 'never', 'none', 'all', 'always',
 	'any'.

	* lib/Mj/TextOutput.pm (mkdigest): Add mkdigest.

	* lib/Mj/CommandProps.pm: Add mkdigest.

Tue Mar  9 22:55:43 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (_digest): Add -check and -force modes.

	* lib/Bf/Sender.pm (M_regular_sender): Don't bomb on undefined
 	message numbers.

Mon Mar  8 00:00:51 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm (_post): Use new _do_digests calling sequence.

	* lib/Mj/Digest/Index.pm: Fix some perl5.004 warnings.

	* lib/Mj/Format.pm (digest): New function.

	* lib/Mj/TextOutput.pm (digest): New function.

	* lib/Majordomo.pm (digest): New function: interface to digest.

Sun Mar  7 00:40:37 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Digest.pm (trigger): Overhaul to force (override
 	decide()) and to accept a list of digests to trigger.
	(add): Call the trigger function with new arguments.

	* lib/Mj/List.pm (digest_incissue): New function.
	(digest_incvol): New function.

	* lib/Mj/Resend.pm (_do_digests): Excise issue incrementing code,
 	call digest_incissue.

	* lib/Mj/Digest/Build.pm (idx_subject_author): Fix undef warning.
	(idx_subject_author): Overhaul idx_subject_author.

	* lib/Mj/Digest/MIME.pm (new): Remove problems with {index} =>
 	{'index'}.

	* lib/Mj/Digest.pm (trigger): Updated to take a lists of digests
 	to trigger (default to all of them) and an argument to force
 	generation regardless of other limitations.

	* lib/Mj/CommandProps.pm: Add 'digest' command.

	* lib/Mj/Digest/MIME.pm: Handle 'preindex', 'postindex', and
 	'footer' correctly.

	* lib/Mj/Digest/Index.pm: Ditto.

	* lib/Mj/Resend.pm (_do_digests): New function; handle generating
 	(but not sending) digests.

	* lib/Mj/Digest/Text.pm: Handle 'preindex', 'postindex', and
 	'footer' correctly.

	* lib/Mj/Digest/Build.pm (build): Remove index_header and use
 	'preindex', 'postindex' and 'footer' instead.

	* lib/Mj/Resend.pm (_add_fters): Don't do substitutions if we
 	don't have a fronter or footer to substitute into.

	* lib/Mj/Digest/Build.pm (idx_subject_author): Minor tweak to tey
 	and keep things on one line more often.
	(build): Pass preindex, postindex, and footer file info.

Sat Mar  6 13:14:50 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/CommandProps.pm: Added 'sub' as an alias for 'subscribe'.

	* lib/Mj/Addr.pm: Removed logging.

	* lib/Mj/List.pm (digest_trigger): New function.

Fri Mar  5 17:05:28 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm (post): Also check ack_attach_original = 'any'.

	* lib/mj_cf_data.pl: ack_attach_original takes 'all', not 'any'.

	* lib/Mj/Resend.pm (post): Oops.

Thu Mar  4 00:14:41 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm (post): ack_attach_original uses 'fail', not
 	'reject'.

	* lib/Majordomo.pm (help_start): Typo: site => site_name.

	* setup/setup_func.pl (suggest_crontab): Suggest daily trigger go
 	ten minutes after the hour, so it doesn't overlap the hourly
 	trigger that runs precisely at midnight.

Wed Mar  3 22:18:13 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/CommandProps.pm: Add 'days_since_subscribe' and 'mime' to
 	allowed variables for 'post'.

	* lib/Mj/Resend.pm (_check_poster): New function, do checks based
 	on the person posting the message.  Currently check the number of
 	days since they joined.

1999-03-01  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* files/INDEX.pl: Renamed quote_regexp to quote_pattern.

Mon Mar  1 07:37:52 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_email (forward_to_owner, resend): Allow possible \r when
 	stripping From_ separators.

Sun Feb 28 00:04:02 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/mj_cf_data.pl: Remove all comment entries.

	* files/INDEX.pl: Added all of the variable descriptions.

Sat Feb 27 14:44:15 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (config_get_comment): Extract the file from the
 	filespace instead of of getting it from the big variable data
 	structure.  Variable descriptions are now translatable.

	* lib/mj_cf_data.pl: Rename 'quote_regexp' to 'quote_pattern'.

	* lib/Mj/Resend.pm (_check_body): Use quote_pattern.

	* setup/setup_func.pl (suggest_crontab): Doesn't need a domain any
 	longer.

	* installbin: Expand @::DOMAINS in mj_trigger to list of all
 	configured domains.

	* bin/mj_trigger: If not passed -d, loop over all configured
 	domains instead.

	* lib/Mj/Resend.pm (post, _post): Fix typos; site -> site_name.

Fri Feb 26 17:38:38 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/MailOut.pm (welcome): $MJ instead of $MAJORDOMO.

	* lib/mj_cf_data.pl: Tweak 'welcome_files' description.

	* files/en/help/help: Mention "unregister".  Use $MJ instead of
 	$WHOAMI and $MJOWNER instead of $OWNER.

	* lib/Mj/List.pm: Add 'nohide' meaning the same thing as showall.

	* lib/Mj/Resend.pm (post): Add some new substitutions in acks.
	(_post): Add new substitutions for headers, fronters and footers.

	* postinstall: Big changes; split out utility functions and
 	installation functions from the main file (which gets much smaller
 	now).

1999-02-26  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Resend.pm (_post): Pass the sender to archive_add; this
	will cause it to generate a mailbox separator to replace the one
	we removed in mj_email several days ago.  Not doing this causes
	bogus archives.

Tue Feb 23 01:42:40 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* setup/ask_basic.pl (ask_basic): Check for qmail before Sendmail.

Tue Feb 23 01:42:40 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/MTAConfig.pm (qmail): No work to do.  Comment out all
 	qmail specific code; it's not necessary.

	* setup/ask_basic.pl (ask_basic, ask_qmail, ask_domain): More
 	qmail support tweaks.

Mon Feb 22 01:04:48 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Digest/Index.pm (done): Fix $args problem: copy in args
 	during object construction, since we don't have the hash at the
 	end.

	* setup/ask_basic.pl (ask_basic): Enable qmail as a supported MTA.

Sun Feb 21 00:38:40 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Digest/Index.pm (done): Add To and From headers.

	* bin/mj_email (do_qmail): New function.  When called with -Q,
 	look at $ENV{LOCAL} and fake various elements of %opts to make it
 	look to the rest of the code as if the appropriate flags had been
 	passed.
  	
	Delay loading most modules until after the qmail checks have been
 	done.

	* lib/Mj/Digest/MIME.pm (new): Use 'to' argument.

	* lib/Mj/Digest/Text.pm (new): Use 'to' argument.

	* lib/Mj/Digest/Build.pm (build): Pass on 'to' argument.

	* lib/Mj/Resend.pm (_post): Pass 'to' parameter to digest_build
 	containing the list address (which is close to what Mj1 does, but
 	not exactly since we don't have a list-digest address anywhere).

	* bin/mj_email (connect_no_parse): Allow /r/n as well as /n to be
 	a blank line.

	* postinstall (do_default_config): Bring prompt for global
 	password in line with what is actually done.

	* lib/Mj/Resend.pm (post): Move decision to exit without acking
 	until after we've tested to see if the message should be posted.
  	Oops.

	* postinstall (do_default_config): Fix undef warning when whoami
 	isn't qualified.

	* lib/Mj/Digest/Text.pm (get_text): Add some additional whitespace
 	when nuking attachments.

	* lib/Majordomo.pm: Bump version number in preparation for
 	snapshot.

Sat Feb 20 00:28:45 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Access.pm (_a_reply, _a_replyfile): Deal with 'NONE'.
	(_a_replyfile): Return file info as fourth argument.
	(_a_mailfile): Return temp as fifth argument, not fourth.
	(list_access_check): Deal with additional argument returned by
 	replyfile.

	* lib/Mj/Resend.pm (post): Major improvements to acking.  Use new
 	ack_denials_always and ack_attach_original variables.  Add
 	$HEADERS expansion.  Receive replyfile info data from
 	list_access_check and make use of it.  Properly ack stalls on
 	'ackimportant', not just 'ackall'.

	* files/INDEX.pl: Include proper subject for ack_denial and
 	ack_stall.

	* lib/mj_cf_data.pl: Add ack_attach_original variable.

	* lib/Mj/Config.pm (parse_enum_array): New function; parse an
 	array of enums and return a hash for quick lookups.

	* lib/mj_cf_data.pl: Rename 'always_ack_denials' to
 	'ack_denials_always'.

	* postinstall (do_default_config): Properly fill in owner address
 	when the user provides a rully qualified address for majordomo.
  	Don't just tack on '-owner'.

	* lib/Mj/Resend.pm (post): Use 'always_ack_denials' variable to
 	decide whether denials should be acked or if ack flags should be
 	checked.  Ack stalls if 'ackimportant' is set, not only on
 	'ackall' as before (bug).
	(_r_ck_body): Get part name right.

Fri Feb 19 19:18:53 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/mj_cf_data.pl: Add always_ack_denials variable.

	* lib/Mj/Resend.pm (_check_mime): Improve logging.

	* lib/Mj/List.pm (make_setting): Fix bad typo.

Tue Feb 16 00:54:20 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Access.pm (list_access_check): Log access variables
 	passed to us.

	* lib/Mj/Resend.pm (_check_mime): Improve logging a bit.

Mon Feb 15 22:03:16 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/List.pm (make_setting): Restructure code for classes
 	taking a time.  Be sure to erase the original class args even if
 	the new class doesn't have args.  For timed classes, save old
 	class data in classarg2.
	(expire_vacation): New function: find all list members set to
 	'nomail' with an expire time and reset them to their previous
 	classes.

	* lib/Majordomo.pm (trigger): Call expire_vacation for each list.

	* lib/mj_cf_data.pl: Fix typo.

Sat Feb  6 17:11:35 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm (_post): Always build complete digest_issues
 	variable, but only increment issue numbers for digests we are
 	sending out.

Fri Feb  5 18:49:16 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm (_post): Add a message indicating what sequence
 	number we're posting.  Also print this out to the session log.

	* lib/Mj/List.pm (flag_set): Add better logging info.

Thu Feb  4 15:46:23 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Deliver/Dest.pm (sendenvelope): Fix precedence problem
 	with sleep delay calculation.

	* bin/mj_email (resend): Strip off mailbox separator before
 	posting.

	* lib/Mj/Deliver/Dest.pm (sendenvelope): Increase number of
 	retries before giving up.

1999-02-04  Jason L Tibbitts III  <tibbs@math.uh.edu>

	* lib/Mj/Deliver/Envelope.pm (DESTROY): Shut down the SMTP
        connection properly.

	* lib/Mj/Deliver/SMTP.pm (QUIT): New method to shut down the
        connection.

Wed Feb  3 17:55:15 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (valid_list): If not 'ALL' or 'GLOBAL',
 	downcase the list name.

	* lib/Mj/CommandProps.pm (command_legal): Downcase the command.

	* lib/Majordomo.pm (substitute_vars): Remove debugging printout.

	* lib/Mj/TextOutput.pm (set): Anchor matches so prevent screwups
        on addresses with dashes in them.

Tue Feb  2 22:10:27 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Digest/Build.pm (idx_subject_author): Renamed from
 	idx_wasilko.

	* lib/Majordomo.pm (get_done): Fix undef warning; don't unlink
 	temporaries if there were none to unlink.

Mon Feb  1 13:09:50 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm (_exclude): Make sure not to try to canonize
 	the user address if it isn't valid.

	* lib/Mj/List.pm (flag_set): An address has no flags set if it
 	isn't valid.

	* lib/Mj/Deliver/Envelope.pm (new): Be a bit more tolerant of
 	envelopes with no sender.

	* lib/Mj/Deliver/SMTP.pm (senddata): Don't print anything to the
 	debug log.

	* lib/Mj/Resend.pm (_add_fters): Take a hashref of substitutions
 	and apply them to the fronters/footers before adding.
	(_post): Pass a set of substitutions to _add_fters.

	* bin/mj_resend: Don't include mailbox separator in messages sent
 	to post().

	* lib/Mj/Resend.pm (_ck_tbody_line): Comment out logging; too much
 	verbosity.

	* lib/Mj/Config.pm (parse_attachment_rules): Properly output code
 	for 'deny' action.

Sun Jan 31 16:34:54 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Format.pm (who): Add 'short' mode that just prints the
 	address lists.

	* lib/Mj/Resend.pm (_post): Remove debugging prints.

	* lib/Majordomo.pm (_list_file_get): Big changes; take a hashref
 	to be used as substitutions and call substitute_vars automatically
 	if necessary.
	(substitute_vars): Support the $INCLUDE expansion; take a filename
 	to include and other variables necessary to support a recursive
 	call.

	* lib/mj_cf_data.pl: digest_index_format wasilko renamed to
 	subject_author.

	* lib/Majordomo.pm (get_done): Clean up temporaries.
	(help_start): Call _list_file_get with new arguments to handle
 	substitution internally.

	* lib/Mj/FileSpace.pm (get): Check wantarray status and return
 	just the filename if in a scalar context.

	* lib/Mj/Resend.pm (_post): Adjust for new arguments to
 	list_file_get.  (This is the only place where this is needed.)

Sat Jan 30 15:21:12 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* *: Redo all calls to sub_vars, sub_vars_string to pass the subs
 	hash by reference.
	
	* lib/Majordomo.pm (substitute_vars, substitute_vars_string): Take
 	the subs hash by reference.

	* lib/Mj/Resend.pm (_post): Don't increment issue numbers for all
 	digests, only the digests we're sending out.  Avoid doing any
 	digest processing if we have no digests to send.

Fri Jan 29 00:11:52 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Deliver/Connection.pm (new): Display any errors opening
 	sockets.

	* lib/Mj/Deliver/Sorter.pm (new): Old bug: Somehow forgot to put
 	the filename into $self.

	* lib/Mj/Deliver.pm (deliver): Don't skip folks with class 'all'.

	* lib/Mj/Config.pm (compile_pattern): Make sure $force is defined.

	* lib/Mj/Access.pm (_a_replyfile): Aargh!  Don't delete the
 	replyfile arguments!  We want to keep those around!

	* lib/Mj/Config.pm (parse_digest_issues): Fix stupid bug: forgot
 	to actually give any data to the table parser.

	* lib/Mj/Deliver.pm (_eclass): Fix typo classarg1 -> classarg.
	(deliver): Don't try to deliver if we don't have the class in our
 	delivery list.

	* lib/Mj/List.pm (describe_class): Handle class args.
	(set): Handle class args properly.

	* lib/Majordomo.pm (_show): Pass both classargs to describe_class.

	* lib/Mj/List.pm (make_setting): Handle both classargs properly.
  	Don't make digest superclass; use classargs instead.

	* setup/ask_basic.pl (ask_basic): Use an enum for the umask
 	values.

	* lib/Mj/List.pm (make_setting): Also take the original class and
 	classarg; like the flags, if the setting string doesn't modify
 	them they are returned intact.

	* lib/Mj/Resend.pm (_post): No need to increment the volume number
 	for every post.

	* lib/Majordomo.pm (set): Take only $setting.

Thu Jan 28 20:42:09 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/TextOutput.pm (set): Just pass a setting, not an
 	action/arg pair.

	* lib/Mj/List.pm (set): Call make_setting to do the dirty work.
  	Why duplicate code?
	(make_setting): Handle digest names and types properly.  Put flags
 	at the head of the return lists in case classarg2 is used.

	* lib/Majordomo.pm (_subscribe): Adapt to new make_setting return.

	* postinstall: Generally use the site password everywhere where a
 	password is required.  It's the only password we can know for
 	sure, since the domain owners may have changed their passwords
 	from those originally installed.

	* lib/Mj/Inform.pm (_inform_owner): Fix very long-standing typo.
  	Add $STATDESC expansion to give textual description of completion
 	status.

Wed Jan 27 21:39:09 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/List.pm (describe_class): Improve description of digest
 	types.

	* bin/mj_email (forward_to_owner): Remove errant mailbox
 	separator from the message.

	* lib/Mj/MTAConfig.pm (add_alias): Fix typo.

Tue Jan 26 21:15:36 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (help_start): If an unknown help topic is
 	requested, first look for "help/unknowntopic" before returning an
 	error.

	* lib/Mj/TextOutput.pm (help): Change default help topic to
 	"help".

	* lib/Mj/Config.pm (compile_pattern): Add method of forcing
 	undelimited patterns into proper patterns with either substring or
 	exact match semantics.
	(parse_attachment_rules): Call compile_pattern to get a regexp out
 	of the MIME-type argument.

Mon Jan 25 23:39:50 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/MTAConfig.pm: Add beginnings of qmail code.  Not actually
 	enabled yet.

	* lib/Majordomo.pm (substitute_vars_string): Allow \$ and \\
 	escapes.  Fix up help files to double backslashes where necessary.

Sun Jan 24 23:01:47 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* Makefile.PL: Big split: move Q&A stuff out into separate files.

	* postinstall (do_default_config): Mistakenly used site_password
 	where master_password belonged.  Remove query routines and use the
 	sile split from Makefile.PL.

Sat Jan 23 18:17:11 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Access.pm (_a_default): 'closed' access means deny, not
 	consult.

	* lib/Majordomo.pm (show): Add security; split off _show function.
  	Remove address validity testing; the dispatcher does that for us.

	* lib/Mj/Format.pm (show): Handle stalled shows.

	* lib/Majordomo.pm (which): Stalled requests have $mac_hits < 0,
 	but this wasn't handled correctly.

Thu Jan 14 00:30:19 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (_register): Generate a password if the one
 	passed in is empty or undefined.

	* lib/Mj/TextOutput.pm (register): Random password is the default;
 	must use 'password' mode to supply a password.

Wed Jan 13 00:29:48 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* postinstall: Call do_default_config properly to get reasonable
 	defaults that don't override domain owners' configurations.

Mon Jan 11 00:49:44 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* postinstall (do_default_config): New function; fill in
 	appropriate defaults from initial configuration instructions.

	* lib/Mj/List.pm (_fill_aux): The suffix representing the database
 	backend is not part of the sublist name.

	* lib/Mj/Config.pm: Remove require of defaults.

Sun Jan 10 00:42:03 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm (_post): 'default_digest' isn't a real digest.

	* lib/Mj/TextOutput.pm (configshow): Handle automatic array
 	variables properly.

	* lib/Mj/Resend.pm (_post): Mods to maintain digest_issues and to
 	include volume/issue when building digests.

	* lib/Mj/Config.pm (parse_digest_issues): New function.
	Addition of digest_issues to various tables.

	* lib/mj_cf_data.pl: Add digest_issues variable.

	* lib/Mj/Resend.pm (_post): Really delete tempfiles.

	* lib/Majordomo.pm (_rekey): Don't explicitly skip the GLOBAL
 	list; let the list itself do what's appropriate.

	* lib/Mj/List.pm (rekey): Don't rekey the GLOBAL list.

	* lib/Majordomo.pm (_rekey): Don't try to rekey GLOBAL.

Sat Jan  9 12:45:17 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Digest/Text.pm (done): Clean up stale entities.

	* lib/Mj/Digest/Index.pm: Fix perl 5.004 warnings.

	* lib/Mj/Digest/MIME.pm: Ditto.

	* lib/Mj/Resend.pm (_post): Unlink some files.

	* lib/Mj/CommandProps.pm: rekey doesn't take a list.

	* lib/Mj/TextOutput.pm (rekey): Ditto.

	* lib/Mj/Format.pm (rekey): Ditto.

	* lib/Majordomo.pm (_re_match): Fix fypo.
	(auxremove): Fix typo.

	* lib/Mj/List.pm (subscriber_rekey): Update to properly transform
 	using Mj::Addr.
	(aux_rekey): Ditto.

Fri Jan  8 00:19:40 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/MTAConfig.pm (add_alias): Fix dumb typo; meant vutfile,
 	wrote aliasfile.

	* lib/Mj/Format.pm (lists): Remove length limit; just show it all
 	if that's what they want.  Add some blank lines between lists in
 	the long output modes.

	* lib/Mj/Resend.pm (_post): Big changes to accommodate digest
 	generation.  Now working!

	* lib/Mj/Deliver.pm (deliver): Remove some debug stuff.

Wed Jan  6 23:33:44 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* postinstall (set_script_perms): Change mode of top level
 	installation directory as appropriate.  Make sure that it is
 	properly readable by everyone.

Mon Jan  4 20:16:17 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Token.pm: Add REQUESTOR to substitute the same as
 	REQUESTER in various files.

Sun Jan  3 21:34:25 1999  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (which): For substring search, compile into a
 	substring pattern implicitly and always do the database search by
 	regexp.

Wed Dec 30 13:23:59 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (_list_file_get_string): New function: return a
 	file in a string.

Tue Dec 29 12:28:12 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (archive): Pass in $tmpdir.

Mon Dec 28 14:30:24 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (archive): Tweaks to handle returns from new
 	digest building functions properly.

	* lib/mj_cf_defs.pl: Change default for digest_index_format to
 	'subject'.

	* lib/mj_cf_data.pl: Change name of plain index format from
 	'default' to 'subject'.

	* lib/Mj/List.pm (is_subscriber, set): Fix strict errors.

	* lib/Mj/Digest/Build.pm (build): Interface with separate digest
 	construction modules.

	* lib/Mj/Digest/MIME.pm: New file: encapsulate a MIME digest.

Mon Dec 21 23:08:56 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Config.pm (parse_taboo_body): Start $max off at -1; the
 	first round through the loop sets it to 0 if it's unset.  This
 	avoids the problem of an empty check causing a run through the
 	entire body, allowing a nice optimization for the default case.

	* lib/Mj/Resend.pm (_r_ck_body): Fix bug skipping body check when
 	$max (max line to check) is 0.

Wed Dec 16 19:12:07 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Config.pm (parse_taboo_body): Start with $max = -1; this
 	is a true value but since we never hit line -1 the result will be
 	that we don't check at all.  Can't use 0 because that means
 	unlimited.  The first time through the loop this gets set to 0 or
 	whatever value was specified in the match line.

Tue Dec  1 17:59:11 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/mj_cf_data.pl: default_lists_format - s/extended/enhanced/g.

Mon Nov 30 20:46:23 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Parser.pm (parse_part): Make signature separator
 	configurable.

	* lib/mj_cf_defs.pl: Add default for 'signature_separator'.

	* lib/mj_cf_data.pl: Add 'signature_separator' variable.

Sun Nov 29 00:24:12 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/mj_cf_defs.pl: Added defaults for 'allowed_flags',
 	'allowed_classes' and 'default_class'.  Change default for
 	'default_flags'.

	* lib/mj_cf_data.pl: Added 'allowed_flags', 'allowed_classes' and
 	'default_class' variables.

	* lib/Mj/Resend.pm (_exclude): Fix typo.
	(_exclude): Make $exclude a hashref.

	* lib/Mj/Deliver.pm (_setup): Fix bug when generating exclude
 	hash.

	* files/INDEX.pl: Reflect name change regexp => patterns.

	* lib/Mj/Resend.pm (_exclude): New function: build up the exclude
 	list.

	* lib/Mj/List.pm (flag_set): Stash the flags in the address and
 	skip database retrieval if present and the new force parameter is
 	not true.
	(is_subscriber): Clean up; always needs to return list data
 	instead of just truth value.  Cache data and use cached data when
 	possible.

Sat Nov 28 00:03:32 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm (_post): Make sure the subject_prefix never
 	shows up in the archive copy.
	(_reply_to): New function: add the appropriate Reply-To: header.

	* lib/Mj/Deliver.pm (deliver): Remove debugging code.

	* t/addr.t: Add stripping tests.

	* lib/Mj/Addr.pm (_parse): We allow _validate to return a negative
 	number to indicate failure, so that we can also use it in another
 	sense.
	(_validate): When multiple addresses are detected, return a
 	special value, the usual error message, the portion on the left of
 	the comma and the portion on the right.
	(_validate): Make sure we don't return the comma.
	(_validate): Strip whitespace from front of the address; there's
 	no sense in having it.

	* lib/Mj/Deliver.pm (deliver): Deal with 'any' class.

	* lib/mj_cf_data.pl: Fix typo.

	* lib/Mj/Resend.pm (_post): Call delivery routine properly.

	* lib/Mj/MailOut.pm (deliver): Adapt to new Mj::Deliver calling
 	convention.

Fri Nov 27 02:05:24 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Deliver.pm (_eclass): New function: figure out the
 	extended class name given a piece of data from te subscriber
 	database.

	* lib/Mj/Archive.pm (expand_date): Adapt to new behavior of
 	get_matching.

	* lib/Mj/SimpleDB/Text.pm (get_matching): When matching against a
 	codered, pass it the key as well as the data.

Thu Nov 26 13:59:58 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Deliver/Sorter.pm (new): File as second argument.

	* lib/Mj/Deliver/Prober.pm (new): Add file as second argument.

	* lib/Mj/Deliver/Dest.pm (new): Takes optional third argument: the
 	file to distribute.  This makes things easier for the higher-level
 	parts of the delivery engine.

Wed Nov 25 00:38:08 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Deliver.pm (deliver): Begin multiple-class rewrite.

Mon Nov 23 00:36:07 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Deliver.pm (deliver): Fix all calls to _re_match; get rid
 	of Safe object.

	* lib/Majordomo.pm (lists): Make compact mode prefer description
 	over description_long[0].

	* lib/Mj/List.pm: Add 'prefix' and 'replyto' flags.

Sun Nov 22 12:15:59 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Deliver.pm (deliver): Call the one true regexp matching
 	routine.

Sat Nov 21 12:51:27 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm: Bump version in preparation for snapshot.

Fri Nov 20 22:37:38 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_email (connect_and_parse): Send the user along with the
 	connect request; if the result is not favorable, exit gracefully
 	and quietly.

	* lib/Majordomo.pm (connect): Take a user (default to anonymous)
 	and return the stripped version if the caller wants it.  If the
 	passed address is not legal, return 'undef' for a session ID.

	* bin/mj_email (connect_no_parse): Send an anonymous user along
 	with the connect request.

Tue Nov 17 00:06:34 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Config.pm (compile_pattern): Add shell-like patterns.

	* Makefile.PL (configure): Fix typo.

	* lib/Mj/Addr.pm (match): Make sure addresses being compared are
 	valid and not anonymous.

	* lib/Mj/MailOut.pm (deliver): MTA is now in the site config.

Mon Nov 16 15:40:58 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm (_subject_prefix): New function; isolate
 	subject prefix manipulation.
	(_post): Call it.

	* lib/Mj/Format.pm (which): Clean up returned message.

	* lib/Majordomo.pm (which): Now takes general pattern.

	* lib/Mj/Config.pm (parse_taboo_body): Call compile_pattern to get
 	generic pattern support and error checking.  Make sure uncompiled
 	pattern is displayed in bounce message.
	(parse_taboo_headers): Ditto.
	(_compile_rule): Fail when parsing the pattern if $ok is false,
 	not if $err is true.

	* lib/Majordomo.pm (list_config_set): Pretty up error message.

	* lib/Mj/Config.pm (_compile_rule): Call compile_pattern to check
 	the regexp.  Accept both supported delimiters, and pattern
 	modifiers.

Sat Nov 14 15:54:59 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Config.pm (parse_delivery_rules): Allow generalized
 	patterns in address matchers.

	* lib/Mj/List.pm: Some general removal of old single-directory
 	stuff.

	* lib/Mj/SimpleDB/Text.pm (lookup_quick_regexp): Restructure; take
 	an additional flag: if ew got a hit but the regexp didn't match
 	the key then write the match back.

	* lib/Mj/SimpleDB/Base.pm (lookup_regexp): Pass that flag on.

	* lib/Mj/SimpleDB/Text.pm (remove): Pass a special flag to make
 	lookup_quick_regexp write back false matches.

	* lib/Majordomo.pm (_auxremove): Return the stripped address,
 	since that's the only thing we stored.

Fri Nov 13 01:03:17 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (who_start): Only parse the regexp if one was
 	given.
	(unsubscribe): Rewrite to properly parse addresses and general
 	patterns.
	(auxremove): Rewrite to mirror unsubscribe.  Now includes access
 	checking.

	* lib/Mj/CommandProps.pm: auxremove must be marked 'noaddr'
 	because it can take a regexp as a victim.

Thu Nov 12 00:33:44 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* bin/mj_email: Abort if Majordomo->new returns a string.

	* lib/Mj/Config.pm (compile_pattern): Allow more than one
 	modifier.

	* lib/Mj/TextOutput.pm (who): Modify to properly pass the compile
 	RE that the core passes back to us.

	* lib/Mj/Config.pm (parse_regexp): Major changes to accept
 	patterns and return true Perl regexps.  The 'regexp' type is now
 	parsed.
	(parse_regexp_array): Call parse_regexp; return arrayref of parsed
 	regexps.
	(compile_pattern): New function.
	(parse_regexp): Move all interesting functionality to
	compile_pattern, which is callable from external code.
	
	* lib/Mj/Access.pm (_d_advertise): Adjust to advertise and
 	noadvertise being parsed arrays (i.e. config_get returns
 	arrayrefs).  Do comparisons on stripped addresses.

Wed Nov 11 18:10:58 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/FileRepl.pm (open): Be even safer: nondestructively
 	create the file if it doesn't exist.

	* lib/Mj/Config.pm (parse_regexp): Call Mj::_re_match properly.

        * Rememberance Day: Lest we forget.

Tue Nov 10 00:36:26 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* postinstall (make_alias_symlinks): If requested, make symlinks
 	from an appropriate root-owned place to the generated alias and
 	vut files.

	* lib/Majordomo.pm (is_subscriber): Fix typo.

Mon Nov  9 17:40:44 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* postinstall (do_site_config): Push various MTA options into the
 	site config.

	* lib/Majordomo.pm (_reg_lookup): Invalid or anonymous addresses
 	are never registered.

	* lib/Mj/List.pm (is_subscriber): Invalid or anonymous addresses
 	are never subscribers.
	(aux_is_member): Was very crusty; should be reasonable now.

	* bin/mj_confirm: When an address is required, use
 	'unknown@anonymous' (i.e. an anonymous address) so we can still
 	extract information.  This address is special cased as being
 	valid.

	* lib/Mj/Addr.pm (isanon): New function.
	(new): Deal with anonymous addresses.

	* lib/Majordomo.pm (_get_stock): Quiet $undexflags undef warning.
	(dispatch): Clean up and bring sanity to address validation.

	* postinstall (do_config): Make the spool directory inside of the
 	filespace.  Also make the public directory.

Fri Nov  6 18:17:18 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (connect): Untaint session ID; it is generated
 	in part by tainted data, but the chances of this being used to
 	influence the session key is negligible.

Thu Nov  5 20:03:09 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* postinstall (create_dirs): Errantly removed code to make the
 	spool directory.  Bad.

Wed Oct 28 10:27:26 1998  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Mj/MTAConfig.pm (add_alias, regen_aliases): Restrict umask
        when writing out aliases.

	* lib/mj_cf_data.pl: Update description of te 'debug' variable.

	* lib/Mj/MTAConfig.pm (add_alias): Use actual value of debug parameter.

Tue Oct 27 19:20:07 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/MTAConfig.pm (sendmail): Quiet Perl 5.004 warnings.

	* lib/Majordomo.pm (_createlist): Quiet Perl 5.004 warnings.

Sat Oct 24 18:52:51 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* postinstall (do_config): Set 'whereami' before setting 'whoami'.

	* lib/Mj/MTAConfig.pm: Add MTA-specific header info.

	* lib/Mj/Format.pm (createlist): Remove $head.

	* lib/Majordomo.pm (_createlist): Remove MTA config header
 	altogether.

	* lib/Mj/MTAConfig.pm (regen_aliases): Do the right thing if the
 	alias file is not automatically maintained.
	(regen_aliases,add_alias): Remove the header altogether.

	* lib/Mj/Format.pm (createlist): Remove multiformatting.
  	Simplified drastically.

	* lib/Mj/TextOutput.pm (createlist): Remove multiformatting; can
 	only create one list at a time now.

Fri Oct 23 16:28:29 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* postinstall (do_site_config): Save 'maintain_aliases' variable
 	in the site config.
	(suggest_mta): Call createlist-regen, don't pass owner.
	(do_config): Configure the GLOBAL owner now, too.

	* Makefile.PL (configure): Ask if sendmail aliases should be
 	maintained.
	(get_enum): New function: accept only one of a list of strings.

	* postinstall (create_dirs): Create directory to hold aliases.

Thu Oct 22 20:11:13 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (createlist): Don't do so many verifications if
 	mode is 'regen'.

Wed Oct 21 23:52:50 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (createlist): Remove special properties of
 	'ALL' list.

Mon Oct 19 19:08:59 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Format.pm (createlist): Don't print out headers and alias
 	blocks if none were returned from the core.

	* lib/Mj/Digest.pm (_open_state,_close_state): Add logging so we
 	can see how long this is taking.

Sat Oct 17 13:30:06 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* installbin: Take 'startperl' from .mj_config instead of from
 	Config.pm.  Prepend '#!' to it.

	* Makefile.PL (get_file): Sprice up prompting a bit.  Add 'force'
 	parameter which forces the file to exist or be executable.
	(configure): Check for startperl; default from Config.pm but warn
 	if it's bogus.

	* lib/Mj/MTAConfig.pm (sendmail): Add debugging info if 'debug'
 	argument is true.

Fri Oct 16 15:52:47 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* Makefile.PL (configure): Check for version of stored config file
 	and force a reconfiguration if necessary.

	* lib/Majordomo.pm: Bump version number in preparation for
 	snapshot.

	* postinstall (do_config): Use the site password to init the
 	individual master_passwords.  This means that you can change the
 	master_passwords at install time, and that we can avoid that
 	single failure at the begging on non-fresh installs.

	* lib/Mj/Digest.pm (_open_state): Fix problem when loading daved
 	data with nested references.
	(choose): Keep track of 'lastrun' time properly.
	Declare $VAR1 as a package global to prevent failures when
 	autoloading is off.

Thu Oct 15 19:22:11 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Config.pm (parse_digests): Redo to accept new element
 	order.

	* lib/mj_cf_data.pl: Redo 'digests' description; reorder elements
 	to that little-used and wizardly elements go on the end where they
 	can be left off.

	* lib/Mj/Digest.pm (_close_state): Turn on Data::Dumper::Purity
 	flag so the nested references don't get destroyed.

	* lib/Mj/Config.pm (_str_to_clock): Fix stupid typo.

	* lib/Mj/Digest.pm (decide): Fix undef warning.

	* lib/mj_cf_defs.pl: Change 'digests' default back to an empty
 	listref; this is the _unparsed_ version, so a hashref is
 	definitely not appropriate.

Wed Oct 14 16:51:35 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Archive.pm (_secs_start,_secs_end): Take 'local'
 	parameter and return a seconds count based on the date being in
 	local time if true.
	(expand_date): Call _secs_* with a true 'local' parameter.

	* Various: turn autoloading back on.
	
	* lib/Mj/Digest/Build.pm (build_mime): Print the message number
 	instead of the raw message, which might be a listref instead of a
 	string.
	
	* lib/Mj/Resend.pm (_post): Allow for the possibility of an
 	undefined subject.
	(_post): Unfold the archive header to prevent newlines from
 	sneaking in.

Tue Oct 13 15:53:46 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Majordomo.pm (config_get_vars): Neglected to make Mj::Addr
 	object.

	* lib/Mj/Digest.pm (_open_state): Need to use Data::Dumper before
 	we can dump the state.

	* lib/Mj/Resend.pm (_post): Check to see that 'digests' is non-nll
 	before trying to pass the archive data to the digestifier.

	* lib/Mj/Archive.pm (add): Return the complete message name, not
 	just the number within the current archive.

Mon Oct 12 17:18:14 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Config.pm (parse_digests): Initialize some parts of the
 	parsed structure.

	* lib/Mj/List.pm (digest_build): Rename from build_digest.

	* lib/Mj/Resend.pm (_post): Call deliver with new args.

	* lib/Mj/MailOut.pm (deliver): Take exclude list as a listref now.
	Put class at end of arglist.
	
	* bin/mj_shell (completer): Tighten up spece requirements when
 	completing config variables.  Fix report by RSW.

Sun Oct 11 22:24:09 1998  Jason L Tibbitts  <tibbs@morpheus.math.uh.edu>

	* lib/Mj/Resend.pm (_post): Get rid of high pripority class.

	* lib/Mj/Digest.pm (add): Update all state information and call
 	the trigger.
	(decide): New function: decide based upon configured digest data
 	and state whether or not to push a new digest.
	(choose): New function: choose which of the waiting messages
 	should be in the new digest.

Wed Oct  7 17:35:11 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Digest.pm (in_clock): New function: is a time in a clock
 	list or not.

	* lib/Mj/Config.pm (parse_digests): Revise parsing of 'digests';
 	eliminate runall and use 'separate' instead.

	* lib/mj_cf_data.pl: Revise description of 'digests'.

Tue Oct  6 09:29:53 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (_post): Reorder so that message is added to
 	archive before message_headers is added; this lets us provide the
 	archive number to message_headers for expansion.

	* lib/Mj/Archive.pm (get_message): Now accept a hash filled out
 	with data; if it exists, don't bother going to the index.
	(expand_date): New function: find all article names and data
 	posted in a given year/month/week/day.
	(_secs_start, _secs_end): New functions: find seconds count of
 	beginning and end of date interval.

Mon Oct  5 21:18:29 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Archive.pm (get_data): Clean up.

Sun Oct  4 09:52:57 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/SimpleDB/Text.pm (get_matching): Add coderef
 	functionality.

	* lib/Mj/Resend.pm (_post): Use $arcent, $archead to extract
 	information about the message about to be archived, instead of
 	using the entity that is posted.
	(_post): Forgot to strip newlines from the subject before passing
 	to archive.

	* lib/Mj/Archive.pm (new): Typo: $size can be unlimited, not
 	$split.

	* Makefile.PL: No longer check for HTML::Stream.

	* bin/mj_confirm (escape): Remove requirement for
 	HTML::Stream::html_escape.

	* lib/Mj/TextOutput.pm (put): Fix undef warning when no
 	description is given.

	* Makefile.PL (MY::postamble): Add some warnings about AutoSplit
 	messages.
	(MY::postamble): 

Sat Oct  3 10:28:16 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* Makefile.PL: Now require Time::Local.  Should come with perl,
 	but check anyway.

	* lib/Mj/Digest/Build.pm (idx_wasilko, idx_default): Replace empty
 	subjects with '(no subject)'.

	* postinstall (do_site_config): Fix message typo.

	* lib/Mj/Digest/Build.pm (build_index): New function: build an
 	'index' digest, containing just index lines and no mnessages.

	* lib/Mj/Archive.pm (get_data): New function: just return info
 	about a message.

	* lib/Majordomo.pm (archive): Pass in appropriate type.

	* lib/Mj/List.pm (build_digest): Use and call Mj::Digest::Build.

	* lib/Mj/Digest/Build.pm: New file: hold functions that build
 	digests out of an archive and a list of messages, plus functions
 	to generate index lines.
	(build): Select build function from the passed-in type.

	* postinstall (set_script_perms): Open permissions on wrappers
 	slightly to allow them to be copied on machines where root can't
 	open a mode 0111 file.

Thu Oct  1 17:45:23 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Archive.pm (last_n): Fix dumb bug; stop if we popped all
 	previous archives.

	* lib/Majordomo.pm (archive): Pass appropriate information to the
 	digest engine.

	* lib/Mj/List.pm (build_digest): Now just pass in the arguments as
 	given.

	* lib/Mj/Digest.pm (idx_default): Just a plain subject listing.
	(idx_wasilko): A fancier listing of authors and subjects.
	(build_mime): Call the appropriate index formatter.  Use the
 	passed-in index fronter, footer, and subject.

	* lib/Mj/Archive.pm (expand_range): Expand a 1 to 3 digit count to
 	a list of the last N messages.

	* lib/mj_cf_data.pl: Add new variable 'digest_index_format'.

	* lib/Mj/List.pm: Move use AutoLoader down near the _END_ tag.

Wed Sep 30 16:55:40 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (_list_config_set): The type of the
 	master_password variable is 'pw' not 'password'.  Also compare
 	against 'passwords' to catch sub-password changes.

	* lib/Mj/Parser.pm (parse_part): Fix typo.

	* postinstall (do_config): Don't print errors a second time if in
 	verbose mode.

	* lib/mj_cf_data.pl: Fix typo in max_header_line_length.  Make
 	description_long mutable.

Tue Sep 29 00:11:39 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/TextOutput.pm (archive): Split arguments on spaces.

	* lib/Majordomo.pm (new):
	  (substitute_vars):
	  (tempname): 
            Make $tmpdir a package global.

Mon Sep 28 21:11:28 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Archive.pm (get_to_file): New function: extract a message into a file.

	* lib/Majordomo.pm:
	  (substitute_vars): 
	  (unique): 
	* lib/Mj/Token.pm (t_accept): 
	* lib/Mj/TextOutput.pm (configshow): 
	* lib/Mj/Resend.pm (post_start): 
	* lib/Mj/Parser.pm (parse_entity): 
	* lib/Mj/MailOut.pm (mail_entity): 
	  (welcome): 
	  (owner_start): 
             Make $unique a package global.

Thu Sep 24 22:39:19 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* bin/mj_shell: Die if Majordomo::new gave back a string instead
 	of a reference.

	* lib/Majordomo.pm (new): Return some errors (in the form of
 	strings) if $topdir or $domain don't exist.

Wed Sep 23 00:16:10 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Inform.pm (inform): Change format of log to use \001 as
 	the separator.

	* lib/Mj/Format.pm: Return the core return value, not just 1 or 0.
	(g_sub): Keep track of successes, failures, etc and return an
 	appropriate aggregate value at the end.

	* lib/Mj/Parser.pm (parse_part): Get four-valued return from
 	formatting Formatting routine (by way of TextOutput routine) and
 	keep track of the exact value.

	* lib/Mj/Archive.pm (add): Various changes; archive count is
 	separated a dash from the rest of the archive name.

Tue Sep 22 18:21:21 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/FileRepl.pm (search_copy): Use _re_match in Majordomo.pm.

	* lib/Mj/File.pm (search): Use _re_match in Majordomo.pm.

	* lib/Mj/TextOutput.pm (g_remove): Remove debugging warning.
	(archive): New function.

	* lib/Mj/Access.pm (_d_password): Fix dumb comparison error.

Mon Sep 21 00:13:06 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Archive.pm (get_message): Keep track of retrieved byte
 	count so the caller can't suck past the end of the message.

	* lib/Mj/List.pm (archive_get_start, archive_get_chunk,
 	archive_get_done): New functions.

Sun Sep 20 11:16:24 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/CommandProps.pm: Change default actions for unreg and
 	unsub to 'confirm'.

	* files/en/help/commands: Added register, unregister and tweaked
 	some instructions.

	* lib/Mj/Format.pm (g_sub): Deal with 'unregistered' action.

	* lib/Majordomo.pm (unregister): New function; remove a user from
 	the reg database and all lists.

	* lib/Mj/TextOutput.pm (g_remove): Take $type as 1st arg; use it
 	to determine which removal function to use.
	(auxremove, unsubscribe): Call g_remove with proper type.

	* lib/Mj/CommandProps.pm: Added definition of unregister command.

	* lib/Majordomo.pm,lib/Mj/Access.pm,lib/Mj/Config.pm,lib/Mj/MailOut.pm,
	* lib/Mj/TextOutput.pm,lib/Mj/Token.pm:
 	Turn on AutoLoader.

	* lib/Majordomo.pm: Bump version number for snapshot.

	* t/shell.t (run): Remove test setting MTA.  Use 'quiet' mode of
 	password command to avoid sending useless mail.

	* postinstall (do_config): Display errors during mj_shell
 	execution.  Don't install variables moved into site config.

	* lib/Mj/Access.pm (_build_passwd_data): Add in site_password
 	values, with return '5'.

	* lib/Majordomo.pm (new): Load in the stock index file.

Sat Sep 19 00:45:21 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/mj_cf_data.pl: Remove mta, lists_dir and install_dir;
 	they're now in the site config.

	* lib/Majordomo.pm (_list_file_get): Modify default search list to
 	look in STOCK, and call _get_stock as appropriate.
	(new): Load the site config file.
	(_site_config_get): New function.
	(_createlist): Call _site_config_get instead of _global_config_get
 	for varions site-specific variables.

	* lib/mj_cf_data.pl: Modify description of file_search.

	* Makefile.PL (configure): Prompt for site password.

	* postinstall (create_dirs): Make the SITE and SITE/files
 	directories.

	* lib/Majordomo.pm (new): Add 'sitedir'.
	(_get_stock): New function; pull a file out of stock storage.

Fri Sep 18 00:29:12 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* README.UPGRADE: Minor tweak in the instructions.

	* lib/Majordomo.pm: Bump version number.  Snapshot time!

Thu Sep 17 01:29:10 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/TextOutput.pm (put): Chunk lines together instead of
 	putting them one at a time in an attempt at optimization.

	* files/INDEX.pl: Added en/help/admin, en/help/regexp.

	* files/en/help/admin,files/en/help/regexp: New files.
	
	* files/en/help/topics,files/en/help/commands,
	* files/en/help/admin_commands:
 	Updated to WRD's latest submissions.

Wed Sep 16 00:10:05 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* postinstall (install_response_files): Split the file
 	installation up into manageable chunks, so as to not exceed any
 	open files limits.
	Pay attention to MAXFILES env variable.

	* lib/Majordomo.pm (_re_match): Use $_ as the comparison string,
 	since it's already local and shared.  Simplify the reval'ed
 	string.

	* lib/Mj/SimpleDB/Text.pm (_re_match): Change to Majordomo
 	version.
	(new): Create a safe compartment in the package like Majordomo.

	* lib/Majordomo.pm (_re_match): Give better warning on bad
 	regexps.

Tue Sep 15 23:36:08 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/List.pm (check_dup): Fix tainting bug.

Mon Sep 14 00:44:27 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (_subscribe): Adding 'password' function made
 	"{password}" ambiguous.  Sigh.
	(_reg_add): Fix update/replace confusion.

	* lib/Mj/Access.pm (_d_advertise): Clean up; call _a_allow or
 	_a_deny as appropriate instead of returning magic variables.
	(_a_denymess): New function to deny and return a message.
	(_d_password): New function: default access controls for password.

	* lib/Majordomo.pm (_subscribe): Generate the password.
	(_register): Ditto.
	(_reg_add): Don't generate passwords here.
	(password): New function: change a registered user's password.

	* files/INDEX.pl: Add 'new_password' file.

	* lib/mj_cf_data.pl: Add 'password_min_length'.

	* lib/Mj/Format.pm (password): New function; show output of
 	password function.

	* lib/Mj/TextOutput.pm (password): New function; let user change
 	their password.

	* lib/Mj/CommandProps.pm: Add password command entry.

Sun Sep 13 02:09:14 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (_r_ck_body): Majordomo::_re_match doesn't need
 	a safe compartment.
	(_describe_taboo): Make sure $match is defined before modifying
 	it.

	* lib/Mj/Token.pm (consult): Missed a %~%.

	* lib/Mj/Parser.pm: Import necessary CommandProps functions and
 	unqualify the relevant function calls.

	* lib/Mj/Access.pm (_a_default): Convert to calling
 	Mj::CommandProps::access_def to access default actions instead of
 	using locally defined variables.

	* lib/Mj/Config.pm: Remove %requests; call CommandProps functions
 	instead.  Replace all references to %requests with appropriate
 	calls.
	(_compile_rule): Give more useful message for illegal variables.
	(parse_access_rules): Give more useful message for illegal
 	requests.

Sat Sep 12 14:06:54 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/TextOutput.pm (auxadd): Renamed from auxsubscribe.
	(auxremove): Renamed from auxunsubscribe.

	* lib/Mj/List.pm (remove): Clean up.
	(aux_add): Ditto.
	(add): Ditto.
	(rekey): Ditto.
	Remofe dead aliasing stuff.

	* lib/Mj/Parser.pm: Use CommandProps instead of loading
 	parser_data.pl.

	* bin/mj_shell: Change command_(legal|property) to
 	Mj::CommandProps::command_(legal|prop).

	* lib/Mj/Parser.pm: Ditto.

	* lib/Mj/CommandProps.pm: New file: replace parser_data.pl with
 	something encompassing all relevant command data.

Fri Sep 11 18:23:01 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* t/db.t: Unlink the proper lockfile.

Thu Sep 10 00:10:08 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (_reg_add): Reference _gen_pw in its package.
	(_subscribe): Switch order of list add and registry add, since the
 	former will bomb if the address already exists.

	* general: Global change from magiv %~% separator to \002.

	* lib/Mj/SimpleDB/Text.pm: Change all uses of \t to \001.

	* lib/Mj/SimpleDB/Base.pm (_stringify): Use \001 as separator, not \t.
	(_unstringify): Ditto.

	* lib/Majordomo.pm (auxadd): Cleanup.

	* lib/Mj/Access.pm (validate_passwd): Make sure we have some
 	registration data before comparing.
	(_a_default): No need to ever confirm if user_password is true.

Wed Sep  9 00:16:02 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Access.pm (list_access_check): Remember to check against
 	the _victim's_ password.
	(_d_subscribe): Handle the case of a valid user password; don't
 	bother confirming.

	* lib/Mj/Config.pm: Add 'user_password' as a legal variable
 	appropriately.

	* lib/Mj/Access.pm (list_access_check): Set 'user_password' and
 	'master_password' flags correctly given the return from
 	validate_passwd.

	* lib/Mj/Resend.pm (_check_approval): Expect positive result from validate_password.

	* lib/Majordomo.pm (dispatch): Expect positive result from
 	validate_password.
	(list_config_get): Ditto.
	(list_config_set): Ditto.
	(list_config_set_to_default): Ditto.
	(config_get_default): Ditto.
	(config_get_vars): Ditto.

	* bin/mj_shell: Fix undef warning.

	* lib/Majordomo.pm (_reg_lookup): Add 'cache' parameter to serve
 	from cached data if available.

	* lib/Mj/Access.pm (_build_passwd_data): Instead of '1', set
 	values dependent on master and GLOBAL access.
	(validate_passwd): Restructure; return the value stored in the
 	hash instead of '1'.
	(_gen_pw): Moved from Majordomo.pm (which is too long).

	* general: Global replacement from password_valid to
 	master_password, to make room for user_password.

Tue Sep  8 09:53:46 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (_request_response): Fix $desc booboo.
	(substitute_vars_string): Match at end of string as well as on
 	word boundary.

	* bin/mj_email (connect_and_parse): We can't call addr_validate
 	because it no longer exists.  Don't bother trying to validate the
 	address; if it is invalid, the core will scream and the end result
 	will be the same.

	* lib/Majordomo.pm (connect): The post method doesn't need
 	validated addresses.

	* lib/Mj/Resend.pm (post): Make a new Addr object after extracting
 	the user from the headers.

Mon Sep  7 12:26:34 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (help_start): Untaint the topic.

	* lib/Mj/Format.pm (index): Show language in long output.

	* lib/Mj/FileSpace.pm (index): Return the language.

	* lib/Majordomo.pm (_get_mailfile): Don't send the full pathanme.

	* lib/Mj/Token.pm (consult): Include language when spooling.

	* lib/Mj/FileSpace.pm (put_start): Take $lang.

	* lib/Majordomo.pm (put_start): Take $lang.

	* lib/Mj/TextOutput.pm (put): Pass in the language.

	* lib/Mj/Inform.pm (_inform_owner): Forgot to add a
 	Content-Language header.

	* lib/Majordomo.pm (_get): Untaint the file name.

Sun Sep  6 11:49:17 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/FileSpace.pm (put): Accept a language.

	* lib/Mj/Access.pm (_d_post): Fix typo.

	* lib/Mj/Inform.pm (_inform_owner): Deal with _list_file_get
 	changes.

Sat Sep  5 17:22:56 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Token.pm (confirm): Deal with _list_file_get changes.

	* lib/Mj/Access.pm (_a_replyfile): Deal with _list_file_get
 	changes.
	(_a_mailfile): Ditto.

	* lib/Majordomo.pm (_get): Deal with _list_file_get changes.
	(_request_response): Ditto.
	(_index): Deal with FileSpace return value changes.

	* lib/Mj/MailOut.pm (welcome): Deal with _list_file_get changes.

	* lib/Mj/FileSpace.pm (get): Return a hash of data instead of
 	individual data elements.

Fri Sep  4 23:36:01 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* t/shell.t: Adjust to new lists-tiny output.

	* lib/Mj/Format.pm (lists): Take into account categories; change
 	tiny output slightly to remove leading spaces.  (Better for shell
 	scripts that way.)

Thu Sep  3 18:29:23 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (lists): Return the category variable.

	* lib/mj_cf_data.pl: Added the 'catrgory' variable.

	* lib/Mj/Config.pm (parse_access_rules): Restructure a bit to have
 	separate sets of legal actions per request and to orovide the list
 	of legal requests for an action in the event of a parsing error.
	(_compile_rule): No longer needs to pass a Safe object to _re_match.

Tue Sep  1 00:12:14 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Format.pm (which): Fixes to give proper output for large
 	numbers of matches.

	* lib/Mj/SimpleDB/Text.pm (get_matching_regexp): Better log
 	message; call _re_match instead of comparing directly.
	(get_matching_quick_regexp): Ditto.

	* lib/Mj/SubscriberList.pm: Remove fields not needed because of
 	the registration database.

	* lib/Majordomo.pm (who_chunk): When we need to strip out
 	comments, allocate an Mj::Addr and work with it.

	* lib/Mj/List.pm (get_member): Return the canonical form of the
 	address as the key, not the address itself.

	* lib/Majordomo.pm (set): Forgot to make the list.

	* lib/Mj/TextOutput.pm (unalias): Use proper arguments: the victim
 	is the supplied address.

	* lib/Majordomo.pm (_unalias): Return a proper value.

Mon Aug 31 00:04:59 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Token.pm (confirm): Make sure that we pass
 	MIME::Entity::build a string for an address instead of an Addr
 	object; it can't deal with it.

	* lib/Majordomo.pm (alias): Don't generate or pass 'mismatch'.
	(_unalias): New function.
	(unalias): Convert to work with new global alias list and do
 	security checking.

Sun Aug 30 00:04:51 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/parser_data.pl: 'unalias' no longer takes a list.

	* lib/Majordomo.pm (connect): The trigger command doesn't take
 	addresses.

	* lib/Mj/Token.pm (t_info): Untaint the token.

	* lib/Majordomo.pm (set): No need to validate the addresses.
	(sessioninfo): No locking on session files.
	(connect): Ditto.
	(reject): Sessions don't go through the filespace. (How long has
 	this been broken?)

	* lib/Mj/SimpleDB/Text.pm (get_matching): Enclose regexp in '/'
 	delimiters.
	(get_matching_quick): Ditto.
	(replace): Can take a coderef to use to modify the values.  This
 	brings it very close to the mogrify function.

	* lib/Majordomo.pm (_reg_remove): New function to remove a list
 	fron the register entry.

	* lib/Mj/Addr.pm (flush): New function to get rid of cached data.

	* lib/Majordomo.pm (get_all_lists): Pay attention to
 	advertise_subscribed to avoid looking into lists if it isn't
 	necessary.
	(get_all_lists): Convert $user to an addr object.  Since this is a
 	utility function, the dispatcher isn't involved to do this
 	automatically.

	* lib/mj_cf_data.pl: Added advertise_subscribed variable.

	* lib/Majordomo.pm (is_subscriber): Don't assume that the user is
 	registered; return false if we can't find any registration data at
 	all.
	(_reg_lookup): Return undef without caching anything if the user
 	is not registered.
	(_reg_add): Silence warnings.

	* lib/Mj/Addr.pm (_xform): If no transforming to do, copy stripped
 	version to xformed version.  This fixes the test suite.

	* lib/Mj/Access.pm (_d_advertise): Call _re_match properly; no
 	need to create a Safe object.

Sat Aug 29 16:39:08 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* t/shell.t: Change alias test not to use a list.

	* lib/Mj/File.pm (_re_match): New function.
	(search): Use _re_match for safety.

	* lib/Majordomo.pm (new): Create a package global Safe object if
 	necessary, for use in regexp matches.
	(who_chunk): Just use the package global Safe object.
	(_re_match): Don't take a Safe object; use the package global.
	(_re_match): Turn off warnings so that problems in the compartment
 	don't leak.

	* lib/Mj/FileRepl.pm (new): Allocate a package-global Safe
 	compartment if necessary, for regexp matches.
	(_re_match): New function; use the package-global Safe compartment
 	to match regexps.

Fri Aug 28 16:51:06 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Deliver/Envelope.pm (new): Return undef if initial
 	addressing fails.

	* lib/Mj/Deliver/SMTP.pm (getresp): Correct a typo && -> ||

	* lib/Mj/Token.pm (t_accept): Make Addr objects unless the
 	function doesn't take them.

	* lib/Mj/List.pm (remove): Don't make an Addr, just deal with one
 	if we get it (unless we're removing a regexp).

	* lib/Majordomo.pm (unsubscribe): Changes to work with Addr
 	object.  Be careful that if we have a regexp instead of an address
 	for a victim, we don't try to make an Addr out of it.

	* lib/Mj/Access.pm (list_access_check): Don't check for mismatch
 	if its already defined.

	* lib/Mj/List.pm (is_subscriber): Look at any data cached in the
 	address before doing a database lookup.

Wed Aug 26 00:50:05 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (_reg_lookup): New function; look up and cache
 	registration data within an Addr.
	(is_subscriber): New function; check membership to a list but use
 	the data in the registration database instead of consulting the
 	list.  Also make use of any cached reg data.

Sat Aug 22 01:53:10 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/TextOutput.pm (alias): No longer takes a list.

	* lib/Mj/List.pm (get_member): Clean up to handle Addr objects.

Fri Aug 21 00:39:03 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/SimpleDB/Base.pm (_unstringify): Always split out to the
 	last field, avoiding undefs for trailing empty fields.

	* lib/Mj/TextOutput.pm (show): Don't take a list.

	* lib/parser_data.pl: 'alias' and 'show' doesn't take lists any longer.

	* lib/Majordomo.pm (dispatch): Don't do Addr parsing for continued
 	functions, and add 'noaddr' function attribute to turn it off for
 	regular functions.
	(_alias_reverse_lookup): Moved from Mj::List and modified
 	appropriately.

	* files/en/welcome: Now include the user's password.

Thu Aug 20 00:46:26 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/TextOutput.pm (configset): Call formatting routine for
 	better output.

	* lib/Mj/Format.pm (configset): New function.

	* lib/Majordomo.pm (_list_config_set): Rebuild password data if
 	necessary.

	* lib/Mj/Config.pm: Remove rebuild_password nonsense.

	* lib/Majordomo.pm (list_config_set): Call _list_config_set
 	instead of calling the list directly.

	* lib/Mj/Config.pm (parse_enum): Add a better error message.

	* lib/Mj/List.pm (is_subscriber): Use Mj::Addr properly.

	* lib/Mj/MailOut.pm (welcome): Substitute all variables in the
 	subject.
	(welcome): Consolidate substitutions.

	* lib/Mj/Format.pm: Fixed a few hundred warnings due to eprinf
 	calls.

	* postinstall: Add registered file.

	* lib/Mj/MailOut.pm (welcome): Added SITE variable.

Wed Aug 19 17:01:33 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/RegList.pm: Swap changetime and regtime.

Tue Aug 18 00:08:09 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (_gen_pw): New function.  Generate some garbage
 	as a password.

	* lib/Mj/MailOut.pm (welcome): Accept an additional hash of
 	arguments to be directly substituted into the message.

	* lib/Mj/Format.pm (register): New function.
	(g_sub): Add code to deal with registration; redo some spacing to
 	make registration message come out right.

	* lib/Mj/Config.pm: Add register as a legal access routine.

	* bin/mj_shell (parse_interactive): Shorten the prompt a bit.

	* lib/parser_data.pl: Add register as a legal command.

	* lib/Majordomo.pm: Add register command.

Mon Aug 17 00:00:25 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/List.pm (aux_add): Fix Addr problems.

	* lib/Majordomo.pm (alias): No need to construct $mismatch.

	* bin/mj_shell: Print warnings to standard error.

	* lib/Mj/Access.pm (validate_passwd): Properly extrace canonical
 	form of the address.
	(list_access_check): Compare address properly when computing
 	$mismatch.

	* t/addr.t: Deal with new Addr object stuff.

	* lib/Mj/Inform.pm (inform): Make sure addresses aren't undef.

Sun Aug 16 00:42:06 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (createlist): Deal with Addr object.

	* lib/Mj/List.pm (new): Don't take 'av'.

	* lib/Majordomo.pm (_make_list): Don't pass 'av'.

	* lib/Mj/List.pm (add): Make use of the Addr object.
	(remove): Make use of Addr object; don't deal with aliases.

	* lib/Mj/Config.pm (parse_address): Use Addr object.
	(new): Don't take 'av'.

	* lib/Mj/Addr.pm (match): Tweak in case the second argument is not
 	an Addr.

	* lib/Majordomo.pm (new): Allocate the RegList.
	(addr_validate): Removed.

	* lib/Mj/List.pm: Removed all aliasing functions.

	* lib/Mj/Token.pm (t_accept): Convert arguments coming out of a
 	token which are always addresses into Addr objects.  All top and
 	bottom half functions should now be able to assume that the
 	arguments that always hold addresses now hold Addr objects.

	* lib/Majordomo.pm (dispatch): Convert addresses that are always
 	present in the argument lists to Addr objects.

	* lib/Mj/Addr.pm: Add some overloading to lessen the pain of
 	conversion.

	* lib/Majordomo.pm (new): Begin rewrite to use master alias
 	database and new address parsing.

	* lib/mj_cf_data.pl: Remove 'apply_global_addr_xforms' and make
 	'addr_xforms' global only.  The new addess parsing rewrite allows
 	only global transforms.

	* lib/Mj/Addr.pm: Begin bug rewrite to make addresses first-class
 	objects instead of strings that operations are applied to.
	Completed big rewrite, now on to the rest of the code.

Sat Aug 15 16:33:58 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Access.pm (_d_post): Remove 'non-numeric' warning.

	* lib/Mj/Parser.pm (parse_entity): Remove undef warning.

	* lib/Mj/Lock.pm (lock): Don't save master_handle if not doing
 	master locking.

	* lib/Mj/List.pm: Add calls to _make_aliaslist to several alias
 	commands.

	* lib/Mj/RegList.pm: New file to hold registration database.

Fri Aug 14 17:03:15 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* postinstall (suggest_mta): Now create the global list properly,
 	so that the owner is set to the configured value.

	* lib/Majordomo.pm (_createlist): Reorder so that even if te MTA
 	is unsupported a proper configuration is suggested.

Mon Aug 10 00:00:00 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm: Bump version number.

	* bin/mj_trigger: Only expire locks on the daily run.

	* lib/Mj/MTAConfig.pm (sendmail): Use $whoami instead of
 	'majordomo' in constructing default aliases.

	* lib/Majordomo.pm (_createlist): Pass in 'whoami'.

	* postinstall (do_config): Set 'whoami'.

	* Makefile.PL (configure): Ask for 'whoami'.

Sun Aug  9 11:11:26 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* bin/mj_trigger: Add code to expire locks after everything has
 	been closed down and disconnected.

	* lib/Majordomo.pm (list_config_set): Unlock config file after
 	each change by an interface.

Sat Aug  8 11:18:45 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Lock.pm (lock_master): New function; acquire the master
 	lock exclusively.
	Deal with master lockfile as an experiment.

	* lib/parser_data.pl: Added 'man' alias for 'help'.

	* bin/mj_shell (completer): Function to do completion for an
 	interactive mj_shell session.  Does commands, lists, and config
 	variables by calling the appropriate core functions.  Make
 	'noornaments' flag a negatable 'ornaments' flag, add
 	'aliascomplete' flag, and set default values for both of them.
  	Document 'aliascomplete' in manpage.
	(completer): Pay attention to 'aliascomplete'.
	(parse_interactive): Don't take any options; access the %opts hash
 	directly.  (No reason not to.)

	* lib/Majordomo.pm (list_config_set_to_default): Rewrite to call
 	inform.

	* README: Updated with new postinstall stuff and interactive shell
 	mode.  Also spellchecked.  (Finally.)

	* postinstall: Big changes to shut things up unless asked.

	* bin/mj_shell (parse_command): Redo the return codes; internalize
 	exit processing.
	$user is now a package global so the completer can see it.
	Turn on autoflush.

	* lib/parser_data.pl: Add some new aliases for exiting.

	* bin/mj_shell (parse_interactive): Quit line can have spaces.

	* lib/parser_data.pl (command_property): Add copyright notice.
	(command_property): Look up properties on aliases, too.
	(commands_matching): New function to be used for completion.

Fri Aug  7 17:30:10 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (list_config_set): Restructure to call inform
 	at the end.

	* bin/mj_shell (parse_command): Say what command is illegal.

	* lib/Majordomo.pm (list_config_set): Untaint incoming config
 	variable data, and justify the security implications.

	* lib/Mj/Access.pm (list_access_check): Spruce up warning message
 	when problems are found in the eval'ed access_rules code.

	* lib/mj_cf_data.pl: Some things don't need to be visible.

Thu Aug  6 00:10:23 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* bin/mj_shell (parse_interactive): New function: interactively
 	parse command lines.  Fancy ornamentation with Term::ReadLine if
 	supported.  --noornaments flag to turn off ornamentation.
	(parse_command): If after a configedit the editor returns an
 	error, abort only after asking.

Wed Aug  5 22:33:24 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/parser_data.pl: Make 'approve' legal on the command line.

	* bin/mj_shell (parse_command): Allow password to be specified on
 	the command line using 'approve';

Tue Aug  4 13:05:57 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Parser.pm (parse_part): Could spew undef warnings of the
 	command was '=' or '-'.

	* lib/Mj/Format.pm (createlist): It's noheader, not quiet to
 	suppress headers.

	* files/en/help/admin_commands: More doc tweaks.

	* lib/Mj/Format.pm (createlist): Move a newline to pretty output a
 	bit when there's no header.

	* lib/Majordomo.pm (_createlist): Add 'ALL' functionality to
 	suggest aliases for 'ALL'.

	* lib/Mj/MTAConfig.pm: Don't take 'owner' at all; we no longer
 	need to know about it.

	* lib/Majordomo.pm (_createlist): Don't pass $owner to the
 	MTAConfig module.

Mon Aug  3 18:30:56 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm: Bump version number.

	* postinstall: Message tweak to make sure everyone knows that they
 	have to make those directories.

Sun Aug  2 12:16:34 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (_check_mime): Don't check the top level.
	(_r_ck_body): Generate more appropriate part names.

Sat Aug  1 09:28:18 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm: Bump version number.

	* lib/Mj/Resend.pm (_ck_tbody_line): Strip newlines so bounce
 	messages look right.
	(_describe_taboo): Chomp the match to keep messages looking right.
	(_r_ck_body, _check_mime): Clean up messages.

	* lib/Mj/MIMEParser.pm: New file; subclass MIME::Parser.  Globally
 	change all uses of MIME::Parser to call this instead.

	* lib/Mj/Resend.pm (_check_body): Retrieve max_mime_header_length
 	and pass to _r_ck_body.
	(_r_ck_body): Accept m_m_h_length and pass to _check_mime.  Also
 	pass the complete entity to _check_mime.
	(_check_mime): Take the full entity and m_m_h_lenght, extract the
 	MIME type and the header, and check each header for a length
 	overrun.
	
	* lib/mj_cf_data.pl: Add max_mime_header_length variable, default
 	to 128.

	* bin/mj_email: Create debugging file based on parsed options.

Thu Jul 30 22:45:01 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Access.pm (_d_post): Make sure the variable is defined
 	before comparing it to zero.

	* postinstall: Tweak response files message.

Wed Jul 29 19:37:25 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm: Bump version number in preparation for another
 	snapshot.  (Finally!)

	* files/en/help/admin_commands: Document 'force' flag to
 	createlist.

	* lib/Majordomo.pm (_createlist): Add 'force' parameter to force
 	creation/configuration even if the list already exists.

Tue Jul 28 16:37:02 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/FileRepl.pm (open): Create the original file if it
 	doesn't exist.

Mon Jul 27 23:07:12 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Access.pm (_a_default): Request_response is normally
 	allowed.

	* lib/Mj/Config.pm (set_to_default): Lock the config file; we need
 	to do this since we're modifying it.
	Add request_response as valid request.

	* lib/Majordomo.pm (list_config_set_to_default): Fix typo.
	(_request_response): Add variable substitutions.

Sun Jul 26 11:27:39 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* postinstall (set_script_perms): Make sure that when wrappers are
 	being generated the backend scripts get execute permission.

	* Makefile.PL (generate_wrappers): Don't bomb if wrappers dir
 	already exists.

	* lib/Mj/MailOut.pm (owner_start): Added owner_* triple to send a
 	message to the list owner.

	* lib/mj_cf_data.pl: Add owners variable.

	* lib/Mj/MTAConfig.pm (sendmail): Update to use new 'mj_email for
 	everything' setup.

	* lib/Majordomo.pm (connect): Added post, owner, request_response
 	dispatch functions.
	(request_response): New function to mail a file in response to a
 	mail message to the -request address.

Sat Jul 25 12:50:11 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* bin/mj_email: Begin rewrite; unify all functionality that sits
 	at an alias into mj_email.

Wed Jul 22 17:07:40 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (_createlist): Make an entry in the lists hash
 	but don't fill it in.  That way subsequent commands will see the
 	list as existing and will be able to operate on it.  The call to
 	_make_list which will happen when some other command is run will
 	actually fill in the list object.

	* lib/mj_cf_data.pl: Add new 'request_answer' variable.

Tue Jun 16 12:09:55 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* Makefile.PL (generate_wrappers): Bomb if we can't open files.

Mon Jun 15 01:43:59 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Deliver/SMTP.pm (getresp): Accept and pass on $tomult.
	(RCPT): Quintuple the timeout value.

	* lib/Mj/Deliver/Connection.pm (getline): Add timeout multiplier.

	* lib/Mj/Addr.pm (validate): Fix bug with !require_fqdn and
 	addresses with no '@'.

	* Makefile.PL: Add and rearrange a couple of prerequisites.

Sun Jun 14 01:01:36 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/File.pm (open): Allow modes beginning with 'U' to specify
 	that no locking be done.

	* lib/Mj/FileSpaceDB.pm (new), lib/Mj/AddressList.pm (new),
 	lib/Mj/SubscriberList.pm (new), lib/Mj/TokenDB.pm (new): Don't try
 	to inherit from SimpleDB.

	* lib/mj_cf_defs.pl: Default database_backend to 'text'.

	* lib/mj_cf_data.pl: New variable database_backend.

	* lib/Majordomo.pm (new), (_make_list), lib/Mj/List.pm
 	(_make_aux), (_make_fs), (_make_dup), (new), lib/Mj/TokenDB.pm
 	(new), lib/Mj/FileSpaceDB.pm (new), lib/Mj/AddressList.pm (new),
 	lib/Mj/AliasList.pm (new), lib/Mj/SubscriberList.pm (new): Deal
 	with backend.

Sat Jun 13 12:12:04 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/SimpleDB.pm: Complete revamp; all flat-file functionality
 	moved into SimpleDB::Text.  This now just acts as a converter and
 	backend selector.

	* lib/Mj/File.pm (open): Accept additional 'lock' parameter.

	* lib/Mj/SimpleDB/Text.pm: Change all functions over to using the
 	special lock files.

	* lib/Mj/FileRepl.pm (open): Accept additional 'lock' parameter
 	giving the name of the phantom lockfile.

Fri Jun 12 22:02:41 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* postinstall (install_response_files): Prompt for passwords if
 	they aren't in the configuration.
	(do_config): Ditto.

	* Makefile.PL (configure): Ask about storing passwords, and don't
 	ask for them if we're not storing them.
	(configure): Restrict permissions on .mj_config if storing
 	passwords.

Sat May 30 21:40:22 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Access.pm (_d_post): Require variables in @consult_vars
 	to be positive instead of just nonzero; this allows negative
 	severities to wipe out other severity accumulations.

	* lib/Mj/Config.pm (parse_taboo_body): Allow + or - before taboo
 	matchers.
	(parse_taboo_headers): Ditto.

Sat May 23 01:19:23 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* misc/testsmtp (putline): Fix dumb typo.

Fri May 15 15:37:53 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* postinstall (install_response_files): Hacks to allow source
 	filenames different from destination filenames, for *_noweb files.
	Add support for *_noweb files, conditional on $config->{cgi_bin}.

Thu May 14 01:22:42 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Archive.pm (add): Changed naming to more closely match
 	archive2.pl: list.YYYYMMDD-XX.

	* lib/Majordomo.pm (archive): Add stub archive entry.

	* bin/mj_shell (parse_command): Move to new mode specification.

Tue May 12 22:14:34 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Format.pm (index): Adjust output formats slightly.

	* lib/Mj/Resend.pm (_post): Pass in body_lines.

	* lib/Mj/Archive.pm: Add an additional index_field for lines in
 	the body.

	* lib/Mj/Parser.pm (parse_part): Change to allow both '=' and '-'
 	as argument/mode separators.

Sun May 10 00:33:48 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Lock.pm (unlock): OK, don't delete the lockfile since it
 	leads to catastrophic list loss on my Solaris machine.

	* lib/mj_cf_defs.pl: Remove hpc web server from the default.

	* postinstall: Properly set permissions on all installed files,
 	including lib and man.  Everything that is publically readable
 	should now have the appropriate permissions, and everything that
 	is to be secured should inherit properly from the configured
 	umask.

	* lib/Mj/Lock.pm (unlock): Turned lockfile deletion back on after
 	some serious testing; for some reason, it doesn't cause problems
 	on Linux.  More testing on Solaris to come.

Sat May  9 12:20:00 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* bin/*: Add LOCKDIR.

	* Makefile.PL (configure): Set lockdir.

	* installbin: Replace LOCKDIR.

	* postinstall (create_dirs): Make locks directory under tmpdir.

	* lib/Mj/Archive.pm: Move indices and counts into a .index
 	directory.  Create it if it doesn't exist.

	* lib/Mj/Parser.pm (parse_part): Stop on any line matching
 	\s*-+\s*.

	* lib/Mj/Deliver/Connection.pm (getline): Used unbuffered reads
 	and do our own internal buffering.

Fri May  8 00:18:51 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/mj_cf_data.pl: archive_size - get rid of lines.

	* lib/Mj/Resend.pm (_post): Pass the archive entity to the
 	archiver, not the distribution entity.

Thu May  7 00:37:20 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (post): Make sure that undef values don't get
 	into $avars.

Wed May  6 21:59:49 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (post): Pass avars to _post by joining them
 	like @reasons.  Always compute metrics and such, even if approved.
  	Don't do access_check if approved.

Tue May  5 22:41:58 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/List.pm (fs_get): Pass on all arguments.

	* lib/mj_cf_data.pl: Tweak archive_dir description.

	* lib/Mj/List.pm (_make_archive): If archive_dir is not set, see
 	if there is a /public/archive directory in the filespace and use
 	it if so.

	* lib/Mj/FileSpace.pm (get): New dir parameter; allow directories.

Mon May  4 02:10:14 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/List.pm (_make_archive): Pass archive_size, too.

	* postinstall: Print the crontab out to a file in install_dir.

	* lib/mj_cf_data.pl: Add archive_size and revise archive_split
 	description.

Sun May  3 14:49:27 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* Makefile.PL: Screwed up MIME-tools version check.

	* lib/Mj/Parser.pm (parse_part): Remove undef warning; explicitly
 	note that a list name is required if one wasn't given or shifted
 	out of the argument list.  This has a speed bonus, too, since
 	valid_list isn't called on an empty list.

	* lib/Majordomo.pm: Bumped version number; still alpha1.

	* postinstall (create_dirs): Create dirs according to the proper
 	umask; show the umask in the printed message.
	(safe_mkdir): Need to chmod again after a chown.

	* bin/mj_shell: Log the umask used.

	* postinstall (set_script_perms): Now make sure that permissions
 	on install_dir and the bin and man in there are sane.

Fri May  1 23:01:19 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (_post): Add Reply-To: headers.

	* lib/mj_cf_data.pl: Redo reply_to description.

Thu Apr 30 01:48:04 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Deliver/Dest.pm (sendenvelope): Sleep for an additional
 	random number of seconds.

	* lib/Mj/Config.pm (get): Save current time instead of on-disk
 	time as config timestamp.
	(lock): Reload the file even if the times are identical.  Since
 	the saved time is generally some time after the actual on-disk
 	time, this doesn't cause unnecessary reloads and closes a race
 	condition.

	* bin/mj_confirm: Direct warnings to STDERR instead of STDOUT,
 	where they get in the way of the HTML.

Tue Apr 28 18:28:26 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* postinstall (suggest_mta): Beautify output somewhat.

	* lib/Mj/Format.pm (createlist): Add noheader and quiet options.

	* lib/Mj/MTAConfig.pm (sendmail): Include domain information.

Tue Apr 28 17:30:58 1998  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* postinstall: Copy files into wtmpdir and make them readable
        before installing them.

Mon Apr 27 00:02:58 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* bin/mj_shell, bin/mj_email, bin/mj_trigger, bin/mj_confirm,
 	bin/mj_resend: Set umask.

	* installbin: Substitute in UMASK.

	* Makefile.PL (configure): Add umask question.

Sat Apr 25 01:46:56 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/FileRepl.pm (AUTOLOAD): Turn off logging; hundreds of
 	getlines fill the logs and are useless.

	* postinstall (create_dirs): Make the new session directory.

	* lib/Majordomo.pm (connect): Don't store sessions in the
 	filespace; store then in a separate directory.
	(s_expire): Just iterate over teh files in the directory and
 	delete the old ones; don't need to bother with the filespace.
	(sessioninfo): Don't go through the filespace.

Fri Apr 24 01:29:33 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* Release of alpha 1.

	* lib/Majordomo.pm: Bump version to alpha1.

Thu Apr 23 01:14:16 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Token.pm (t_remind): Send consult reminders to the right
 	place.

	* lib/Majordomo.pm: Bump version number.

Wed Apr 22 02:24:12 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (_r_ck_body): Fix fix error in recursive call.
  	Fix some undef errors.

Tue Apr 21 00:31:45 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (_r_ck_body, _check_header): Give info about
 	date of original when duplicates are found.

Mon Apr 20 01:54:00 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/List.pm (check_dup): Return the actual data in case of a
 	duplicate, just in case someone wants it.

	* lib/mj_cf_defs.pl: apply_global_xforms should default to 'yes'.

	* lib/Mj/List.pm (default_flags): Another dumb thinko.

Sun Apr 19 16:58:30 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/List.pm (flag_set): Fix dumb thinko.

Sat Apr 18 12:05:06 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (post): Add separate entities for notification
 	messages.  Purge all entities if not passing them on to bottom
 	half function.

Tue Apr 14 00:41:58 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/List.pm (flag_set): Look in nonmember_flags if checking
 	on a nonmember.
	(default_flags): Look in the config file instead returning
 	something hardcoded.

	* lib/mj_cf_defs.pl: Add defaults for below.

	* lib/mj_cf_data.pl: Add default_flags and nonmember_flags.

Sun Apr 12 00:03:57 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (_re_match): Prevent problems with specials in
 	matched string.

	* lib/Mj/Resend.pm (_post): Fix undef bug in subject_prefix
 	manipulation.

	* Makefile.PL (check_prereq): Print info on how to use CPAN to
 	install missing modules.

	* bin/mj_email: Don't close stderr.

	* bin/mj_trigger: Don't close stderr.

	* bin/mj_confirm: Don't close stderr.

	* bin/mj_resend: Don't close stderr.

	* installbin: Clean up pattern matches.

	* lib/Mj/Parser.pm (parse_line): Add ability to backslash lines
 	within a here document.

	* lib/Mj/Config.pm: Add new legal access variables.
	(_compile_rule): Fix dumb typo in regexp.

Sat Apr 11 20:08:26 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/mj_cf_data.pl: Tweak maxlength description.

	* lib/Mj/Access.pm (_d_post): Typo: dup_meg_id => dup_msg_id.
	(_d_post): Add checks for total_header_length_exceeded and
 	max_header_length_exceeded.

	* lib/Mj/Resend.pm (_check_header): Add header size checks.

	* lib/mj_cf_defs.pl: Added defaults for max_header_line_length and
 	max_total_header_length.

	* lib/mj_cf_data.pl: Added max_header_line_length and
 	max_total_header_length.

	* lib/Mj/Resend.pm (post): _Major_ rewrite.
	(_check_header): New function to check the header.
	(_check_body): New function to set up the body checks.
	(_r_ck_body): Recursively check the body tree.
	(_ck_theader): Check the header for taboo things.
	(_ck_tbody_line): Check a line of the body for taboo matches.
	(_check_mime): Check a body entity for bad MIME parts.
	(_describe_taboo): Generate descriptions of taboo matches and
 	update the hash of bounce variables.

	* lib/mj_cf_defs.pl: Add default for quote_regexp.

	* lib/mj_cf_data.pl: Add quote_regexp variable.

	* lib/Mj/Config.pm (parse_regexp_array): Use a Safe compartment to
 	evaluate the regexps.
	(parse_regexp): New function; check a regexp in a Safe
 	compartment.

Thu Apr  9 17:32:25 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Config.pm (new): It's 'mtime', not 'timestamp'.

Wed Apr  8 01:21:20 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* Makefile.PL (have_vers): Fix problem with not bombing on bad
 	modules when version 0 is wanted.

	* lib/Mj/Access.pm (list_access_check): Fix invalid password
 	error.

	* lib/Mj/Token.pm (consult): Fix expiry and reminder substitution
 	strings.
	(confirm): Ditto.

Tue Apr  7 18:56:09 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Token.pm (t_accept): Add necessary return values so that
 	consult and chained tokens don't generate errors in inform.

	* Makefile.PL (check_syslog): Revamp error message and return
 	false if it bombed.

Mon Apr  6 00:00:13 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Config.pm (_compile_rule): Allow the special
 	class-defined taboo and admin variables.

	* lib/Mj/Resend.pm (post): Deal with classes properly.

	* lib/Mj/Config.pm (parse_taboo_body): We were wiping out the
 	strings passed to us, causing the stored config file to lose
 	extended settings.
	(parse_taboo_headers): Ditto.

	* lib/Mj/Resend.pm (_check_taboo): Deal with classes.
	(_r_ck_taboo): Ditto.

	* lib/Mj/Config.pm (parse_taboo_body): Parse and incorporate
 	additional class argument.
	(parse_taboo_headers): Ditto.

	* postinstall: Place all temporary files in $config->{wtmpdir}
 	just in case root can't write to the build directory.

	* lib/Mj/FileSpace.pm (put): Add functionality to just create a
 	file; pass back the pathname upon success so it can be manipulated
 	elsewhere.

	* lib/Majordomo.pm (connect): Append to the session and keep it
 	open.

	* lib/Mj/Inform.pm (inform): Also log to the session.

	* postinstall (copy_file): New function.  Call copy_file to put
 	mj_confirm in the proper place if cgi_bin is set in the startup
 	configuration.

	* Makefile.PL (configure): Add questions about cgi_bin directory.

Sun Apr  5 23:59:55 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* bin/mj_shell: Removed now spurious reference to TMPDIR.

Fri Apr  3 01:26:48 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* bin/mj_shell (parse_command): Use WTMPDIR for user-owner
 	temporaries.

	* Makefile.PL (configure): Query for wtmpdir.

	* installbin: Expand WTMPDIR.

Thu Apr  2 20:18:13 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* postinstall (create_dirs): Create sessions directory so that we
 	can run mj_shell (to create the sessions directory).

	* Makefile.PL (check_prereq): Return a value indicating any
 	problems.

Wed Apr  1 00:36:00 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Format.pm (who): Pass regexp properly.

	* lib/Majordomo.pm (who_chunk): Skip addresses matching regexp.

	* lib/Mj/TextOutput.pm (who): Pass arguments in.

	* lib/Mj/Resend.pm (_post): Pass sequence number to
 	Mailout::deliver.

	* lib/Mj/MailOut.pm (deliver): Take sequence number as an
 	argument, since the confg file is unreliable at this point.

	* lib/Mj/Deliver.pm (deliver): Do extended sender manipulation if
 	asked.

	* lib/Bf/Sender.pm (M_probe_sender): Strip any existing mailbox
 	stuff before adding our own.

	* lib/Mj/MailOut.pm (deliver): Set 'manip' flag.

Tue Mar 31 01:29:20 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/List.pm: Noted places where i18n must happen.

	* lib/mj_cf_data.pl: Update docs for message_headers (add seqno)
 	and subject_prefix (add seqno and remove sender).

	* lib/Mj/Resend.pm (_post): Update the sequence number atomically.

Mon Mar 30 00:26:02 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/List.pm (config_lock): New.
	(config_unlock): New.

	* lib/Majordomo.pm (_list_config_lock): New.
	(_list_config_unlock): New.

	* lib/Mj/Config.pm (lock): New function to lock the config file.
	(unlock): Do the opposite.
	(DESTROY): Now just unlock instead of save; unlocking will
 	automatically save if needed.
	(set): Automatically lock if needed.

	* lib/Mj/TextOutput.pm (configshow): Comment out automatic
 	variables; the user can uncomment them if they really need to be
 	set manually.

	* lib/Mj/Config.pm (isauto): New function.

Sun Mar 29 01:18:50 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/List.pm (config_get_isauto): New function.

	* lib/Majordomo.pm (config_get_isauto): New function.

	* Makefile.PL (configure): Tweaked install_dir question.

	* lib/Mj/Config.pm (save): Remove ability to save old-style files.

Sat Mar 28 02:16:12 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/mj_cf_data.pl: Tweak tmpdir description.

	* Makefile.PL (configure): Add security warning about tmpdir.

	* postinstall (create_dirs): Create tmpdir.

Fri Mar 27 01:03:16 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* .cvsignore: Added some additional goodies.

	* lib/Majordomo.pm (_list_file_get): Reqrite expansion; support
 	multiple languages in search list and never search a directory
 	more than once.

	* lib/mj_cf_data.pl: Added default_language.

Thu Mar 26 00:35:48 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/SubscriberList.pm: Add new 'warnings' and 'classarg2'
 	fields, for future use.

	* lib/Majordomo.pm (_list_file_get): Tweak to search /stock/en
 	last.  No more non-language-specific stock directories.

	* lib/Mj/FileSpace.pm (mkdir): New function.
	(_find_legal_files): Tweak to not add trailing slash to
 	directories.

	* lib/Mj/List.pm (fs_mkdir): New function.

	* lib/Majordomo.pm (_put): Make directories given appropriate
 	mode.

	* lib/Mj/TextOutput.pm (put): Deal with making directories.

Tue Mar 24 00:06:36 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/SubscriberList.pm: Added password and language fields for
 	future use.

	* lib/mj_cf_data.pl: Minor doc tweaks.
	
	* lib/Majordomo.pm (help_start): Call _list_file_get to get the
 	file instead of manipulating the list directly.

Mon Mar 23 02:30:29 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/MailOut.pm (deliver): Pay attention to
 	bounce_probe_frequency and calculate buckets accordingly.

	* lib/mj_cf_data.pl: Add bounce_probe_frequency and lame
 	explanation.

	* lib/mj_cf_defs.pl: Added bounce_probe_frequency defaulting off.

Sun Mar 22 13:40:31 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (_post): Implement sequence numbering.

	* lib/Majordomo.pm (_list_config_set): New function.

	* lib/mj_cf_data.pl: Add sequence_number variable.

	* lib/mj_cf_defs.pl: Add sequence_number default to 1.

Sat Mar 21 14:20:55 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Format.pm (index): Fix a typo.

	* lib/Majordomo.pm (_list_file_get): Many changes to implement
 	enhanced search functionality.
	(list_config_set_to_default): Broken from long ago.

	* lib/mj_cf_data.pl: New description.

	* lib/Mj/Config.pm (parse_list_array): Add colon-separated
 	comment/path goody.

	* lib/Mj/Resend.pm (_post): Args to _list_file_get changed.

	* lib/Majordomo.pm (_list_file_get): New lang parameter, comes
 	_before_ force parameter.

Thu Mar 19 03:04:01 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Deliver.pm (deliver): Bunch o' changes to support bounce
 	probing.

	* lib/Mj/Deliver/Prober.pm: New file; handle bounce probes.

	* lib/Mj/MailOut.pm (mail_message): Specifically set the host.

Wed Mar 18 00:07:06 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Deliver/Dest.pm (new): Add force_single input argument;
 	ignores any batching parameters and instead uses maxaddrs=1.  Use
 	this instead of trying to build a fake ruleset.

	* lib/Mj/Deliver/QQEnvelope.pm (sender): Ditto.

	* lib/Mj/Deliver/Envelope.pm (sender): New function to set sender.

	* lib/Mj/Deliver/SMTP.pm (getresp): Recognize 452 like 552.

Mon Mar 16 02:59:40 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* bin/mj_trigger: It's the trigger, not the delivery agent.
	Make everything go to stdout.

Sun Mar 15 18:24:31 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Deliver/Dest.pm (sendenvelope): Update comments to make
 	note of ehat needs to be done to eliminate some problems.
	(openenvelope): Add super-emergency mode, try every host three
 	times before killing it, and clean up code path.

	* postinstall (suggest_crontab): Give necessary crontab entries.

Sat Mar 14 22:55:15 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Deliver/Dest.pm (openenvelope): Oops; could use zero
 	modulus.

Tue Mar 10 00:57:05 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm: Added copyright notice to all files.

Mon Mar  9 00:11:29 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/List.pm (expire_dup): New function.

	* lib/mj_cf_defs.pl: Add default dup_lifetime value of 28 days.

	* lib/mj_cf_data.pl: Add dup_lifetime variable.

	* lib/Mj/Parser.pm (parse_entity): Accept Content-Type: text along
 	with text/plain to accommodate broken Sun mailer.  Better to not
 	do this if no MIME-Version header, but that would require keeping
 	around the top-level head somewhere.

	* lib/Mj/Resend.pm (_post): Add a Sender: header.

	* lib/Majordomo.pm (accept): Construct some useful logging data
 	for nonexistant tokens.

Sun Mar  8 01:01:05 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Token.pm (confirm): Add a To: header to messages.
	(t_accept): Return 0 on nonexistant token, not -1.

	* lib/Majordomo.pm (s_expire): Fix dumb bug; we nuked the record
 	from the database, then called fs_delete on it (which failed.)

	* bin/mj_trigger: Change debugging output location.

	* lib/Mj/FileSpace.pm (mogrify): New function.

	* lib/mj_cf_defs.pl: Add default value for session_lifetime of 14
 	days.

	* lib/mj_cf_data.pl: Add session_lifetime variable.

	* lib/Mj/List.pm (fs_mogrify): New function.

Fri Mar  6 23:12:16 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/TextOutput.pm (put): Left of an argument to final Format
 	call.

	* lib/Mj/SimpleDB.pm (mogrify): Untaint the read half of the
 	FileRepl.

Mon Mar  2 01:38:32 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* bin/mj_trigger: New file; must run as majordomo user to invoke
 	trigger function.

	* lib/Mj/Log.pm (add): Couldn't set level to 0.

	* postinstall (set_script_perms): Add support for non-setid
 	scripts.

	* Makefile.PL: Add mj_trigger and support for non-wrapped scripts.

Sun Mar  1 00:51:05 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* bin/mj_resend: Add time/date output to log.

	* lib/Mj/Token.pm (t_add): Add expire and remind times.
	(consult): Purge the entity instead of unlinking the tempfile.

Sat Feb 28 16:26:58 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/TokenDB.pm: Add expire and remind fields.

	* lib/mj_cf_data.pl: confirm_url is a global because tokens are
 	global.  List owners don't have the power to add additional
 	confirmation interfaces.

Fri Feb 27 00:25:00 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Format.pm (lists): Accept and ignore the OK flag.

	* lib/Majordomo.pm (lists): Return an OK flag.

	* lib/Mj/TextOutput.pm (put): Take 'data' mode and accept
 	content-type, charset and content-transfer-encoding.

	* lib/Mj/Addr.pm: Various doc tweaks, fix left -> right, and bang
 	path regexp error.  Patch from NB.

Thu Feb 26 02:20:05 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (_put): Extract charset from $stuff, and pass
 	it into fs_put.
	(_get): Deal with charset.

	* lib/Mj/FileSpace.pm: Several changes to take, maintain and
 	return charset field.

	* lib/Mj/FileSpaceDB.pm: Add charset field.

	* lib/Mj/SimpleDB.pm (_stringify): Fix logic error.

	* lib/Mj/Token.pm (t_expire): Minor fixes; pay attention to
 	permanent flag.

Wed Feb 25 00:08:57 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Access.pm (_d_post): Implement 'administrivia' bailout.

Tue Feb 24 00:03:16 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Format.pm (showtokens): Deal with ALL; show list name
 	too.

	* lib/Majordomo.pm (_make_list): Do nothing on 'ALL'.
	(_showtokens): Tweak for ALL.
	(_list_config_get): Ditto.

	* lib/Mj/Access.pm (list_access_check): ALL -> GLOBAL.

	* lib/parser_data.pl: Allow ALL list for showtokens.

	* lib/Mj/Deliver/Envelope.pm: Tweak docs.

	* lib/Majordomo.pm: The following pain brought to you by
 	microsoft.
	(tokeninfo): Fix undef warnings if no sessionid.

	* lib/Mj/Token.pm (confirm): Nuke suggested filename.
	(consult): Ditto.
	(consult): Ditto.
	(t_accept): Ditto.

	* lib/Mj/Access.pm (_a_mailfile): Nuke suggested filename.

	* lib/Mj/MailOut.pm (welcome): Nuke suggested filename.

	* lib/Mj/Parser.pm (parse_entity): Nuke suggested filename.

	* lib/Mj/Resend.pm (post): Nuke suggested filename.

	* lib/Mj/Inform.pm (_inform_owner): Nuke suggested filename.

	* lib/Majordomo.pm (_get_mailfile): Nuke suggested filename.
	(reject): Ditto.

Mon Feb 23 00:17:44 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (_showtokens): New function.

	* lib/Mj/Format.pm (showtokens): New function.

	* lib/Mj/TextOutput.pm (showtokens): New function.

	* lib/Majordomo.pm: Add showtokens command to dispatcher.

	* lib/parser_data.pl: Add 'showtokens' command.

	* lib/Mj/TokenDB.pm: Add an additional 'reminded' field to
 	TokenDB.

Sun Feb 22 00:00:48 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (subscribe): Minor tweaks.

	* lib/Mj/Config.pm: Add showtokens as a legal request.

	* lib/Majordomo.pm (help_start): Fill out substitution hash.
	(get_done): Clear subst hash.
	(get_chunk): Make use of subst hash if it exists.
	(substitute_vars_string): Need to replace all occurrences on a
 	line.

	* lib/Mj/Format.pm (index): Tweak output a bit.
	(g_sub): Fix return value; return true if anything succeeded.

Sat Feb 21 22:28:05 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (post): Added additional logging.

Fri Feb 20 23:39:47 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/mj_cf_data.pl: Changed comments of 'description' and
 	'description_long'.

Thu Feb 19 00:15:24 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (post): Added $mime = $mime_consult ||
 	$mime_deny access variable.

	* lib/Mj/Access.pm (global_access_check): Add 'not' to permitted
 	ops list.

	* lib/Mj/Parser.pm (parse_part): Make the command count something
 	people can understand.

	* lib/Majordomo.pm (accept): Left an argument ouf of the inform
 	call.

Wed Feb 18 01:50:20 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Token.pm (confirm): Spool the message properly for
 	confirming post requests, just like we do when consulting them.

	* bin/mj_resend: Call &post with something useful as a command
 	line.

	* lib/Mj/Resend.pm (post): Properly pass the data we were called
 	with on to list_access_check so it gets into the token properly.

	* bin/mj_resend: Use message header as session data and call
 	connect properly.

	* lib/Mj/Config.pm (_compile_rule): Forgot to turn off $invert
 	after @ expansion.

	* lib/Mj/Addr.pm (validate): Special message for commas in
 	route-addrs; warn about source routes instead of multiple
 	addresses.  #17

	* lib/Mj/Format.pm (escape): New function.  #20
	(eprintf): New function.  #20
	(eprint): New function.  #20
	Change all functions to use eprint and eprintf.  #20

	* lib/Mj/Addr.pm (validate): Add .cd domain. #18

	* lib/Mj/Format.pm (show): Clean up error printing.  Need to do a
 	bunch more of this elsewhere.
	(accept): $sessionid should be $rsessionid.  #19

	* lib/Mj/Addr.pm (validate): Set $" and change some error messages
 	to show more info.  #16

	* lib/Majordomo.pm (accept): Call inform here instead.

	* lib/Mj/Token.pm (t_accept): We weren't informing about the
 	actions done because of token accepts.
	(t_accept): Changed my mind.

	* lib/Mj/Archive.pm (add): Month was one off.

	* lib/Mj/Resend.pm (_post): Actually remove prefix from subject,
 	so that the archive gets a clean version.
	(_check_approval): This is no longer unfinished.

Tue Feb 17 02:28:48 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* bin/mj_email: Call Majordomo::addr_validate instead of talking
 	to Mj::Addr.

	* lib/Majordomo.pm (addr_validate): New utility function.

	* Makefile.PL: Require MIME::Entity 4.114 because of bugs.

Mon Feb 16 00:51:20 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (substitute_vars_string): Add word boundary to
 	regex to prevent expansion of $A in $ABC.

Sun Feb 15 18:34:52 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Config.pm: Add matches_list subscribe access variable. #2

	* lib/Mj/Addr.pm (validate): Tweak an error message.

	* lib/Mj/Format.pm (reject): Add notice that notifications are
 	being sent.

	* lib/Majordomo.pm (reject): Fix lack of To: header in owner info.

	* t/addr.t: New test; exercise the address parser. #4

	* Makefile.PL (configure): Changed wrapper prompt to something
 	truthful.

Fri Feb 13 02:27:24 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/List.pm (new): Take an address validator and pass it into
 	the Mj::Config::new.
	Lots of changes to call $self->{'av'}->validate.

	* lib/Mj/Config.pm (new): Take an address validator object.
	(parse_address): Make use of it.

Thu Feb 12 03:07:49 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Addr.pm (addr_validate): Added logic to check for
 	excessively long user and host names and for illegal characters in
 	either.

Wed Feb 11 01:16:03 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Parser.pm (parse_line): Nuke tabs in command line input.

Mon Feb  9 01:03:56 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Inform.pm (inform): Don't bother with 'reject' actions.

	* lib/Majordomo.pm (reject): Also send session data to list owner
 	and majordomo-owner, depending on their inform settings.

Sun Feb  1 00:11:02 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (sessioninfo): New function; give back the
 	stored session data for a sessionid.

	* lib/Mj/Format.pm (reject): Take and print out sessionid.
	(accept): Take and print out sessionid.

	* lib/Mj/Token.pm (t_add): Write out sessionid.
	(confirm): Add sessionid expansion token.
	(consult): Add optional sessionid argument.
	(t_accept): Pass sessionid along for chained consults.
	(t_accept): Pass out sessionid to the calling function.

	* lib/Mj/TokenDB.pm: Added sessionid field.

	* lib/Mj/Config.pm (_compile_rule): Tweak comparison recognizer.
	(_compile_rule): Even more tweaks to the comparison recognizer.

Sat Jan 31 23:49:18 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Config.pm (parse_taboo_body): If the line limit is 0, we
 	would always fail taboo matches.
	(_compile_rule): Fully support numeric comparisons.

	* lib/Mj/Access.pm (global_access_check): Added extra ops for
 	comparison to @permitted_ops.

Wed Jan 28 02:24:47 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Config.pm (parse_access_rules): Check for legal %requests
 	and %actions.
	Added %actions.
	(_compile_rule): Use new %requests structure.

Tue Jan 27 00:27:26 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Config.pm: Fleshed out %requests hash.

	* lib/Mj/Resend.pm (post): Add some extra access variables.

Mon Jan 26 23:40:18 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/MailOut.pm (welcome): OWNER should refer to the list
 	owner, not the majordomo owner.

Sun Jan 25 00:01:13 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/TextOutput.pm (createlist): Place header and body in the
 	proper order.

	* lib/Majordomo.pm (createlist): Return messages in the proper
 	position.

	* lib/Mj/MTAConfig.pm (sendmail): Removed extra space from
 	returned messages.

	* lib/Majordomo.pm (_global_config_get): Remove old majordomo.cf
 	hack.

	* lib/Mj/Config.pm (get): Tweaked to return a defined value when
 	defaulting.

	* lib/Mj/Parser.pm (parse_part): Tweak so that args is never
 	passed as a read-only value.

	* lib/parser_data.pl: new* are not obsolete any longer.

	* lib/Mj/FileSpace.pm (put_start): Return some additional errors
 	for nonexistent directories.

	* lib/Mj/Resend.pm (_r_ck_taboo): Clean up debugging crap.

	* lib/Mj/Config.pm (parse_string_2darray): Tweak to fix undefined
 	warnings.

	* lib/Mj/TextOutput.pm (put): Decide just how many arguments we
 	are going to pass into the internal put routine.

	* lib/Mj/Format.pm: Added routines to feed newinfo, newintro and
 	newfaq into put.  Made put special case some files to output
 	different messages.

Sat Jan 24 01:28:30 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Format.pm (index): Various tweaking.

	* lib/Mj/Parser.pm (parse_entity): Modified to look for text part
 	types case-insensitively, and to report ignored parts instead of
 	ignoring them.

	* lib/Mj/Access.pm (_a_default): Modified *_access targets to look
 	for a 'root' parameter and always deny if present.  This locks out
 	non-passworded access to all but the public filespaces.  Also
 	changed get and index to set and pass in this parameter.

	* lib/Majordomo.pm (faq_start): Lots of new functions to support
 	the faq command.

	* lib/Mj/TextOutput.pm (index): Yet another new function.

	* lib/Mj/Format.pm (index): Pretty-print indices.

	* lib/Majordomo.pm (index): Internal index support.

	* lib/Mj/List.pm (fs_index): New function.

	* lib/Mj/FileSpace.pm (index): New function to prepare an index.

	* lib/Majordomo.pm: Several new functions to support info, intro,
 	get (with file mailout and immediate mode).
	
	* lib/Mj/Format.pm (g_get): Generic way to handle info, intro,
 	help.

	* lib/Mj/TextOutput.pm (createlist): Properly default $owner.

	* lib/Mj/Access.pm (_a_default): Fix list access for GLOBAL.

	* lib/Majordomo.pm (dispatch): Add get to dispatch array.

	* lib/Mj/Format.pm (get): Format the get thing.

	* lib/Mj/TextOutput.pm (get): Do the get thing.

	* lib/Majordomo.pm (get_start): New set of functions to handle
 	file retrieval.

Fri Jan 23 01:27:38 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Token.pm (t_remove): Force deletion of spooled files.

	* lib/Mj/Resend.pm (_post): Add force parameter when retrieving
 	spooled files.

	* lib/Majordomo.pm (_list_file_get): Add force parameter.

	* lib/Mj/Token.pm (consult): put spool files without read
 	permission.  They should be security protected.

	* lib/Majordomo.pm (help_start): Clean up.

	* DESIGN: Fixed some typos and corrected a few things.

	* lib/Mj/TextOutput.pm (createlist): Clean up output a bit.

	* bin/mj_confirm: Make it work again.  Add a few goodies and some
 	comments.

	* lib/Mj/Token.pm (t_info): Rewrite to preserve interface
 	boundary.

Thu Jan 22 00:29:02 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Access.pm (_d_subscribe): open+confirm would consult.
  	Oops.

	* bin/mj_email: Log properly to a handle when requested.

	* lib/Mj/Log.pm (message): Put PID in handle output.

Wed Jan 21 01:43:19 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* postinstall (do_config): Removed debugging switches.  Oops.

Tue Jan 20 23:34:54 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (post): Properly ack denials if an appropriate
 	flag is set.

	* lib/Mj/Access.pm (_d_post): New function; provide default action
 	for posting.
	(_a_deny): Return better default message for post action.
	(list_access_check): Bugfig: pass %args to access function.

Sun Jan 18 12:35:54 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (_r_ck_taboo): Renamed from _check_taboo_1 to
 	quiet autosplit.

Sat Jan 17 00:55:21 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Config.pm (parse_attachment_rules): New function.
	(parse_attachment_rules): Return default values at end of list.

	* lib/Mj/Access.pm (_d_advertise): Fixed a couple of bugs.

	* lib/Majordomo.pm (_re_match): Now return any errors encountered
 	during the match if wanted so that the routine can be used as a
 	regexp syntax checker.

Sun Jan 11 01:54:38 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (_add_fters): New function; add fronters and
 	footers.
	(_add_fters): Get rid of X-Mailer in fters.
	(_add_fters): Make sure we have a text/plain part before we mess
 	with it.
	(_add_fters): Frequencies are now percentages; this makes more
 	sense and is simpler to write.

	* lib/Mj/Config.pm (parse_string_2darray): New routine to parse
 	footers and fronters (and possibly other things).

	* Makefile.PL: Now require MIME-tools 4.109 (for deep copy).

Fri Jan  9 00:19:28 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (_check_approval): Fix lower bounds on preamble
 	search.

	* lib/Mj/Deliver.pm (_re_match): Put back in.

	* Makefile.PL: Require MIME-tools 4.107.

	* lib/Mj/Resend.pm (_trim_approved): Call seek properly, call the
 	proper config_get routine.
	(_trim_approved): Fix more typos.

	* bin/mj_resend: Pass full arg list to post();

	* lib/Mj/Resend.pm (_check_approval): Take care of newlines at the
 	end of Approved: lines.
	(post): Now takes full argument list.

	* lib/Mj/Access.pm (validate_passwd): Called canon with the wrong
 	list.

Thu Jan  8 20:29:29 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (_trim_approved): New function: extract
 	approved message from approval message.
	(_post): Call _trim_approved.

Wed Jan  7 00:03:52 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (tempname): New function; generate a unique
 	temporary filename.

Mon Jan  5 00:56:30 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Resend.pm (post): Now use severity values for taboo
 	failures.  Can't use them in the access language yet, though.
	(_check_approval): Do more extensive approval checks.

Fri Jan  2 00:37:41 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Token.pm (t_add): The database remove must come last,
 	else we have to save its output.  We need to return this to the
 	calling routine, and the unspooling was hosing that return value.
  	I had weird problems with this in the past for reasons I could
 	never pin down, but it seems to be OK now.
	
Thu Jan  1 15:14:25 1998  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (_createlist): New function.
	(createlist): Split off bottom half; do proper security checks.

	* lib/Mj/Format.pm (createlist): New function.

	* lib/Mj/TextOutput.pm (createlist): Rewrite.

	* lib/Mj/Format.pm (indicate): Fixed * -> - mixup.

Wed Dec 31 19:21:07 1997  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm (_rekey): New.
	(rekey): Do real access checks.

	* lib/Mj/Access.pm (_d_advertise): New function.
	(_a_default): Now does what it's supposed to.

	* lib/Mj/Deliver.pm (deliver): No need to share $addr with the
 	Safe compartment.

	* lib/Majordomo.pm (_re_match): Moved from Deliver.pm; it's useful.

Sat Dec 20 00:45:03 1997  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/TextOutput.pm (lists): Move everything to Format.

	* lib/Mj/Format.pm (lists): New function.

	* lib/Mj/TextOutput.pm (help): Rewrite.

	* lib/Mj/Format.pm (help): New function.

	* lib/Mj/TextOutput.pm (post): Rewrite.

	* lib/Mj/Format.pm (post): New function.

Thu Dec 18 00:44:19 1997  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* Makefile.PL: Require new MIME-tools versions.

	* lib/Mj/Format.pm (put): New function.

Wed Dec 17 00:43:51 1997  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Token.pm (t_accept): Use different approval message when
	request is 'post'.

Mon Dec 15 01:52:47 1997  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Deliver/SMTP.pm (enddata): Send an extra line ending if
	we didn't send one as part of the data.

	* lib/Mj/List.pm (flag_set): Fix typos and warnings.

	* lib/Majordomo.pm (accept): Fix tainting issue with tokens.

	* lib/Mj/Token.pm (consult): Don't add info about the bounce
	reasons if they are none; doing so resulted in a newline in the
	headers.  Bad.

	* lib/Mj/Format.pm (set): Fix undef warning.

	* lib/Mj/List.pm (set): Fixed up messages.

Sun Dec 14 13:27:58 1997  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Token.pm (t_accept): Reorganize and add replyfile
	functionality for chained tokens.

	* lib/Mj/Access.pm (list_access_check): Now track a default
	replyfile and use it if no reply string is specified.
	(_a_conf_cons): Use 4th chain arg as replyfile.

	* lib/Majordomo.pm: Bumped version for internal snapshot.

	* lib/Mj/Format.pm (prepend): New function.
	(indicate): New function.
	(accept): Use them.
	Convert all functions to use them.

	* lib/Mj/Access.pm (_a_replyfile): New function.

Sat Dec 13 15:41:49 1997  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Access.pm (list_access_check): Allow + as _ in actions.

Thu Dec 11 23:25:02 1997  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Token.pm (t_accept): Big fix; now send results of consult
	tokens to the victim.

	* lib/Mj/Format.pm (accept): Add some logging; special case
	acceptance of consult tokens.

	* lib/Mj/Inform.pm (_inform_owner): Purge the entity to get rid of
	tempfile droppings.

Tue Dec  9 01:36:14 1997  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Token.pm: token routines take four chain fields now.

	* lib/Mj/Format.pm (g_sub): reorg.

	* lib/Majordomo.pm (accept): vict -> victim.

	* lib/Mj/Token.pm (consult): Fixed bugs; got rid of extra
	$requester variable.  (Why was it there?)

	* lib/Mj/TokenDB.pm: Changed field order.

Mon Dec  8 00:50:23 1997  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Config.pm (parse_table): Compress multiple blank lines
	for multiline elements.

	* lib/Majordomo.pm (reject): Return the extracted token.

	* lib/Mj/TextOutput.pm (reject): Rewrite; call format function.

	* lib/Mj/Config.pm (parse_inform): Added reject as
	inform-by-default.

	* lib/Mj/Format.pm (reject): New function.

	* lib/Mj/Token.pm (t_reject): Removed quiet flag; we go through
	the dispatcher now, so we have the generic noinform mode.

	* lib/Majordomo.pm (reject): New function.

1997-12-07  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/TextOutput.pm (rekey): Cleanup and call formatter.

	* lib/Mj/Format.pm (rekey): New function.

	* lib/Mj/TextOutput.pm (set): Cleanup and call formatter.

	* lib/Mj/Format.pm (set): New function.

1997-12-06  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Format.pm (show): New function.

	* lib/Mj/TextOutput.pm (unalias): Cleanup and call formatting
	function.
	(show):  Cleanup and call formatter.

	* lib/Mj/Format.pm (unalias): New function.

	* lib/Mj/TextOutput.pm (auxwho): Cleanup and call format function.
	(which): Cleanup.
	(who): Cleanup.
	(unsubscribe): Cleanup.

	* lib/Majordomo.pm (auxwho_start): Add check for legal sublist name.

	* lib/Mj/Format.pm (auxwho): New function.

	* lib/Mj/TextOutput.pm (auxunsubscribe): Cleanup.
	(auxsubscribe): Cleanup.
	(alias): Cleanup.

	* lib/Mj/Config.pm (parse_restrict_post): Fixed undefined value
	warning.

	* lib/Mj/TextOutput.pm (g_add): Call into formatting routine
	instead of doing it ourselves.
	(g_add): Handle both arglist and argfile in one loop.  No code
	duplication!
	(g_remove): Call into formatting routine, plus various changes to
	make this possible.

	* lib/Mj/Format.pm (g_sub): Duh.  ARRAY instead of LIST.

1997-12-05  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm: Now handles caching old password values and
	incorporating new passwords properly.  Install on home development
	machine works now.

1997-12-04  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/Access.pm (_build_passwd_data): Take $force flag.

	* lib/Mj/Config.pm (rebuild_passwd): New routine.
	(parse_list_array): New routine.
	(set): Call rebuild_passwd as necessary to handle password
	changes.
	(parse_passwords): Return rebuild flag.

Wed Dec  3 01:54:36 1997  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Mj/TextOutput.pm (auxunsubscribe): Modernized logging.

	* lib/Majordomo.pm (_unsubscribe): Removed inform calls.
	(unsubscribe): Removed inform calls.
	(_subscribe): Ditto.
	(subscribe): g.

Mon Dec  1 01:37:51 1997  Jason L Tibbitts  <tibbs@morpheus.hpc.uh.edu>

	* lib/Majordomo.pm: Got rid of some apostrophes in pods do satisfy
	emacs highlighting.

Thu Oct 16 02:27:48 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Mj/Format.pm (accept): Use three stored args from the
		  token.

	* lib/Majordomo.pm (accept): Return the three stored arguments.

	* lib/Mj/TextOutput.pm: Convert to Format functions with three
		  free parameters.

	* lib/Mj/Format.pm: Convert to three free parameters.

Tue Oct 14 01:50:39 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Mj/TextOutput.pm (which): Now prepare args, call core, and
		  format.

	* lib/Majordomo.pm (which): Completely rewritten; now implement
		  all functionality internally.

	* lib/Mj/List.pm (search): IMPORTANT: search now returns key/data
		  pairs, not just matching keys.

Sun Oct 12 01:49:08 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Majordomo.pm (accept): New function; internaliaze some of
		  the acceptance routine.  Update dispatcher to handle
		  it.

	* lib/Mj/Token.pm (token_accept): Modify to handle new accept
		  sequence.

	* postinstall: Hack: skip MTA suggestions if no STDIN.

	* lib/Mj/TextOutput.pm: Removed more 8 char clashes.

	* lib/Mj/Format.pm: New file: core return formatting functions.

Sat Oct 11 22:52:49 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* Makefile.PL: Clean up @SCRIPTS, @EXES declaration just for fun.

Fri Oct 10 20:55:46 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* Makefile.PL (MY::postamble): Add install->postinstall
		  dependency.

	* postinstall (suggest_mta): New function.

Wed Oct  8 00:02:24 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* Makefile.PL: Data::ShowTable 3.3 is now required.

	* lib/Majordomo.pm (dispatch): Pass additional data to inform
		  routine.

	* lib/Mj/Inform.pm (inform): Added passworded and interface log
		  items.

	* bin/mj_confirm: Added rudimentary docs to keep build process
		  quiet.

	* lib/Mj/Access.pm: Adjusted many function names to stay within
		  the stupid 8 character uniqueness limit.

	* lib/Mj/TextOutput.pm (help): Fix to get list value from
		  dispatcher.
	
	* lib/Majordomo.pm (help_chunk): Fix to return OK flag so the
		  dispatcher can deal with it.

Tue Oct  7 02:00:05 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Mj/TextOutput.pm (put): Use dispatcher and put_*.

	* lib/Majordomo.pm: Rename list_file_put_* to put_*.  Made
		  dispatcher aware of this.

Sun Oct  5 01:19:50 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Mj/TextOutput.pm: Adjust all routines to deal with
		  dispatcher.

	* lib/Majordomo.pm (dispatch): New function: dispatcher.
	adjust all routines to deal with dispatcher.

Tue Sep 30 23:16:48 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Mj/TextOutput.pm (help): downcase the topics.

Mon Sep 29 00:37:53 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Mj/Inform.pm (inform): Add override parameter.

Fri Sep 26 19:01:25 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* bin/mj_shell (parse_command): Fix typo.

	* Makefile.PL: Piles of additions to deal with wrappers.

	* installbin: Don't substitute vars in the wrappers.

Sun Sep 21 19:34:44 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* bin/mj_shell (parse_command): Provide default for EDITOR.

	* lib/Majordomo.pm (createlist): Added nocreate mode; just
		  suggests configuration.
		  (createlist): Error out if list already exists.
		  (createlist): Fix some more bugs.

	* lib/Mj/Config.pm: Removed visible tag from some variables that
		  should not be visible.

Sat Sep 20 12:09:37 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Mj/Addr.pm (addr_validate): Force items on rhs of stripped
		  address to lower case.  (Can't do this for the lhs,
		  though.)

	* lib/Mj/Config.pm (intro): varlabie -> variable

Mon Sep 15 21:25:18 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* bin/mj_shell (parse_command): Error out if no command was
		  given.

Sun Sep 14 22:51:15 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Majordomo.pm (list_config_set): Slight tweak to failed
		  password message.

	* postinstall (install_response_files): Take advantage of file
		  parsing and multiple -f arguments.
		  (do_config): Take advantage of file parsing.

Sat Sep 13 22:09:50 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* bin/mj_shell: new -F option to parse many commands from a file,
		  and major code cleanup.
		  Now using Getopt::Long.

Fri Sep 12 00:23:56 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Mj/Access.pm (list_access_check): Change in behavior: if a
		  password is given, it _must_ be valid.

	* lib/Majordomo.pm (createlist): Incorrectly called
		  global_access_check.
		  Various other global_access_check screwups.

	* lib/parser_data.pl: Enabled help command.

	* lib/Mj/TextOutput.pm (help): New help command.

	* lib/Majordomo.pm (help_start): New function - help retrieval.
	(help_chunk): New function.
	(help_done): New function.

	* lib/mj_cf_data.pl: Message_fronter -> message_fronter.
	mumbatches -> numbatches.
	Better description of 'global' attribute.

	* lib/Mj/Parser.pm (parse_part): Tiny == -> = bug.

Thu Sep 11 00:49:01 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Mj/TextOutput.pm (post): New interface to iterative
		  posting.

	* lib/Mj/Resend.pm (post_start): New function- iterative posting.
	(post_chunk): New function.
	(post_done): New function.
	(post): Fixed access check and removed warnings.

Wed Sep 10 00:51:19 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Majordomo.pm (who_start): Add functionality to show hidden
		  addreses with who if approved.

Tue Sep  9 00:17:25 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/mj_cf_data.pl: Improved docs for inform variable.

	* lib/Majordomo.pm (_alias): Fixed error return.

	* lib/Mj/List.pm (alias_add): Fixed error return.

	* lib/Mj/Access.pm (list_access_check): Moved come config variable
		  retrievals farther down, so they don't have to be done
		  if a password is given.

	* t/shell.t: Added tests for auxlists and configset.

Mon Sep  8 16:38:54 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Mj/TextOutput.pm (configset): Added filehandle input method.
	
	* lib/Mj/Config.pm (parse_inform): Now uses 'report' instead of
		  'log'.  Everything gets logged.

	* lib/Majordomo.pm (who_start): Added calls to inform.
	(who_done): Added call to inform.
	(lists): Added calls to inform.
	(unsubscribe): Split out bottom half, added inform calls.

	* lib/mj_cf_defs.pl: Changed default for sender.

	* lib/Mj/MailOut.pm (welcome): Expand variables in descriptions
		  and subjects.
		  (welcome): Fixed bugs in variable expansion.

	* lib/Mj/Inform.pm (_inform_owner): left $list off of
		  list_config_get.
	
Sat Sep  6 14:36:50 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/mj_cf_data.pl: new variable 'inform'.

	* lib/Mj/Config.pm (parse_inform): New function to parse inform
		  variable.
	
	* postinstall (set_script_perms): Rearrange chown and chmod to
		  hopefully fix Linux problems.

Fri Sep  5 00:34:11 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Majordomo.pm: Released version 0199709050.

Sun Aug 24 00:06:55 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Mj/Config.pm: Allowed undef for many variables.
	(parse_address): Look up domain and tack it on if necessary.
	(parse_address_array): Call parse_address to do work.

	* bin/mj_email: Add MIME-Version header to toplevel if necessary.
	
	* lib/Mj/Deliver/Dest.pm: Documented most of the class data.

Sat Aug 23 00:28:52 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* bin/mj_email: Now log to STDERR if it's a terminal.  Call
		  mail_message instead of dealing with the Envelope
		  manually.
	
	* t/shell.t: renamed from basics.t.  Added several more tests.

Fri Aug 22 01:02:49 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* Makefile.PL: Dumb formatting changes.

	* lib/Mj/Config.pm: Fixed up several config data references.

	* lib/Mj/TextOutput.pm (configset): Fix undef warning.

	* lib/Mj/List.pm (_file_path): Moved up before END token.

	* postinstall (rchown): New function.  Do chown -R, basically.
	(set_script_perms): Use it on install_dir, else we can't do the
		configset later on.

Thu Aug 21 16:50:42 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Mj/List.pm: Removed references to _build_digest_data.  Use
		  parsed version from config instead.

	* postinstall: Set owner/group before mode; Linux requires this.
	
	* lib/Mj/Config.pm: Finished most of parsing rewrite; now in
		  testing.
	
Sun Aug 17 13:28:47 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Mj/Access.pm (list_access_check): Ripped out all of rule
		  compilation stuff.  Now gets data pre-parsed from the
		  list config.
	
Fri Aug 15 00:53:53 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Mj/Config.pm: Parsing/syntax-checking rewrite started.

	* lib/Mj/Parser.pm (parse_part): Set $mode to '' if not defined to
		  prevent lots of undef warnings.

	* lib/Mj/Log.pm (abort): Set CarpLevel so that we complain about
		  where we were called.

	* bin/mj_email: Added UID and GID checks.  Got rid of extra flag
		  on Majordomo allocation.
	

Thu Aug 14 21:34:48 1997  Jason L Tibbitts III  <tibbs@hpc.uh.edu>

	* lib/Majordomo.pm: Released version 0.0199708140.

	* TASKS: Added info on MTAConfig module.

	* BUGS: The race condition in SimpleDB seems to be history.

	* Makefile.PL (configure): Mention createlist command for
		  conversion.
	
	* lib/Majordomo.pm (legal_list_name): Made legal_list_name take
		  periods, but not '.' and '..'.

	* README (Note): Added warning about setuid not working on broken
		  systems.
	
	* Makefile.PL: Added require to check for 5.00401.  Removed prereq
		  check and special code to check perl version.
