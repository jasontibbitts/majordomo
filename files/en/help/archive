= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
archive-delete[-hidden][-force]    listname filespec
archive-get[-immediate][-hidden]   listname filespec
archive-get-digest[-mime][-hidden] listname filespec
archive-index[-hidden]             listname filespec
archive-stats[-hidden]             listname filespec
archive-summary                    listname
archive-sync                       listname pattern
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
listname, required, is the name of a regular list at this site
filespec, required, is a single value or range of values (see below)
pattern,  required, is a single value or pattern matching archive file names
-hidden, if specified, displays only hidden messages (admins only)
= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

The archive command is used to retrieve posted messages that have been
sent to a mailing list.  It also offers two special command modes
("delete" and "sync") that allow list administrators to alter the
contents of the archives.  All of the other command modes are
potentially available to both subscribers and administrators.  Each
command mode is detailed in a separate section of this document.

In the examples that follow, where you see LISTNAME, instead use the 
name of an actual mailing list.

Most of the commands use a flexible but complicated file specification
syntax ("filespec").  The filespec allows you to indicate exactly which
messages you wish to see.  The filespec syntax is discussed, with
examples, in the last section of this document.

In addition, a here document can be used to specify patterns which limit
the scope of the messages retrieved by the archive command.  Each
pattern should be preceded by a "~s" to search the subjects of messages,
and a "~a" to search the addresses of the people who posted the
messages.  For example, the following command would match messages that
were posted in the year 2001 and have the word "Unknown" in the subject 
header:

archive-index LISTNAME 2001 <<ABCD
  ~s/Unknown/
ABCD

Only messages that match all of the patterns will be retrieved.  See
"help here_document" and "help patterns" for more details on here
documents and pattern matching.

List archives may be organized by year, month, week, or day, at the
discretion of the list owners. The configuration of the list does not
affect the use of "archive" commands, but refer to "help index" and
"help get" for other ways to directly access the archive files without
using "archive-index" and "archive-get".  List owners can limit access
to the archives with the archive_access configuration setting.

Messages sent to auxiliary lists are also archived, and made available
using the archive-get command with an extra argument.  Examples are
shown in the filespec section.

                             archive-summary

The archive-summary command is used to see which archives are available
for a mailing list.  It is usually similar to the 

  index LISTNAME archive

command, but it also displays the number of messages, lines, and bytes
in each archive file.  This command does not take a filespec or other
argument at the moment.  Just use

  archive-summary LISTNAME


                              archive-index

The archive-index command is used to see a summary of individual
messages within an archive.  The details in the summary usually include
the message number and date, the e-mail address of the author, the
subject of the message, and the size of the message in kilobytes.  The
message number of each message can be used in the filespec to retrieve
messages individually.

The archive message number indicates the count of the message within a
particular archive file.  For example, 200101/12 means the 12th message
in the January, 2001 archive.  Administrators should note that this is
not the same as the sequence number of the message.  For example, a
sequence number of 85 means that this is the 85th message ever posted to
the mailing list (see "help configset_sequence_number" for a more
thorough explanation.)

                               archive-get

The archive-get command is used to retrieve the actual contents of
posted messages.  If the "get" command mode is used by itself, each
message that is retrieved will be mailed to you, just as if you had
received it when it was first delivered to the mailing list.  List
administrators can use this in combination with the "default user"
command to resend messages to individual subscribers who wish to receive
a new copy.

If the archive-get-immediate command is used, all of the messages will
cause all messages to be sent within one message, exactly as they are
stored in the archive, with all message headers intact.

The archive-get-digest or archive-get-digest-mime command will cause
messages to be bundled into digests, typically with no more than 1000
lines in each digest.  Usually, a plain text digest is sent, but "mime"
mode will cause the messages to be bundled into MIME digests, in which
each message is a separate attachment.

                              archive-stats

The archive-stats command is used to get a sorted report of the number
of messages posted by each address to a mailing list for the messages
specified by "filespec". For instance, to find out who posted most often
on a mailing list during September 2000, use this command:

  archive-stats LISTNAME 200009


                 archive-delete (for administrators only)

The archive-delete option takes the usual arguments: dates, message
counts, message numbers, and combinations thereof.   It is possible to
delete all of the archives for a mailing list with one command, and a
message can be prevented from appearing in a digest by deleting it.  Use
the archive-index command before running the archive-delete command if
you wish to verify which messages will be deleted.  If you wish to
delete a recent message from the archives, but want to make sure that
all digests containing the message have been sent, use the
"digest-status" command to examine the state of the digests.  See 
"help digest" for more details.

Example:
  digest-status LISTNAME ALL

If you attempt to delete a message that has not yet been delivered in a
digest, that message will not be removed unless you use the "force"
command mode.

Example:
  archive-delete-force LISTNAME 200107/14

After one or more messages have been deleted, the numbers of the
remaining messages are not changed. For example, if message number
200008/2 were deleted,  200008/1 and 200008/3 would be the first two
messages in the August 2000 archive.  Deleting a message causes the
index and count files to be updated automatically, so "archive-sync" is
not needed after "archive-delete".

Messages that are posted by people with the "hidepost" setting will
be marked as hidden, and an "X-no-archive: yes" header will be added to
those messages.  In addition, messages that match the patterns in
the noarchive_body and noarchive_headers configuration settings will
receive the same treatment.  If the "hidden" command mode is used, only
messages that are marked as hidden will be deleted.  The hidden command
mode also applies to the archive-get and archive_index commands.  An
administrative password is required to use it.

The message archives are used by the delivery system to construct
message digests.  If an attempt is made to delete a message that
is awaiting delivery as part of a digest, it will not be removed unless
the "force" command mode is also used.

                  archive-sync (for administrators only)

The archive-sync command allows list administrators to upload old
archives, or to replace existing archives, after the archive files have
been changed using the put command.

Only use "archive-sync" when you have manually edited a file at the
operating system level. You may also have to delete old archive database
files and strip special lines out of the archive to make this work. For
expert use only! Back up your directories before attempting to use this
option.

The archive-sync command takes one argument, which must be the
date of a particular archive file or a Majordomo pattern matching
one or more archive files (see "help patterns").  For example,
  archive-sync LISTNAME 200005
would synchronize the May 2000 archive databases with the
messages themselves.  

Alternately, if you have a bunch of files to process at once, you can
specify a pattern and all files matching that pattern will be
synchronized.  For example,

  archive-sync LISTNAME /19991/

would synchronize the October, November, and December 1999 archives.
The archive names against which the pattern is matched may be seen using
the archive-summary command.

In the file system, all archive file names must begin with the list
name, and the list name should NOT be included in the "filespec" field.
This is important to remember if you upload archives into the archive
directory using the put command.

When using archive-sync, any message without an X-Archive-Number header
will be given a new number, one greater than the highest number in the
archive, and a new header.  Any archive number that does not correspond
to the archive in question will be replaced by one that does (in this
way, it is possible to combine archives).



                      The file specification syntax


The "filespec" needed for these "archive" commands can take various
forms, and examples of each are shown below:
  count
  date
  date/message_number
  auxlist.date
  auxlist.date/message_number
  filespec1 - filespec2

The "count" form gets the number of messages you ask for, ending with
the last message posted to the list.

Dates can be specified in several formats, as detailed in the "Time
Stamp" section of "help times".

Within each archive, each message will have a number, and that number
must be used to retrieve a single message. Without it, you can retrieve
messages covering a range of dates but cannot select a single message.

The "filespec1 - filespec2" form MUST have spaces on each side of the
dash, and the two filespec fields can be any of the other forms. When a
dash is used, all messages in the range specified are processed. See the
examples below for additional notes on range usage and interactions
between the two fields of the range.

Example 1: "filespec" is a simple message count (not often used)
    archive-index test 20
  would retrieve an index of the last 20 messages sent to the "test" list,
    archive-get test 20
  would retrieve the twenty messages themselves.

Example 2: "filespec" is a date (usually used with -index, not -get)
    archive-index test 1999
  shows all messages in all of the 1999 archives of the "test" list.
    archive-get test 199903
  retrieves all messages in the March 1999 archive of the "test" list.
    archive-index test 19990305
  shows only messages posted on the "test" list the day of 5 March 1999.
  (Refer to "help times" for details of the date field syntax.)

Example 3: "filespec" includes a message number (from "archive-index")
    archive-get test 199903/4
  retrieves the 4th message in the March 1999 archive of the "test" list.

Example 4: "filespec" includes an auxiliary list
    archive-get test bugs.199903
  retrieves all messages in the March 1999 archive of the auxiliary list
  "bugs" of the main list "test".

Example 5: "filespec" includes an auxiliary list AND a message number
    archive-get test bugs.199903/4
  retrieves the 4th in the March 1999 archive of the auxiliary list
  "bugs" of the main list "test".

Example 6: "filespec1 - filespec2" includes a range of dates
    archive-get almond 20000205 - 20000207
  would retrieve all messages distributed on the "almond" list
  during the 5th, 6th, and 7th of February, 2000.
  WARNING: "20000205-20000207" will NOT WORK - you must include spaces!

Example 7: "filespec1 - filespec2" has decreasing "count" fields
    archive-index lime 15 - 3
  would retrieve an index of the 15 messages immediately preceding
  the 3rd most recent message sent to the "lime" list. This unusual
  result happens because the last field of the range (3) indicates the
  range ends with the 3rd most recent post. The start of the range,
  as with a single message count, counts backwards from the end.

Example 8: "filespec1 - filespec2" has a message number and a count
    archive-get lemon 200001/3 - 15
  will retrieve the third message in the January, 2000, archive of
  the "lemon" list, and 14 messages FOLLOWING it, even if those
  messages are found in other archives, such as February 2000, or
  later. Note that the count field does NOT go back in time from
  the date field, but goes forward instead!

Example 9: "filespec1 - filespec2" has a count and then a date field
    archive-index tangerine 10 - 1998
  would retrieve an index of the LAST TEN messages posted to the
  "tangerine" list during 1998.

Example 10: "filespec1 - filespec2" has a date and then a count field
    archive-index tangerine 1998 - 10
  would retrieve an index of the FIRST TEN messages posted to the
  "tangerine" list during 1998.

The index and get commands may not allow archive retrieval if "configset
archive_dir" is set to somewhere outside the list's file space, but they
may work if the file system permissions are set appropriately. Contact
your system administrator if you get messages like "permission denied".

Mail headers can be used by people who post messages to a mailing list
to indicate that they do not wish the message to be displayed in a
public archive.  Majordomo honors the following two headers by default:

  X-no-archive: yes
  Restrict: no-external-archive

Additional headers can be supported by changing the noarchive_headers
configuration setting; see "help configset_noarchive_headers" for
more details.


See Also:
   help access_variables (set/test for this command)
   help configset archive_dir (to store archives in a non-default dir)
   help configset archive_access (to restrict access to these files)
   help configset archive_index  (to restrict indexing of these files)
   help get   (which may be used in some cases to retrieve archives)
   help here_document
   help index (which may be used to show which archives are available)
   help filespecs (for majordomo filespecs that apply ONLY to -sync)
   help patterns
   help put   (which is used to create the archive directory)
   help times (for how to specify time stamps)

For a list of all help topics send this one-line message
   help topics
to the server at $MJ
