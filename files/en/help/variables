                 Substitution variables and file templates

When Majordomo sends a reply message in response to a request, the document
that it sends is usually a template.  The template may have one or more 
keyword variables, for which Majordomo automatically substitutes the 
appropriate value.  Majordomo variables, for the purpose of message 
or file substitution, are upper case words with a leading dollar sign.

For example, when you use the command
   help overview
The first line of the template says
   An Overview of Majordomo 2, version \$VERSION
However, what you see on your screen is
   An Overview of Majordomo 2, version $VERSION

Majordomo automatically substitutes the version number for the 
VERSION keyword variable.

The most important use of variable substitutions is in the faq, info, and
intro files that are available through the commands with the same names.

Substitution variables are not the same as access rule variables.
See "help access_variables" for more information about access variables.

As an example of a variable, using this string in a file
  \$MJ
will cause the the address of the majordomo email interface to be
inserted before the user sees the file contents.

You must watch out for lines that get too long when the string
(or the contents of a file) replaces the variable name you type.

There are some cases where some variables are undefined... so the
user may see the actual variable name if you use a variable in the
wrong place. The most problematic variable in this respect is
"\$VICTIM", which is descriptive but may cause minor panic.

The \$INCLUDE variable is a special case, not mentioned in the per-file
list below, but available in many cases when other variable substitution
is present! Documents may be combined 'on the fly' using \$INCLUDE
to insert other files as they are sent out. You can nest
includes 3 levels deep, so an included file can include another
file. More than 3 levels of nesting is taken to be an infinite loop,
and the inclusion is terminated with an error message.

If you use \$INCLUDE, the syntax is different than other variables.
This variable MUST be followed with a dash and then the path to the
file you want to include.  Nothing can follow the file name. For example
  \$INCLUDE-help/topics
will pull the contents of "help topics" into your current file,
usually from the SITE/files/en/help directory. This variable should
be used only by skilled administrators, and only with full testing
before the files are released. It is especially critical to test
error messages, which may be hard to simulate.  See "help reply_files"
for more information about which files support the \$INCLUDE variable.

If you misspell a variable, or use one that is not defined,
it will show up in the mail message exactly as you typed it (dollar
sign and all), so watch for these and be aware that unevaluated
variables do not cause errors to be logged.

You can keep variable evaluation from happening by escaping the
dollar sign with a backslash, as in
  \\$MAJORDOMO
which will appear as simply "\$MAJORDOMO" to the user.

In addition, the text can be padded and justified, as illustrated
in this example:
  \$LIST:-18 X \$COMMAND:11

The name of the mailing list is padded with spaces to at least 18 characters
and left-justified.  The command is padded to at least 11 characters and
right-justified.  If the mailing list name is "aardvark" and the command
is "subscribe" then this line would be displayed as
  aardvark           X   subscribe           

Padding in this manner is very useful for commands, such as who-enhanced,
that display a table of data with each column aligned properly.

See "help get" and "help put" for information on how to see, change,
or create the error, format, and reply files that use these substitutions.

Standard substitution variables
-------------------------------

There is a set of standard substitutions, that apply to most
of the Majordomo error, format, and reply files.  Their names and values
(in the context of the GLOBAL list) are shown in the following list.  Naturally, 
some of the variables (LIST, OWNER, REQUEST, SUBLIST, and WHOAMI)
will vary depending upon the mailing list.

\$CONFIRM_URL $CONFIRM_URL
  (The location of the WWW interface for token confirmation)

\$DOMAIN      $DOMAIN
  (The name of the current domain, as determined at installation time)

\$LIST        $LIST
  (The name of the current mailing list, or GLOBAL)

\$MJ          $MJ
  (The e-mail address of the majordomo server)

\$MAJORDOMO   $MAJORDOMO
  (The e-mail address of the majordomo server)

\$MJOWNER     $MJOWNER
  (The e-mail address of the administrator of this domain)

\$OWNER       $OWNER
  (The e-mail address of the administrator of the current mailing list)

\$PWLENGTH    $PWLENGTH     
  (The minimum length of a new password.  See "help password" and 
   "help admin_passwords" for details.)

\$REQUEST     $REQUEST   
  (The "request" address for a mailing list)

\$SITE        $SITE
  (The name of this site)

\$SUBLIST     $SUBLIST
  (An auxiliary list, if one is used.  See "help auxiliary_list" for details.)

\$UCLIST      $UCLIST
  (The name of the current mailing list, in capital letters)

\$VERSION     $VERSION
  (Which version of Majordomo 2 is used at this site.)

\$WHEREAMI    $WHEREAMI
  (The name of the current domain.)

\$WHOAMI      $WHOAMI
  (The list address, or the Majordomo server address in a GLOBAL context.)

\$WWWADM_URL  $WWWADM_URL
  (The location of the WWW interface for list administrators)

\$WWWUSR_URL  $WWWUSR_URL
  (The location of the WWW interface for list subscribers)

Other variables
---------------

In time, a complete list of the other substitutions supported by 
the error, format, and reply files will be presented here.

See "help error_files" for a description of each of the error files.
See "help format_files" for a description of each of the format files.
See "help reply_files" for a description of each of the reply files.

\$APPROVALS
  The number of people who must use the accept command to approve
  a stalled request.

\$ARCHIVE
  The archive name of a posted message, for example "200008".
  This is not the same as the sequence number;  see "help archive"
  for more details.

\$ARCURL
  The URL that allows access to an external archive.  This value is
  determined by the archive_url configuration setting;  see 
  "help configset_archive_url" for more information.

\$AUTHOR_NEXT
\$AUTHOR_PREV
\$DATE_NEXT
\$DATE_PREV
\$NUMERIC_NEXT
\$NUMERIC_PREV
\$SUBJECT_NEXT
\$SUBJECT_PREV
\$THREAD_NEXT
\$THREAD_PREV
  These substitutions contain the message numbers of the next and
  previous messages within a mailing list archive, depending upon
  the order in which the messages are sorted.

\$CAN_READ
  This boolean variable is true if the person making a request has
  permission to use the archive command for a particular mailing
  list.

\$CGIDATA
  A supplementary part of the URL of the current CGI script, for use
  in the web interfaces when the URL is used in an anchor 
  ("<a href=...>").

\$CGIURL
  The URL of the current CGI script, when one of the web interfaces
  is being used.

\$CMDLINE
  The command line that would be used to issue a command via e-mail
  or the mj_shell program.

\$CMDPASS
  The password with which the current command was issued.

\$CONSULT
  " " if the type of a stalled command is "consult"; '' otherwise.
  "consult" means that the moderators must confirm the command.

\$DATE
  The date at which a request was originally issued;  in some cases
  this may be the Date header from a posted message.

\$EXPIRE   
  The number of days before a request that has been stalled expires, or
  in some cases the date at which it will expire.  This value is
  determined by the token_lifetime configuration setting 
  (see "help configset_token_lifetime" for details).

\$ERROR
  An error message which describes why a command failed.

\$FULFILL
  The date at which a delayed request will be completed
  (see "help delay" for more information).

\$HOST
  The host from which a posted message is distributed to the subscribers
  of a mailing list.  This value comes from the resend_host configuration
  setting (see "help configset_resend_host" for more details).

\$ISPOST
  " " if a token refers to a stalled posted message; '' if a token
  refers to a Majordomo command.

\$MSGNO
  The archive name and number of a posted message, for example
  "200008/12".  This is not the same as the sequence number.  
  See "help archive" for more details.

\$PASSWORD
  The personal password corresponding to a particular e-mail address.

\$REMIND 
  The number of days before a reminder for a request that requires
  confirmation, is sent to the person whom the request affects.
  This value is determined by the token_remind configuration setting
  (see "help configset_token_remind" for details).

\$REASONS
  The reasons, supplied by the access rules, that a request was denied
  or stalled (see "help configset_access_rules" for more details).

\$REQUESTER
  The e-mail address from which a Majordomo request was sent.

\$SENDER
  The e-mail address from which a posted message was sent, or the
  envelope address used by a mailing list to deliver messages to the
  subscribers.

\$SEQNO
  The sequence number of a message posted to a mailing list.  This
  value comes from the sequence_number configuration setting (see
  "help configset_sequence_number" for more information).

\$SUBJECT
  The Subject header of a posted message.

\$SUBLIST
  The name of the auxiliary list to which a command applies (see
  "help auxiliary_list" for more information).

\$SUBSCRIBED
  If a message was posted by a subscriber to the mailing list, this
  value is empty.  If not, it is the word "not".

\$TOKEN
  The twelve-character identifier that is used to accept or reject
  a stalled command (see "help tokeninfo" for more information.)

\$TYPE
  The type of a stalled command, such as "confirm" if the person
  affected by the request must confirm the command, or "consult" if 
  the moderators must confirm the command.

\$URL
  Identical to \$CONFIRM_URL

\$USER
  The e-mail address from which a Majordomo request was originally sent.
  (this needs to be reconciled with \$REQUESTER)

\$VICTIM 
  The e-mail address of the person affected by a Majordomo command.

\$WILLACK
  " " if an acknowledgement message will be mailed if a token is
  accepted or rejected; '' otherwise.


Extensions for error and format files
-------------------------------------

Beyond the standard reply files, Majordomo comes with error and format
files that determine the output of the individual Majordomo commands.
Error files are used to display explanations when a command is 
incorrect, not permitted, or otherwise unavailable.  Format files
display the output of the individual commands, and vary depending
upon the interface.  Currently, the e-mail and mj_shell interfaces
use the "text" format files, whereas the web interfaces use
the "wwwadm" and "wwwusr" format files.

There are three extensions to the substitutions which are used
by the error and format files. 

1. A keyword variable prefixed with a question mark instead of a dollar
sign will cause the whole line to be omitted from the output
if the value is not set.

Example:
  The archive is available on the web at ?ARCURL


2. A substitution value that is actually an array of values will
cause the same line to be displayed multiple times, once for
each value in the array.  Other substitutions on the same line, which
only have one value, will be displayed only on the first line.

Example:
  \$LIST:-23 $DESCRIPTION

(This example is used by the lists command to display a list name and
a multiple-line description of the mailing list.  Although the list name 
only appears on the first line, a 23 space indentation appears on each 
succeeding line, which keeps the lines of the description aligned with
one another.)

3. The special \$HELP substitution, following by a colon and the name 
of a help page (in upper-case letters), will cause a hypertext link 
to that page to appear in the output of the WWW interfaces.  In the text 
formatting files, the variable is simply replaced by the name of the 
page, in lower-case letters.

Example:
  You may change your delivery class using the \$HELP:SET command.


See Also:
   help access_variables (for access_rules variables)
   help configset_access_rules  (for mailfile and deny usage)
   help configset_welcome_files (for additional files that can be sent)
   help digest                  (for additional file names and usage)
   help error_files
   help format_files
   help get                     (obtain existing files)
   help put                     (create or update files by email)
   help reply_files

$INCLUDE-help/foot
